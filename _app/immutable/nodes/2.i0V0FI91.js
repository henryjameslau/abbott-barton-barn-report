import{t as Pa,a as Fr,c as Ul,d as eu}from"../chunks/DQZC0xAn.js";import"../chunks/BC74cwy0.js";import{h as ko,ap as sf,aq as af,ar as nf,as as of,a6 as lf,a4 as cf,v as Ao,at as Zl,au as Nr,av as ql,w as uu,x as zo,g as Xt,a3 as ca,a5 as jr,f as yi,y as du,z as pu,t as xn,aw as hu,a9 as id,A as Ea,ax as tu}from"../chunks/B9xGxy6i.js";import{h as uf}from"../chunks/Cw_ioqh_.js";import{p as lt,i as rd,b as hf,s as df,a as pf}from"../chunks/CdEH34GP.js";import{s as Gl}from"../chunks/BGseuEJq.js";import{i as Eo}from"../chunks/BclMnI8D.js";import{c as sd,o as $l,a as ad,w as ff}from"../chunks/BRWZnJpP.js";const Wh=[...` 	
\r\fÂ \v\uFEFF`];function mf(Me,ne,xe){var pe=""+Me;if(xe){for(var Ie in xe)if(xe[Ie])pe=pe?pe+" "+Ie:Ie;else if(pe.length)for(var Ae=Ie.length,Qe=0;(Qe=pe.indexOf(Ie,Qe))>=0;){var u=Qe+Ae;(Qe===0||Wh.includes(pe[Qe-1]))&&(u===pe.length||Wh.includes(pe[u]))?pe=(Qe===0?"":pe.substring(0,Qe))+pe.substring(u+1):Qe=u}}return pe===""?null:pe}function Xh(Me,ne=!1){var xe=ne?" !important;":";",pe="";for(var Ie in Me){var Ae=Me[Ie];Ae!=null&&Ae!==""&&(pe+=" "+Ie+": "+Ae+xe)}return pe}function gf(Me,ne){if(ne){var xe="",pe,Ie;return Array.isArray(ne)?(pe=ne[0],Ie=ne[1]):pe=ne,pe&&(xe+=Xh(pe)),Ie&&(xe+=Xh(Ie,!0)),xe=xe.trim(),xe===""?null:xe}return String(Me)}function _f(Me,ne,xe,pe,Ie,Ae){var Qe=Me.__className;if(ko||Qe!==xe||Qe===void 0){var u=mf(xe,pe,Ae);(!ko||u!==Me.getAttribute("class"))&&(u==null?Me.removeAttribute("class"):Me.className=u),Me.__className=xe}else if(Ae&&Ie!==Ae)for(var We in Ae){var Y=!!Ae[We];(Ie==null||Y!==!!Ie[We])&&Me.classList.toggle(We,Y)}return Ae}function iu(Me,ne={},xe,pe){for(var Ie in xe){var Ae=xe[Ie];ne[Ie]!==Ae&&(xe[Ie]==null?Me.style.removeProperty(Ie):Me.style.setProperty(Ie,Ae,pe))}}function yf(Me,ne,xe,pe){var Ie=Me.__style;if(ko||Ie!==ne){var Ae=gf(ne,pe);(!ko||Ae!==Me.getAttribute("style"))&&(Ae==null?Me.removeAttribute("style"):Me.style.cssText=Ae),Me.__style=ne}else pe&&(Array.isArray(pe)?(iu(Me,xe==null?void 0:xe[0],pe[0]),iu(Me,xe==null?void 0:xe[1],pe[1],"important")):iu(Me,xe,pe));return pe}const xf=Symbol("is custom element"),vf=Symbol("is html");function Yh(Me,ne,xe,pe){var Ie=bf(Me);ko&&(Ie[ne]=Me.getAttribute(ne),ne==="src"||ne==="srcset"||ne==="href"&&Me.nodeName==="LINK")||Ie[ne]!==(Ie[ne]=xe)&&(ne==="loading"&&(Me[sf]=xe),xe==null?Me.removeAttribute(ne):typeof xe!="string"&&wf(Me).includes(ne)?Me[ne]=xe:Me.setAttribute(ne,xe))}function bf(Me){return Me.__attributes??(Me.__attributes={[xf]:Me.nodeName.includes("-"),[vf]:Me.namespaceURI===af})}var Jh=new Map;function wf(Me){var ne=Jh.get(Me.nodeName);if(ne)return ne;Jh.set(Me.nodeName,ne=[]);for(var xe,pe=Me,Ie=Element.prototype;Ie!==pe;){xe=of(pe);for(var Ae in xe)xe[Ae].set&&ne.push(Ae);pe=nf(pe)}return ne}function If(Me,ne,xe){var pe=lf(Me,ne);pe&&pe.set&&(Me[ne]=xe,cf(()=>{Me[ne]=null}))}function nd(Me){return Me&&Me.__esModule&&Object.prototype.hasOwnProperty.call(Me,"default")?Me.default:Me}var Nl={exports:{}},Sf=Nl.exports,Hh;function Tf(){return Hh||(Hh=1,function(Me,ne){(function(xe,pe){Me.exports=pe()})(Sf,function(){var xe,pe,Ie;function Ae(u,We){if(!xe)xe=We;else if(!pe)pe=We;else{var Y="var sharedChunk = {}; ("+xe+")(sharedChunk); ("+pe+")(sharedChunk);",pt={};xe(pt),Ie=We(pt),typeof window<"u"&&(Ie.workerUrl=window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"})))}}Ae(["exports"],function(u){function We(i,e,s,n){return new(s||(s=Promise))(function(l,p){function f(w){try{x(n.next(w))}catch(S){p(S)}}function m(w){try{x(n.throw(w))}catch(S){p(S)}}function x(w){var S;w.done?l(w.value):(S=w.value,S instanceof s?S:new s(function(C){C(S)})).then(f,m)}x((n=n.apply(i,e||[])).next())})}function Y(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var pt=yt;function yt(i,e){this.x=i,this.y=e}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,s=i.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),s=Math.sin(i),n=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=n,this},_rotateAround:function(i,e){var s=Math.cos(i),n=Math.sin(i),l=e.y+n*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-n*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(i){return i instanceof yt?i:Array.isArray(i)?new yt(i[0],i[1]):i};var _e=Y(pt),rt=wt;function wt(i,e,s,n){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=s,this.p2y=n}wt.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,n=0;n<8;n++){var l=this.sampleCurveX(s)-i;if(Math.abs(l)<e)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=l/p}var f=0,m=1;for(s=i,n=0;n<20&&(l=this.sampleCurveX(s),!(Math.abs(l-i)<e));n++)i>l?f=s:m=s,s=.5*(m-f)+f;return s},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var at=Y(rt);let Se,Ve;function st(){return Se==null&&(Se=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Se}function ht(){if(Ve==null&&(Ve=!1,st())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let n=0;n<5*5;n++){const l=4*n;e.fillStyle=`rgb(${l},${l+1},${l+2})`,e.fillRect(n%5,Math.floor(n/5),1,1)}const s=e.getImageData(0,0,5,5).data;for(let n=0;n<5*5*4;n++)if(n%4!=3&&s[n]!==n){Ve=!0;break}}}return Ve||!1}function Ot(i,e,s,n){const l=new at(i,e,s,n);return function(p){return l.solve(p)}}const vt=Ot(.25,.1,.25,1);function qt(i,e,s){return Math.min(s,Math.max(e,i))}function Pi(i,e,s){const n=s-e,l=((i-e)%n+n)%n+e;return l===e?s:l}function jt(i,...e){for(const s of e)for(const n in s)i[n]=s[n];return i}let Pt=1;function ft(i,e,s){const n={};for(const l in i)n[l]=e.call(s||this,i[l],l,i);return n}function wi(i,e,s){const n={};for(const l in i)e.call(s||this,i[l],l,i)&&(n[l]=i[l]);return n}function Ct(i){return Array.isArray(i)?i.map(Ct):typeof i=="object"&&i?ft(i,Ct):i}const ji={};function nt(i){ji[i]||(typeof console<"u"&&console.warn(i),ji[i]=!0)}function Dt(i,e,s){return(s.y-i.y)*(e.x-i.x)>(e.y-i.y)*(s.x-i.x)}function Ii(i){let e=0;for(let s,n,l=0,p=i.length,f=p-1;l<p;f=l++)s=i[l],n=i[f],e+=(n.x-s.x)*(s.y+n.y);return e}function Li(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let dt=null;function Sr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function fi(i,e,s,n,l){return We(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const f=p==null?void 0:p.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const m=f.startsWith("BGR"),x=new Uint8ClampedArray(n*l*4);if(yield p.copyTo(x,function(w,S,C,A,P){const D=4*Math.max(-S,0),B=(Math.max(0,C)-C)*A*4+D,U=4*A,G=Math.max(0,S),Q=Math.max(0,C);return{rect:{x:G,y:Q,width:Math.min(w.width,S+A)-G,height:Math.min(w.height,C+P)-Q},layout:[{offset:B,stride:U}]}}(i,e,s,n,l)),m)for(let w=0;w<x.length;w+=4){const S=x[w];x[w]=x[w+2],x[w+2]=S}return x}finally{p.close()}})}let Di,Nt,ui,pr;const Tr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,s.drawImage(i,0,0,i.width,i.height),s},resolveURL:i=>(ui||(ui=document.createElement("a")),ui.href=i,ui.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(pr==null&&(pr=matchMedia("(prefers-reduced-motion: reduce)")),pr.matches)}},Ur={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class rr extends Error{constructor(e,s,n,l){super(`AJAXError: ${s} (${e}): ${n}`),this.status=e,this.statusText=s,this.url=n,this.body=l}}const Ui=Li()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Fi=i=>Ur.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function le(i,e){const s=new AbortController,n=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Ui(),signal:s.signal});let l=!1,p=!1;return i.type==="json"&&n.headers.set("Accept","application/json"),p||fetch(n).then(f=>f.ok?(m=>{(i.type==="arrayBuffer"||i.type==="image"?m.arrayBuffer():i.type==="json"?m.json():m.text()).then(x=>{p||(l=!0,e(null,x,m.headers.get("Cache-Control"),m.headers.get("Expires")))}).catch(x=>{p||e(new Error(x.message))})})(f):f.blob().then(m=>e(new rr(f.status,f.statusText,i.url,m)))).catch(f=>{f.code!==20&&e(new Error(f.message))}),{cancel:()=>{p=!0,l||s.abort()}}}const je=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Li()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Li())return(Fi(i.url)||le)(i,e)}if(!(/^file:/.test(s=i.url)||/^file:/.test(Ui())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return le(i,e);if(Li()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var s;return function(n,l){const p=new XMLHttpRequest;p.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(p.responseType="arraybuffer");for(const f in n.headers)p.setRequestHeader(f,n.headers[f]);return n.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=n.credentials==="include",p.onerror=()=>{l(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let f=p.response;if(n.type==="json")try{f=JSON.parse(p.response)}catch(m){return l(m)}l(null,f,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else{const f=new Blob([p.response],{type:p.getResponseHeader("Content-Type")});l(new rr(p.status,p.statusText,n.url,f))}},p.send(n.body),{cancel:()=>p.abort()}}(i,e)},Ce=function(i,e){return je(jt(i,{type:"arrayBuffer"}),e)};function me(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),s=window.location;return e.protocol===s.protocol&&e.host===s.host}function be(i,e,s){s[i]&&s[i].indexOf(e)!==-1||(s[i]=s[i]||[],s[i].push(e))}function ye(i,e,s){if(s&&s[i]){const n=s[i].indexOf(e);n!==-1&&s[i].splice(n,1)}}class Oe{constructor(e,s={}){jt(this,s),this.type=e}}class Je extends Oe{constructor(e,s={}){super("error",jt({error:e},s))}}class mt{on(e,s){return this._listeners=this._listeners||{},be(e,s,this._listeners),this}off(e,s){return ye(e,s,this._listeners),ye(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},be(e,s,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,s){typeof e=="string"&&(e=new Oe(e,s||{}));const n=e.type;if(this.listens(n)){e.target=this;const l=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const m of l)m.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const m of p)ye(n,m,this._oneTimeListeners),m.call(this,e);const f=this._eventedParent;f&&(jt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof Je&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const sr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mr(i,e){const s={};for(const n in i)n!=="ref"&&(s[n]=i[n]);return sr.forEach(n=>{n in e&&(s[n]=e[n])}),s}function Wt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let s=0;s<i.length;s++)if(!Wt(i[s],e[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const s in i)if(!Wt(i[s],e[s]))return!1;return!0}return i===e}const Lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zr(i,e,s){s.push({command:Lt.addSource,args:[i,e[i]]})}function js(i,e,s){e.push({command:Lt.removeSource,args:[i]}),s[i]=!0}function es(i,e,s,n){js(i,s,n),Zr(i,e,s)}function Da(i,e,s){let n;for(n in i[s])if(Object.prototype.hasOwnProperty.call(i[s],n)&&n!=="data"&&!Wt(i[s][n],e[s][n]))return!1;for(n in e[s])if(Object.prototype.hasOwnProperty.call(e[s],n)&&n!=="data"&&!Wt(i[s][n],e[s][n]))return!1;return!0}function Us(i,e,s,n,l,p){let f;for(f in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,f)&&(Wt(i[f],e[f])||s.push({command:p,args:[n,f,e[f],l]}));for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(Wt(i[f],e[f])||s.push({command:p,args:[n,f,e[f],l]}))}function ds(i){return i.id}function Is(i,e){return i[e.id]=e,i}class ze{constructor(e,s,n,l){this.message=(e?`${e}: `:"")+n,l&&(this.identifier=l),s!=null&&s.__line__&&(this.line=s.__line__)}}function qr(i,...e){for(const s of e)for(const n in s)i[n]=s[n];return i}class ni extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class Ss{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[n,l]of s)this.bindings[n]=l}concat(e){return new Ss(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ts={kind:"null"},Pe={kind:"number"},xt={kind:"string"},ct={kind:"boolean"},Ji={kind:"color"},Gr={kind:"object"},gt={kind:"value"},is={kind:"collator"},V={kind:"formatted"},k={kind:"padding"},z={kind:"resolvedImage"},L={kind:"variableAnchorOffsetCollection"};function j(i,e){return{kind:"array",itemType:i,N:e}}function Z(i){if(i.kind==="array"){const e=Z(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ee=[ts,Pe,xt,ct,Ji,V,Gr,j(gt),k,z,L];function X(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!X(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const s of ee)if(!X(s,e))return null}}return`Expected ${Z(i)} but found ${Z(e)} instead.`}function $(i,e){return e.some(s=>s.kind===i.kind)}function K(i,e){return e.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function ce(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const ue=.96422,fe=.82521,He=4/29,ot=6/29,Ze=3*ot*ot,et=ot*ot*ot,ut=Math.PI/180,Vt=180/Math.PI;function Gt(i){return(i%=360)<0&&(i+=360),i}function Et([i,e,s,n]){let l,p;const f=Zi((.2225045*(i=zt(i))+.7168786*(e=zt(e))+.0606169*(s=zt(s)))/1);i===e&&e===s?l=p=f:(l=Zi((.4360747*i+.3850649*e+.1430804*s)/ue),p=Zi((.0139322*i+.0971045*e+.7141733*s)/fe));const m=116*f-16;return[m<0?0:m,500*(l-f),200*(f-p),n]}function zt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Zi(i){return i>et?Math.pow(i,1/3):i/Ze+He}function Yt([i,e,s,n]){let l=(i+16)/116,p=isNaN(e)?l:l+e/500,f=isNaN(s)?l:l-s/200;return l=1*Bi(l),p=ue*Bi(p),f=fe*Bi(f),[xi(3.1338561*p-1.6168667*l-.4906146*f),xi(-.9787684*p+1.9161415*l+.033454*f),xi(.0719453*p-.2289914*l+1.4052427*f),n]}function xi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Bi(i){return i>ot?i*i*i:Ze*(i-He)}function Cr(i){return parseInt(i.padEnd(2,i),16)/255}function Po(i,e){return Zs(e?i/100:i,0,1)}function Zs(i,e,s){return Math.min(Math.max(e,i),s)}function qs(i){return!i.some(Number.isNaN)}const Wl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ut{constructor(e,s,n,l=1,p=!0){this.r=e,this.g=s,this.b=n,this.a=l,p||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[e,s,n,l]))}static parse(e){if(e instanceof Ut)return e;if(typeof e!="string")return;const s=function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Wl[n];if(l){const[f,m,x]=l;return[f/255,m/255,x/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const f=n.length<6?1:2;let m=1;return[Cr(n.slice(m,m+=f)),Cr(n.slice(m,m+=f)),Cr(n.slice(m,m+=f)),Cr(n.slice(m,m+f)||"ff")]}if(n.startsWith("rgb")){const f=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,x,w,S,C,A,P,D,B,U,G,Q]=f,W=[S||" ",P||" ",U].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const te=[w,A,B].join(""),re=te==="%%%"?100:te===""?255:0;if(re){const de=[Zs(+x/re,0,1),Zs(+C/re,0,1),Zs(+D/re,0,1),G?Po(+G,Q):1];if(qs(de))return de}}return}}const p=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,m,x,w,S,C,A,P,D]=p,B=[x||" ",S||" ",A].join("");if(B==="  "||B==="  /"||B===",,"||B===",,,"){const U=[+m,Zs(+w,0,100),Zs(+C,0,100),P?Po(+P,D):1];if(qs(U))return function([G,Q,W,te]){function re(de){const Re=(de+G/30)%12,Ge=Q*Math.min(W,1-W);return W-Ge*Math.max(-1,Math.min(Re-3,9-Re,1))}return G=Gt(G),Q/=100,W/=100,[re(0),re(8),re(4),te]}(U)}}}(e);return s?new Ut(...s,!1):void 0}get rgb(){const{r:e,g:s,b:n,a:l}=this,p=l||1/0;return this.overwriteGetter("rgb",[e/p,s/p,n/p,l])}get hcl(){return this.overwriteGetter("hcl",function(e){const[s,n,l,p]=Et(e),f=Math.sqrt(n*n+l*l);return[Math.round(1e4*f)?Gt(Math.atan2(l,n)*Vt):NaN,f,s,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Et(this.rgb))}overwriteGetter(e,s){return Object.defineProperty(this,e,{value:s}),s}toString(){const[e,s,n,l]=this.rgb;return`rgba(${[e,s,n].map(p=>Math.round(255*p)).join(",")},${l})`}}Ut.black=new Ut(0,0,0,1),Ut.white=new Ut(1,1,1,1),Ut.transparent=new Ut(0,0,0,0),Ut.red=new Ut(1,0,0,1);class vn{constructor(e,s,n){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class La{constructor(e,s,n,l,p){this.text=e,this.image=s,this.scale=n,this.fontStack=l,this.textColor=p}}class qi{constructor(e){this.sections=e}static fromString(e){return new qi([new La(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof qi?e:qi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class fr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof fr)return e;if(typeof e=="number")return new fr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new fr(e)}}toString(){return JSON.stringify(this.values)}}const Xl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof kr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let s=0;s<e.length;s+=2){const n=e[s],l=e[s+1];if(typeof n!="string"||!Xl.has(n)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new kr(e)}}toString(){return JSON.stringify(this.values)}}class Ri{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ri({name:e,available:!1}):null}}function Fa(i,e,s,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,s,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,s,n]:[i,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ut||i instanceof vn||i instanceof qi||i instanceof fr||i instanceof kr||i instanceof Ri)return!0;if(Array.isArray(i)){for(const e of i)if(!Gs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Gs(i[e]))return!1;return!0}return!1}function ii(i){if(i===null)return ts;if(typeof i=="string")return xt;if(typeof i=="boolean")return ct;if(typeof i=="number")return Pe;if(i instanceof Ut)return Ji;if(i instanceof vn)return is;if(i instanceof qi)return V;if(i instanceof fr)return k;if(i instanceof kr)return L;if(i instanceof Ri)return z;if(Array.isArray(i)){const e=i.length;let s;for(const n of i){const l=ii(n);if(s){if(s===l)continue;s=gt;break}s=l}return j(s||gt,e)}return Gr}function Ft(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ut||i instanceof qi||i instanceof fr||i instanceof kr||i instanceof Ri?i.toString():JSON.stringify(i)}class Ts{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Gs(e[1]))return s.error("invalid value");const n=e[1];let l=ii(n);const p=s.expectedType;return l.kind!=="array"||l.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(l=p),new Ts(l,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class oi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ba={string:xt,number:Pe,boolean:ct,object:Gr};class Ar{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let n,l=1;const p=e[0];if(p==="array"){let m,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Ba)||w==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);m=Ba[w],l++}else m=gt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}n=j(m,x)}else{if(!Ba[p])throw new Error(`Types doesn't contain name = ${p}`);n=Ba[p]}const f=[];for(;l<e.length;l++){const m=s.parse(e[l],l,gt);if(!m)return null;f.push(m)}return new Ar(n,f)}evaluate(e){for(let s=0;s<this.args.length;s++){const n=this.args[s].evaluate(e);if(!X(this.type,ii(n)))return n;if(s===this.args.length-1)throw new oi(`Expected value to be of type ${Z(this.type)}, but found ${Z(ii(n))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const bn={"to-boolean":ct,"to-color":Ji,"to-number":Pe,"to-string":xt};class ps{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const n=e[0];if(!bn[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return s.error("Expected one argument.");const l=bn[n],p=[];for(let f=1;f<e.length;f++){const m=s.parse(e[f],f,gt);if(!m)return null;p.push(m)}return new ps(l,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let s,n;for(const l of this.args){if(s=l.evaluate(e),n=null,s instanceof Ut)return s;if(typeof s=="string"){const p=e.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(n=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Fa(s[0],s[1],s[2],s[3]),!n))return new Ut(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new oi(n||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const n of this.args){s=n.evaluate(e);const l=fr.parse(s);if(l)return l}throw new oi(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const n of this.args){s=n.evaluate(e);const l=kr.parse(s);if(l)return l}throw new oi(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const n of this.args){if(s=n.evaluate(e),s===null)return 0;const l=Number(s);if(!isNaN(l))return l}throw new oi(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return qi.fromString(Ft(this.args[0].evaluate(e)));case"resolvedImage":return Ri.fromString(Ft(this.args[0].evaluate(e)));default:return Ft(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Do=["Unknown","Point","LineString","Polygon"];class wn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=Ut.parse(e)),s}}class Ra{constructor(e,s,n=[],l,p=new Ss,f=[]){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=p,this.errors=f,this.expectedType=l,this._isConstant=s}parse(e,s,n,l,p={}){return s?this.concat(s,n,l)._parse(e,p):this._parse(e,p)}_parse(e,s){function n(l,p,f){return f==="assert"?new Ar(p,[l]):f==="coerce"?new ps(p,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[l];if(p){let f=p.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,x=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(m.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(m,x))return null}else f=n(f,m,s.typeAnnotation||"coerce");else f=n(f,m,s.typeAnnotation||"coerce");else f=n(f,m,s.typeAnnotation||"coerce");else f=n(f,m,s.typeAnnotation||"assert")}if(!(f instanceof Ts)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const m=new wn;try{f=new Ts(f.type,f.evaluate(m))}catch(x){return this.error(x.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,n){const l=typeof e=="number"?this.path.concat(e):this.path,p=n?this.scope.concat(n):this.scope;return new Ra(this.registry,this._isConstant,l,s||null,p,this.errors)}error(e,...s){const n=`${this.key}${s.map(l=>`[${l}]`).join("")}`;this.errors.push(new ni(n,e))}checkSubtype(e,s){const n=X(e,s);return n&&this.error(n),n}}class Oa{constructor(e,s,n){this.type=is,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return s.error("Collator options argument must be an object.");const l=s.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,ct);if(!l)return null;const p=s.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,ct);if(!p)return null;let f=null;return n.locale&&(f=s.parse(n.locale,1,xt),!f)?null:new Oa(l,p,f)}evaluate(e){return new vn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const fs=8192;function In(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ua(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Lo(i,e){const s=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(s*l*fs),Math.round(n*l*fs)]}function Yl(i,e,s){const n=i[0]-e[0],l=i[1]-e[1],p=i[0]-s[0],f=i[1]-s[1];return n*f-p*l==0&&n*p<=0&&l*f<=0}function Sn(i,e){let s=!1;for(let f=0,m=e.length;f<m;f++){const x=e[f];for(let w=0,S=x.length;w<S-1;w++){if(Yl(i,x[w],x[w+1]))return!1;(l=x[w])[1]>(n=i)[1]!=(p=x[w+1])[1]>n[1]&&n[0]<(p[0]-l[0])*(n[1]-l[1])/(p[1]-l[1])+l[0]&&(s=!s)}}var n,l,p;return s}function Tn(i,e){for(let s=0;s<e.length;s++)if(Sn(i,e[s]))return!0;return!1}function Fo(i,e,s,n){const l=n[0]-s[0],p=n[1]-s[1],f=(i[0]-s[0])*p-l*(i[1]-s[1]),m=(e[0]-s[0])*p-l*(e[1]-s[1]);return f>0&&m<0||f<0&&m>0}function Jl(i,e,s){for(const w of s)for(let S=0;S<w.length-1;++S)if((m=[(f=w[S+1])[0]-(p=w[S])[0],f[1]-p[1]])[0]*(x=[(l=e)[0]-(n=i)[0],l[1]-n[1]])[1]-m[1]*x[0]!=0&&Fo(n,l,p,f)&&Fo(p,f,n,l))return!0;var n,l,p,f,m,x;return!1}function Bo(i,e){for(let s=0;s<i.length;++s)if(!Sn(i[s],e))return!1;for(let s=0;s<i.length-1;++s)if(Jl(i[s],i[s+1],e))return!1;return!0}function Ro(i,e){for(let s=0;s<e.length;s++)if(Bo(i,e[s]))return!0;return!1}function Va(i,e,s){const n=[];for(let l=0;l<i.length;l++){const p=[];for(let f=0;f<i[l].length;f++){const m=Lo(i[l][f],s);In(e,m),p.push(m)}n.push(p)}return n}function Oo(i,e,s){const n=[];for(let l=0;l<i.length;l++){const p=Va(i[l],e,s);n.push(p)}return n}function Vo(i,e,s,n){if(i[0]<s[0]||i[0]>s[2]){const l=.5*n;let p=i[0]-s[0]>l?-n:s[0]-i[0]>l?n:0;p===0&&(p=i[0]-s[2]>l?-n:s[2]-i[0]>l?n:0),i[0]+=p}In(e,i)}function Mn(i,e,s,n){const l=Math.pow(2,n.z)*fs,p=[n.x*fs,n.y*fs],f=[];for(const m of i)for(const x of m){const w=[x.x+p[0],x.y+p[1]];Vo(w,e,s,l),f.push(w)}return f}function Cn(i,e,s,n){const l=Math.pow(2,n.z)*fs,p=[n.x*fs,n.y*fs],f=[];for(const x of i){const w=[];for(const S of x){const C=[S.x+p[0],S.y+p[1]];In(e,C),w.push(C)}f.push(w)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const x of f)for(const w of x)Vo(w,e,s,l)}var m;return f}class Ms{constructor(e,s){this.type=ct,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Gs(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let l=0;l<n.features.length;++l){const p=n.features[l].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ms(n,n.features[l].geometry)}else if(n.type==="Feature"){const l=n.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Ms(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Ms(n,n)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,n){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=s.canonicalID();if(n.type==="Polygon"){const m=Va(n.coordinates,p,f),x=Mn(s.geometry(),l,p,f);if(!ua(l,p))return!1;for(const w of x)if(!Sn(w,m))return!1}if(n.type==="MultiPolygon"){const m=Oo(n.coordinates,p,f),x=Mn(s.geometry(),l,p,f);if(!ua(l,p))return!1;for(const w of x)if(!Tn(w,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,n){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=s.canonicalID();if(n.type==="Polygon"){const m=Va(n.coordinates,p,f),x=Cn(s.geometry(),l,p,f);if(!ua(l,p))return!1;for(const w of x)if(!Bo(w,m))return!1}if(n.type==="MultiPolygon"){const m=Oo(n.coordinates,p,f),x=Cn(s.geometry(),l,p,f);if(!ua(l,p))return!1;for(const w of x)if(!Ro(w,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Na{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const n=e[1];return s.scope.has(n)?new Na(n,s.scope.get(n)):s.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class zr{constructor(e,s,n,l){this.name=e,this.type=s,this._evaluate=n,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const n=e[0],l=zr.definitions[n];if(!l)return s.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=f.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let x=null;for(const[w,S]of m){x=new Ra(s.registry,ja,s.path,null,s.scope);const C=[];let A=!1;for(let P=1;P<e.length;P++){const D=e[P],B=Array.isArray(w)?w[P-1]:w.type,U=x.parse(D,1+C.length,B);if(!U){A=!0;break}C.push(U)}if(!A)if(Array.isArray(w)&&w.length!==C.length)x.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){const D=Array.isArray(w)?w[P]:w.type,B=C[P];x.concat(P+1).checkSubtype(D,B.type)}if(x.errors.length===0)return new zr(n,p,S,C)}}if(m.length===1)s.errors.push(...x.errors);else{const w=(m.length?m:f).map(([C])=>{return A=C,Array.isArray(A)?`(${A.map(Z).join(", ")})`:`(${Z(A.type)}...)`;var A}).join(" | "),S=[];for(let C=1;C<e.length;C++){const A=s.parse(e[C],1+S.length);if(!A)return null;S.push(Z(A.type))}s.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,s){zr.definitions=s;for(const n in s)e[n]=zr}}function ja(i){if(i instanceof Na)return ja(i.boundExpression);if(i instanceof zr&&i.name==="error"||i instanceof Oa||i instanceof Ms)return!1;const e=i instanceof ps||i instanceof Ar;let s=!0;return i.eachChild(n=>{s=e?s&&ja(n):s&&n instanceof Ts}),!!s&&Ua(i)&&Za(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ua(i){if(i instanceof zr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ms)return!1;let e=!0;return i.eachChild(s=>{e&&!Ua(s)&&(e=!1)}),e}function ha(i){if(i instanceof zr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(s=>{e&&!ha(s)&&(e=!1)}),e}function Za(i,e){if(i instanceof zr&&e.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(n=>{s&&!Za(n,e)&&(s=!1)}),s}function $s(i,e){const s=i.length-1;let n,l,p=0,f=s,m=0;for(;p<=f;)if(m=Math.floor((p+f)/2),n=i[m],l=i[m+1],n<=e){if(m===s||e<l)return m;p=m+1}else{if(!(n>e))throw new oi("Input is not a number.");f=m-1}return 0}class ms{constructor(e,s,n){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[l,p]of n)this.labels.push(l),this.outputs.push(p)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const n=s.parse(e[1],1,Pe);if(!n)return null;const l=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let f=1;f<e.length;f+=2){const m=f===1?-1/0:e[f],x=e[f+1],w=f,S=f+1;if(typeof m!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=m)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=s.parse(x,S,p);if(!C)return null;p=p||C.type,l.push([m,C])}return new ms(p,n,l)}evaluate(e){const s=this.labels,n=this.outputs;if(s.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=s[0])return n[0].evaluate(e);const p=s.length;return l>=s[p-1]?n[p-1].evaluate(e):n[$s(s,l)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function kt(i,e,s){return i+s*(e-i)}function qa(i,e,s){return i.map((n,l)=>kt(n,e[l],s))}const mr={number:kt,color:function(i,e,s,n="rgb"){switch(n){case"rgb":{const[l,p,f,m]=qa(i.rgb,e.rgb,s);return new Ut(l,p,f,m,!1)}case"hcl":{const[l,p,f,m]=i.hcl,[x,w,S,C]=e.hcl;let A,P;if(isNaN(l)||isNaN(x))isNaN(l)?isNaN(x)?A=NaN:(A=x,f!==1&&f!==0||(P=w)):(A=l,S!==1&&S!==0||(P=p));else{let Q=x-l;x>l&&Q>180?Q-=360:x<l&&l-x>180&&(Q+=360),A=l+s*Q}const[D,B,U,G]=function([Q,W,te,re]){return Q=isNaN(Q)?0:Q*ut,Yt([te,Math.cos(Q)*W,Math.sin(Q)*W,re])}([A,P??kt(p,w,s),kt(f,S,s),kt(m,C,s)]);return new Ut(D,B,U,G,!1)}case"lab":{const[l,p,f,m]=Yt(qa(i.lab,e.lab,s));return new Ut(l,p,f,m,!1)}}},array:qa,padding:function(i,e,s){return new fr(qa(i.values,e.values,s))},variableAnchorOffsetCollection:function(i,e,s){const n=i.values,l=e.values;if(n.length!==l.length)throw new oi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const p=[];for(let f=0;f<n.length;f+=2){if(n[f]!==l[f])throw new oi(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${n[f]}, to[${f}]: ${l[f]}`);p.push(n[f]);const[m,x]=n[f+1],[w,S]=l[f+1];p.push([kt(m,w,s),kt(x,S,s)])}return new kr(p)}};class gr{constructor(e,s,n,l,p){this.type=e,this.operator=s,this.interpolation=n,this.input=l,this.labels=[],this.outputs=[];for(const[f,m]of p)this.labels.push(f),this.outputs.push(m)}static interpolationFactor(e,s,n,l){let p=0;if(e.name==="exponential")p=kn(s,e.base,n,l);else if(e.name==="linear")p=kn(s,1,n,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;p=new at(f[0],f[1],f[2],f[3]).solve(kn(s,1,n,l))}return p}static parse(e,s){let[n,l,p,...f]=e;if(!Array.isArray(l)||l.length===0)return s.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Pe),!p)return null;const m=[];let x=null;n==="interpolate-hcl"||n==="interpolate-lab"?x=Ji:s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(let w=0;w<f.length;w+=2){const S=f[w],C=f[w+1],A=w+3,P=w+4;if(typeof S!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=S)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const D=s.parse(C,P,x);if(!D)return null;x=x||D.type,m.push([S,D])}return ce(x,Pe)||ce(x,Ji)||ce(x,k)||ce(x,L)||ce(x,j(Pe))?new gr(x,n,l,p,m):s.error(`Type ${Z(x)} is not interpolatable.`)}evaluate(e){const s=this.labels,n=this.outputs;if(s.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=s[0])return n[0].evaluate(e);const p=s.length;if(l>=s[p-1])return n[p-1].evaluate(e);const f=$s(s,l),m=gr.interpolationFactor(this.interpolation,l,s[f],s[f+1]),x=n[f].evaluate(e),w=n[f+1].evaluate(e);switch(this.operator){case"interpolate":return mr[this.type.kind](x,w,m);case"interpolate-hcl":return mr.color(x,w,m,"hcl");case"interpolate-lab":return mr.color(x,w,m,"lab")}}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function kn(i,e,s,n){const l=n-s,p=i-s;return l===0?0:e===1?p/l:(Math.pow(e,p)-1)/(Math.pow(e,l)-1)}class Ga{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let n=null;const l=s.expectedType;l&&l.kind!=="value"&&(n=l);const p=[];for(const m of e.slice(1)){const x=s.parse(m,1+p.length,n,void 0,{typeAnnotation:"omit"});if(!x)return null;n=n||x.type,p.push(x)}if(!n)throw new Error("No output type");const f=l&&p.some(m=>X(l,m.type));return new Ga(f?gt:n,p)}evaluate(e){let s,n=null,l=0;for(const p of this.args)if(l++,n=p.evaluate(e),n&&n instanceof Ri&&!n.available&&(s||(s=n.name),n=null,l===this.args.length&&(n=s)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class $a{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let p=1;p<e.length-1;p+=2){const f=e[p];if(typeof f!="string")return s.error(`Expected string, but found ${typeof f} instead.`,p);if(/[^a-zA-Z0-9_]/.test(f))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const m=s.parse(e[p+1],p+1);if(!m)return null;n.push([f,m])}const l=s.parse(e[e.length-1],e.length-1,s.expectedType,n);return l?new $a(n,l):null}outputDefined(){return this.result.outputDefined()}}class An{constructor(e,s,n){this.type=e,this.index=s,this.input=n}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=s.parse(e[1],1,Pe),l=s.parse(e[2],2,j(s.expectedType||gt));return n&&l?new An(l.type.itemType,n,l):null}evaluate(e){const s=this.index.evaluate(e),n=this.input.evaluate(e);if(s<0)throw new oi(`Array index out of bounds: ${s} < 0.`);if(s>=n.length)throw new oi(`Array index out of bounds: ${s} > ${n.length-1}.`);if(s!==Math.floor(s))throw new oi(`Array index must be an integer, but found ${s} instead.`);return n[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class zn{constructor(e,s){this.type=ct,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=s.parse(e[1],1,gt),l=s.parse(e[2],2,gt);return n&&l?$(n.type,[ct,xt,Pe,ts,gt])?new zn(n,l):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Z(n.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!K(s,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${Z(ii(s))} instead.`);if(!K(n,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${Z(ii(n))} instead.`);return n.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Wa{constructor(e,s,n){this.type=Pe,this.needle=e,this.haystack=s,this.fromIndex=n}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=s.parse(e[1],1,gt),l=s.parse(e[2],2,gt);if(!n||!l)return null;if(!$(n.type,[ct,xt,Pe,ts,gt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Z(n.type)} instead`);if(e.length===4){const p=s.parse(e[3],3,Pe);return p?new Wa(n,l,p):null}return new Wa(n,l)}evaluate(e){const s=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!K(s,["boolean","string","number","null"]))throw new oi(`Expected first argument to be of type boolean, string, number or null, but found ${Z(ii(s))} instead.`);if(!K(n,["string","array"]))throw new oi(`Expected second argument to be of type array or string, but found ${Z(ii(n))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return n.indexOf(s,l)}return n.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class En{constructor(e,s,n,l,p,f){this.inputType=e,this.type=s,this.input=n,this.cases=l,this.outputs=p,this.otherwise=f}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let n,l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const p={},f=[];for(let w=2;w<e.length-1;w+=2){let S=e[w];const C=e[w+1];Array.isArray(S)||(S=[S]);const A=s.concat(w);if(S.length===0)return A.error("Expected at least one branch label.");for(const D of S){if(typeof D!="number"&&typeof D!="string")return A.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return A.error("Numeric branch labels must be integer values.");if(n){if(A.checkSubtype(n,ii(D)))return null}else n=ii(D);if(p[String(D)]!==void 0)return A.error("Branch labels must be unique.");p[String(D)]=f.length}const P=s.parse(C,w,l);if(!P)return null;l=l||P.type,f.push(P)}const m=s.parse(e[1],1,gt);if(!m)return null;const x=s.parse(e[e.length-1],e.length-1,l);return x?m.type.kind!=="value"&&s.concat(1).checkSubtype(n,m.type)?null:new En(n,l,m,p,f,x):null}evaluate(e){const s=this.input.evaluate(e);return(ii(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Pn{constructor(e,s,n){this.type=e,this.branches=s,this.otherwise=n}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let n;s.expectedType&&s.expectedType.kind!=="value"&&(n=s.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const m=s.parse(e[f],f,ct);if(!m)return null;const x=s.parse(e[f+1],f+1,n);if(!x)return null;l.push([m,x]),n=n||x.type}const p=s.parse(e[e.length-1],e.length-1,n);if(!p)return null;if(!n)throw new Error("Can't infer output type");return new Pn(n,l,p)}evaluate(e){for(const[s,n]of this.branches)if(s.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,n]of this.branches)e(s),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Xa{constructor(e,s,n,l){this.type=e,this.input=s,this.beginIndex=n,this.endIndex=l}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=s.parse(e[1],1,gt),l=s.parse(e[2],2,Pe);if(!n||!l)return null;if(!$(n.type,[j(gt),xt,gt]))return s.error(`Expected first argument to be of type array or string, but found ${Z(n.type)} instead`);if(e.length===4){const p=s.parse(e[3],3,Pe);return p?new Xa(n.type,n,l,p):null}return new Xa(n.type,n,l)}evaluate(e){const s=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!K(s,["string","array"]))throw new oi(`Expected first argument to be of type array or string, but found ${Z(ii(s))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return s.slice(n,l)}return s.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function No(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jo(i,e,s,n){return n.compare(e,s)===0}function Ws(i,e,s){const n=i!=="=="&&i!=="!=";return class od{constructor(p,f,m){this.type=ct,this.lhs=p,this.rhs=f,this.collator=m,this.hasUntypedArgument=p.type.kind==="value"||f.type.kind==="value"}static parse(p,f){if(p.length!==3&&p.length!==4)return f.error("Expected two or three arguments.");const m=p[0];let x=f.parse(p[1],1,gt);if(!x)return null;if(!No(m,x.type))return f.concat(1).error(`"${m}" comparisons are not supported for type '${Z(x.type)}'.`);let w=f.parse(p[2],2,gt);if(!w)return null;if(!No(m,w.type))return f.concat(2).error(`"${m}" comparisons are not supported for type '${Z(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${Z(x.type)}' and '${Z(w.type)}'.`);n&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new Ar(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new Ar(x.type,[w])));let S=null;if(p.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(p[3],3,is),!S)return null}return new od(x,w,S)}evaluate(p){const f=this.lhs.evaluate(p),m=this.rhs.evaluate(p);if(n&&this.hasUntypedArgument){const x=ii(f),w=ii(m);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new oi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const x=ii(f),w=ii(m);if(x.kind!=="string"||w.kind!=="string")return e(p,f,m)}return this.collator?s(p,f,m,this.collator.evaluate(p)):e(p,f,m)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Hl=Ws("==",function(i,e,s){return e===s},jo),Kl=Ws("!=",function(i,e,s){return e!==s},function(i,e,s,n){return!jo(0,e,s,n)}),Ql=Ws("<",function(i,e,s){return e<s},function(i,e,s,n){return n.compare(e,s)<0}),ec=Ws(">",function(i,e,s){return e>s},function(i,e,s,n){return n.compare(e,s)>0}),tc=Ws("<=",function(i,e,s){return e<=s},function(i,e,s,n){return n.compare(e,s)<=0}),ic=Ws(">=",function(i,e,s){return e>=s},function(i,e,s,n){return n.compare(e,s)>=0});class Dn{constructor(e,s,n,l,p){this.type=xt,this.number=e,this.locale=s,this.currency=n,this.minFractionDigits=l,this.maxFractionDigits=p}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const n=s.parse(e[1],1,Pe);if(!n)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return s.error("NumberFormat options argument must be an object.");let p=null;if(l.locale&&(p=s.parse(l.locale,1,xt),!p))return null;let f=null;if(l.currency&&(f=s.parse(l.currency,1,xt),!f))return null;let m=null;if(l["min-fraction-digits"]&&(m=s.parse(l["min-fraction-digits"],1,Pe),!m))return null;let x=null;return l["max-fraction-digits"]&&(x=s.parse(l["max-fraction-digits"],1,Pe),!x)?null:new Dn(n,p,f,m,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ya{constructor(e){this.type=V,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return s.error("First argument must be an image or text section.");const l=[];let p=!1;for(let f=1;f<=e.length-1;++f){const m=e[f];if(p&&typeof m=="object"&&!Array.isArray(m)){p=!1;let x=null;if(m["font-scale"]&&(x=s.parse(m["font-scale"],1,Pe),!x))return null;let w=null;if(m["text-font"]&&(w=s.parse(m["text-font"],1,j(xt)),!w))return null;let S=null;if(m["text-color"]&&(S=s.parse(m["text-color"],1,Ji),!S))return null;const C=l[l.length-1];C.scale=x,C.font=w,C.textColor=S}else{const x=s.parse(e[f],1,gt);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new Ya(l)}evaluate(e){return new qi(this.sections.map(s=>{const n=s.content.evaluate(e);return ii(n)===z?new La("",n,null,null,null):new La(Ft(n),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}}class Ln{constructor(e){this.type=z,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const n=s.parse(e[1],1,xt);return n?new Ln(n):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),n=Ri.fromString(s);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(s)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class Fn{constructor(e){this.type=Pe,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=s.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Z(n.type)} instead.`):new Fn(n):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new oi(`Expected value to be of type string or array, but found ${Z(ii(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Xs={"==":Hl,"!=":Kl,">":ec,"<":Ql,">=":ic,"<=":tc,array:Ar,at:An,boolean:Ar,case:Pn,coalesce:Ga,collator:Oa,format:Ya,image:Ln,in:zn,"index-of":Wa,interpolate:gr,"interpolate-hcl":gr,"interpolate-lab":gr,length:Fn,let:$a,literal:Ts,match:En,number:Ar,"number-format":Dn,object:Ar,slice:Xa,step:ms,string:Ar,"to-boolean":ps,"to-color":ps,"to-number":ps,"to-string":ps,var:Na,within:Ms};function Uo(i,[e,s,n,l]){e=e.evaluate(i),s=s.evaluate(i),n=n.evaluate(i);const p=l?l.evaluate(i):1,f=Fa(e,s,n,p);if(f)throw new oi(f);return new Ut(e/255,s/255,n/255,p,!1)}function Zo(i,e){return i in e}function Bn(i,e){const s=e[i];return s===void 0?null:s}function Cs(i){return{type:i}}function qo(i){return{result:"success",value:i}}function gs(i){return{result:"error",value:i}}function Ys(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Go(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Rn(i){return!!i.expression&&i.expression.interpolated}function Bt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ri(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function rc(i){return i}function At(i,e){const s=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),p=i.type||(Rn(e)?"exponential":"interval");if(s||e.type==="padding"){const S=s?Ut.parse:fr.parse;(i=qr({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],S(C[1])])),i.default=S(i.default?i.default:e.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let m,x,w;if(p==="exponential")m=da;else if(p==="interval")m=ei;else if(p==="categorical"){m=si,x=Object.create(null);for(const S of i.stops)x[S[0]]=S[1];w=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=$o}if(n){const S={},C=[];for(let D=0;D<i.stops.length;D++){const B=i.stops[D],U=B[0].zoom;S[U]===void 0&&(S[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},C.push(U)),S[U].stops.push([B[0].value,B[1]])}const A=[];for(const D of C)A.push([S[D].zoom,At(S[D],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:gr.interpolationFactor.bind(void 0,P),zoomStops:A.map(D=>D[0]),evaluate:({zoom:D},B)=>da({stops:A,base:i.base},e,D).evaluate(D,B)}}if(l){const S=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:gr.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(i,e,C,x,w)}}return{kind:"source",evaluate(S,C){const A=C&&C.properties?C.properties[i.property]:void 0;return A===void 0?ks(i.default,e.default):m(i,e,A,x,w)}}}function ks(i,e,s){return i!==void 0?i:e!==void 0?e:s!==void 0?s:void 0}function si(i,e,s,n,l){return ks(typeof s===l?n[s]:void 0,i.default,e.default)}function ei(i,e,s){if(Bt(s)!=="number")return ks(i.default,e.default);const n=i.stops.length;if(n===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[n-1][0])return i.stops[n-1][1];const l=$s(i.stops.map(p=>p[0]),s);return i.stops[l][1]}function da(i,e,s){const n=i.base!==void 0?i.base:1;if(Bt(s)!=="number")return ks(i.default,e.default);const l=i.stops.length;if(l===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[l-1][0])return i.stops[l-1][1];const p=$s(i.stops.map(S=>S[0]),s),f=function(S,C,A,P){const D=P-A,B=S-A;return D===0?0:C===1?B/D:(Math.pow(C,B)-1)/(Math.pow(C,D)-1)}(s,n,i.stops[p][0],i.stops[p+1][0]),m=i.stops[p][1],x=i.stops[p+1][1],w=mr[e.type]||rc;return typeof m.evaluate=="function"?{evaluate(...S){const C=m.evaluate.apply(void 0,S),A=x.evaluate.apply(void 0,S);if(C!==void 0&&A!==void 0)return w(C,A,f,i.colorSpace)}}:w(m,x,f,i.colorSpace)}function $o(i,e,s){switch(e.type){case"color":s=Ut.parse(s);break;case"formatted":s=qi.fromString(s.toString());break;case"resolvedImage":s=Ri.fromString(s.toString());break;case"padding":s=fr.parse(s);break;default:Bt(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return ks(s,i.default,e.default)}zr.register(Xs,{error:[{kind:"error"},[xt],(i,[e])=>{throw new oi(e.evaluate(i))}],typeof:[xt,[gt],(i,[e])=>Z(ii(e.evaluate(i)))],"to-rgba":[j(Pe,4),[Ji],(i,[e])=>{const[s,n,l,p]=e.evaluate(i).rgb;return[255*s,255*n,255*l,p]}],rgb:[Ji,[Pe,Pe,Pe],Uo],rgba:[Ji,[Pe,Pe,Pe,Pe],Uo],has:{type:ct,overloads:[[[xt],(i,[e])=>Zo(e.evaluate(i),i.properties())],[[xt,Gr],(i,[e,s])=>Zo(e.evaluate(i),s.evaluate(i))]]},get:{type:gt,overloads:[[[xt],(i,[e])=>Bn(e.evaluate(i),i.properties())],[[xt,Gr],(i,[e,s])=>Bn(e.evaluate(i),s.evaluate(i))]]},"feature-state":[gt,[xt],(i,[e])=>Bn(e.evaluate(i),i.featureState||{})],properties:[Gr,[],i=>i.properties()],"geometry-type":[xt,[],i=>i.geometryType()],id:[gt,[],i=>i.id()],zoom:[Pe,[],i=>i.globals.zoom],"heatmap-density":[Pe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Pe,[],i=>i.globals.lineProgress||0],accumulated:[gt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Pe,Cs(Pe),(i,e)=>{let s=0;for(const n of e)s+=n.evaluate(i);return s}],"*":[Pe,Cs(Pe),(i,e)=>{let s=1;for(const n of e)s*=n.evaluate(i);return s}],"-":{type:Pe,overloads:[[[Pe,Pe],(i,[e,s])=>e.evaluate(i)-s.evaluate(i)],[[Pe],(i,[e])=>-e.evaluate(i)]]},"/":[Pe,[Pe,Pe],(i,[e,s])=>e.evaluate(i)/s.evaluate(i)],"%":[Pe,[Pe,Pe],(i,[e,s])=>e.evaluate(i)%s.evaluate(i)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(i,[e,s])=>Math.pow(e.evaluate(i),s.evaluate(i))],sqrt:[Pe,[Pe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Pe,[Pe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Pe,[Pe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Pe,[Pe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Pe,[Pe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Pe,[Pe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Pe,[Pe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Pe,Cs(Pe),(i,e)=>Math.min(...e.map(s=>s.evaluate(i)))],max:[Pe,Cs(Pe),(i,e)=>Math.max(...e.map(s=>s.evaluate(i)))],abs:[Pe,[Pe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Pe,[Pe],(i,[e])=>{const s=e.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Pe,[Pe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Pe,[Pe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ct,[xt,gt],(i,[e,s])=>i.properties()[e.value]===s.value],"filter-id-==":[ct,[gt],(i,[e])=>i.id()===e.value],"filter-type-==":[ct,[xt],(i,[e])=>i.geometryType()===e.value],"filter-<":[ct,[xt,gt],(i,[e,s])=>{const n=i.properties()[e.value],l=s.value;return typeof n==typeof l&&n<l}],"filter-id-<":[ct,[gt],(i,[e])=>{const s=i.id(),n=e.value;return typeof s==typeof n&&s<n}],"filter->":[ct,[xt,gt],(i,[e,s])=>{const n=i.properties()[e.value],l=s.value;return typeof n==typeof l&&n>l}],"filter-id->":[ct,[gt],(i,[e])=>{const s=i.id(),n=e.value;return typeof s==typeof n&&s>n}],"filter-<=":[ct,[xt,gt],(i,[e,s])=>{const n=i.properties()[e.value],l=s.value;return typeof n==typeof l&&n<=l}],"filter-id-<=":[ct,[gt],(i,[e])=>{const s=i.id(),n=e.value;return typeof s==typeof n&&s<=n}],"filter->=":[ct,[xt,gt],(i,[e,s])=>{const n=i.properties()[e.value],l=s.value;return typeof n==typeof l&&n>=l}],"filter-id->=":[ct,[gt],(i,[e])=>{const s=i.id(),n=e.value;return typeof s==typeof n&&s>=n}],"filter-has":[ct,[gt],(i,[e])=>e.value in i.properties()],"filter-has-id":[ct,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ct,[j(xt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ct,[j(gt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ct,[xt,j(gt)],(i,[e,s])=>s.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ct,[xt,j(gt)],(i,[e,s])=>function(n,l,p,f){for(;p<=f;){const m=p+f>>1;if(l[m]===n)return!0;l[m]>n?f=m-1:p=m+1}return!1}(i.properties()[e.value],s.value,0,s.value.length-1)],all:{type:ct,overloads:[[[ct,ct],(i,[e,s])=>e.evaluate(i)&&s.evaluate(i)],[Cs(ct),(i,e)=>{for(const s of e)if(!s.evaluate(i))return!1;return!0}]]},any:{type:ct,overloads:[[[ct,ct],(i,[e,s])=>e.evaluate(i)||s.evaluate(i)],[Cs(ct),(i,e)=>{for(const s of e)if(s.evaluate(i))return!0;return!1}]]},"!":[ct,[ct],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ct,[xt],(i,[e])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(e.evaluate(i))}],upcase:[xt,[xt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[xt,[xt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[xt,Cs(gt),(i,e)=>e.map(s=>Ft(s.evaluate(i))).join("")],"resolved-locale":[xt,[is],(i,[e])=>e.evaluate(i).resolvedLocale()]});class On{constructor(e,s){var n;this.expression=e,this._warningHistory={},this._evaluator=new wn,this._defaultValue=s?(n=s).type==="color"&&ri(n.default)?new Ut(0,0,0,0):n.type==="color"?Ut.parse(n.default)||null:n.type==="padding"?fr.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?kr.parse(n.default)||null:n.default===void 0?null:n.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,n,l,p,f){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=n,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,s,n,l,p,f){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=n||null,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new oi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Ja(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Xs}function Ha(i,e){const s=new Ra(Xs,ja,[],e?function(l){const p={color:Ji,string:xt,number:Pe,enum:xt,boolean:ct,formatted:V,padding:k,resolvedImage:z,variableAnchorOffsetCollection:L};return l.type==="array"?j(p[l.value]||gt,l.length):p[l.type]}(e):void 0),n=s.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?qo(new On(n,e)):gs(s.errors)}class Vn{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!ha(s.expression)}evaluateWithoutErrorHandling(e,s,n,l,p,f){return this._styleExpression.evaluateWithoutErrorHandling(e,s,n,l,p,f)}evaluate(e,s,n,l,p,f){return this._styleExpression.evaluate(e,s,n,l,p,f)}}class Ka{constructor(e,s,n,l){this.kind=e,this.zoomStops=n,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!ha(s.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,s,n,l,p,f){return this._styleExpression.evaluateWithoutErrorHandling(e,s,n,l,p,f)}evaluate(e,s,n,l,p,f){return this._styleExpression.evaluate(e,s,n,l,p,f)}interpolationFactor(e,s,n){return this.interpolationType?gr.interpolationFactor(this.interpolationType,e,s,n):0}}function Nn(i,e){const s=Ha(i,e);if(s.result==="error")return s;const n=s.value.expression,l=Ua(n);if(!l&&!Ys(e))return gs([new ni("","data expressions not supported")]);const p=Za(n,["zoom"]);if(!p&&!Go(e))return gs([new ni("","zoom expressions not supported")]);const f=fa(n);return f||p?f instanceof ni?gs([f]):f instanceof gr&&!Rn(e)?gs([new ni("",'"interpolate" expressions cannot be used with this property')]):qo(f?new Ka(l?"camera":"composite",s.value,f.labels,f instanceof gr?f.interpolation:void 0):new Vn(l?"constant":"source",s.value)):gs([new ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pa{constructor(e,s){this._parameters=e,this._specification=s,qr(this,At(this._parameters,this._specification))}static deserialize(e){return new pa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fa(i){let e=null;if(i instanceof $a)e=fa(i.result);else if(i instanceof Ga){for(const s of i.args)if(e=fa(s),e)break}else(i instanceof ms||i instanceof gr)&&i.input instanceof zr&&i.input.name==="zoom"&&(e=i);return e instanceof ni||i.eachChild(s=>{const n=fa(s);n instanceof ni?e=n:!e&&n?e=new ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ma(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ma(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const sc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jn(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ma(i)||(i=Qa(i));const e=Ha(i,sc);if(e.result==="error")throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,n,l)=>e.value.evaluate(s,n,{},l),needGeometry:Wo(i)}}function ac(i,e){return i<e?-1:i>e?1:0}function Wo(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Wo(i[e]))return!0;return!1}function Qa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Un(i[1],i[2],"=="):e==="!="?ga(Un(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Un(i[1],i[2],e):e==="any"?(s=i.slice(1),["any"].concat(s.map(Qa))):e==="all"?["all"].concat(i.slice(1).map(Qa)):e==="none"?["all"].concat(i.slice(1).map(Qa).map(ga)):e==="in"?Xo(i[1],i.slice(2)):e==="!in"?ga(Xo(i[1],i.slice(2))):e==="has"?Yo(i[1]):e==="!has"?ga(Yo(i[1])):e!=="within"||i;var s}function Un(i,e,s){switch(i){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,i,e]}}function Xo(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ac)]]:["filter-in-small",i,["literal",e]]}}function Yo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ga(i){return["!",i]}function en(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const p of i)l+=`${en(p)},`;return`${l}]`}const s=Object.keys(i).sort();let n="{";for(let l=0;l<s.length;l++)n+=`${JSON.stringify(s[l])}:${en(i[s[l]])},`;return`${n}}`}function tn(i){let e="";for(const s of sr)e+=`/${en(i[s])}`;return e}function Jo(i){const e=i.value;return e?[new ze(i.key,e,"constants have been deprecated as of v8")]:[]}function li(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function As(i){if(Array.isArray(i))return i.map(As);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const s in i)e[s]=As(i[s]);return e}return li(i)}function ar(i){const e=i.key,s=i.value,n=i.valueSpec||{},l=i.objectElementValidators||{},p=i.style,f=i.styleSpec,m=i.validateSpec;let x=[];const w=Bt(s);if(w!=="object")return[new ze(e,s,`object expected, ${w} found`)];for(const S in s){const C=S.split(".")[0],A=n[C]||n["*"];let P;if(l[C])P=l[C];else if(n[C])P=m;else if(l["*"])P=l["*"];else{if(!n["*"]){x.push(new ze(e,s[S],`unknown property "${S}"`));continue}P=m}x=x.concat(P({key:(e&&`${e}.`)+S,value:s[S],valueSpec:A,style:p,styleSpec:f,object:s,objectKey:S,validateSpec:m},s))}for(const S in n)l[S]||n[S].required&&n[S].default===void 0&&s[S]===void 0&&x.push(new ze(e,s,`missing required property "${S}"`));return x}function Js(i){const e=i.value,s=i.valueSpec,n=i.style,l=i.styleSpec,p=i.key,f=i.arrayElementValidator||i.validateSpec;if(Bt(e)!=="array")return[new ze(p,e,`array expected, ${Bt(e)} found`)];if(s.length&&e.length!==s.length)return[new ze(p,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new ze(p,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let m={type:s.value,values:s.values};l.$version<7&&(m.function=s.function),Bt(s.value)==="object"&&(m=s.value);let x=[];for(let w=0;w<e.length;w++)x=x.concat(f({array:e,arrayIndex:w,value:e[w],valueSpec:m,validateSpec:i.validateSpec,style:n,styleSpec:l,key:`${p}[${w}]`}));return x}function _a(i){const e=i.key,s=i.value,n=i.valueSpec;let l=Bt(s);return l==="number"&&s!=s&&(l="NaN"),l!=="number"?[new ze(e,s,`number expected, ${l} found`)]:"minimum"in n&&s<n.minimum?[new ze(e,s,`${s} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&s>n.maximum?[new ze(e,s,`${s} is greater than the maximum value ${n.maximum}`)]:[]}function rn(i){const e=i.valueSpec,s=li(i.value.type);let n,l,p,f={};const m=s!=="categorical"&&i.value.property===void 0,x=!m,w=Bt(i.value.stops)==="array"&&Bt(i.value.stops[0])==="array"&&Bt(i.value.stops[0][0])==="object",S=ar({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(s==="identity")return[new ze(P.key,P.value,'identity function may not have a "stops" property')];let D=[];const B=P.value;return D=D.concat(Js({key:P.key,value:B,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),Bt(B)==="array"&&B.length===0&&D.push(new ze(P.key,B,"array must have at least one stop")),D},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return s==="identity"&&m&&S.push(new ze(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||S.push(new ze(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!Rn(i.valueSpec)&&S.push(new ze(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!Ys(i.valueSpec)?S.push(new ze(i.key,i.value,"property functions not supported")):m&&!Go(i.valueSpec)&&S.push(new ze(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!w||i.value.property!==void 0||S.push(new ze(i.key,i.value,'"property" property is required')),S;function C(P){let D=[];const B=P.value,U=P.key;if(Bt(B)!=="array")return[new ze(U,B,`array expected, ${Bt(B)} found`)];if(B.length!==2)return[new ze(U,B,`array length 2 expected, length ${B.length} found`)];if(w){if(Bt(B[0])!=="object")return[new ze(U,B,`object expected, ${Bt(B[0])} found`)];if(B[0].zoom===void 0)return[new ze(U,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new ze(U,B,"object stop key must have value")];if(p&&p>li(B[0].zoom))return[new ze(U,B[0].zoom,"stop zoom values must appear in ascending order")];li(B[0].zoom)!==p&&(p=li(B[0].zoom),l=void 0,f={}),D=D.concat(ar({key:`${U}[0]`,value:B[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:_a,value:A}}))}else D=D.concat(A({key:`${U}[0]`,value:B[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},B));return Ja(As(B[1]))?D.concat([new ze(`${U}[1]`,B[1],"expressions are not allowed in function stops.")]):D.concat(P.validateSpec({key:`${U}[1]`,value:B[1],valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function A(P,D){const B=Bt(P.value),U=li(P.value),G=P.value!==null?P.value:D;if(n){if(B!==n)return[new ze(P.key,G,`${B} stop domain type must match previous stop domain type ${n}`)]}else n=B;if(B!=="number"&&B!=="string"&&B!=="boolean")return[new ze(P.key,G,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&s!=="categorical"){let Q=`number expected, ${B} found`;return Ys(e)&&s===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze(P.key,G,Q)]}return s!=="categorical"||B!=="number"||isFinite(U)&&Math.floor(U)===U?s!=="categorical"&&B==="number"&&l!==void 0&&U<l?[new ze(P.key,G,"stop domain values must appear in ascending order")]:(l=U,s==="categorical"&&U in f?[new ze(P.key,G,"stop domain values must be unique")]:(f[U]=!0,[])):[new ze(P.key,G,`integer expected, found ${U}`)]}}function zs(i){const e=(i.expressionContext==="property"?Nn:Ha)(As(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new ze(`${i.key}${n.key}`,i.value,n.message));const s=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new ze(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ha(s))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ha(s))return[new ze(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Za(s,["zoom","feature-state"]))return[new ze(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ua(s))return[new ze(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ya(i){const e=i.key,s=i.value,n=i.valueSpec,l=[];return Array.isArray(n.values)?n.values.indexOf(li(s))===-1&&l.push(new ze(e,s,`expected one of [${n.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(n.values).indexOf(li(s))===-1&&l.push(new ze(e,s,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(s)} found`)),l}function Hs(i){return ma(As(i.value))?zs(qr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ho(i)}function Ho(i){const e=i.value,s=i.key;if(Bt(e)!=="array")return[new ze(s,e,`array expected, ${Bt(e)} found`)];const n=i.styleSpec;let l,p=[];if(e.length<1)return[new ze(s,e,"filter array must have at least 1 element")];switch(p=p.concat(ya({key:`${s}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),li(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&li(e[1])==="$type"&&p.push(new ze(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new ze(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Bt(e[1]),l!=="string"&&p.push(new ze(`${s}[1]`,e[1],`string expected, ${l} found`)));for(let f=2;f<e.length;f++)l=Bt(e[f]),li(e[1])==="$type"?p=p.concat(ya({key:`${s}[${f}]`,value:e[f],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&p.push(new ze(`${s}[${f}]`,e[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)p=p.concat(Ho({key:`${s}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Bt(e[1]),e.length!==2?p.push(new ze(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&p.push(new ze(`${s}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Bt(e[1]),e.length!==2?p.push(new ze(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&p.push(new ze(`${s}[1]`,e[1],`object expected, ${l} found`))}return p}function Ko(i,e){const s=i.key,n=i.validateSpec,l=i.style,p=i.styleSpec,f=i.value,m=i.objectKey,x=p[`${e}_${i.layerType}`];if(!x)return[];const w=m.match(/^(.*)-transition$/);if(e==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return n({key:s,value:f,valueSpec:p.transition,style:l,styleSpec:p});const S=i.valueSpec||x[m];if(!S)return[new ze(s,f,`unknown property "${m}"`)];let C;if(Bt(f)==="string"&&Ys(S)&&!S.tokens&&(C=/^{([^}]+)}$/.exec(f)))return[new ze(s,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const A=[];return i.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&A.push(new ze(s,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&ri(As(f))&&li(f.type)==="identity"&&A.push(new ze(s,f,'"text-font" does not support identity functions'))),A.concat(n({key:i.key,value:f,valueSpec:S,style:l,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:m}))}function Qo(i){return Ko(i,"paint")}function el(i){return Ko(i,"layout")}function tl(i){let e=[];const s=i.value,n=i.key,l=i.style,p=i.styleSpec;s.type||s.ref||e.push(new ze(n,s,'either "type" or "ref" is required'));let f=li(s.type);const m=li(s.ref);if(s.id){const x=li(s.id);for(let w=0;w<i.arrayIndex;w++){const S=l.layers[w];li(S.id)===x&&e.push(new ze(n,s.id,`duplicate layer id "${s.id}", previously used at line ${S.id.__line__}`))}}if("ref"in s){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in s&&e.push(new ze(n,s[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{li(w.id)===m&&(x=w)}),x?x.ref?e.push(new ze(n,s.ref,"ref cannot reference another ref layer")):f=li(x.type):e.push(new ze(n,s.ref,`ref layer "${m}" not found`))}else if(f!=="background")if(s.source){const x=l.sources&&l.sources[s.source],w=x&&li(x.type);x?w==="vector"&&f==="raster"?e.push(new ze(n,s.source,`layer "${s.id}" requires a raster source`)):w!=="raster-dem"&&f==="hillshade"?e.push(new ze(n,s.source,`layer "${s.id}" requires a raster-dem source`)):w==="raster"&&f!=="raster"?e.push(new ze(n,s.source,`layer "${s.id}" requires a vector source`)):w!=="vector"||s["source-layer"]?w==="raster-dem"&&f!=="hillshade"?e.push(new ze(n,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!s.paint||!s.paint["line-gradient"]||w==="geojson"&&x.lineMetrics||e.push(new ze(n,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ze(n,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new ze(n,s.source,`source "${s.source}" not found`))}else e.push(new ze(n,s,'missing required property "source"'));return e=e.concat(ar({key:n,value:s,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${n}.type`,value:s.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"}),filter:Hs,layout:x=>ar({layer:s,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>el(qr({layerType:f},w))}}),paint:x=>ar({layer:s,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>Qo(qr({layerType:f},w))}})}})),e}function $r(i){const e=i.value,s=i.key,n=Bt(e);return n!=="string"?[new ze(s,e,`string expected, ${n} found`)]:[]}const xa={promoteId:function({key:i,value:e}){if(Bt(e)==="string")return $r({key:i,value:e});{const s=[];for(const n in e)s.push(...$r({key:`${i}.${n}`,value:e[n]}));return s}}};function _r(i){const e=i.value,s=i.key,n=i.styleSpec,l=i.style,p=i.validateSpec;if(!e.type)return[new ze(s,e,'"type" is required')];const f=li(e.type);let m;switch(f){case"vector":case"raster":return m=ar({key:s,value:e,valueSpec:n[`source_${f.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:xa,validateSpec:p}),m;case"raster-dem":return m=function(x){var w;const S=(w=x.sourceName)!==null&&w!==void 0?w:"",C=x.value,A=x.styleSpec,P=A.source_raster_dem,D=x.style;let B=[];const U=Bt(C);if(C===void 0)return B;if(U!=="object")return B.push(new ze("source_raster_dem",C,`object expected, ${U} found`)),B;const G=li(C.encoding)==="custom",Q=["redFactor","greenFactor","blueFactor","baseShift"],W=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const te in C)!G&&Q.includes(te)?B.push(new ze(te,C[te],`In "${S}": "${te}" is only valid when "encoding" is set to "custom". ${W} encoding found`)):P[te]?B=B.concat(x.validateSpec({key:te,value:C[te],valueSpec:P[te],validateSpec:x.validateSpec,style:D,styleSpec:A})):B.push(new ze(te,C[te],`unknown property "${te}"`));return B}({sourceName:s,value:e,style:i.style,styleSpec:n,validateSpec:p}),m;case"geojson":if(m=ar({key:s,value:e,valueSpec:n.source_geojson,style:l,styleSpec:n,validateSpec:p,objectElementValidators:xa}),e.cluster)for(const x in e.clusterProperties){const[w,S]=e.clusterProperties[x],C=typeof w=="string"?[w,["accumulated"],["get",x]]:w;m.push(...zs({key:`${s}.${x}.map`,value:S,expressionContext:"cluster-map"})),m.push(...zs({key:`${s}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return m;case"video":return ar({key:s,value:e,valueSpec:n.source_video,style:l,validateSpec:p,styleSpec:n});case"image":return ar({key:s,value:e,valueSpec:n.source_image,style:l,validateSpec:p,styleSpec:n});case"canvas":return[new ze(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ya({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function va(i){const e=i.value,s=i.styleSpec,n=s.light,l=i.style;let p=[];const f=Bt(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new ze("light",e,`object expected, ${f} found`)]),p;for(const m in e){const x=m.match(/^(.*)-transition$/);p=p.concat(x&&n[x[1]]&&n[x[1]].transition?i.validateSpec({key:m,value:e[m],valueSpec:s.transition,validateSpec:i.validateSpec,style:l,styleSpec:s}):n[m]?i.validateSpec({key:m,value:e[m],valueSpec:n[m],validateSpec:i.validateSpec,style:l,styleSpec:s}):[new ze(m,e[m],`unknown property "${m}"`)])}return p}function il(i){const e=i.value,s=i.styleSpec,n=s.terrain,l=i.style;let p=[];const f=Bt(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new ze("terrain",e,`object expected, ${f} found`)]),p;for(const m in e)p=p.concat(n[m]?i.validateSpec({key:m,value:e[m],valueSpec:n[m],validateSpec:i.validateSpec,style:l,styleSpec:s}):[new ze(m,e[m],`unknown property "${m}"`)]);return p}function rl(i){let e=[];const s=i.value,n=i.key;if(Array.isArray(s)){const l=[],p=[];for(const f in s)s[f].id&&l.includes(s[f].id)&&e.push(new ze(n,s,`all the sprites' ids must be unique, but ${s[f].id} is duplicated`)),l.push(s[f].id),s[f].url&&p.includes(s[f].url)&&e.push(new ze(n,s,`all the sprites' URLs must be unique, but ${s[f].url} is duplicated`)),p.push(s[f].url),e=e.concat(ar({key:`${n}[${f}]`,value:s[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return $r({key:n,value:s})}const sl={"*":()=>[],array:Js,boolean:function(i){const e=i.value,s=i.key,n=Bt(e);return n!=="boolean"?[new ze(s,e,`boolean expected, ${n} found`)]:[]},number:_a,color:function(i){const e=i.key,s=i.value,n=Bt(s);return n!=="string"?[new ze(e,s,`color expected, ${n} found`)]:Ut.parse(String(s))?[]:[new ze(e,s,`color expected, "${s}" found`)]},constants:Jo,enum:ya,filter:Hs,function:rn,layer:tl,object:ar,source:_r,light:va,terrain:il,string:$r,formatted:function(i){return $r(i).length===0?[]:zs(i)},resolvedImage:function(i){return $r(i).length===0?[]:zs(i)},padding:function(i){const e=i.key,s=i.value;if(Bt(s)==="array"){if(s.length<1||s.length>4)return[new ze(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const n={type:"number"};let l=[];for(let p=0;p<s.length;p++)l=l.concat(i.validateSpec({key:`${e}[${p}]`,value:s[p],validateSpec:i.validateSpec,valueSpec:n}));return l}return _a({key:e,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,s=i.value,n=Bt(s),l=i.styleSpec;if(n!=="array"||s.length<1||s.length%2!=0)return[new ze(e,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let f=0;f<s.length;f+=2)p=p.concat(ya({key:`${e}[${f}]`,value:s[f],valueSpec:l.layout_symbol["text-anchor"]})),p=p.concat(Js({key:`${e}[${f+1}]`,value:s[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return p},sprite:rl};function _s(i){const e=i.value,s=i.valueSpec,n=i.styleSpec;return i.validateSpec=_s,s.expression&&ri(li(e))?rn(i):s.expression&&Ja(As(e))?zs(i):s.type&&sl[s.type]?sl[s.type](i):ar(qr({},i,{valueSpec:s.type?n[s.type]:s}))}function al(i){const e=i.value,s=i.key,n=$r(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new ze(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new ze(s,e,'"glyphs" url must include a "{range}" token'))),n}function Er(i,e=oe){let s=[];return s=s.concat(_s({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:_s,objectElementValidators:{glyphs:al,"*":()=>[]}})),i.constants&&(s=s.concat(Jo({key:"constants",value:i.constants}))),sn(s)}function rs(i){return function(e){return i({...e,validateSpec:_s})}}function sn(i){return[].concat(i).sort((e,s)=>e.line-s.line)}function ss(i){return function(...e){return sn(i.apply(this,e))}}Er.source=ss(rs(_r)),Er.sprite=ss(rs(rl)),Er.glyphs=ss(rs(al)),Er.light=ss(rs(va)),Er.terrain=ss(rs(il)),Er.layer=ss(rs(tl)),Er.filter=ss(rs(Hs)),Er.paintProperty=ss(rs(Qo)),Er.layoutProperty=ss(rs(el));const as=Er,nc=as.light,Zn=as.paintProperty,nl=as.layoutProperty;function an(i,e){let s=!1;if(e&&e.length)for(const n of e)i.fire(new Je(new Error(n.message))),s=!0;return s}class Ks{constructor(e,s,n){const l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const f=new Int32Array(this.arrayBuffer);e=f[0],this.d=(s=f[1])+2*(n=f[2]);for(let x=0;x<this.d*this.d;x++){const w=f[3+x],S=f[3+x+1];l.push(w===S?null:f.subarray(w,S))}const m=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],m),this.bboxes=f.subarray(m),this.insert=this._insertReadonly}else{this.d=s+2*n;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=n,this.scale=s/e,this.uid=0;const p=n/s*e;this.min=-p,this.max=e+p}insert(e,s,n,l,p){this._forEachCell(s,n,l,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,n,l,p,f){this.cells[p].push(f)}query(e,s,n,l,p){const f=this.min,m=this.max;if(e<=f&&s<=f&&m<=n&&m<=l&&!p)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,s,n,l,this._queryCell,x,{},p),x}}_queryCell(e,s,n,l,p,f,m,x){const w=this.cells[p];if(w!==null){const S=this.keys,C=this.bboxes;for(let A=0;A<w.length;A++){const P=w[A];if(m[P]===void 0){const D=4*P;(x?x(C[D+0],C[D+1],C[D+2],C[D+3]):e<=C[D+2]&&s<=C[D+3]&&n>=C[D+0]&&l>=C[D+1])?(m[P]=!0,f.push(S[P])):m[P]=!1}}}}_forEachCell(e,s,n,l,p,f,m,x){const w=this._convertToCellCoord(e),S=this._convertToCellCoord(s),C=this._convertToCellCoord(n),A=this._convertToCellCoord(l);for(let P=w;P<=C;P++)for(let D=S;D<=A;D++){const B=this.d*D+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(D),this._convertFromCellCoord(P+1),this._convertFromCellCoord(D+1)))&&p.call(this,e,s,n,l,B,f,m,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let n=0;for(let f=0;f<this.cells.length;f++)n+=this.cells[f].length;const l=new Int32Array(s+n+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let p=s;for(let f=0;f<e.length;f++){const m=e[f];l[3+f]=p,l.set(m,p),p+=m.length}return l[3+e.length]=p,l.set(this.keys,p),p+=this.keys.length,l[3+e.length+1]=p,l.set(this.bboxes,p),p+=this.bboxes.length,l.buffer}static serialize(e,s){const n=e.toArrayBuffer();return s&&s.push(n),{buffer:n}}static deserialize(e){return new Ks(e.buffer)}}const ns={};function Ne(i,e,s={}){if(ns[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),ns[i]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Ne("Object",Object),Ne("TransferableGridIndex",Ks),Ne("Color",Ut),Ne("Error",Error),Ne("AJAXError",rr),Ne("ResolvedImage",Ri),Ne("StylePropertyFunction",pa),Ne("StyleExpression",On,{omit:["_evaluator"]}),Ne("ZoomDependentExpression",Ka),Ne("ZoomConstantExpression",Vn),Ne("CompoundExpression",zr,{omit:["_evaluate"]});for(const i in Xs)Xs[i]._classRegistryKey||Ne(`Expression_${i}`,Xs[i]);function nn(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ys(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(nn(i)||Sr(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return e&&e.push(s.buffer),s}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const n of i)s.push(ys(n,e));return s}if(typeof i=="object"){const s=i.constructor,n=s._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");if(!ns[n])throw new Error(`${n} is not registered.`);const l=s.serialize?s.serialize(i,e):{};if(s.serialize){if(e&&l===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||ns[n].omit.indexOf(p)>=0)continue;const f=i[p];l[p]=ns[n].shallow.indexOf(p)>=0?f:ys(f,e)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(l.$name=n),l}throw new Error("can't serialize object of type "+typeof i)}function Qs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||nn(i)||Sr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Qs);if(typeof i=="object"){const e=i.$name||"Object";if(!ns[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=ns[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(i);const n=Object.create(s.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const p=i[l];n[l]=ns[e].shallow.indexOf(l)>=0?p:Qs(p)}return n}throw new Error("can't deserialize object of type "+typeof i)}class ol{constructor(){this.first=!0}update(e,s){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const Be={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function qn(i){for(const e of i)if($n(e.charCodeAt(0)))return!0;return!1}function Gn(i){for(const e of i)if(!oc(e.charCodeAt(0)))return!1;return!0}function oc(i){return!(Be.Arabic(i)||Be["Arabic Supplement"](i)||Be["Arabic Extended-A"](i)||Be["Arabic Presentation Forms-A"](i)||Be["Arabic Presentation Forms-B"](i))}function $n(i){return!(i!==746&&i!==747&&(i<4352||!(Be["Bopomofo Extended"](i)||Be.Bopomofo(i)||Be["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Be["CJK Compatibility Ideographs"](i)||Be["CJK Compatibility"](i)||Be["CJK Radicals Supplement"](i)||Be["CJK Strokes"](i)||!(!Be["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Be["CJK Unified Ideographs Extension A"](i)||Be["CJK Unified Ideographs"](i)||Be["Enclosed CJK Letters and Months"](i)||Be["Hangul Compatibility Jamo"](i)||Be["Hangul Jamo Extended-A"](i)||Be["Hangul Jamo Extended-B"](i)||Be["Hangul Jamo"](i)||Be["Hangul Syllables"](i)||Be.Hiragana(i)||Be["Ideographic Description Characters"](i)||Be.Kanbun(i)||Be["Kangxi Radicals"](i)||Be["Katakana Phonetic Extensions"](i)||Be.Katakana(i)&&i!==12540||!(!Be["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Be["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Be["Unified Canadian Aboriginal Syllabics"](i)||Be["Unified Canadian Aboriginal Syllabics Extended"](i)||Be["Vertical Forms"](i)||Be["Yijing Hexagram Symbols"](i)||Be["Yi Syllables"](i)||Be["Yi Radicals"](i))))}function ll(i){return!($n(i)||function(e){return!!(Be["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Be["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Be["Letterlike Symbols"](e)||Be["Number Forms"](e)||Be["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Be["Control Pictures"](e)&&e!==9251||Be["Optical Character Recognition"](e)||Be["Enclosed Alphanumerics"](e)||Be["Geometric Shapes"](e)||Be["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Be["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Be["CJK Symbols and Punctuation"](e)||Be.Katakana(e)||Be["Private Use Area"](e)||Be["CJK Compatibility Forms"](e)||Be["Small Form Variants"](e)||Be["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function cl(i){return i>=1424&&i<=2303||Be["Arabic Presentation Forms-A"](i)||Be["Arabic Presentation Forms-B"](i)}function ul(i,e){return!(!e&&cl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Be.Khmer(i))}function lc(i){for(const e of i)if(cl(e.charCodeAt(0)))return!0;return!1}const Wn="deferred",Xn="loading",Yn="loaded";let Jn=null,nr="unavailable",xs=null;const ba=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(nr="error"),Jn&&Jn(i)};function Hn(){wa.fire(new Oe("pluginStateChange",{pluginStatus:nr,pluginURL:xs}))}const wa=new mt,Kn=function(){return nr},hl=function(){if(nr!==Wn||!xs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");nr=Xn,Hn(),xs&&Ce({url:xs},i=>{i?ba(i):(nr=Yn,Hn())})},yr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>nr===Yn||yr.applyArabicShaping!=null,isLoading:()=>nr===Xn,setState(i){if(!Li())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");nr=i.pluginStatus,xs=i.pluginURL},isParsed(){if(!Li())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return yr.applyArabicShaping!=null&&yr.processBidirectionalText!=null&&yr.processStyledBidirectionalText!=null},getPluginURL(){if(!Li())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return xs}};class Ht{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ol,this.transition={})}isSupportedScript(e){return function(s,n){for(const l of s)if(!ul(l.charCodeAt(0),n))return!1;return!0}(e,yr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*s}}}class on{constructor(e,s){this.property=e,this.value=s,this.expression=function(n,l){if(ri(n))return new pa(n,l);if(Ja(n)){const p=Nn(n,l);if(p.result==="error")throw new Error(p.value.map(f=>`${f.key}: ${f.message}`).join(", "));return p.value}{let p=n;return l.type==="color"&&typeof n=="string"?p=Ut.parse(n):l.type!=="padding"||typeof n!="number"&&!Array.isArray(n)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(n)&&(p=kr.parse(n)):p=fr.parse(n),{kind:"constant",evaluate:()=>p}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,n){return this.property.possiblyEvaluate(this,e,s,n)}}class Qn{constructor(e){this.property=e,this.value=new on(e,void 0)}transitioned(e,s){return new pl(this.property,this.value,s,jt({},e.transition,this.transition),e.now)}untransitioned(){return new pl(this.property,this.value,null,{},0)}}class dl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ct(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qn(this._values[e].property)),this._values[e].value=new on(this._values[e].property,s===null?void 0:Ct(s))}getTransition(e){return Ct(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qn(this._values[e].property)),this._values[e].transition=Ct(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const n=this.getValue(s);n!==void 0&&(e[s]=n);const l=this.getTransition(s);l!==void 0&&(e[`${s}-transition`]=l)}return e}transitioned(e,s){const n=new fl(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].transitioned(e,s._values[l]);return n}untransitioned(){const e=new fl(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class pl{constructor(e,s,n,l,p){this.property=e,this.value=s,this.begin=p+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=n)}possiblyEvaluate(e,s,n){const l=e.now||0,p=this.value.possiblyEvaluate(e,s,n),f=this.prior;if(f){if(l>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(l<this.begin)return f.possiblyEvaluate(e,s,n);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,s,n),p,function(x){if(x<=0)return 0;if(x>=1)return 1;const w=x*x,S=w*x;return 4*(x<.5?S:3*(x-w)+S-.75)}(m))}}return p}}class fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,n){const l=new ln(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(e,s,n);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ct(this._values[e].value)}setValue(e,s){this._values[e]=new on(this._values[e].property,s===null?void 0:Ct(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const n=this.getValue(s);n!==void 0&&(e[s]=n)}return e}possiblyEvaluate(e,s,n){const l=new ln(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(e,s,n);return l}}class Hi{constructor(e,s,n){this.property=e,this.value=s,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,n,l){return this.property.evaluate(this.value,this.parameters,e,s,n,l)}}class ln{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,n){const l=mr[this.specification.type];return l?l(e,s,n):e}}class tt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,n,l){return new Hi(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},n,l)}:e.expression,s)}interpolate(e,s,n){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Hi(this,{kind:"constant",value:void 0},e.parameters);const l=mr[this.specification.type];if(l){const p=l(e.value.value,s.value.value,n);return new Hi(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,s,n,l,p,f){return e.kind==="constant"?e.value:e.evaluate(s,n,l,p,f)}}class Ia extends tt{possiblyEvaluate(e,s,n,l){if(e.value===void 0)return new Hi(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const p=e.expression.evaluate(s,null,{},n,l),f=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,m=this._calculate(f,f,f,s);return new Hi(this,{kind:"constant",value:m},s)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Hi(this,{kind:"constant",value:p},s)}return new Hi(this,e.expression,s)}evaluate(e,s,n,l,p,f){if(e.kind==="source"){const m=e.evaluate(s,n,l,p,f);return this._calculate(m,m,m,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},n,l),e.evaluate({zoom:Math.floor(s.zoom)},n,l),e.evaluate({zoom:Math.floor(s.zoom)+1},n,l),s):e.value}_calculate(e,s,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:n,to:s}}interpolate(e){return e}}class eo{constructor(e){this.specification=e}possiblyEvaluate(e,s,n,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(s,null,{},n,l);return this._calculate(p,p,p,s)}return this._calculate(e.expression.evaluate(new Ht(Math.floor(s.zoom-1),s)),e.expression.evaluate(new Ht(Math.floor(s.zoom),s)),e.expression.evaluate(new Ht(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:n,to:s}}interpolate(e){return e}}class to{constructor(e){this.specification=e}possiblyEvaluate(e,s,n,l){return!!e.expression.evaluate(s,null,{},n,l)}interpolate(){return!1}}class mi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const n=e[s];n.specification.overridable&&this.overridableProperties.push(s);const l=this.defaultPropertyValues[s]=new on(n,void 0),p=this.defaultTransitionablePropertyValues[s]=new Qn(n);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=l.possiblyEvaluate({})}}}Ne("DataDrivenProperty",tt),Ne("DataConstantProperty",Ye),Ne("CrossFadedDataDrivenProperty",Ia),Ne("CrossFadedProperty",eo),Ne("ColorRampProperty",to);const io="-transition";class Pr extends mt{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new cc(s.layout)),s.paint)){this._transitionablePaint=new dl(s.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ln(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,n={}){s!=null&&this._validate(nl,`layers.${this.id}.layout.${e}`,e,s,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return e.endsWith(io)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,n={}){if(s!=null&&this._validate(Zn,`layers.${this.id}.paint.${e}`,e,s,n))return!1;if(e.endsWith(io))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const l=this._transitionablePaint._values[e],p=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||f||p||this._handleOverridablePaintPropertyUpdate(e,m,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),wi(e,(s,n)=>!(s===void 0||n==="layout"&&!Object.keys(s).length||n==="paint"&&!Object.keys(s).length))}_validate(e,s,n,l,p={}){return(!p||p.validate!==!1)&&an(this,e.call(as,{key:s,layerType:this.type,objectKey:n,value:l,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Hi&&Ys(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const ml={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Es{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ci{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ai(i,e=1){let s=0,n=0;return{members:i.map(l=>{const p=ml[l.type].BYTES_PER_ELEMENT,f=s=ea(s,Math.max(e,p)),m=l.components||1;return n=Math.max(n,p),s+=p*m,{name:l.name,type:l.type,components:m,offset:f}}),size:ea(s,Math.max(n,e)),alignment:e}}function ea(i,e){return Math.ceil(i/e)*e}class Sa extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const n=this.length;return this.resize(n+1),this.emplace(n,e,s)}emplace(e,s,n){const l=2*e;return this.int16[l+0]=s,this.int16[l+1]=n,e}}Sa.prototype.bytesPerElement=4,Ne("StructArrayLayout2i4",Sa);class Ta extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,s,n)}emplace(e,s,n,l){const p=3*e;return this.int16[p+0]=s,this.int16[p+1]=n,this.int16[p+2]=l,e}}Ta.prototype.bytesPerElement=6,Ne("StructArrayLayout3i6",Ta);class Ps extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,n,l)}emplace(e,s,n,l,p){const f=4*e;return this.int16[f+0]=s,this.int16[f+1]=n,this.int16[f+2]=l,this.int16[f+3]=p,e}}Ps.prototype.bytesPerElement=8,Ne("StructArrayLayout4i8",Ps);class ro extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,n,l,p,f)}emplace(e,s,n,l,p,f,m){const x=6*e;return this.int16[x+0]=s,this.int16[x+1]=n,this.int16[x+2]=l,this.int16[x+3]=p,this.int16[x+4]=f,this.int16[x+5]=m,e}}ro.prototype.bytesPerElement=12,Ne("StructArrayLayout2i4i12",ro);class so extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,n,l,p,f)}emplace(e,s,n,l,p,f,m){const x=4*e,w=8*e;return this.int16[x+0]=s,this.int16[x+1]=n,this.uint8[w+4]=l,this.uint8[w+5]=p,this.uint8[w+6]=f,this.uint8[w+7]=m,e}}so.prototype.bytesPerElement=8,Ne("StructArrayLayout2i4ub8",so);class ta extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const n=this.length;return this.resize(n+1),this.emplace(n,e,s)}emplace(e,s,n){const l=2*e;return this.float32[l+0]=s,this.float32[l+1]=n,e}}ta.prototype.bytesPerElement=8,Ne("StructArrayLayout2f8",ta);class ao extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f,m,x,w,S){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,n,l,p,f,m,x,w,S)}emplace(e,s,n,l,p,f,m,x,w,S,C){const A=10*e;return this.uint16[A+0]=s,this.uint16[A+1]=n,this.uint16[A+2]=l,this.uint16[A+3]=p,this.uint16[A+4]=f,this.uint16[A+5]=m,this.uint16[A+6]=x,this.uint16[A+7]=w,this.uint16[A+8]=S,this.uint16[A+9]=C,e}}ao.prototype.bytesPerElement=20,Ne("StructArrayLayout10ui20",ao);class no extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f,m,x,w,S,C,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,s,n,l,p,f,m,x,w,S,C,A)}emplace(e,s,n,l,p,f,m,x,w,S,C,A,P){const D=12*e;return this.int16[D+0]=s,this.int16[D+1]=n,this.int16[D+2]=l,this.int16[D+3]=p,this.uint16[D+4]=f,this.uint16[D+5]=m,this.uint16[D+6]=x,this.uint16[D+7]=w,this.int16[D+8]=S,this.int16[D+9]=C,this.int16[D+10]=A,this.int16[D+11]=P,e}}no.prototype.bytesPerElement=24,Ne("StructArrayLayout4i4ui4i24",no);class Rt extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,s,n)}emplace(e,s,n,l){const p=3*e;return this.float32[p+0]=s,this.float32[p+1]=n,this.float32[p+2]=l,e}}Rt.prototype.bytesPerElement=12,Ne("StructArrayLayout3f12",Rt);class h extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}h.prototype.bytesPerElement=4,Ne("StructArrayLayout1ul4",h);class t extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f,m,x,w){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,n,l,p,f,m,x,w)}emplace(e,s,n,l,p,f,m,x,w,S){const C=10*e,A=5*e;return this.int16[C+0]=s,this.int16[C+1]=n,this.int16[C+2]=l,this.int16[C+3]=p,this.int16[C+4]=f,this.int16[C+5]=m,this.uint32[A+3]=x,this.uint16[C+8]=w,this.uint16[C+9]=S,e}}t.prototype.bytesPerElement=20,Ne("StructArrayLayout6i1ul2ui20",t);class a extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,n,l,p,f)}emplace(e,s,n,l,p,f,m){const x=6*e;return this.int16[x+0]=s,this.int16[x+1]=n,this.int16[x+2]=l,this.int16[x+3]=p,this.int16[x+4]=f,this.int16[x+5]=m,e}}a.prototype.bytesPerElement=12,Ne("StructArrayLayout2i2i2i12",a);class o extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,n,l,p)}emplace(e,s,n,l,p,f){const m=4*e,x=8*e;return this.float32[m+0]=s,this.float32[m+1]=n,this.float32[m+2]=l,this.int16[x+6]=p,this.int16[x+7]=f,e}}o.prototype.bytesPerElement=16,Ne("StructArrayLayout2f1f2i16",o);class c extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,n,l)}emplace(e,s,n,l,p){const f=12*e,m=3*e;return this.uint8[f+0]=s,this.uint8[f+1]=n,this.float32[m+1]=l,this.float32[m+2]=p,e}}c.prototype.bytesPerElement=12,Ne("StructArrayLayout2ub2f12",c);class d extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,s,n)}emplace(e,s,n,l){const p=3*e;return this.uint16[p+0]=s,this.uint16[p+1]=n,this.uint16[p+2]=l,e}}d.prototype.bytesPerElement=6,Ne("StructArrayLayout3ui6",d);class _ extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f,m,x,w,S,C,A,P,D,B,U,G){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,s,n,l,p,f,m,x,w,S,C,A,P,D,B,U,G)}emplace(e,s,n,l,p,f,m,x,w,S,C,A,P,D,B,U,G,Q){const W=24*e,te=12*e,re=48*e;return this.int16[W+0]=s,this.int16[W+1]=n,this.uint16[W+2]=l,this.uint16[W+3]=p,this.uint32[te+2]=f,this.uint32[te+3]=m,this.uint32[te+4]=x,this.uint16[W+10]=w,this.uint16[W+11]=S,this.uint16[W+12]=C,this.float32[te+7]=A,this.float32[te+8]=P,this.uint8[re+36]=D,this.uint8[re+37]=B,this.uint8[re+38]=U,this.uint32[te+10]=G,this.int16[W+22]=Q,e}}_.prototype.bytesPerElement=48,Ne("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_);class y extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,n,l,p,f,m,x,w,S,C,A,P,D,B,U,G,Q,W,te,re,de,Re,Ge,Fe,Le,ke,Ue){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,e,s,n,l,p,f,m,x,w,S,C,A,P,D,B,U,G,Q,W,te,re,de,Re,Ge,Fe,Le,ke,Ue)}emplace(e,s,n,l,p,f,m,x,w,S,C,A,P,D,B,U,G,Q,W,te,re,de,Re,Ge,Fe,Le,ke,Ue,Ee){const we=32*e,Ke=16*e;return this.int16[we+0]=s,this.int16[we+1]=n,this.int16[we+2]=l,this.int16[we+3]=p,this.int16[we+4]=f,this.int16[we+5]=m,this.int16[we+6]=x,this.int16[we+7]=w,this.uint16[we+8]=S,this.uint16[we+9]=C,this.uint16[we+10]=A,this.uint16[we+11]=P,this.uint16[we+12]=D,this.uint16[we+13]=B,this.uint16[we+14]=U,this.uint16[we+15]=G,this.uint16[we+16]=Q,this.uint16[we+17]=W,this.uint16[we+18]=te,this.uint16[we+19]=re,this.uint16[we+20]=de,this.uint16[we+21]=Re,this.uint16[we+22]=Ge,this.uint32[Ke+12]=Fe,this.float32[Ke+13]=Le,this.float32[Ke+14]=ke,this.uint16[we+30]=Ue,this.uint16[we+31]=Ee,e}}y.prototype.bytesPerElement=64,Ne("StructArrayLayout8i15ui1ul2f2ui64",y);class v extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}v.prototype.bytesPerElement=4,Ne("StructArrayLayout1f4",v);class I extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,s,n)}emplace(e,s,n,l){const p=3*e;return this.uint16[6*e+0]=s,this.float32[p+1]=n,this.float32[p+2]=l,e}}I.prototype.bytesPerElement=12,Ne("StructArrayLayout1ui2f12",I);class T extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,s,n)}emplace(e,s,n,l){const p=4*e;return this.uint32[2*e+0]=s,this.uint16[p+2]=n,this.uint16[p+3]=l,e}}T.prototype.bytesPerElement=8,Ne("StructArrayLayout1ul2ui8",T);class M extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const n=this.length;return this.resize(n+1),this.emplace(n,e,s)}emplace(e,s,n){const l=2*e;return this.uint16[l+0]=s,this.uint16[l+1]=n,e}}M.prototype.bytesPerElement=4,Ne("StructArrayLayout2ui4",M);class E extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}E.prototype.bytesPerElement=2,Ne("StructArrayLayout1ui2",E);class O extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,n,l)}emplace(e,s,n,l,p){const f=4*e;return this.float32[f+0]=s,this.float32[f+1]=n,this.float32[f+2]=l,this.float32[f+3]=p,e}}O.prototype.bytesPerElement=16,Ne("StructArrayLayout4f16",O);class R extends Es{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _e(this.anchorPointX,this.anchorPointY)}}R.prototype.size=20;class N extends t{get(e){return new R(this,e)}}Ne("CollisionBoxArray",N);class F extends Es{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}F.prototype.size=48;class J extends _{get(e){return new F(this,e)}}Ne("PlacedSymbolArray",J);class ie extends Es{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ie.prototype.size=64;class q extends y{get(e){return new ie(this,e)}}Ne("SymbolInstanceArray",q);class H extends v{getoffsetX(e){return this.float32[1*e+0]}}Ne("GlyphOffsetArray",H);class se extends Ta{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ne("SymbolLineVertexArray",se);class ae extends Es{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ae.prototype.size=12;class he extends I{get(e){return new ae(this,e)}}Ne("TextAnchorOffsetArray",he);class ve extends Es{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ve.prototype.size=8;class ge extends T{get(e){return new ve(this,e)}}Ne("FeatureIndexArray",ge);class Te extends Sa{}class qe extends Sa{}class St extends Sa{}class De extends ro{}class it extends so{}class $e extends ta{}class Zt extends ao{}class It extends no{}class _t extends Rt{}class Tt extends h{}class hi extends a{}class Jt extends c{}class Oi extends d{}class Si extends M{}const gi=ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:xr}=gi;class Kt{constructor(e=[]){this.segments=e}prepareSegment(e,s,n,l){let p=this.segments[this.segments.length-1];return e>Kt.MAX_VERTEX_ARRAY_LENGTH&&nt(`Max vertices per segment is ${Kt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Kt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==l)&&(p={vertexOffset:s.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},l!==void 0&&(p.sortKey=l),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,n,l){return new Kt([{vertexOffset:e,primitiveOffset:s,vertexLength:n,primitiveLength:l,vaos:{},sortKey:0}])}}function Wr(i,e){return 256*(i=qt(Math.floor(i),0,255))+qt(Math.floor(e),0,255)}Kt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ne("SegmentVector",Kt);const Xr=ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var vs={exports:{}},Ds={exports:{}};Ds.exports=function(i,e){var s,n,l,p,f,m,x,w;for(n=i.length-(s=3&i.length),l=e,f=3432918353,m=461845907,w=0;w<n;)x=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,l=27492+(65535&(p=5*(65535&(l=(l^=x=(65535&(x=(x=(65535&x)*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(x=0,s){case 3:x^=(255&i.charCodeAt(w+2))<<16;case 2:x^=(255&i.charCodeAt(w+1))<<8;case 1:l^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(w)))*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*m+(((x>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var ia=Ds.exports,Gi={exports:{}};Gi.exports=function(i,e){for(var s,n=i.length,l=e^n,p=0;n>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(s>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),n-=4,++p;switch(n){case 3:l^=(255&i.charCodeAt(p+2))<<16;case 2:l^=(255&i.charCodeAt(p+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(p)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Vi=ia,Ki=Gi.exports;vs.exports=Vi,vs.exports.murmur3=Vi,vs.exports.murmur2=Ki;var Ls=Y(vs.exports);class di{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,n,l){this.ids.push(Ti(e)),this.positions.push(s,n,l)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Ti(e);let n=0,l=this.ids.length-1;for(;n<l;){const f=n+l>>1;this.ids[f]>=s?l=f:n=f+1}const p=[];for(;this.ids[n]===s;)p.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return p}static serialize(e,s){const n=new Float64Array(e.ids),l=new Uint32Array(e.positions);return or(n,l,0,n.length-1),s&&s.push(n.buffer,l.buffer),{ids:n,positions:l}}static deserialize(e){const s=new di;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function Ti(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ls(String(i))}function or(i,e,s,n){for(;s<n;){const l=i[s+n>>1];let p=s-1,f=n+1;for(;;){do p++;while(i[p]<l);do f--;while(i[f]>l);if(p>=f)break;pi(i,p,f),pi(e,3*p,3*f),pi(e,3*p+1,3*f+1),pi(e,3*p+2,3*f+2)}f-s<n-f?(or(i,e,s,f),s=f+1):(or(i,e,f+1,n),n=f)}}function pi(i,e,s){const n=i[e];i[e]=i[s],i[s]=n}Ne("FeaturePositionMap",di);class Fs{constructor(e,s){this.gl=e.gl,this.location=s}}class cn extends Fs{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class gl extends Fs{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class _l extends Fs{constructor(e,s){super(e,s),this.current=Ut.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const uc=new Float32Array(16);function oo(i){return[Wr(255*i.r,255*i.g),Wr(255*i.b,255*i.a)]}class Yr{constructor(e,s,n){this.value=e,this.uniformNames=s.map(l=>`u_${l}`),this.type=n}setUniform(e,s,n){e.set(n.constantOr(this.value))}getBinding(e,s,n){return this.type==="color"?new _l(e,s):new cn(e,s)}}class Bs{constructor(e,s){this.uniformNames=s.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setUniform(e,s,n,l){const p=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,s,n){return n.substr(0,9)==="u_pattern"?new gl(e,s):new cn(e,s)}}class Jr{constructor(e,s,n,l){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,s,n,l,p){const f=this.paintVertexArray.length,m=this.expression.evaluate(new Ht(0),s,{},l,[],p);this.paintVertexArray.resize(e),this._setPaintValue(f,e,m)}updatePaintArray(e,s,n,l){const p=this.expression.evaluate({zoom:0},n,l);this._setPaintValue(e,s,p)}_setPaintValue(e,s,n){if(this.type==="color"){const l=oo(n);for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,l[0],l[1])}else{for(let l=e;l<s;l++)this.paintVertexArray.emplace(l,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Dr{constructor(e,s,n,l,p,f){this.expression=e,this.uniformNames=s.map(m=>`u_${m}_t`),this.type=n,this.useIntegerZoom=l,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,s,n,l,p){const f=this.expression.evaluate(new Ht(this.zoom),s,{},l,[],p),m=this.expression.evaluate(new Ht(this.zoom+1),s,{},l,[],p),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,f,m)}updatePaintArray(e,s,n,l){const p=this.expression.evaluate({zoom:this.zoom},n,l),f=this.expression.evaluate({zoom:this.zoom+1},n,l);this._setPaintValue(e,s,p,f)}_setPaintValue(e,s,n,l){if(this.type==="color"){const p=oo(n),f=oo(l);for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,p[0],p[1],f[0],f[1])}else{for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,n,l);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const n=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,l=qt(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,s,n){return new cn(e,s)}}class Hr{constructor(e,s,n,l,p,f){this.expression=e,this.type=s,this.useIntegerZoom=n,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,s,n){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,s.patterns&&s.patterns[this.layerId],n)}updatePaintArray(e,s,n,l,p){this._setPaintValues(e,s,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(e,s,n,l){if(!l||!n)return;const{min:p,mid:f,max:m}=n,x=l[p],w=l[f],S=l[m];if(x&&w&&S)for(let C=e;C<s;C++)this.zoomInPaintVertexArray.emplace(C,w.tl[0],w.tl[1],w.br[0],w.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],w.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,w.tl[0],w.tl[1],w.br[0],w.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],w.pixelRatio,S.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Xr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Xr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lo{constructor(e,s,n){this.binders={},this._buffers=[];const l=[];for(const p in e.paint._values){if(!n(p))continue;const f=e.paint.get(p);if(!(f instanceof Hi&&Ys(f.property.specification)))continue;const m=ld(p,e.type),x=f.value,w=f.property.specification.type,S=f.property.useIntegerZoom,C=f.property.specification["property-type"],A=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[p]=A?new Bs(x.value,m):new Yr(x.value,m,w),l.push(`/u_${p}`);else if(x.kind==="source"||A){const P=fu(p,w,"source");this.binders[p]=A?new Hr(x,w,S,s,P,e.id):new Jr(x,m,w,P),l.push(`/a_${p}`)}else{const P=fu(p,w,"composite");this.binders[p]=new Dr(x,m,w,S,s,P),l.push(`/z_${p}`)}}this.cacheKey=l.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Jr||s instanceof Dr?s.maxValue:0}populatePaintArrays(e,s,n,l,p){for(const f in this.binders){const m=this.binders[f];(m instanceof Jr||m instanceof Dr||m instanceof Hr)&&m.populatePaintArray(e,s,n,l,p)}}setConstantPatternPositions(e,s){for(const n in this.binders){const l=this.binders[n];l instanceof Bs&&l.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,n,l,p){let f=!1;for(const m in e){const x=s.getPositions(m);for(const w of x){const S=n.feature(w.index);for(const C in this.binders){const A=this.binders[C];if((A instanceof Jr||A instanceof Dr||A instanceof Hr)&&A.expression.isStateDependent===!0){const P=l.paint.get(C);A.expression=P.value,A.updatePaintArray(w.start,w.end,S,e[m],p),f=!0}}}}return f}defines(){const e=[];for(const s in this.binders){const n=this.binders[s];(n instanceof Yr||n instanceof Bs)&&e.push(...n.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const n=this.binders[s];if(n instanceof Jr||n instanceof Dr)for(let l=0;l<n.paintVertexAttributes.length;l++)e.push(n.paintVertexAttributes[l].name);else if(n instanceof Hr)for(let l=0;l<Xr.members.length;l++)e.push(Xr.members[l].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const n=this.binders[s];if(n instanceof Yr||n instanceof Bs||n instanceof Dr)for(const l of n.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const n=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof Yr||p instanceof Bs||p instanceof Dr){for(const f of p.uniformNames)if(s[f]){const m=p.getBinding(e,s[f],f);n.push({name:f,property:l,binding:m})}}}return n}setUniforms(e,s,n,l){for(const{name:p,property:f,binding:m}of s)this.binders[f].setUniform(m,l,n.get(f),p)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const n=this.binders[s];if(e&&n instanceof Hr){const l=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(n instanceof Jr||n instanceof Dr)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const s in this.binders){const n=this.binders[s];(n instanceof Jr||n instanceof Dr||n instanceof Hr)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Jr||s instanceof Dr||s instanceof Hr)&&s.destroy()}}}class os{constructor(e,s,n=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new lo(l,s,n);this.needsUpload=!1,this._featureMap=new di,this._bufferOffset=0}populatePaintArrays(e,s,n,l,p,f){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,s,l,p,f);s.id!==void 0&&this._featureMap.add(s.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,n,l){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,s,p,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ld(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function fu(i,e,s){const n={color:{source:ta,composite:O},number:{source:v,composite:ta}},l=function(p){return{"line-pattern":{source:Zt,composite:Zt},"fill-pattern":{source:Zt,composite:Zt},"fill-extrusion-pattern":{source:Zt,composite:Zt}}[p]}(i);return l&&l[s]||n[e][s]}Ne("ConstantBinder",Yr),Ne("CrossFadedConstantBinder",Bs),Ne("SourceExpressionBinder",Jr),Ne("CrossFadedCompositeBinder",Hr),Ne("CompositeExpressionBinder",Dr),Ne("ProgramConfiguration",lo,{omit:["_buffers"]}),Ne("ProgramConfigurationSet",os);const vi=8192,hc=Math.pow(2,14)-1,mu=-hc-1;function Ma(i){const e=vi/i.extent,s=i.loadGeometry();for(let n=0;n<s.length;n++){const l=s[n];for(let p=0;p<l.length;p++){const f=l[p],m=Math.round(f.x*e),x=Math.round(f.y*e);f.x=qt(m,mu,hc),f.y=qt(x,mu,hc),(m<f.x||m>f.x+1||x<f.y||x>f.y+1)&&nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Ca(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ma(i):[]}}function yl(i,e,s,n,l){i.emplaceBack(2*e+(n+1)/2,2*s+(l+1)/2)}class dc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new qe,this.indexArray=new Oi,this.segments=new Kt,this.programConfigurations=new os(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,n){const l=this.layers[0],p=[];let f=null,m=!1;l.type==="circle"&&(f=l.layout.get("circle-sort-key"),m=!f.isConstant());for(const{feature:x,id:w,index:S,sourceLayerIndex:C}of e){const A=this.layers[0]._featureFilter.needGeometry,P=Ca(x,A);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),P,n))continue;const D=m?f.evaluate(P,{},n):void 0,B={id:w,properties:x.properties,type:x.type,sourceLayerIndex:C,index:S,geometry:A?P.geometry:Ma(x),patterns:{},sortKey:D};p.push(B)}m&&p.sort((x,w)=>x.sortKey-w.sortKey);for(const x of p){const{geometry:w,index:S,sourceLayerIndex:C}=x,A=e[S].feature;this.addFeature(x,w,S,n),s.featureIndex.insert(A,w,S,C,this.index)}}update(e,s,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,n,l){for(const p of s)for(const f of p){const m=f.x,x=f.y;if(m<0||m>=vi||x<0||x>=vi)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=w.vertexLength;yl(this.layoutVertexArray,m,x,-1,-1),yl(this.layoutVertexArray,m,x,1,-1),yl(this.layoutVertexArray,m,x,1,1),yl(this.layoutVertexArray,m,x,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},l)}}function gu(i,e){for(let s=0;s<i.length;s++)if(un(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(un(i,e[s]))return!0;return!!pc(i,e)}function cd(i,e,s){return!!un(i,e)||!!fc(e,i,s)}function _u(i,e){if(i.length===1)return xu(e,i[0]);for(let s=0;s<e.length;s++){const n=e[s];for(let l=0;l<n.length;l++)if(un(i,n[l]))return!0}for(let s=0;s<i.length;s++)if(xu(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(pc(i,e[s]))return!0;return!1}function ud(i,e,s){if(i.length>1){if(pc(i,e))return!0;for(let n=0;n<e.length;n++)if(fc(e[n],i,s))return!0}for(let n=0;n<i.length;n++)if(fc(i[n],e,s))return!0;return!1}function pc(i,e){if(i.length===0||e.length===0)return!1;for(let s=0;s<i.length-1;s++){const n=i[s],l=i[s+1];for(let p=0;p<e.length-1;p++)if(hd(n,l,e[p],e[p+1]))return!0}return!1}function hd(i,e,s,n){return Dt(i,s,n)!==Dt(e,s,n)&&Dt(i,e,s)!==Dt(i,e,n)}function fc(i,e,s){const n=s*s;if(e.length===1)return i.distSqr(e[0])<n;for(let l=1;l<e.length;l++)if(yu(i,e[l-1],e[l])<n)return!0;return!1}function yu(i,e,s){const n=e.distSqr(s);if(n===0)return i.distSqr(e);const l=((i.x-e.x)*(s.x-e.x)+(i.y-e.y)*(s.y-e.y))/n;return i.distSqr(l<0?e:l>1?s:s.sub(e)._mult(l)._add(e))}function xu(i,e){let s,n,l,p=!1;for(let f=0;f<i.length;f++){s=i[f];for(let m=0,x=s.length-1;m<s.length;x=m++)n=s[m],l=s[x],n.y>e.y!=l.y>e.y&&e.x<(l.x-n.x)*(e.y-n.y)/(l.y-n.y)+n.x&&(p=!p)}return p}function un(i,e){let s=!1;for(let n=0,l=i.length-1;n<i.length;l=n++){const p=i[n],f=i[l];p.y>e.y!=f.y>e.y&&e.x<(f.x-p.x)*(e.y-p.y)/(f.y-p.y)+p.x&&(s=!s)}return s}function dd(i,e,s){const n=s[0],l=s[2];if(i.x<n.x&&e.x<n.x||i.x>l.x&&e.x>l.x||i.y<n.y&&e.y<n.y||i.y>l.y&&e.y>l.y)return!1;const p=Dt(i,e,s[0]);return p!==Dt(i,e,s[1])||p!==Dt(i,e,s[2])||p!==Dt(i,e,s[3])}function co(i,e,s){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:s.programConfigurations.get(e.id).getMaxValue(i)}function xl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function vl(i,e,s,n,l){if(!e[0]&&!e[1])return i;const p=_e.convert(e)._mult(l);s==="viewport"&&p._rotate(-n);const f=[];for(let m=0;m<i.length;m++)f.push(i[m].sub(p));return f}let vu,bu;Ne("CircleBucket",dc,{omit:["layers"]});var pd={get paint(){return bu=bu||new mi({"circle-radius":new tt(oe.paint_circle["circle-radius"]),"circle-color":new tt(oe.paint_circle["circle-color"]),"circle-blur":new tt(oe.paint_circle["circle-blur"]),"circle-opacity":new tt(oe.paint_circle["circle-opacity"]),"circle-translate":new Ye(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tt(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tt(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tt(oe.paint_circle["circle-stroke-opacity"])})},get layout(){return vu=vu||new mi({"circle-sort-key":new tt(oe.layout_circle["circle-sort-key"])})}},lr=1e-6,hn=typeof Float32Array<"u"?Float32Array:Array;function mc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function wu(i,e,s){var n=e[0],l=e[1],p=e[2],f=e[3],m=e[4],x=e[5],w=e[6],S=e[7],C=e[8],A=e[9],P=e[10],D=e[11],B=e[12],U=e[13],G=e[14],Q=e[15],W=s[0],te=s[1],re=s[2],de=s[3];return i[0]=W*n+te*m+re*C+de*B,i[1]=W*l+te*x+re*A+de*U,i[2]=W*p+te*w+re*P+de*G,i[3]=W*f+te*S+re*D+de*Q,i[4]=(W=s[4])*n+(te=s[5])*m+(re=s[6])*C+(de=s[7])*B,i[5]=W*l+te*x+re*A+de*U,i[6]=W*p+te*w+re*P+de*G,i[7]=W*f+te*S+re*D+de*Q,i[8]=(W=s[8])*n+(te=s[9])*m+(re=s[10])*C+(de=s[11])*B,i[9]=W*l+te*x+re*A+de*U,i[10]=W*p+te*w+re*P+de*G,i[11]=W*f+te*S+re*D+de*Q,i[12]=(W=s[12])*n+(te=s[13])*m+(re=s[14])*C+(de=s[15])*B,i[13]=W*l+te*x+re*A+de*U,i[14]=W*p+te*w+re*P+de*G,i[15]=W*f+te*S+re*D+de*Q,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var uo,fd=wu;function bl(i,e,s){var n=e[0],l=e[1],p=e[2],f=e[3];return i[0]=s[0]*n+s[4]*l+s[8]*p+s[12]*f,i[1]=s[1]*n+s[5]*l+s[9]*p+s[13]*f,i[2]=s[2]*n+s[6]*l+s[10]*p+s[14]*f,i[3]=s[3]*n+s[7]*l+s[11]*p+s[15]*f,i}uo=new hn(4),hn!=Float32Array&&(uo[0]=0,uo[1]=0,uo[2]=0,uo[3]=0);class md extends Pr{constructor(e){super(e,pd)}createBucket(e){return new dc(e)}queryRadius(e){const s=e;return co("circle-radius",this,s)+co("circle-stroke-width",this,s)+xl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,s,n,l,p,f,m,x){const w=vl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,m),S=this.paint.get("circle-radius").evaluate(s,n)+this.paint.get("circle-stroke-width").evaluate(s,n),C=this.paint.get("circle-pitch-alignment")==="map",A=C?w:function(D,B){return D.map(U=>Iu(U,B))}(w,x),P=C?S*m:S;for(const D of l)for(const B of D){const U=C?B:Iu(B,x);let G=P;const Q=bl([],[B.x,B.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?G*=Q[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(G*=f.cameraToCenterDistance/Q[3]),cd(A,U,G))return!0}return!1}}function Iu(i,e){const s=bl([],[i.x,i.y,0,1],e);return new _e(s[0]/s[3],s[1]/s[3])}class Su extends dc{}let Tu;Ne("HeatmapBucket",Su,{omit:["layers"]});var gd={get paint(){return Tu=Tu||new mi({"heatmap-radius":new tt(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tt(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new to(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(oe.paint_heatmap["heatmap-opacity"])})}};function gc(i,{width:e,height:s},n,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*s*n)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${e*s*n}`)}else l=new Uint8Array(e*s*n);return i.width=e,i.height=s,i.data=l,i}function Mu(i,{width:e,height:s},n){if(e===i.width&&s===i.height)return;const l=gc({},{width:e,height:s},n);_c(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,s)},n),i.width=e,i.height=s,i.data=l.data}function _c(i,e,s,n,l,p){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||s.x>i.width-l.width||s.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||n.x>e.width-l.width||n.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,m=e.data;if(f===m)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<l.height;x++){const w=((s.y+x)*i.width+s.x)*p,S=((n.y+x)*e.width+n.x)*p;for(let C=0;C<l.width*p;C++)m[S+C]=f[w+C]}return e}class ho{constructor(e,s){gc(this,e,1,s)}resize(e){Mu(this,e,1)}clone(){return new ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,n,l,p){_c(e,s,n,l,p,1)}}class Br{constructor(e,s){gc(this,e,4,s)}resize(e){Mu(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,n,l,p){_c(e,s,n,l,p,4)}}function Cu(i){const e={},s=i.resolution||256,n=i.clips?i.clips.length:1,l=i.image||new Br({width:s,height:n});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const p=(f,m,x)=>{e[i.evaluationKey]=x;const w=i.expression.evaluate(e);l.data[f+m+0]=Math.floor(255*w.r/w.a),l.data[f+m+1]=Math.floor(255*w.g/w.a),l.data[f+m+2]=Math.floor(255*w.b/w.a),l.data[f+m+3]=Math.floor(255*w.a)};if(i.clips)for(let f=0,m=0;f<n;++f,m+=4*s)for(let x=0,w=0;x<s;x++,w+=4){const S=x/(s-1),{start:C,end:A}=i.clips[f];p(m,w,C*(1-S)+A*S)}else for(let f=0,m=0;f<s;f++,m+=4)p(0,m,f/(s-1));return l}Ne("AlphaImage",ho),Ne("RGBAImage",Br);class _d extends Pr{createBucket(e){return new Su(e)}constructor(e){super(e,gd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ku;var yd={get paint(){return ku=ku||new mi({"hillshade-illumination-direction":new Ye(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(oe.paint_hillshade["hillshade-accent-color"])})}};class xd extends Pr{constructor(e){super(e,yd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const vd=ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:bd}=vd;var yc={exports:{}};function wl(i,e,s){s=s||2;var n,l,p,f,m,x,w,S=e&&e.length,C=S?e[0]*s:i.length,A=Au(i,0,C,s,!0),P=[];if(!A||A.next===A.prev)return P;if(S&&(A=function(B,U,G,Q){var W,te,re,de=[];for(W=0,te=U.length;W<te;W++)(re=Au(B,U[W]*Q,W<te-1?U[W+1]*Q:B.length,Q,!1))===re.next&&(re.steiner=!0),de.push(Ad(re));for(de.sort(Md),W=0;W<de.length;W++)G=Cd(de[W],G);return G}(i,e,A,s)),i.length>80*s){n=p=i[0],l=f=i[1];for(var D=s;D<C;D+=s)(m=i[D])<n&&(n=m),(x=i[D+1])<l&&(l=x),m>p&&(p=m),x>f&&(f=x);w=(w=Math.max(p-n,f-l))!==0?32767/w:0}return po(A,P,s,n,l,w,0),P}function Au(i,e,s,n,l){var p,f;if(l===bc(i,e,s,n)>0)for(p=e;p<s;p+=n)f=Pu(p,i[p],i[p+1],f);else for(p=s-n;p>=e;p-=n)f=Pu(p,i[p],i[p+1],f);return f&&Il(f,f.next)&&(mo(f),f=f.next),f}function ka(i,e){if(!i)return i;e||(e=i);var s,n=i;do if(s=!1,n.steiner||!Il(n,n.next)&&_i(n.prev,n,n.next)!==0)n=n.next;else{if(mo(n),(n=e=n.prev)===n.next)break;s=!0}while(s||n!==e);return e}function po(i,e,s,n,l,p,f){if(i){!f&&p&&function(S,C,A,P){var D=S;do D.z===0&&(D.z=xc(D.x,D.y,C,A,P)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==S);D.prevZ.nextZ=null,D.prevZ=null,function(B){var U,G,Q,W,te,re,de,Re,Ge=1;do{for(G=B,B=null,te=null,re=0;G;){for(re++,Q=G,de=0,U=0;U<Ge&&(de++,Q=Q.nextZ);U++);for(Re=Ge;de>0||Re>0&&Q;)de!==0&&(Re===0||!Q||G.z<=Q.z)?(W=G,G=G.nextZ,de--):(W=Q,Q=Q.nextZ,Re--),te?te.nextZ=W:B=W,W.prevZ=te,te=W;G=Q}te.nextZ=null,Ge*=2}while(re>1)}(D)}(i,n,l,p);for(var m,x,w=i;i.prev!==i.next;)if(m=i.prev,x=i.next,p?Id(i,n,l,p):wd(i))e.push(m.i/s|0),e.push(i.i/s|0),e.push(x.i/s|0),mo(i),i=x.next,w=x.next;else if((i=x)===w){f?f===1?po(i=Sd(ka(i),e,s),e,s,n,l,p,2):f===2&&Td(i,e,s,n,l,p):po(ka(i),e,s,n,l,p,1);break}}}function wd(i){var e=i.prev,s=i,n=i.next;if(_i(e,s,n)>=0)return!1;for(var l=e.x,p=s.x,f=n.x,m=e.y,x=s.y,w=n.y,S=l<p?l<f?l:f:p<f?p:f,C=m<x?m<w?m:w:x<w?x:w,A=l>p?l>f?l:f:p>f?p:f,P=m>x?m>w?m:w:x>w?x:w,D=n.next;D!==e;){if(D.x>=S&&D.x<=A&&D.y>=C&&D.y<=P&&dn(l,m,p,x,f,w,D.x,D.y)&&_i(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function Id(i,e,s,n){var l=i.prev,p=i,f=i.next;if(_i(l,p,f)>=0)return!1;for(var m=l.x,x=p.x,w=f.x,S=l.y,C=p.y,A=f.y,P=m<x?m<w?m:w:x<w?x:w,D=S<C?S<A?S:A:C<A?C:A,B=m>x?m>w?m:w:x>w?x:w,U=S>C?S>A?S:A:C>A?C:A,G=xc(P,D,e,s,n),Q=xc(B,U,e,s,n),W=i.prevZ,te=i.nextZ;W&&W.z>=G&&te&&te.z<=Q;){if(W.x>=P&&W.x<=B&&W.y>=D&&W.y<=U&&W!==l&&W!==f&&dn(m,S,x,C,w,A,W.x,W.y)&&_i(W.prev,W,W.next)>=0||(W=W.prevZ,te.x>=P&&te.x<=B&&te.y>=D&&te.y<=U&&te!==l&&te!==f&&dn(m,S,x,C,w,A,te.x,te.y)&&_i(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;W&&W.z>=G;){if(W.x>=P&&W.x<=B&&W.y>=D&&W.y<=U&&W!==l&&W!==f&&dn(m,S,x,C,w,A,W.x,W.y)&&_i(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;te&&te.z<=Q;){if(te.x>=P&&te.x<=B&&te.y>=D&&te.y<=U&&te!==l&&te!==f&&dn(m,S,x,C,w,A,te.x,te.y)&&_i(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Sd(i,e,s){var n=i;do{var l=n.prev,p=n.next.next;!Il(l,p)&&zu(l,n,n.next,p)&&fo(l,p)&&fo(p,l)&&(e.push(l.i/s|0),e.push(n.i/s|0),e.push(p.i/s|0),mo(n),mo(n.next),n=i=p),n=n.next}while(n!==i);return ka(n)}function Td(i,e,s,n,l,p){var f=i;do{for(var m=f.next.next;m!==f.prev;){if(f.i!==m.i&&zd(f,m)){var x=Eu(f,m);return f=ka(f,f.next),x=ka(x,x.next),po(f,e,s,n,l,p,0),void po(x,e,s,n,l,p,0)}m=m.next}f=f.next}while(f!==i)}function Md(i,e){return i.x-e.x}function Cd(i,e){var s=function(l,p){var f,m=p,x=l.x,w=l.y,S=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){var C=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(C<=x&&C>S&&(S=C,f=m.x<m.next.x?m:m.next,C===x))return f}m=m.next}while(m!==p);if(!f)return null;var A,P=f,D=f.x,B=f.y,U=1/0;m=f;do x>=m.x&&m.x>=D&&x!==m.x&&dn(w<B?x:S,w,D,B,w<B?S:x,w,m.x,m.y)&&(A=Math.abs(w-m.y)/(x-m.x),fo(m,l)&&(A<U||A===U&&(m.x>f.x||m.x===f.x&&kd(f,m)))&&(f=m,U=A)),m=m.next;while(m!==P);return f}(i,e);if(!s)return e;var n=Eu(s,i);return ka(n,n.next),ka(s,s.next)}function kd(i,e){return _i(i.prev,i,e.prev)<0&&_i(e.next,i,i.next)<0}function xc(i,e,s,n,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ad(i){var e=i,s=i;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==i);return s}function dn(i,e,s,n,l,p,f,m){return(l-f)*(e-m)>=(i-f)*(p-m)&&(i-f)*(n-m)>=(s-f)*(e-m)&&(s-f)*(p-m)>=(l-f)*(n-m)}function zd(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(s,n){var l=s;do{if(l.i!==s.i&&l.next.i!==s.i&&l.i!==n.i&&l.next.i!==n.i&&zu(l,l.next,s,n))return!0;l=l.next}while(l!==s);return!1}(i,e)&&(fo(i,e)&&fo(e,i)&&function(s,n){var l=s,p=!1,f=(s.x+n.x)/2,m=(s.y+n.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&f<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(p=!p),l=l.next;while(l!==s);return p}(i,e)&&(_i(i.prev,i,e.prev)||_i(i,e.prev,e))||Il(i,e)&&_i(i.prev,i,i.next)>0&&_i(e.prev,e,e.next)>0)}function _i(i,e,s){return(e.y-i.y)*(s.x-e.x)-(e.x-i.x)*(s.y-e.y)}function Il(i,e){return i.x===e.x&&i.y===e.y}function zu(i,e,s,n){var l=Tl(_i(i,e,s)),p=Tl(_i(i,e,n)),f=Tl(_i(s,n,i)),m=Tl(_i(s,n,e));return l!==p&&f!==m||!(l!==0||!Sl(i,s,e))||!(p!==0||!Sl(i,n,e))||!(f!==0||!Sl(s,i,n))||!(m!==0||!Sl(s,e,n))}function Sl(i,e,s){return e.x<=Math.max(i.x,s.x)&&e.x>=Math.min(i.x,s.x)&&e.y<=Math.max(i.y,s.y)&&e.y>=Math.min(i.y,s.y)}function Tl(i){return i>0?1:i<0?-1:0}function fo(i,e){return _i(i.prev,i,i.next)<0?_i(i,e,i.next)>=0&&_i(i,i.prev,e)>=0:_i(i,e,i.prev)<0||_i(i,i.next,e)<0}function Eu(i,e){var s=new vc(i.i,i.x,i.y),n=new vc(e.i,e.x,e.y),l=i.next,p=e.prev;return i.next=e,e.prev=i,s.next=l,l.prev=s,n.next=s,s.prev=n,p.next=n,n.prev=p,n}function Pu(i,e,s,n){var l=new vc(i,e,s);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function mo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function vc(i,e,s){this.i=i,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bc(i,e,s,n){for(var l=0,p=e,f=s-n;p<s;p+=n)l+=(i[f]-i[p])*(i[p+1]+i[f+1]),f=p;return l}yc.exports=wl,yc.exports.default=wl,wl.deviation=function(i,e,s,n){var l=e&&e.length,p=Math.abs(bc(i,0,l?e[0]*s:i.length,s));if(l)for(var f=0,m=e.length;f<m;f++)p-=Math.abs(bc(i,e[f]*s,f<m-1?e[f+1]*s:i.length,s));var x=0;for(f=0;f<n.length;f+=3){var w=n[f]*s,S=n[f+1]*s,C=n[f+2]*s;x+=Math.abs((i[w]-i[C])*(i[S+1]-i[w+1])-(i[w]-i[S])*(i[C+1]-i[w+1]))}return p===0&&x===0?0:Math.abs((x-p)/p)},wl.flatten=function(i){for(var e=i[0][0].length,s={vertices:[],holes:[],dimensions:e},n=0,l=0;l<i.length;l++){for(var p=0;p<i[l].length;p++)for(var f=0;f<e;f++)s.vertices.push(i[l][p][f]);l>0&&s.holes.push(n+=i[l-1].length)}return s};var Du=Y(yc.exports);function Ed(i,e,s,n,l){Lu(i,e,s,n||i.length-1,l||Pd)}function Lu(i,e,s,n,l){for(;n>s;){if(n-s>600){var p=n-s+1,f=e-s+1,m=Math.log(p),x=.5*Math.exp(2*m/3),w=.5*Math.sqrt(m*x*(p-x)/p)*(f-p/2<0?-1:1);Lu(i,e,Math.max(s,Math.floor(e-f*x/p+w)),Math.min(n,Math.floor(e+(p-f)*x/p+w)),l)}var S=i[e],C=s,A=n;for(go(i,s,e),l(i[n],S)>0&&go(i,s,n);C<A;){for(go(i,C,A),C++,A--;l(i[C],S)<0;)C++;for(;l(i[A],S)>0;)A--}l(i[s],S)===0?go(i,s,A):go(i,++A,n),A<=e&&(s=A+1),e<=A&&(n=A-1)}}function go(i,e,s){var n=i[e];i[e]=i[s],i[s]=n}function Pd(i,e){return i<e?-1:i>e?1:0}function wc(i,e){const s=i.length;if(s<=1)return[i];const n=[];let l,p;for(let f=0;f<s;f++){const m=Ii(i[f]);m!==0&&(i[f].area=Math.abs(m),p===void 0&&(p=m<0),p===m<0?(l&&n.push(l),l=[i[f]]):l.push(i[f]))}if(l&&n.push(l),e>1)for(let f=0;f<n.length;f++)n[f].length<=e||(Ed(n[f],e,1,n[f].length-1,Dd),n[f]=n[f].slice(0,e));return n}function Dd(i,e){return e.area-i.area}function Ic(i,e,s){const n=s.patternDependencies;let l=!1;for(const p of e){const f=p.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const m=f.constantOr(null);m&&(l=!0,n[m.to]=!0,n[m.from]=!0)}return l}function Sc(i,e,s,n,l){const p=l.patternDependencies;for(const f of e){const m=f.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let x=m.evaluate({zoom:n-1},s,{},l.availableImages),w=m.evaluate({zoom:n},s,{},l.availableImages),S=m.evaluate({zoom:n+1},s,{},l.availableImages);x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,p[x]=!0,p[w]=!0,p[S]=!0,s.patterns[f.id]={min:x,mid:w,max:S}}}return s}class Tc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new St,this.indexArray=new Oi,this.indexArray2=new Si,this.programConfigurations=new os(e.layers,e.zoom),this.segments=new Kt,this.segments2=new Kt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,n){this.hasPattern=Ic("fill",this.layers,s);const l=this.layers[0].layout.get("fill-sort-key"),p=!l.isConstant(),f=[];for(const{feature:m,id:x,index:w,sourceLayerIndex:S}of e){const C=this.layers[0]._featureFilter.needGeometry,A=Ca(m,C);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),A,n))continue;const P=p?l.evaluate(A,{},n,s.availableImages):void 0,D={id:x,properties:m.properties,type:m.type,sourceLayerIndex:S,index:w,geometry:C?A.geometry:Ma(m),patterns:{},sortKey:P};f.push(D)}p&&f.sort((m,x)=>m.sortKey-x.sortKey);for(const m of f){const{geometry:x,index:w,sourceLayerIndex:S}=m;if(this.hasPattern){const C=Sc("fill",this.layers,m,this.zoom,s);this.patternFeatures.push(C)}else this.addFeature(m,x,w,n,{});s.featureIndex.insert(e[w].feature,x,w,S,this.index)}}update(e,s,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,n)}addFeatures(e,s,n){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,s,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,n,l,p){for(const f of wc(s,500)){let m=0;for(const P of f)m+=P.length;const x=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),w=x.vertexLength,S=[],C=[];for(const P of f){if(P.length===0)continue;P!==f[0]&&C.push(S.length/2);const D=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),B=D.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(B+P.length-1,B),S.push(P[0].x),S.push(P[0].y);for(let U=1;U<P.length;U++)this.layoutVertexArray.emplaceBack(P[U].x,P[U].y),this.indexArray2.emplaceBack(B+U-1,B+U),S.push(P[U].x),S.push(P[U].y);D.vertexLength+=P.length,D.primitiveLength+=P.length}const A=Du(S,C);for(let P=0;P<A.length;P+=3)this.indexArray.emplaceBack(w+A[P],w+A[P+1],w+A[P+2]);x.vertexLength+=m,x.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,p,l)}}let Fu,Bu;Ne("FillBucket",Tc,{omit:["layers","patternFeatures"]});var Ld={get paint(){return Bu=Bu||new mi({"fill-antialias":new Ye(oe.paint_fill["fill-antialias"]),"fill-opacity":new tt(oe.paint_fill["fill-opacity"]),"fill-color":new tt(oe.paint_fill["fill-color"]),"fill-outline-color":new tt(oe.paint_fill["fill-outline-color"]),"fill-translate":new Ye(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ia(oe.paint_fill["fill-pattern"])})},get layout(){return Fu=Fu||new mi({"fill-sort-key":new tt(oe.layout_fill["fill-sort-key"])})}};class Fd extends Pr{constructor(e){super(e,Ld)}recalculate(e,s){super.recalculate(e,s);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Tc(e)}queryRadius(){return xl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,s,n,l,p,f,m){return _u(vl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,m),l)}isTileClipped(){return!0}}const Bd=ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Rd=ai([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Od}=Bd;var ra={},Vd=pt,Ru=pn;function pn(i,e,s,n,l){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=l,i.readFields(Nd,this,e)}function Nd(i,e,s){i==1?e.id=s.readVarint():i==2?function(n,l){for(var p=n.readVarint()+n.pos;n.pos<p;){var f=l._keys[n.readVarint()],m=l._values[n.readVarint()];l.properties[f]=m}}(s,e):i==3?e.type=s.readVarint():i==4&&(e._geometry=s.pos)}function jd(i){for(var e,s,n=0,l=0,p=i.length,f=p-1;l<p;f=l++)n+=((s=i[f]).x-(e=i[l]).x)*(e.y+s.y);return n}pn.types=["Unknown","Point","LineString","Polygon"],pn.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,s=i.readVarint()+i.pos,n=1,l=0,p=0,f=0,m=[];i.pos<s;){if(l<=0){var x=i.readVarint();n=7&x,l=x>>3}if(l--,n===1||n===2)p+=i.readSVarint(),f+=i.readSVarint(),n===1&&(e&&m.push(e),e=[]),e.push(new Vd(p,f));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&m.push(e),m},pn.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,s=1,n=0,l=0,p=0,f=1/0,m=-1/0,x=1/0,w=-1/0;i.pos<e;){if(n<=0){var S=i.readVarint();s=7&S,n=S>>3}if(n--,s===1||s===2)(l+=i.readSVarint())<f&&(f=l),l>m&&(m=l),(p+=i.readSVarint())<x&&(x=p),p>w&&(w=p);else if(s!==7)throw new Error("unknown command "+s)}return[f,x,m,w]},pn.prototype.toGeoJSON=function(i,e,s){var n,l,p=this.extent*Math.pow(2,s),f=this.extent*i,m=this.extent*e,x=this.loadGeometry(),w=pn.types[this.type];function S(P){for(var D=0;D<P.length;D++){var B=P[D];P[D]=[360*(B.x+f)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+m)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(n=0;n<x.length;n++)C[n]=x[n][0];S(x=C);break;case 2:for(n=0;n<x.length;n++)S(x[n]);break;case 3:for(x=function(P){var D=P.length;if(D<=1)return[P];for(var B,U,G=[],Q=0;Q<D;Q++){var W=jd(P[Q]);W!==0&&(U===void 0&&(U=W<0),U===W<0?(B&&G.push(B),B=[P[Q]]):B.push(P[Q]))}return B&&G.push(B),G}(x),n=0;n<x.length;n++)for(l=0;l<x[n].length;l++)S(x[n][l])}x.length===1?x=x[0]:w="Multi"+w;var A={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var Ud=Ru,Ou=Vu;function Vu(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Zd,this,e),this.length=this._features.length}function Zd(i,e,s){i===15?e.version=s.readVarint():i===1?e.name=s.readString():i===5?e.extent=s.readVarint():i===2?e._features.push(s.pos):i===3?e._keys.push(s.readString()):i===4&&e._values.push(function(n){for(var l=null,p=n.readVarint()+n.pos;n.pos<p;){var f=n.readVarint()>>3;l=f===1?n.readString():f===2?n.readFloat():f===3?n.readDouble():f===4?n.readVarint64():f===5?n.readVarint():f===6?n.readSVarint():f===7?n.readBoolean():null}return l}(s))}Vu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Ud(this._pbf,e,this.extent,this._keys,this._values)};var qd=Ou;function Gd(i,e,s){if(i===3){var n=new qd(s,s.readVarint()+s.pos);n.length&&(e[n.name]=n)}}ra.VectorTile=function(i,e){this.layers=i.readFields(Gd,{},e)},ra.VectorTileFeature=Ru,ra.VectorTileLayer=Ou;const $d=ra.VectorTileFeature.types,Mc=Math.pow(2,13);function _o(i,e,s,n,l,p,f,m){i.emplaceBack(e,s,2*Math.floor(n*Mc)+f,l*Mc*2,p*Mc*2,Math.round(m))}class Cc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new De,this.centroidVertexArray=new Te,this.indexArray=new Oi,this.programConfigurations=new os(e.layers,e.zoom),this.segments=new Kt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,n){this.features=[],this.hasPattern=Ic("fill-extrusion",this.layers,s);for(const{feature:l,id:p,index:f,sourceLayerIndex:m}of e){const x=this.layers[0]._featureFilter.needGeometry,w=Ca(l,x);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),w,n))continue;const S={id:p,sourceLayerIndex:m,index:f,geometry:x?w.geometry:Ma(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Sc("fill-extrusion",this.layers,S,this.zoom,s)):this.addFeature(S,S.geometry,f,n,{}),s.featureIndex.insert(l,S.geometry,f,m,this.index,!0)}}addFeatures(e,s,n){for(const l of this.features){const{geometry:p}=l;this.addFeature(l,p,l.index,s,n)}}update(e,s,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Od),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rd.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,n,l,p){const f={x:0,y:0,vertexCount:0};for(const m of wc(s,500)){let x=0;for(const D of m)x+=D.length;let w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const D of m){if(D.length===0||Xd(D))continue;let B=0;for(let U=0;U<D.length;U++){const G=D[U];if(U>=1){const Q=D[U-1];if(!Wd(G,Q)){w.vertexLength+4>Kt.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const W=G.sub(Q)._perp()._unit(),te=Q.dist(G);B+te>32768&&(B=0),_o(this.layoutVertexArray,G.x,G.y,W.x,W.y,0,0,B),_o(this.layoutVertexArray,G.x,G.y,W.x,W.y,0,1,B),f.x+=2*G.x,f.y+=2*G.y,f.vertexCount+=2,B+=te,_o(this.layoutVertexArray,Q.x,Q.y,W.x,W.y,0,0,B),_o(this.layoutVertexArray,Q.x,Q.y,W.x,W.y,0,1,B),f.x+=2*Q.x,f.y+=2*Q.y,f.vertexCount+=2;const re=w.vertexLength;this.indexArray.emplaceBack(re,re+2,re+1),this.indexArray.emplaceBack(re+1,re+2,re+3),w.vertexLength+=4,w.primitiveLength+=2}}}}if(w.vertexLength+x>Kt.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),$d[e.type]!=="Polygon")continue;const S=[],C=[],A=w.vertexLength;for(const D of m)if(D.length!==0){D!==m[0]&&C.push(S.length/2);for(let B=0;B<D.length;B++){const U=D[B];_o(this.layoutVertexArray,U.x,U.y,0,0,1,1,0),f.x+=U.x,f.y+=U.y,f.vertexCount+=1,S.push(U.x),S.push(U.y)}}const P=Du(S,C);for(let D=0;D<P.length;D+=3)this.indexArray.emplaceBack(A+P[D],A+P[D+2],A+P[D+1]);w.primitiveLength+=P.length/3,w.vertexLength+=x}for(let m=0;m<f.vertexCount;m++)this.centroidVertexArray.emplaceBack(Math.floor(f.x/f.vertexCount),Math.floor(f.y/f.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,p,l)}}function Wd(i,e){return i.x===e.x&&(i.x<0||i.x>vi)||i.y===e.y&&(i.y<0||i.y>vi)}function Xd(i){return i.every(e=>e.x<0)||i.every(e=>e.x>vi)||i.every(e=>e.y<0)||i.every(e=>e.y>vi)}let Nu;Ne("FillExtrusionBucket",Cc,{omit:["layers","features"]});var Yd={get paint(){return Nu=Nu||new mi({"fill-extrusion-opacity":new Ye(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tt(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ia(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tt(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tt(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Jd extends Pr{constructor(e){super(e,Yd)}createBucket(e){return new Cc(e)}queryRadius(){return xl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,s,n,l,p,f,m,x){const w=vl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,m),S=this.paint.get("fill-extrusion-height").evaluate(s,n),C=this.paint.get("fill-extrusion-base").evaluate(s,n),A=function(D,B,U,G){const Q=[];for(const W of D){const te=[W.x,W.y,0,1];bl(te,te,B),Q.push(new _e(te[0]/te[3],te[1]/te[3]))}return Q}(w,x),P=function(D,B,U,G){const Q=[],W=[],te=G[8]*B,re=G[9]*B,de=G[10]*B,Re=G[11]*B,Ge=G[8]*U,Fe=G[9]*U,Le=G[10]*U,ke=G[11]*U;for(const Ue of D){const Ee=[],we=[];for(const Ke of Ue){const Xe=Ke.x,bt=Ke.y,Qt=G[0]*Xe+G[4]*bt+G[12],ti=G[1]*Xe+G[5]*bt+G[13],Ci=G[2]*Xe+G[6]*bt+G[14],Lr=G[3]*Xe+G[7]*bt+G[15],cr=Ci+de,bi=Lr+Re,Ni=Qt+Ge,Wi=ti+Fe,ur=Ci+Le,hr=Lr+ke,ki=new _e((Qt+te)/bi,(ti+re)/bi);ki.z=cr/bi,Ee.push(ki);const Ai=new _e(Ni/hr,Wi/hr);Ai.z=ur/hr,we.push(Ai)}Q.push(Ee),W.push(we)}return[Q,W]}(l,C,S,x);return function(D,B,U){let G=1/0;_u(U,B)&&(G=ju(U,B[0]));for(let Q=0;Q<B.length;Q++){const W=B[Q],te=D[Q];for(let re=0;re<W.length-1;re++){const de=W[re],Re=[de,W[re+1],te[re+1],te[re],de];gu(U,Re)&&(G=Math.min(G,ju(U,Re)))}}return G!==1/0&&G}(P[0],P[1],A)}}function yo(i,e){return i.x*e.x+i.y*e.y}function ju(i,e){if(i.length===1){let s=0;const n=e[s++];let l;for(;!l||n.equals(l);)if(l=e[s++],!l)return 1/0;for(;s<e.length;s++){const p=e[s],f=i[0],m=l.sub(n),x=p.sub(n),w=f.sub(n),S=yo(m,m),C=yo(m,x),A=yo(x,x),P=yo(w,m),D=yo(w,x),B=S*A-C*C,U=(A*P-C*D)/B,G=(S*D-C*P)/B,Q=n.z*(1-U-G)+l.z*U+p.z*G;if(isFinite(Q))return Q}return 1/0}{let s=1/0;for(const n of e)s=Math.min(s,n.z);return s}}const Hd=ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Kd}=Hd,Qd=ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ep}=Qd,tp=ra.VectorTileFeature.types,ip=Math.cos(Math.PI/180*37.5),Uu=Math.pow(2,14)/.5;class kc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new it,this.layoutVertexArray2=new $e,this.indexArray=new Oi,this.programConfigurations=new os(e.layers,e.zoom),this.segments=new Kt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,n){this.hasPattern=Ic("line",this.layers,s);const l=this.layers[0].layout.get("line-sort-key"),p=!l.isConstant(),f=[];for(const{feature:m,id:x,index:w,sourceLayerIndex:S}of e){const C=this.layers[0]._featureFilter.needGeometry,A=Ca(m,C);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),A,n))continue;const P=p?l.evaluate(A,{},n):void 0,D={id:x,properties:m.properties,type:m.type,sourceLayerIndex:S,index:w,geometry:C?A.geometry:Ma(m),patterns:{},sortKey:P};f.push(D)}p&&f.sort((m,x)=>m.sortKey-x.sortKey);for(const m of f){const{geometry:x,index:w,sourceLayerIndex:S}=m;if(this.hasPattern){const C=Sc("line",this.layers,m,this.zoom,s);this.patternFeatures.push(C)}else this.addFeature(m,x,w,n,{});s.featureIndex.insert(e[w].feature,x,w,S,this.index)}}update(e,s,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,n)}addFeatures(e,s,n){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,s,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ep)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,n,l,p){const f=this.layers[0].layout,m=f.get("line-join").evaluate(e,{}),x=f.get("line-cap"),w=f.get("line-miter-limit"),S=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of s)this.addLine(C,e,m,x,w,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,p,l)}addLine(e,s,n,l,p,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=tp[s.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let w=0;for(;w<x-1&&e[w].equals(e[w+1]);)w++;if(x<(m?3:2))return;n==="bevel"&&(p=1.05);const S=this.overscaling<=16?15*vi/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,P,D,B,U;this.e1=this.e2=-1,m&&(A=e[x-2],U=e[w].sub(A)._unit()._perp());for(let G=w;G<x;G++){if(D=G===x-1?m?e[w+1]:void 0:e[G+1],D&&e[G].equals(D))continue;U&&(B=U),A&&(P=A),A=e[G],U=D?D.sub(A)._unit()._perp():B,B=B||U;let Q=B.add(U);Q.x===0&&Q.y===0||Q._unit();const W=B.x*U.x+B.y*U.y,te=Q.x*U.x+Q.y*U.y,re=te!==0?1/te:1/0,de=2*Math.sqrt(2-2*te),Re=te<ip&&P&&D,Ge=B.x*U.y-B.y*U.x>0;if(Re&&G>w){const ke=A.dist(P);if(ke>2*S){const Ue=A.sub(A.sub(P)._mult(S/ke)._round());this.updateDistance(P,Ue),this.addCurrentVertex(Ue,B,0,0,C),P=Ue}}const Fe=P&&D;let Le=Fe?n:m?"butt":l;if(Fe&&Le==="round"&&(re<f?Le="miter":re<=2&&(Le="fakeround")),Le==="miter"&&re>p&&(Le="bevel"),Le==="bevel"&&(re>2&&(Le="flipbevel"),re<p&&(Le="miter")),P&&this.updateDistance(P,A),Le==="miter")Q._mult(re),this.addCurrentVertex(A,Q,0,0,C);else if(Le==="flipbevel"){if(re>100)Q=U.mult(-1);else{const ke=re*B.add(U).mag()/B.sub(U).mag();Q._perp()._mult(ke*(Ge?-1:1))}this.addCurrentVertex(A,Q,0,0,C),this.addCurrentVertex(A,Q.mult(-1),0,0,C)}else if(Le==="bevel"||Le==="fakeround"){const ke=-Math.sqrt(re*re-1),Ue=Ge?ke:0,Ee=Ge?0:ke;if(P&&this.addCurrentVertex(A,B,Ue,Ee,C),Le==="fakeround"){const we=Math.round(180*de/Math.PI/20);for(let Ke=1;Ke<we;Ke++){let Xe=Ke/we;if(Xe!==.5){const Qt=Xe-.5;Xe+=Xe*Qt*(Xe-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*Qt*Qt+(.848013+W*(.215638*W-1.06021)))}const bt=U.sub(B)._mult(Xe)._add(B)._unit()._mult(Ge?-1:1);this.addHalfVertex(A,bt.x,bt.y,!1,Ge,0,C)}}D&&this.addCurrentVertex(A,U,-Ue,-Ee,C)}else if(Le==="butt")this.addCurrentVertex(A,Q,0,0,C);else if(Le==="square"){const ke=P?1:-1;this.addCurrentVertex(A,Q,ke,ke,C)}else Le==="round"&&(P&&(this.addCurrentVertex(A,B,0,0,C),this.addCurrentVertex(A,B,1,1,C,!0)),D&&(this.addCurrentVertex(A,U,-1,-1,C,!0),this.addCurrentVertex(A,U,0,0,C)));if(Re&&G<x-1){const ke=A.dist(D);if(ke>2*S){const Ue=A.add(D.sub(A)._mult(S/ke)._round());this.updateDistance(A,Ue),this.addCurrentVertex(Ue,U,0,0,C),A=Ue}}}}addCurrentVertex(e,s,n,l,p,f=!1){const m=s.y*l-s.x,x=-s.y-s.x*l;this.addHalfVertex(e,s.x+s.y*n,s.y-s.x*n,f,!1,n,p),this.addHalfVertex(e,m,x,f,!0,-l,p),this.distance>Uu/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,s,n,l,p,f))}addHalfVertex({x:e,y:s},n,l,p,f,m,x){const w=.5*(this.lineClips?this.scaledDistance*(Uu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(s<<1)+(f?1:0),Math.round(63*n)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const S=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),x.primitiveLength++),f?this.e2=S:this.e1=S}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}let Zu,qu;Ne("LineBucket",kc,{omit:["layers","patternFeatures"]});var Gu={get paint(){return qu=qu||new mi({"line-opacity":new tt(oe.paint_line["line-opacity"]),"line-color":new tt(oe.paint_line["line-color"]),"line-translate":new Ye(oe.paint_line["line-translate"]),"line-translate-anchor":new Ye(oe.paint_line["line-translate-anchor"]),"line-width":new tt(oe.paint_line["line-width"]),"line-gap-width":new tt(oe.paint_line["line-gap-width"]),"line-offset":new tt(oe.paint_line["line-offset"]),"line-blur":new tt(oe.paint_line["line-blur"]),"line-dasharray":new eo(oe.paint_line["line-dasharray"]),"line-pattern":new Ia(oe.paint_line["line-pattern"]),"line-gradient":new to(oe.paint_line["line-gradient"])})},get layout(){return Zu=Zu||new mi({"line-cap":new Ye(oe.layout_line["line-cap"]),"line-join":new tt(oe.layout_line["line-join"]),"line-miter-limit":new Ye(oe.layout_line["line-miter-limit"]),"line-round-limit":new Ye(oe.layout_line["line-round-limit"]),"line-sort-key":new tt(oe.layout_line["line-sort-key"])})}};class rp extends tt{possiblyEvaluate(e,s){return s=new Ht(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(e,s)}evaluate(e,s,n,l){return s=jt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,n,l)}}let Ml;class sp extends Pr{constructor(e){super(e,Gu),this.gradientVersion=0,Ml||(Ml=new rp(Gu.paint.properties["line-width"].specification),Ml.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(n){return n._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof ms,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,s){super.recalculate(e,s),this.paint._values["line-floorwidth"]=Ml.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new kc(e)}queryRadius(e){const s=e,n=$u(co("line-width",this,s),co("line-gap-width",this,s)),l=co("line-offset",this,s);return n/2+Math.abs(l)+xl(this.paint.get("line-translate"))}queryIntersectsFeature(e,s,n,l,p,f,m){const x=vl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,m),w=m/2*$u(this.paint.get("line-width").evaluate(s,n),this.paint.get("line-gap-width").evaluate(s,n)),S=this.paint.get("line-offset").evaluate(s,n);return S&&(l=function(C,A){const P=[];for(let D=0;D<C.length;D++){const B=C[D],U=[];for(let G=0;G<B.length;G++){const Q=B[G-1],W=B[G],te=B[G+1],re=G===0?new _e(0,0):W.sub(Q)._unit()._perp(),de=G===B.length-1?new _e(0,0):te.sub(W)._unit()._perp(),Re=re._add(de)._unit(),Ge=Re.x*de.x+Re.y*de.y;Ge!==0&&Re._mult(1/Ge),U.push(Re._mult(A)._add(W))}P.push(U)}return P}(l,S*m)),function(C,A,P){for(let D=0;D<A.length;D++){const B=A[D];if(C.length>=3){for(let U=0;U<B.length;U++)if(un(C,B[U]))return!0}if(ud(C,B,P))return!0}return!1}(x,l,w)}isTileClipped(){return!0}}function $u(i,e){return e>0?e+2*i:i}const ap=ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),np=ai([{name:"a_projected_pos",components:3,type:"Float32"}],4);ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const op=ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wu=ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lp=ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function cp(i,e,s){return i.sections.forEach(n=>{n.text=function(l,p,f){const m=p.layout.get("text-transform").evaluate(f,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),yr.applyArabicShaping&&(l=yr.applyArabicShaping(l)),l}(n.text,e,s)}),i}ai([{name:"triangle",components:3,type:"Uint16"}]),ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ai([{type:"Float32",name:"offsetX"}]),ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ai([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xo={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var Mi=24,Xu=$t,Yu=function(i,e,s,n,l){var p,f,m=8*l-n-1,x=(1<<m)-1,w=x>>1,S=-7,C=l-1,A=-1,P=i[e+C];for(C+=A,p=P&(1<<-S)-1,P>>=-S,S+=m;S>0;p=256*p+i[e+C],C+=A,S-=8);for(f=p&(1<<-S)-1,p>>=-S,S+=n;S>0;f=256*f+i[e+C],C+=A,S-=8);if(p===0)p=1-w;else{if(p===x)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,n),p-=w}return(P?-1:1)*f*Math.pow(2,p-n)},Ju=function(i,e,s,n,l,p){var f,m,x,w=8*p-l-1,S=(1<<w)-1,C=S>>1,A=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=0,D=1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,f=S):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+C>=1?A/x:A*Math.pow(2,1-C))*x>=2&&(f++,x/=2),f+C>=S?(m=0,f=S):f+C>=1?(m=(e*x-1)*Math.pow(2,l),f+=C):(m=e*Math.pow(2,C-1)*Math.pow(2,l),f=0));l>=8;i[s+P]=255&m,P+=D,m/=256,l-=8);for(f=f<<l|m,w+=l;w>0;i[s+P]=255&f,P+=D,f/=256,w-=8);i[s+P-D]|=128*B};function $t(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var Ac=4294967296,Hu=1/Ac,Ku=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Rs(i){return i.type===$t.Bytes?i.readVarint()+i.pos:i.pos+1}function fn(i,e,s){return s?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Qu(i,e,s){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(n);for(var l=s.pos-1;l>=i;l--)s.buf[l+n]=s.buf[l]}function up(i,e){for(var s=0;s<i.length;s++)e.writeVarint(i[s])}function hp(i,e){for(var s=0;s<i.length;s++)e.writeSVarint(i[s])}function dp(i,e){for(var s=0;s<i.length;s++)e.writeFloat(i[s])}function pp(i,e){for(var s=0;s<i.length;s++)e.writeDouble(i[s])}function fp(i,e){for(var s=0;s<i.length;s++)e.writeBoolean(i[s])}function mp(i,e){for(var s=0;s<i.length;s++)e.writeFixed32(i[s])}function gp(i,e){for(var s=0;s<i.length;s++)e.writeSFixed32(i[s])}function _p(i,e){for(var s=0;s<i.length;s++)e.writeFixed64(i[s])}function yp(i,e){for(var s=0;s<i.length;s++)e.writeSFixed64(i[s])}function Cl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function mn(i,e,s){i[s]=e,i[s+1]=e>>>8,i[s+2]=e>>>16,i[s+3]=e>>>24}function eh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}$t.prototype={destroy:function(){this.buf=null},readFields:function(i,e,s){for(s=s||this.length;this.pos<s;){var n=this.readVarint(),l=n>>3,p=this.pos;this.type=7&n,i(l,e,this),this.pos===p&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Cl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=eh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cl(this.buf,this.pos)+Cl(this.buf,this.pos+4)*Ac;return this.pos+=8,i},readSFixed64:function(){var i=Cl(this.buf,this.pos)+eh(this.buf,this.pos+4)*Ac;return this.pos+=8,i},readFloat:function(){var i=Yu(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Yu(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,s,n=this.buf;return e=127&(s=n[this.pos++]),s<128?e:(e|=(127&(s=n[this.pos++]))<<7,s<128?e:(e|=(127&(s=n[this.pos++]))<<14,s<128?e:(e|=(127&(s=n[this.pos++]))<<21,s<128?e:function(l,p,f){var m,x,w=f.buf;if(m=(112&(x=w[f.pos++]))>>4,x<128||(m|=(127&(x=w[f.pos++]))<<3,x<128)||(m|=(127&(x=w[f.pos++]))<<10,x<128)||(m|=(127&(x=w[f.pos++]))<<17,x<128)||(m|=(127&(x=w[f.pos++]))<<24,x<128)||(m|=(1&(x=w[f.pos++]))<<31,x<128))return fn(l,m,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Ku?function(s,n,l){return Ku.decode(s.subarray(n,l))}(this.buf,e,i):function(s,n,l){for(var p="",f=n;f<l;){var m,x,w,S=s[f],C=null,A=S>239?4:S>223?3:S>191?2:1;if(f+A>l)break;A===1?S<128&&(C=S):A===2?(192&(m=s[f+1]))==128&&(C=(31&S)<<6|63&m)<=127&&(C=null):A===3?(x=s[f+2],(192&(m=s[f+1]))==128&&(192&x)==128&&((C=(15&S)<<12|(63&m)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):A===4&&(x=s[f+2],w=s[f+3],(192&(m=s[f+1]))==128&&(192&x)==128&&(192&w)==128&&((C=(15&S)<<18|(63&m)<<12|(63&x)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,A=1):C>65535&&(C-=65536,p+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),p+=String.fromCharCode(C),f+=A}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==$t.Bytes)return i.push(this.readVarint(e));var s=Rs(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==$t.Bytes)return i.push(this.readSVarint());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==$t.Bytes)return i.push(this.readBoolean());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==$t.Bytes)return i.push(this.readFloat());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==$t.Bytes)return i.push(this.readDouble());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==$t.Bytes)return i.push(this.readFixed32());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==$t.Bytes)return i.push(this.readSFixed32());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==$t.Bytes)return i.push(this.readFixed64());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==$t.Bytes)return i.push(this.readSFixed64());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===$t.Varint)for(;this.buf[this.pos++]>127;);else if(e===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$t.Fixed32)this.pos+=4;else{if(e!==$t.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),mn(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),mn(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),mn(this.buf,-1&i,this.pos),mn(this.buf,Math.floor(i*Hu),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),mn(this.buf,-1&i,this.pos),mn(this.buf,Math.floor(i*Hu),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,s){var n,l;if(e>=0?(n=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,f,m){m.buf[m.pos++]=127&p|128,p>>>=7,m.buf[m.pos++]=127&p|128,p>>>=7,m.buf[m.pos++]=127&p|128,p>>>=7,m.buf[m.pos++]=127&p|128,m.buf[m.pos]=127&(p>>>=7)}(n,0,s),function(p,f){var m=(7&p)<<4;f.buf[f.pos++]|=m|((p>>>=3)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p)))))}(l,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,l,p){for(var f,m,x=0;x<l.length;x++){if((f=l.charCodeAt(x))>55295&&f<57344){if(!m){f>56319||x+1===l.length?(n[p++]=239,n[p++]=191,n[p++]=189):m=f;continue}if(f<56320){n[p++]=239,n[p++]=191,n[p++]=189,m=f;continue}f=m-55296<<10|f-56320|65536,m=null}else m&&(n[p++]=239,n[p++]=191,n[p++]=189,m=null);f<128?n[p++]=f:(f<2048?n[p++]=f>>6|192:(f<65536?n[p++]=f>>12|224:(n[p++]=f>>18|240,n[p++]=f>>12&63|128),n[p++]=f>>6&63|128),n[p++]=63&f|128)}return p}(this.buf,i,this.pos);var s=this.pos-e;s>=128&&Qu(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),Ju(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ju(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,e){this.pos++;var s=this.pos;i(e,this);var n=this.pos-s;n>=128&&Qu(s,n,this),this.pos=s-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,s){this.writeTag(i,$t.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,up,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,hp,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,fp,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,dp,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,pp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,mp,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,gp,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,_p,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,yp,e)},writeBytesField:function(i,e){this.writeTag(i,$t.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,$t.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,$t.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,$t.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,$t.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,$t.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,$t.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,$t.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,$t.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,$t.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var zc=Y(Xu);const Ec=3;function xp(i,e,s){i===1&&s.readMessage(vp,e)}function vp(i,e,s){if(i===3){const{id:n,bitmap:l,width:p,height:f,left:m,top:x,advance:w}=s.readMessage(bp,{});e.push({id:n,bitmap:new ho({width:p+2*Ec,height:f+2*Ec},l),metrics:{width:p,height:f,left:m,top:x,advance:w}})}}function bp(i,e,s){i===1?e.id=s.readVarint():i===2?e.bitmap=s.readBytes():i===3?e.width=s.readVarint():i===4?e.height=s.readVarint():i===5?e.left=s.readSVarint():i===6?e.top=s.readSVarint():i===7&&(e.advance=s.readVarint())}const wp=Ec;function th(i){let e=0,s=0;for(const f of i)e+=f.w*f.h,s=Math.max(s,f.w);i.sort((f,m)=>m.h-f.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let l=0,p=0;for(const f of i)for(let m=n.length-1;m>=0;m--){const x=n[m];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,p=Math.max(p,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===x.w&&f.h===x.h){const w=n.pop();m<n.length&&(n[m]=w)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(n.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:l,h:p,fill:e/(l*p)||0}}const vr=1;class Pc{constructor(e,{pixelRatio:s,version:n,stretchX:l,stretchY:p,content:f}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=l,this.stretchY=p,this.content=f,this.version=n}get tl(){return[this.paddedRect.x+vr,this.paddedRect.y+vr]}get br(){return[this.paddedRect.x+this.paddedRect.w-vr,this.paddedRect.y+this.paddedRect.h-vr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*vr)/this.pixelRatio,(this.paddedRect.h-2*vr)/this.pixelRatio]}}class ih{constructor(e,s){const n={},l={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,n,p),this.addImages(s,l,p);const{w:f,h:m}=th(p),x=new Br({width:f||1,height:m||1});for(const w in e){const S=e[w],C=n[w].paddedRect;Br.copy(S.data,x,{x:0,y:0},{x:C.x+vr,y:C.y+vr},S.data)}for(const w in s){const S=s[w],C=l[w].paddedRect,A=C.x+vr,P=C.y+vr,D=S.data.width,B=S.data.height;Br.copy(S.data,x,{x:0,y:0},{x:A,y:P},S.data),Br.copy(S.data,x,{x:0,y:B-1},{x:A,y:P-1},{width:D,height:1}),Br.copy(S.data,x,{x:0,y:0},{x:A,y:P+B},{width:D,height:1}),Br.copy(S.data,x,{x:D-1,y:0},{x:A-1,y:P},{width:1,height:B}),Br.copy(S.data,x,{x:0,y:0},{x:A+D,y:P},{width:1,height:B})}this.image=x,this.iconPositions=n,this.patternPositions=l}addImages(e,s,n){for(const l in e){const p=e[l],f={x:0,y:0,w:p.data.width+2*vr,h:p.data.height+2*vr};n.push(f),s[l]=new Pc(f,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),s),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),s)}patchUpdatedImage(e,s,n){if(!e||!s||e.version===s.version)return;e.version=s.version;const[l,p]=e.tl;n.update(s.data,void 0,{x:l,y:p})}}var sa;Ne("ImagePosition",Pc),Ne("ImageAtlas",ih),u.ai=void 0,(sa=u.ai||(u.ai={}))[sa.none=0]="none",sa[sa.horizontal=1]="horizontal",sa[sa.vertical=2]="vertical",sa[sa.horizontalOnly=3]="horizontalOnly";const vo=-17;class bo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const n=new bo;return n.scale=e||1,n.fontStack=s,n}static forImage(e){const s=new bo;return s.imageName=e,s}}class gn{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const n=new gn;for(let l=0;l<e.sections.length;l++){const p=e.sections[l];p.image?n.addImageSection(p):n.addTextSection(p,s)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let s="";for(let n=0;n<e.length;n++){const l=e.charCodeAt(n+1)||null,p=e.charCodeAt(n-1)||null;s+=l&&ll(l)&&!xo[e[n+1]]||p&&ll(p)&&!xo[e[n-1]]||!xo[e[n]]?e[n]:xo[e[n]]}return s}(this.text)}trim(){let e=0;for(let n=0;n<this.text.length&&Al[this.text.charCodeAt(n)];n++)e++;let s=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Al[this.text.charCodeAt(n)];n--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const n=new gn;return n.text=this.text.substring(e,s),n.sectionIndex=this.sectionIndex.slice(e,s),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(bo.forText(e.scale,e.fontStack||s));const n=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(n)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void nt("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(bo.forImage(s)),this.sectionIndex.push(this.sections.length-1)):nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kl(i,e,s,n,l,p,f,m,x,w,S,C,A,P,D,B){const U=gn.fromFeature(i,l);let G;C===u.ai.vertical&&U.verticalizePunctuation();const{processBidirectionalText:Q,processStyledBidirectionalText:W}=yr;if(Q&&U.sections.length===1){G=[];const de=Q(U.toString(),Dc(U,w,p,e,n,P,D));for(const Re of de){const Ge=new gn;Ge.text=Re,Ge.sections=U.sections;for(let Fe=0;Fe<Re.length;Fe++)Ge.sectionIndex.push(0);G.push(Ge)}}else if(W){G=[];const de=W(U.text,U.sectionIndex,Dc(U,w,p,e,n,P,D));for(const Re of de){const Ge=new gn;Ge.text=Re[0],Ge.sectionIndex=Re[1],Ge.sections=U.sections,G.push(Ge)}}else G=function(de,Re){const Ge=[],Fe=de.text;let Le=0;for(const ke of Re)Ge.push(de.substring(Le,ke)),Le=ke;return Le<Fe.length&&Ge.push(de.substring(Le,Fe.length)),Ge}(U,Dc(U,w,p,e,n,P,D));const te=[],re={positionedLines:te,text:U.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(de,Re,Ge,Fe,Le,ke,Ue,Ee,we,Ke,Xe,bt){let Qt=0,ti=vo,Ci=0,Lr=0;const cr=Ee==="right"?1:Ee==="left"?0:.5;let bi=0;for(const ki of Le){ki.trim();const Ai=ki.getMaxScale(),Qi=(Ai-1)*Mi,dr={positionedGlyphs:[],lineOffset:0};de.positionedLines[bi]=dr;const er=dr.positionedGlyphs;let br=0;if(!ki.length()){ti+=ke,++bi;continue}for(let zi=0;zi<ki.length();zi++){const Mt=ki.getSection(zi),tr=ki.getSectionIndex(zi),Xi=ki.getCharCode(zi);let Ei=0,Kr=null,ls=null,cs=null,Os=Mi;const Qr=!(we===u.ai.horizontal||!Xe&&!$n(Xi)||Xe&&(Al[Xi]||(Ni=Xi,Be.Arabic(Ni)||Be["Arabic Supplement"](Ni)||Be["Arabic Extended-A"](Ni)||Be["Arabic Presentation Forms-A"](Ni)||Be["Arabic Presentation Forms-B"](Ni))));if(Mt.imageName){const Or=Fe[Mt.imageName];if(!Or)continue;cs=Mt.imageName,de.iconsInText=de.iconsInText||!0,ls=Or.paddedRect;const Ir=Or.displaySize;Mt.scale=Mt.scale*Mi/bt,Kr={width:Ir[0],height:Ir[1],left:vr,top:-3,advance:Qr?Ir[1]:Ir[0]},Ei=Qi+(Mi-Ir[1]*Mt.scale),Os=Kr.advance;const Vs=Qr?Ir[0]*Mt.scale-Mi*Ai:Ir[1]*Mt.scale-Mi*Ai;Vs>0&&Vs>br&&(br=Vs)}else{const Or=Ge[Mt.fontStack],Ir=Or&&Or[Xi];if(Ir&&Ir.rect)ls=Ir.rect,Kr=Ir.metrics;else{const Vs=Re[Mt.fontStack],Co=Vs&&Vs[Xi];if(!Co)continue;Kr=Co.metrics}Ei=(Ai-Mt.scale)*Mi}Qr?(de.verticalizable=!0,er.push({glyph:Xi,imageName:cs,x:Qt,y:ti+Ei,vertical:Qr,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:tr,metrics:Kr,rect:ls}),Qt+=Os*Mt.scale+Ke):(er.push({glyph:Xi,imageName:cs,x:Qt,y:ti+Ei,vertical:Qr,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:tr,metrics:Kr,rect:ls}),Qt+=Kr.advance*Mt.scale+Ke)}er.length!==0&&(Ci=Math.max(Qt-Ke,Ci),Tp(er,0,er.length-1,cr,br)),Qt=0;const wr=ke*Ai+br;dr.lineOffset=Math.max(br,Qi),ti+=wr,Lr=Math.max(wr,Lr),++bi}var Ni;const Wi=ti-vo,{horizontalAlign:ur,verticalAlign:hr}=Lc(Ue);(function(ki,Ai,Qi,dr,er,br,wr,zi,Mt){const tr=(Ai-Qi)*er;let Xi=0;Xi=br!==wr?-zi*dr-vo:(-dr*Mt+.5)*wr;for(const Ei of ki)for(const Kr of Ei.positionedGlyphs)Kr.x+=tr,Kr.y+=Xi})(de.positionedLines,cr,ur,hr,Ci,Lr,ke,Wi,Le.length),de.top+=-hr*Wi,de.bottom=de.top+Wi,de.left+=-ur*Ci,de.right=de.left+Ci}(re,e,s,n,G,f,m,x,C,w,A,B),!function(de){for(const Re of de)if(Re.positionedGlyphs.length!==0)return!1;return!0}(te)&&re}const Al={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ip={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rh(i,e,s,n,l,p){if(e.imageName){const f=n[e.imageName];return f?f.displaySize[0]*e.scale*Mi/p+l:0}{const f=s[e.fontStack],m=f&&f[i];return m?m.metrics.advance*e.scale+l:0}}function sh(i,e,s,n){const l=Math.pow(i-e,2);return n?i<e?l/2:2*l:l+Math.abs(s)*s}function Sp(i,e,s){let n=0;return i===10&&(n-=1e4),s&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function ah(i,e,s,n,l,p){let f=null,m=sh(e,s,l,p);for(const x of n){const w=sh(e-x.x,s,l,p)+x.badness;w<=m&&(f=x,m=w)}return{index:i,x:e,priorBreak:f,badness:m}}function nh(i){return i?nh(i.priorBreak).concat(i.index):[]}function Dc(i,e,s,n,l,p,f){if(p!=="point")return[];if(!i)return[];const m=[],x=function(A,P,D,B,U,G){let Q=0;for(let W=0;W<A.length();W++){const te=A.getSection(W);Q+=rh(A.getCharCode(W),te,B,U,P,G)}return Q/Math.max(1,Math.ceil(Q/D))}(i,e,s,n,l,f),w=i.text.indexOf("â")>=0;let S=0;for(let A=0;A<i.length();A++){const P=i.getSection(A),D=i.getCharCode(A);if(Al[D]||(S+=rh(D,P,n,l,e,f)),A<i.length()-1){const B=!((C=D)<11904||!(Be["Bopomofo Extended"](C)||Be.Bopomofo(C)||Be["CJK Compatibility Forms"](C)||Be["CJK Compatibility Ideographs"](C)||Be["CJK Compatibility"](C)||Be["CJK Radicals Supplement"](C)||Be["CJK Strokes"](C)||Be["CJK Symbols and Punctuation"](C)||Be["CJK Unified Ideographs Extension A"](C)||Be["CJK Unified Ideographs"](C)||Be["Enclosed CJK Letters and Months"](C)||Be["Halfwidth and Fullwidth Forms"](C)||Be.Hiragana(C)||Be["Ideographic Description Characters"](C)||Be["Kangxi Radicals"](C)||Be["Katakana Phonetic Extensions"](C)||Be.Katakana(C)||Be["Vertical Forms"](C)||Be["Yi Radicals"](C)||Be["Yi Syllables"](C)));(Ip[D]||B||P.imageName)&&m.push(ah(A+1,S,x,m,Sp(D,i.getCharCode(A+1),B&&w),!1))}}var C;return nh(ah(i.length(),S,x,m,0,!0))}function Lc(i){let e=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Tp(i,e,s,n,l){if(!n&&!l)return;const p=i[s],f=(i[s].x+p.metrics.advance*p.scale)*n;for(let m=e;m<=s;m++)i[m].x-=f,i[m].y+=l}function Mp(i,e,s){const{horizontalAlign:n,verticalAlign:l}=Lc(s),p=e[0]-i.displaySize[0]*n,f=e[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function oh(i,e,s,n,l,p){const f=i.image;let m;if(f.content){const U=f.content,G=f.pixelRatio||1;m=[U[0]/G,U[1]/G,f.displaySize[0]-U[2]/G,f.displaySize[1]-U[3]/G]}const x=e.left*p,w=e.right*p;let S,C,A,P;s==="width"||s==="both"?(P=l[0]+x-n[3],C=l[0]+w+n[1]):(P=l[0]+(x+w-f.displaySize[0])/2,C=P+f.displaySize[0]);const D=e.top*p,B=e.bottom*p;return s==="height"||s==="both"?(S=l[1]+D-n[0],A=l[1]+B+n[2]):(S=l[1]+(D+B-f.displaySize[1])/2,A=S+f.displaySize[1]),{image:f,top:S,right:C,bottom:A,left:P,collisionPadding:m}}const wo=255,bs=128,aa=wo*bs;function lh(i,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ht(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:l}=s;let p=0;for(;p<n.length&&n[p]<=i;)p++;p=Math.max(0,p-1);let f=p;for(;f<n.length&&n[f]<i+1;)f++;f=Math.min(n.length-1,f);const m=n[p],x=n[f];return s.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:x,minSize:s.evaluate(new Ht(m)),maxSize:s.evaluate(new Ht(x)),interpolationType:l}}}function Fc(i,e,s){let n="never";const l=i.get(e);return l?n=l:i.get(s)&&(n="always"),n}const Cp=ra.VectorTileFeature.types,kp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zl(i,e,s,n,l,p,f,m,x,w,S,C,A){const P=m?Math.min(aa,Math.round(m[0])):0,D=m?Math.min(aa,Math.round(m[1])):0;i.emplaceBack(e,s,Math.round(32*n),Math.round(32*l),p,f,(P<<1)+(x?1:0),D,16*w,16*S,256*C,256*A)}function Bc(i,e,s){i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s)}function Ap(i){for(const e of i.sections)if(lc(e.text))return!0;return!1}class Rc{constructor(e){this.layoutVertexArray=new It,this.indexArray=new Oi,this.programConfigurations=e,this.segments=new Kt,this.dynamicLayoutVertexArray=new _t,this.opacityVertexArray=new Tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,n,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ap.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,np.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,kp,!0),this.opacityVertexBuffer.itemSize=1),(n||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ne("SymbolBuffers",Rc);class Oc{constructor(e,s,n){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new n,this.segments=new Kt,this.collisionVertexArray=new Jt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,op.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ne("CollisionBuffers",Oc);class _n{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mc([]),this.placementViewportMatrix=mc([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lh(this.zoom,s["text-size"]),this.iconSizeData=lh(this.zoom,s["icon-size"]);const n=this.layers[0].layout,l=n.get("symbol-sort-key"),p=n.get("symbol-z-order");this.canOverlap=Fc(n,"text-overlap","text-allow-overlap")!=="never"||Fc(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map(f=>u.ai[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID}createArrays(){this.text=new Rc(new os(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rc(new os(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new H,this.lineVertexArray=new se,this.symbolInstances=new q,this.textAnchorOffsets=new he}calculateGlyphDependencies(e,s,n,l,p){for(let f=0;f<e.length;f++)if(s[e.charCodeAt(f)]=!0,(n||l)&&p){const m=xo[e.charAt(f)];m&&(s[m.charCodeAt(0)]=!0)}}populate(e,s,n){const l=this.layers[0],p=l.layout,f=p.get("text-font"),m=p.get("text-field"),x=p.get("icon-image"),w=(m.value.kind!=="constant"||m.value.value instanceof qi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),S=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=p.get("symbol-sort-key");if(this.features=[],!w&&!S)return;const A=s.iconDependencies,P=s.glyphDependencies,D=s.availableImages,B=new Ht(this.zoom);for(const{feature:U,id:G,index:Q,sourceLayerIndex:W}of e){const te=l._featureFilter.needGeometry,re=Ca(U,te);if(!l._featureFilter.filter(B,re,n))continue;let de,Re;if(te||(re.geometry=Ma(U)),w){const Fe=l.getValueAndResolveTokens("text-field",re,n,D),Le=qi.factory(Fe);Ap(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||Kn()==="unavailable"||this.hasRTLText&&yr.isParsed())&&(de=cp(Le,l,re))}if(S){const Fe=l.getValueAndResolveTokens("icon-image",re,n,D);Re=Fe instanceof Ri?Fe:Ri.fromString(Fe)}if(!de&&!Re)continue;const Ge=this.sortFeaturesByKey?C.evaluate(re,{},n):void 0;if(this.features.push({id:G,text:de,icon:Re,index:Q,sourceLayerIndex:W,geometry:re.geometry,properties:U.properties,type:Cp[U.type],sortKey:Ge}),Re&&(A[Re.name]=!0),de){const Fe=f.evaluate(re,{},n).join(","),Le=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ai.vertical)>=0;for(const ke of de.sections)if(ke.image)A[ke.image.name]=!0;else{const Ue=qn(de.toString()),Ee=ke.fontStack||Fe,we=P[Ee]=P[Ee]||{};this.calculateGlyphDependencies(ke.text,we,Le,this.allowVerticalPlacement,Ue)}}}p.get("symbol-placement")==="line"&&(this.features=function(U){const G={},Q={},W=[];let te=0;function re(Fe){W.push(U[Fe]),te++}function de(Fe,Le,ke){const Ue=Q[Fe];return delete Q[Fe],Q[Le]=Ue,W[Ue].geometry[0].pop(),W[Ue].geometry[0]=W[Ue].geometry[0].concat(ke[0]),Ue}function Re(Fe,Le,ke){const Ue=G[Le];return delete G[Le],G[Fe]=Ue,W[Ue].geometry[0].shift(),W[Ue].geometry[0]=ke[0].concat(W[Ue].geometry[0]),Ue}function Ge(Fe,Le,ke){const Ue=ke?Le[0][Le[0].length-1]:Le[0][0];return`${Fe}:${Ue.x}:${Ue.y}`}for(let Fe=0;Fe<U.length;Fe++){const Le=U[Fe],ke=Le.geometry,Ue=Le.text?Le.text.toString():null;if(!Ue){re(Fe);continue}const Ee=Ge(Ue,ke),we=Ge(Ue,ke,!0);if(Ee in Q&&we in G&&Q[Ee]!==G[we]){const Ke=Re(Ee,we,ke),Xe=de(Ee,we,W[Ke].geometry);delete G[Ee],delete Q[we],Q[Ge(Ue,W[Xe].geometry,!0)]=Xe,W[Ke].geometry=null}else Ee in Q?de(Ee,we,ke):we in G?Re(Ee,we,ke):(re(Fe),G[Ee]=te-1,Q[we]=te-1)}return W.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((U,G)=>U.sortKey-G.sortKey)}update(e,s,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const n=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(s[e.segment+1]),p=e.dist(s[e.segment]);const f={};for(let m=e.segment+1;m<s.length;m++)f[m]={x:s[m].x,y:s[m].y,tileUnitDistanceFromAnchor:l},m<s.length-1&&(l+=s[m+1].dist(s[m]));for(let m=e.segment||0;m>=0;m--)f[m]={x:s[m].x,y:s[m].y,tileUnitDistanceFromAnchor:p},m>0&&(p+=s[m-1].dist(s[m]));for(let m=0;m<s.length;m++){const x=f[m];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,s,n,l,p,f,m,x,w,S,C,A){const P=e.indexArray,D=e.layoutVertexArray,B=e.segments.prepareSegment(4*s.length,D,P,this.canOverlap?f.sortKey:void 0),U=this.glyphOffsetArray.length,G=B.vertexLength,Q=this.allowVerticalPlacement&&m===u.ai.vertical?Math.PI/2:0,W=f.text&&f.text.sections;for(let te=0;te<s.length;te++){const{tl:re,tr:de,bl:Re,br:Ge,tex:Fe,pixelOffsetTL:Le,pixelOffsetBR:ke,minFontScaleX:Ue,minFontScaleY:Ee,glyphOffset:we,isSDF:Ke,sectionIndex:Xe}=s[te],bt=B.vertexLength,Qt=we[1];zl(D,x.x,x.y,re.x,Qt+re.y,Fe.x,Fe.y,n,Ke,Le.x,Le.y,Ue,Ee),zl(D,x.x,x.y,de.x,Qt+de.y,Fe.x+Fe.w,Fe.y,n,Ke,ke.x,Le.y,Ue,Ee),zl(D,x.x,x.y,Re.x,Qt+Re.y,Fe.x,Fe.y+Fe.h,n,Ke,Le.x,ke.y,Ue,Ee),zl(D,x.x,x.y,Ge.x,Qt+Ge.y,Fe.x+Fe.w,Fe.y+Fe.h,n,Ke,ke.x,ke.y,Ue,Ee),Bc(e.dynamicLayoutVertexArray,x,Q),P.emplaceBack(bt,bt+1,bt+2),P.emplaceBack(bt+1,bt+2,bt+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(we[0]),te!==s.length-1&&Xe===s[te+1].sectionIndex||e.programConfigurations.populatePaintArrays(D.length,f,f.index,{},A,W&&W[Xe])}e.placedSymbolArray.emplaceBack(x.x,x.y,U,this.glyphOffsetArray.length-U,G,w,S,x.segment,n?n[0]:0,n?n[1]:0,l[0],l[1],m,0,!1,0,C)}_addCollisionDebugVertex(e,s,n,l,p,f){return s.emplaceBack(0,0),e.emplaceBack(n.x,n.y,l,p,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(e,s,n,l,p,f,m){const x=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),w=x.vertexLength,S=p.layoutVertexArray,C=p.collisionVertexArray,A=m.anchorX,P=m.anchorY;this._addCollisionDebugVertex(S,C,f,A,P,new _e(e,s)),this._addCollisionDebugVertex(S,C,f,A,P,new _e(n,s)),this._addCollisionDebugVertex(S,C,f,A,P,new _e(n,l)),this._addCollisionDebugVertex(S,C,f,A,P,new _e(e,l)),x.vertexLength+=4;const D=p.indexArray;D.emplaceBack(w,w+1),D.emplaceBack(w+1,w+2),D.emplaceBack(w+2,w+3),D.emplaceBack(w+3,w),x.primitiveLength+=4}addDebugCollisionBoxes(e,s,n,l){for(let p=e;p<s;p++){const f=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Oc(hi,Wu.members,Si),this.iconCollisionBox=new Oc(hi,Wu.members,Si);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,n,l,p,f,m,x,w){const S={};for(let C=s;C<n;C++){const A=e.get(C);S.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.textFeatureIndex=A.featureIndex;break}for(let C=l;C<p;C++){const A=e.get(C);S.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.verticalTextFeatureIndex=A.featureIndex;break}for(let C=f;C<m;C++){const A=e.get(C);S.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.iconFeatureIndex=A.featureIndex;break}for(let C=x;C<w;C++){const A=e.get(C);S.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},S.verticalIconFeatureIndex=A.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const n=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const n=e.placedSymbolArray.get(s),l=n.vertexStartIndex+4*n.numGlyphs;for(let p=n.vertexStartIndex;p<l;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),n=Math.cos(e),l=[],p=[],f=[];for(let m=0;m<this.symbolInstances.length;++m){f.push(m);const x=this.symbolInstances.get(m);l.push(0|Math.round(s*x.anchorX+n*x.anchorY)),p.push(x.featureIndex)}return f.sort((m,x)=>l[m]-l[x]||p[x]-p[m]),f}addToSortKeyRanges(e,s){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===s?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const n=this.symbolInstances.get(s);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((l,p,f)=>{l>=0&&f.indexOf(l)===p&&this.addIndicesForPlacedSymbol(this.text,l)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ch,uh;Ne("SymbolBucket",_n,{omit:["layers","collisionBoxArray","features","compareText"]}),_n.MAX_GLYPHS=65535,_n.addDynamicAttributes=Bc;var Vc={get paint(){return uh=uh||new mi({"icon-opacity":new tt(oe.paint_symbol["icon-opacity"]),"icon-color":new tt(oe.paint_symbol["icon-color"]),"icon-halo-color":new tt(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new tt(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tt(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new tt(oe.paint_symbol["text-opacity"]),"text-color":new tt(oe.paint_symbol["text-color"],{runtimeType:Ji,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new tt(oe.paint_symbol["text-halo-color"]),"text-halo-width":new tt(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new tt(oe.paint_symbol["text-halo-blur"]),"text-translate":new Ye(oe.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(oe.paint_symbol["text-translate-anchor"])})},get layout(){return ch=ch||new mi({"symbol-placement":new Ye(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tt(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new tt(oe.layout_symbol["icon-size"]),"icon-text-fit":new Ye(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new tt(oe.layout_symbol["icon-image"]),"icon-rotate":new tt(oe.layout_symbol["icon-rotate"]),"icon-padding":new tt(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new tt(oe.layout_symbol["icon-offset"]),"icon-anchor":new tt(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(oe.layout_symbol["text-rotation-alignment"]),"text-field":new tt(oe.layout_symbol["text-field"]),"text-font":new tt(oe.layout_symbol["text-font"]),"text-size":new tt(oe.layout_symbol["text-size"]),"text-max-width":new tt(oe.layout_symbol["text-max-width"]),"text-line-height":new Ye(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new tt(oe.layout_symbol["text-letter-spacing"]),"text-justify":new tt(oe.layout_symbol["text-justify"]),"text-radial-offset":new tt(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new tt(oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new tt(oe.layout_symbol["text-anchor"]),"text-max-angle":new Ye(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(oe.layout_symbol["text-writing-mode"]),"text-rotate":new tt(oe.layout_symbol["text-rotate"]),"text-padding":new Ye(oe.layout_symbol["text-padding"]),"text-keep-upright":new Ye(oe.layout_symbol["text-keep-upright"]),"text-transform":new tt(oe.layout_symbol["text-transform"]),"text-offset":new tt(oe.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(oe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(oe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(oe.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(oe.layout_symbol["text-optional"])})}};class hh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ts,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ne("FormatSectionOverride",hh,{omit:["defaultValue"]});class El extends Pr{constructor(e){super(e,Vc)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const n=this.layout.get("text-writing-mode");if(n){const l=[];for(const p of n)l.indexOf(p)<0&&l.push(p);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,n,l){const p=this.layout.get(e).evaluate(s,{},n,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ja(f.value)||!p?p:function(m,x){return x.replace(/{([^{}]+)}/g,(w,S)=>m&&S in m?String(m[S]):"")}(s.properties,p)}createBucket(e){return new _n(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Vc.paint.overridableProperties){if(!El.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),n=new hh(s),l=new On(n,s.property.specification);let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new Vn("source",l):new Ka("composite",l,s.value.zoomStops),this.paint._values[e]=new Hi(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,n){return!(!this.layout||s.isDataDriven()||n.isDataDriven())&&El.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const n=e.get("text-field"),l=Vc.paint.properties[s];let p=!1;const f=m=>{for(const x of m)if(l.overrides&&l.overrides.hasOverride(x))return void(p=!0)};if(n.value.kind==="constant"&&n.value.value instanceof qi)f(n.value.value.sections);else if(n.value.kind==="source"){const m=w=>{p||(w instanceof Ts&&ii(w.value)===V?f(w.value.sections):w instanceof Ya?f(w.sections):w.eachChild(m))},x=n.value;x._styleExpression&&m(x._styleExpression.expression)}return p}}let dh;var zp={get paint(){return dh=dh||new mi({"background-color":new Ye(oe.paint_background["background-color"]),"background-pattern":new eo(oe.paint_background["background-pattern"]),"background-opacity":new Ye(oe.paint_background["background-opacity"])})}};class Ep extends Pr{constructor(e){super(e,zp)}}let ph;var Pp={get paint(){return ph=ph||new mi({"raster-opacity":new Ye(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(oe.paint_raster["raster-saturation"]),"raster-contrast":new Ye(oe.paint_raster["raster-contrast"]),"raster-resampling":new Ye(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(oe.paint_raster["raster-fade-duration"])})}};class Dp extends Pr{constructor(e){super(e,Pp)}}class Lp extends Pr{constructor(e){super(e,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Fp{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Nc=63710088e-1;class na{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new na(Pi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,n=this.lat*s,l=e.lat*s,p=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos((e.lng-this.lng)*s);return Nc*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof na)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new na(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new na(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const fh=2*Math.PI*Nc;function mh(i){return fh*Math.cos(i*Math.PI/180)}function gh(i){return(180+i)/360}function _h(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function yh(i,e){return i/mh(e)}function xh(i){return 360*i-180}function jc(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Pl{constructor(e,s,n=0){this.x=+e,this.y=+s,this.z=+n}static fromLngLat(e,s=0){const n=na.convert(e);return new Pl(gh(n.lng),_h(n.lat),yh(s,n.lat))}toLngLat(){return new na(xh(this.x),jc(this.y))}toAltitude(){return this.z*mh(jc(this.y))}meterInMercatorCoordinateUnits(){return 1/fh*(e=jc(this.y),1/Math.cos(e*Math.PI/180));var e}}function vh(i,e,s){var n=2*Math.PI*6378137/256/Math.pow(2,s);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Uc{constructor(e,s,n){if(e<0||e>25||n<0||n>=Math.pow(2,e)||s<0||s>=Math.pow(2,e))throw new Error(`x=${s}, y=${n}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=n,this.key=Io(0,e,e,s,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,n){const l=(f=this.y,m=this.z,x=vh(256*(p=this.x),256*(f=Math.pow(2,m)-f-1),m),w=vh(256*(p+1),256*(f+1),m),x[0]+","+x[1]+","+w[0]+","+w[1]);var p,f,m,x,w;const S=function(C,A,P){let D,B="";for(let U=C;U>0;U--)D=1<<U-1,B+=(A&D?1:0)+(P&D?2:0);return B}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,S).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new _e((e.x*s-this.x)*vi,(e.y*s-this.y)*vi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bh{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Io(e,s.z,s.z,s.x,s.y)}}class Rr{constructor(e,s,n,l,p){if(e<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=s,this.canonical=new Uc(n,+l,+p),this.key=Io(s,e,n,l,p)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new Rr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?Io(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):Io(this.wrap*+s,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,n=2*this.canonical.x,l=2*this.canonical.y;return[new Rr(s,this.wrap,s,n,l),new Rr(s,this.wrap,s,n+1,l),new Rr(s,this.wrap,s,n,l+1),new Rr(s,this.wrap,s,n+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Rr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Pl(e.x-this.wrap,e.y))}}function Io(i,e,s,n,l){(i*=2)<0&&(i=-1*i-1);const p=1<<s;return(p*p*i+p*l+n).toString(36)+s.toString(36)+e.toString(36)}Ne("CanonicalTileID",Uc),Ne("OverscaledTileID",Rr,{omit:["posMatrix"]});class wh{constructor(e,s,n,l=1,p=1,f=1,m=0){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void nt(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const x=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=p,this.blueFactor=f,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let w=0;w<x;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(x,w)]=this.data[this._idx(x-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,x)]=this.data[this._idx(w,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<x;w++)for(let S=0;S<x;S++){const C=this.get(w,S);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,s){const n=new Uint8Array(this.data.buffer),l=4*this._idx(e,s);return this.unpack(n[l],n[l+1],n[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}unpack(e,s,n){return e*this.redFactor+s*this.greenFactor+n*this.blueFactor-this.baseShift}getPixels(){return new Br({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=s*this.dim,p=s*this.dim+this.dim,f=n*this.dim,m=n*this.dim+this.dim;switch(s){case-1:l=p-1;break;case 1:p=l+1}switch(n){case-1:f=m-1;break;case 1:m=f+1}const x=-s*this.dim,w=-n*this.dim;for(let S=f;S<m;S++)for(let C=l;C<p;C++)this.data[this._idx(C,S)]=e.data[this._idx(C+x,S+w)]}}Ne("DEMData",wh);class Ih{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const n=e[s];this._stringToNumber[n]=s,this._numberToString[s]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Sh{constructor(e,s,n,l,p){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=n,e._y=l,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class Th{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ks(vi,16,0),this.grid3D=new Ks(vi,16,0),this.featureIndexArray=new ge,this.promoteId=s}insert(e,s,n,l,p,f){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,l,p);const x=f?this.grid3D:this.grid;for(let w=0;w<s.length;w++){const S=s[w],C=[1/0,1/0,-1/0,-1/0];for(let A=0;A<S.length;A++){const P=S[A];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<vi&&C[1]<vi&&C[2]>=0&&C[3]>=0&&x.insert(m,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ra.VectorTile(new zc(this.rawTileData)).layers,this.sourceLayerCoder=new Ih(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,n,l){this.loadVTLayers();const p=e.params||{},f=vi/e.tileSize/e.scale,m=jn(p.filter),x=e.queryGeometry,w=e.queryPadding*f,S=Ch(x),C=this.grid.query(S.minX-w,S.minY-w,S.maxX+w,S.maxY+w),A=Ch(e.cameraQueryGeometry),P=this.grid3D.query(A.minX-w,A.minY-w,A.maxX+w,A.maxY+w,(U,G,Q,W)=>function(te,re,de,Re,Ge){for(const Le of te)if(re<=Le.x&&de<=Le.y&&Re>=Le.x&&Ge>=Le.y)return!0;const Fe=[new _e(re,de),new _e(re,Ge),new _e(Re,Ge),new _e(Re,de)];if(te.length>2){for(const Le of Fe)if(un(te,Le))return!0}for(let Le=0;Le<te.length-1;Le++)if(dd(te[Le],te[Le+1],Fe))return!0;return!1}(e.cameraQueryGeometry,U-w,G-w,Q+w,W+w));for(const U of P)C.push(U);C.sort(Bp);const D={};let B;for(let U=0;U<C.length;U++){const G=C[U];if(G===B)continue;B=G;const Q=this.featureIndexArray.get(G);let W=null;this.loadMatchingFeature(D,Q.bucketIndex,Q.sourceLayerIndex,Q.featureIndex,m,p.layers,p.availableImages,s,n,l,(te,re,de)=>(W||(W=Ma(te)),re.queryIntersectsFeature(x,te,de,W,this.z,e.transform,f,e.pixelPosMatrix)))}return D}loadMatchingFeature(e,s,n,l,p,f,m,x,w,S,C){const A=this.bucketLayerIDs[s];if(f&&!function(U,G){for(let Q=0;Q<U.length;Q++)if(G.indexOf(U[Q])>=0)return!0;return!1}(f,A))return;const P=this.sourceLayerCoder.decode(n),D=this.vtLayers[P].feature(l);if(p.needGeometry){const U=Ca(D,!0);if(!p.filter(new Ht(this.tileID.overscaledZ),U,this.tileID.canonical))return}else if(!p.filter(new Ht(this.tileID.overscaledZ),D))return;const B=this.getId(D,P);for(let U=0;U<A.length;U++){const G=A[U];if(f&&f.indexOf(G)<0)continue;const Q=x[G];if(!Q)continue;let W={};B&&S&&(W=S.getState(Q.sourceLayer||"_geojsonTileLayer",B));const te=jt({},w[G]);te.paint=Mh(te.paint,Q.paint,D,W,m),te.layout=Mh(te.layout,Q.layout,D,W,m);const re=!C||C(D,Q,W);if(!re)continue;const de=new Sh(D,this.z,this.x,this.y,B);de.layer=te;let Re=e[G];Re===void 0&&(Re=e[G]=[]),Re.push({featureIndex:l,feature:de,intersectionZ:re})}}lookupSymbolFeatures(e,s,n,l,p,f,m,x){const w={};this.loadVTLayers();const S=jn(p);for(const C of e)this.loadMatchingFeature(w,n,l,C,S,f,m,x,s);return w}hasLayer(e){for(const s of this.bucketLayerIDs)for(const n of s)if(e===n)return!0;return!1}getId(e,s){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof n=="boolean"&&(n=Number(n))),n}}function Mh(i,e,s,n,l){return ft(i,(p,f)=>{const m=e instanceof ln?e.get(f):null;return m&&m.evaluate?m.evaluate(s,n,l):m})}function Ch(i){let e=1/0,s=1/0,n=-1/0,l=-1/0;for(const p of i)e=Math.min(e,p.x),s=Math.min(s,p.y),n=Math.max(n,p.x),l=Math.max(l,p.y);return{minX:e,minY:s,maxX:n,maxY:l}}function Bp(i,e){return e-i}function kh(i,e,s,n,l){const p=[];for(let f=0;f<i.length;f++){const m=i[f];let x;for(let w=0;w<m.length-1;w++){let S=m[w],C=m[w+1];S.x<e&&C.x<e||(S.x<e?S=new _e(e,S.y+(e-S.x)/(C.x-S.x)*(C.y-S.y))._round():C.x<e&&(C=new _e(e,S.y+(e-S.x)/(C.x-S.x)*(C.y-S.y))._round()),S.y<s&&C.y<s||(S.y<s?S=new _e(S.x+(s-S.y)/(C.y-S.y)*(C.x-S.x),s)._round():C.y<s&&(C=new _e(S.x+(s-S.y)/(C.y-S.y)*(C.x-S.x),s)._round()),S.x>=n&&C.x>=n||(S.x>=n?S=new _e(n,S.y+(n-S.x)/(C.x-S.x)*(C.y-S.y))._round():C.x>=n&&(C=new _e(n,S.y+(n-S.x)/(C.x-S.x)*(C.y-S.y))._round()),S.y>=l&&C.y>=l||(S.y>=l?S=new _e(S.x+(l-S.y)/(C.y-S.y)*(C.x-S.x),l)._round():C.y>=l&&(C=new _e(S.x+(l-S.y)/(C.y-S.y)*(C.x-S.x),l)._round()),x&&S.equals(x[x.length-1])||(x=[S],p.push(x)),x.push(C)))))}}return p}Ne("FeatureIndex",Th,{omit:["rawTileData","sourceLayerCoder"]});class oa extends _e{constructor(e,s,n,l){super(e,s),this.angle=n,l!==void 0&&(this.segment=l)}clone(){return new oa(this.x,this.y,this.angle,this.segment)}}function Ah(i,e,s,n,l){if(e.segment===void 0||s===0)return!0;let p=e,f=e.segment+1,m=0;for(;m>-s/2;){if(f--,f<0)return!1;m-=i[f].dist(p),p=i[f]}m+=i[f].dist(i[f+1]),f++;const x=[];let w=0;for(;m<s/2;){const S=i[f],C=i[f+1];if(!C)return!1;let A=i[f-1].angleTo(S)-S.angleTo(C);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:m,angleDelta:A}),w+=A;m-x[0].distance>n;)w-=x.shift().angleDelta;if(w>l)return!1;f++,m+=S.dist(C)}return!0}function zh(i){let e=0;for(let s=0;s<i.length-1;s++)e+=i[s].dist(i[s+1]);return e}function Eh(i,e,s){return i?.6*e*s:0}function Ph(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Rp(i,e,s,n,l,p){const f=Eh(s,l,p),m=Ph(s,n)*p;let x=0;const w=zh(i)/2;for(let S=0;S<i.length-1;S++){const C=i[S],A=i[S+1],P=C.dist(A);if(x+P>w){const D=(w-x)/P,B=mr.number(C.x,A.x,D),U=mr.number(C.y,A.y,D),G=new oa(B,U,A.angleTo(C),S);return G._round(),!f||Ah(i,G,m,f,e)?G:void 0}x+=P}}function Op(i,e,s,n,l,p,f,m,x){const w=Eh(n,p,f),S=Ph(n,l),C=S*f,A=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return e-C<e/4&&(e=C+e/4),Dh(i,A?e/2*m%e:(S/2+2*p)*f*m%e,e,w,s,C,A,!1,x)}function Dh(i,e,s,n,l,p,f,m,x){const w=p/2,S=zh(i);let C=0,A=e-s,P=[];for(let D=0;D<i.length-1;D++){const B=i[D],U=i[D+1],G=B.dist(U),Q=U.angleTo(B);for(;A+s<C+G;){A+=s;const W=(A-C)/G,te=mr.number(B.x,U.x,W),re=mr.number(B.y,U.y,W);if(te>=0&&te<x&&re>=0&&re<x&&A-w>=0&&A+w<=S){const de=new oa(te,re,Q,D);de._round(),n&&!Ah(i,de,p,n,l)||P.push(de)}}C+=G}return m||P.length||f||(P=Dh(i,C/2,s,n,l,p,f,!0,x)),P}Ne("Anchor",oa);const So=vr;function Lh(i,e,s,n){const l=[],p=i.image,f=p.pixelRatio,m=p.paddedRect.w-2*So,x=p.paddedRect.h-2*So,w=i.right-i.left,S=i.bottom-i.top,C=p.stretchX||[[0,m]],A=p.stretchY||[[0,x]],P=(ke,Ue)=>ke+Ue[1]-Ue[0],D=C.reduce(P,0),B=A.reduce(P,0),U=m-D,G=x-B;let Q=0,W=D,te=0,re=B,de=0,Re=U,Ge=0,Fe=G;if(p.content&&n){const ke=p.content;Q=Dl(C,0,ke[0]),te=Dl(A,0,ke[1]),W=Dl(C,ke[0],ke[2]),re=Dl(A,ke[1],ke[3]),de=ke[0]-Q,Ge=ke[1]-te,Re=ke[2]-ke[0]-W,Fe=ke[3]-ke[1]-re}const Le=(ke,Ue,Ee,we)=>{const Ke=Ll(ke.stretch-Q,W,w,i.left),Xe=Fl(ke.fixed-de,Re,ke.stretch,D),bt=Ll(Ue.stretch-te,re,S,i.top),Qt=Fl(Ue.fixed-Ge,Fe,Ue.stretch,B),ti=Ll(Ee.stretch-Q,W,w,i.left),Ci=Fl(Ee.fixed-de,Re,Ee.stretch,D),Lr=Ll(we.stretch-te,re,S,i.top),cr=Fl(we.fixed-Ge,Fe,we.stretch,B),bi=new _e(Ke,bt),Ni=new _e(ti,bt),Wi=new _e(ti,Lr),ur=new _e(Ke,Lr),hr=new _e(Xe/f,Qt/f),ki=new _e(Ci/f,cr/f),Ai=e*Math.PI/180;if(Ai){const er=Math.sin(Ai),br=Math.cos(Ai),wr=[br,-er,er,br];bi._matMult(wr),Ni._matMult(wr),ur._matMult(wr),Wi._matMult(wr)}const Qi=ke.stretch+ke.fixed,dr=Ue.stretch+Ue.fixed;return{tl:bi,tr:Ni,bl:ur,br:Wi,tex:{x:p.paddedRect.x+So+Qi,y:p.paddedRect.y+So+dr,w:Ee.stretch+Ee.fixed-Qi,h:we.stretch+we.fixed-dr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hr,pixelOffsetBR:ki,minFontScaleX:Re/f/w,minFontScaleY:Fe/f/S,isSDF:s}};if(n&&(p.stretchX||p.stretchY)){const ke=Fh(C,U,D),Ue=Fh(A,G,B);for(let Ee=0;Ee<ke.length-1;Ee++){const we=ke[Ee],Ke=ke[Ee+1];for(let Xe=0;Xe<Ue.length-1;Xe++)l.push(Le(we,Ue[Xe],Ke,Ue[Xe+1]))}}else l.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:x+1}));return l}function Dl(i,e,s){let n=0;for(const l of i)n+=Math.max(e,Math.min(s,l[1]))-Math.max(e,Math.min(s,l[0]));return n}function Fh(i,e,s){const n=[{fixed:-1,stretch:0}];for(const[l,p]of i){const f=n[n.length-1];n.push({fixed:l-f.stretch,stretch:f.stretch}),n.push({fixed:l-f.stretch,stretch:f.stretch+(p-l)})}return n.push({fixed:e+So,stretch:s}),n}function Ll(i,e,s,n){return i/e*s+n}function Fl(i,e,s,n){return i-e*s/n}class Bl{constructor(e,s,n,l,p,f,m,x,w,S){if(this.boxStartIndex=e.length,w){let C=f.top,A=f.bottom;const P=f.collisionPadding;P&&(C-=P[1],A+=P[3]);let D=A-C;D>0&&(D=Math.max(10,D),this.circleDiameter=D)}else{let C=f.top*m-x[0],A=f.bottom*m+x[2],P=f.left*m-x[3],D=f.right*m+x[1];const B=f.collisionPadding;if(B&&(P-=B[0]*m,C-=B[1]*m,D+=B[2]*m,A+=B[3]*m),S){const U=new _e(P,C),G=new _e(D,C),Q=new _e(P,A),W=new _e(D,A),te=S*Math.PI/180;U._rotate(te),G._rotate(te),Q._rotate(te),W._rotate(te),P=Math.min(U.x,G.x,Q.x,W.x),D=Math.max(U.x,G.x,Q.x,W.x),C=Math.min(U.y,G.y,Q.y,W.y),A=Math.max(U.y,G.y,Q.y,W.y)}e.emplaceBack(s.x,s.y,P,C,D,A,n,l,p)}this.boxEndIndex=e.length}}class Vp{constructor(e=[],s=Np){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:n}=this,l=s[e];for(;e>0;){const p=e-1>>1,f=s[p];if(n(l,f)>=0)break;s[e]=f,e=p}s[e]=l}_down(e){const{data:s,compare:n}=this,l=this.length>>1,p=s[e];for(;e<l;){let f=1+(e<<1),m=s[f];const x=f+1;if(x<this.length&&n(s[x],m)<0&&(f=x,m=s[x]),n(m,p)>=0)break;s[e]=m,e=f}s[e]=p}}function Np(i,e){return i<e?-1:i>e?1:0}function jp(i,e=1,s=!1){let n=1/0,l=1/0,p=-1/0,f=-1/0;const m=i[0];for(let P=0;P<m.length;P++){const D=m[P];(!P||D.x<n)&&(n=D.x),(!P||D.y<l)&&(l=D.y),(!P||D.x>p)&&(p=D.x),(!P||D.y>f)&&(f=D.y)}const x=Math.min(p-n,f-l);let w=x/2;const S=new Vp([],Up);if(x===0)return new _e(n,l);for(let P=n;P<p;P+=x)for(let D=l;D<f;D+=x)S.push(new yn(P+w,D+w,w,i));let C=function(P){let D=0,B=0,U=0;const G=P[0];for(let Q=0,W=G.length,te=W-1;Q<W;te=Q++){const re=G[Q],de=G[te],Re=re.x*de.y-de.x*re.y;B+=(re.x+de.x)*Re,U+=(re.y+de.y)*Re,D+=3*Re}return new yn(B/D,U/D,0,P)}(i),A=S.length;for(;S.length;){const P=S.pop();(P.d>C.d||!C.d)&&(C=P,s&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,A)),P.max-C.d<=e||(w=P.h/2,S.push(new yn(P.p.x-w,P.p.y-w,w,i)),S.push(new yn(P.p.x+w,P.p.y-w,w,i)),S.push(new yn(P.p.x-w,P.p.y+w,w,i)),S.push(new yn(P.p.x+w,P.p.y+w,w,i)),A+=4)}return s&&(console.log(`num probes: ${A}`),console.log(`best distance: ${C.d}`)),C.p}function Up(i,e){return e.max-i.max}function yn(i,e,s,n){this.p=new _e(i,e),this.h=s,this.d=function(l,p){let f=!1,m=1/0;for(let x=0;x<p.length;x++){const w=p[x];for(let S=0,C=w.length,A=C-1;S<C;A=S++){const P=w[S],D=w[A];P.y>l.y!=D.y>l.y&&l.x<(D.x-P.x)*(l.y-P.y)/(D.y-P.y)+P.x&&(f=!f),m=Math.min(m,yu(l,P,D))}}return(f?1:-1)*Math.sqrt(m)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var $i;u.aq=void 0,($i=u.aq||(u.aq={}))[$i.center=1]="center",$i[$i.left=2]="left",$i[$i.right=3]="right",$i[$i.top=4]="top",$i[$i.bottom=5]="bottom",$i[$i["top-left"]=6]="top-left",$i[$i["top-right"]=7]="top-right",$i[$i["bottom-left"]=8]="bottom-left",$i[$i["bottom-right"]=9]="bottom-right";const la=7,Zc=Number.POSITIVE_INFINITY;function Bh(i,e){return e[1]!==Zc?function(s,n,l){let p=0,f=0;switch(n=Math.abs(n),l=Math.abs(l),s){case"top-right":case"top-left":case"top":f=l-la;break;case"bottom-right":case"bottom-left":case"bottom":f=-l+la}switch(s){case"top-right":case"bottom-right":case"right":p=-n;break;case"top-left":case"bottom-left":case"left":p=n}return[p,f]}(i,e[0],e[1]):function(s,n){let l=0,p=0;n<0&&(n=0);const f=n/Math.SQRT2;switch(s){case"top-right":case"top-left":p=f-la;break;case"bottom-right":case"bottom-left":p=-f+la;break;case"bottom":p=-n+la;break;case"top":p=n-la}switch(s){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=n;break;case"right":l=-n}return[l,p]}(i,e[0])}function Rh(i,e,s){var n;const l=i.layout,p=(n=l.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(e,{},s);if(p){const m=p.values,x=[];for(let w=0;w<m.length;w+=2){const S=x[w]=m[w],C=m[w+1].map(A=>A*Mi);S.startsWith("top")?C[1]-=la:S.startsWith("bottom")&&(C[1]+=la),x[w+1]=C}return new kr(x)}const f=l.get("text-variable-anchor");if(f){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(e,{},s)*Mi,Zc]:l.get("text-offset").evaluate(e,{},s).map(w=>w*Mi);const x=[];for(const w of f)x.push(w,Bh(w,m));return new kr(x)}return null}function qc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zp(i,e,s,n,l,p,f,m,x,w,S){let C=p.textMaxSize.evaluate(e,{});C===void 0&&(C=f);const A=i.layers[0].layout,P=A.get("icon-offset").evaluate(e,{},S),D=Vh(s.horizontal),B=f/24,U=i.tilePixelRatio*B,G=i.tilePixelRatio*C/24,Q=i.tilePixelRatio*m,W=i.tilePixelRatio*A.get("symbol-spacing"),te=A.get("text-padding")*i.tilePixelRatio,re=function(we,Ke,Xe,bt=1){const Qt=we.get("icon-padding").evaluate(Ke,{},Xe),ti=Qt&&Qt.values;return[ti[0]*bt,ti[1]*bt,ti[2]*bt,ti[3]*bt]}(A,e,S,i.tilePixelRatio),de=A.get("text-max-angle")/180*Math.PI,Re=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",Ge=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Fe=A.get("symbol-placement"),Le=W/2,ke=A.get("icon-text-fit");let Ue;n&&ke!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(Ue=oh(n,s.vertical,ke,A.get("icon-text-fit-padding"),P,B)),D&&(n=oh(n,D,ke,A.get("icon-text-fit-padding"),P,B)));const Ee=(we,Ke)=>{Ke.x<0||Ke.x>=vi||Ke.y<0||Ke.y>=vi||function(Xe,bt,Qt,ti,Ci,Lr,cr,bi,Ni,Wi,ur,hr,ki,Ai,Qi,dr,er,br,wr,zi,Mt,tr,Xi,Ei,Kr){const ls=Xe.addToLineVertexArray(bt,Qt);let cs,Os,Qr,Or,Ir=0,Vs=0,Co=0,Zh=0,Kc=-1,Qc=-1;const Ns={};let qh=Ls("");if(Xe.allowVerticalPlacement&&ti.vertical){const ir=bi.layout.get("text-rotate").evaluate(Mt,{},Ei)+90;Qr=new Bl(Ni,bt,Wi,ur,hr,ti.vertical,ki,Ai,Qi,ir),cr&&(Or=new Bl(Ni,bt,Wi,ur,hr,cr,er,br,Qi,ir))}if(Ci){const ir=bi.layout.get("icon-rotate").evaluate(Mt,{}),Vr=bi.layout.get("icon-text-fit")!=="none",Aa=Lh(Ci,ir,Xi,Vr),hs=cr?Lh(cr,ir,Xi,Vr):void 0;Os=new Bl(Ni,bt,Wi,ur,hr,Ci,er,br,!1,ir),Ir=4*Aa.length;const za=Xe.iconSizeData;let ws=null;za.kind==="source"?(ws=[bs*bi.layout.get("icon-size").evaluate(Mt,{})],ws[0]>aa&&nt(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${wo}. Reduce your "icon-size".`)):za.kind==="composite"&&(ws=[bs*tr.compositeIconSizes[0].evaluate(Mt,{},Ei),bs*tr.compositeIconSizes[1].evaluate(Mt,{},Ei)],(ws[0]>aa||ws[1]>aa)&&nt(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${wo}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Aa,ws,zi,wr,Mt,u.ai.none,bt,ls.lineStartIndex,ls.lineLength,-1,Ei),Kc=Xe.icon.placedSymbolArray.length-1,hs&&(Vs=4*hs.length,Xe.addSymbols(Xe.icon,hs,ws,zi,wr,Mt,u.ai.vertical,bt,ls.lineStartIndex,ls.lineLength,-1,Ei),Qc=Xe.icon.placedSymbolArray.length-1)}const Gh=Object.keys(ti.horizontal);for(const ir of Gh){const Vr=ti.horizontal[ir];if(!cs){qh=Ls(Vr.text);const hs=bi.layout.get("text-rotate").evaluate(Mt,{},Ei);cs=new Bl(Ni,bt,Wi,ur,hr,Vr,ki,Ai,Qi,hs)}const Aa=Vr.positionedLines.length===1;if(Co+=Oh(Xe,bt,Vr,Lr,bi,Qi,Mt,dr,ls,ti.vertical?u.ai.horizontal:u.ai.horizontalOnly,Aa?Gh:[ir],Ns,Kc,tr,Ei),Aa)break}ti.vertical&&(Zh+=Oh(Xe,bt,ti.vertical,Lr,bi,Qi,Mt,dr,ls,u.ai.vertical,["vertical"],Ns,Qc,tr,Ei));const $p=cs?cs.boxStartIndex:Xe.collisionBoxArray.length,Wp=cs?cs.boxEndIndex:Xe.collisionBoxArray.length,Xp=Qr?Qr.boxStartIndex:Xe.collisionBoxArray.length,Yp=Qr?Qr.boxEndIndex:Xe.collisionBoxArray.length,Jp=Os?Os.boxStartIndex:Xe.collisionBoxArray.length,Hp=Os?Os.boxEndIndex:Xe.collisionBoxArray.length,Kp=Or?Or.boxStartIndex:Xe.collisionBoxArray.length,Qp=Or?Or.boxEndIndex:Xe.collisionBoxArray.length;let us=-1;const Ol=(ir,Vr)=>ir&&ir.circleDiameter?Math.max(ir.circleDiameter,Vr):Vr;us=Ol(cs,us),us=Ol(Qr,us),us=Ol(Os,us),us=Ol(Or,us);const $h=us>-1?1:0;$h&&(us*=Kr/Mi),Xe.glyphOffsetArray.length>=_n.MAX_GLYPHS&&nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mt.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,Mt.sortKey);const ef=Rh(bi,Mt,Ei),[tf,rf]=function(ir,Vr){const Aa=ir.length,hs=Vr==null?void 0:Vr.values;if((hs==null?void 0:hs.length)>0)for(let za=0;za<hs.length;za+=2){const ws=hs[za+1];ir.emplaceBack(u.aq[hs[za]],ws[0],ws[1])}return[Aa,ir.length]}(Xe.textAnchorOffsets,ef);Xe.symbolInstances.emplaceBack(bt.x,bt.y,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical||-1,Kc,Qc,qh,$p,Wp,Xp,Yp,Jp,Hp,Kp,Qp,Wi,Co,Zh,Ir,Vs,$h,0,ki,us,tf,rf)}(i,Ke,we,s,n,l,Ue,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,U,[te,te,te,te],Re,x,Q,re,Ge,P,e,p,w,S,f)};if(Fe==="line")for(const we of kh(e.geometry,0,0,vi,vi)){const Ke=Op(we,W,de,s.vertical||D,n,24,G,i.overscaling,vi);for(const Xe of Ke)D&&qp(i,D.text,Le,Xe)||Ee(we,Xe)}else if(Fe==="line-center"){for(const we of e.geometry)if(we.length>1){const Ke=Rp(we,de,s.vertical||D,n,24,G);Ke&&Ee(we,Ke)}}else if(e.type==="Polygon")for(const we of wc(e.geometry,0)){const Ke=jp(we,16);Ee(we[0],new oa(Ke.x,Ke.y,0))}else if(e.type==="LineString")for(const we of e.geometry)Ee(we,new oa(we[0].x,we[0].y,0));else if(e.type==="Point")for(const we of e.geometry)for(const Ke of we)Ee([Ke],new oa(Ke.x,Ke.y,0))}function Oh(i,e,s,n,l,p,f,m,x,w,S,C,A,P,D){const B=function(Q,W,te,re,de,Re,Ge,Fe){const Le=re.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,ke=[];for(const Ue of W.positionedLines)for(const Ee of Ue.positionedGlyphs){if(!Ee.rect)continue;const we=Ee.rect||{};let Ke=wp+1,Xe=!0,bt=1,Qt=0;const ti=(de||Fe)&&Ee.vertical,Ci=Ee.metrics.advance*Ee.scale/2;if(Fe&&W.verticalizable&&(Qt=Ue.lineOffset/2-(Ee.imageName?-(Mi-Ee.metrics.width*Ee.scale)/2:(Ee.scale-1)*Mi)),Ee.imageName){const zi=Ge[Ee.imageName];Xe=zi.sdf,bt=zi.pixelRatio,Ke=vr/bt}const Lr=de?[Ee.x+Ci,Ee.y]:[0,0];let cr=de?[0,0]:[Ee.x+Ci+te[0],Ee.y+te[1]-Qt],bi=[0,0];ti&&(bi=cr,cr=[0,0]);const Ni=Ee.metrics.isDoubleResolution?2:1,Wi=(Ee.metrics.left-Ke)*Ee.scale-Ci+cr[0],ur=(-Ee.metrics.top-Ke)*Ee.scale+cr[1],hr=Wi+we.w/Ni*Ee.scale/bt,ki=ur+we.h/Ni*Ee.scale/bt,Ai=new _e(Wi,ur),Qi=new _e(hr,ur),dr=new _e(Wi,ki),er=new _e(hr,ki);if(ti){const zi=new _e(-Ci,Ci-vo),Mt=-Math.PI/2,tr=Mi/2-Ci,Xi=new _e(5-vo-tr,-(Ee.imageName?tr:0)),Ei=new _e(...bi);Ai._rotateAround(Mt,zi)._add(Xi)._add(Ei),Qi._rotateAround(Mt,zi)._add(Xi)._add(Ei),dr._rotateAround(Mt,zi)._add(Xi)._add(Ei),er._rotateAround(Mt,zi)._add(Xi)._add(Ei)}if(Le){const zi=Math.sin(Le),Mt=Math.cos(Le),tr=[Mt,-zi,zi,Mt];Ai._matMult(tr),Qi._matMult(tr),dr._matMult(tr),er._matMult(tr)}const br=new _e(0,0),wr=new _e(0,0);ke.push({tl:Ai,tr:Qi,bl:dr,br:er,tex:we,writingMode:W.writingMode,glyphOffset:Lr,sectionIndex:Ee.sectionIndex,isSDF:Xe,pixelOffsetTL:br,pixelOffsetBR:wr,minFontScaleX:0,minFontScaleY:0})}return ke}(0,s,m,l,p,f,n,i.allowVerticalPlacement),U=i.textSizeData;let G=null;U.kind==="source"?(G=[bs*l.layout.get("text-size").evaluate(f,{})],G[0]>aa&&nt(`${i.layerIds[0]}: Value for "text-size" is >= ${wo}. Reduce your "text-size".`)):U.kind==="composite"&&(G=[bs*P.compositeTextSizes[0].evaluate(f,{},D),bs*P.compositeTextSizes[1].evaluate(f,{},D)],(G[0]>aa||G[1]>aa)&&nt(`${i.layerIds[0]}: Value for "text-size" is >= ${wo}. Reduce your "text-size".`)),i.addSymbols(i.text,B,G,m,p,f,w,e,x.lineStartIndex,x.lineLength,A,D);for(const Q of S)C[Q]=i.text.placedSymbolArray.length-1;return 4*B.length}function Vh(i){for(const e in i)return i[e];return null}function qp(i,e,s,n){const l=i.compareText;if(e in l){const p=l[e];for(let f=p.length-1;f>=0;f--)if(n.dist(p[f])<s)return!0}else l[e]=[];return l[e].push(n),!1}const Nh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gc{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,n]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=n>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const p=Nh[15&n];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new Gc(m,f,p,e)}constructor(e,s=64,n=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=Nh.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-m%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${n}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+m+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=s,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return $c(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:m}=this,x=[0,p.length-1,0],w=[];for(;x.length;){const S=x.pop()||0,C=x.pop()||0,A=x.pop()||0;if(C-A<=m){for(let U=A;U<=C;U++){const G=f[2*U],Q=f[2*U+1];G>=e&&G<=n&&Q>=s&&Q<=l&&w.push(p[U])}continue}const P=A+C>>1,D=f[2*P],B=f[2*P+1];D>=e&&D<=n&&B>=s&&B<=l&&w.push(p[P]),(S===0?e<=D:s<=B)&&(x.push(A),x.push(P-1),x.push(1-S)),(S===0?n>=D:l>=B)&&(x.push(P+1),x.push(C),x.push(1-S))}return w}within(e,s,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:p,nodeSize:f}=this,m=[0,l.length-1,0],x=[],w=n*n;for(;m.length;){const S=m.pop()||0,C=m.pop()||0,A=m.pop()||0;if(C-A<=f){for(let U=A;U<=C;U++)Uh(p[2*U],p[2*U+1],e,s)<=w&&x.push(l[U]);continue}const P=A+C>>1,D=p[2*P],B=p[2*P+1];Uh(D,B,e,s)<=w&&x.push(l[P]),(S===0?e-n<=D:s-n<=B)&&(m.push(A),m.push(P-1),m.push(1-S)),(S===0?e+n>=D:s+n>=B)&&(m.push(P+1),m.push(C),m.push(1-S))}return x}}function $c(i,e,s,n,l,p){if(l-n<=s)return;const f=n+l>>1;jh(i,e,f,n,l,p),$c(i,e,s,n,f-1,1-p),$c(i,e,s,f+1,l,1-p)}function jh(i,e,s,n,l,p){for(;l>n;){if(l-n>600){const w=l-n+1,S=s-n+1,C=Math.log(w),A=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*A*(w-A)/w)*(S-w/2<0?-1:1);jh(i,e,s,Math.max(n,Math.floor(s-S*A/w+P)),Math.min(l,Math.floor(s+(w-S)*A/w+P)),p)}const f=e[2*s+p];let m=n,x=l;for(To(i,e,n,s),e[2*l+p]>f&&To(i,e,n,l);m<x;){for(To(i,e,m,x),m++,x--;e[2*m+p]<f;)m++;for(;e[2*x+p]>f;)x--}e[2*n+p]===f?To(i,e,n,x):(x++,To(i,e,x,l)),x<=s&&(n=x+1),s<=x&&(l=x-1)}}function To(i,e,s,n){Wc(i,s,n),Wc(e,2*s,2*n),Wc(e,2*s+1,2*n+1)}function Wc(i,e,s){const n=i[e];i[e]=i[s],i[s]=n}function Uh(i,e,s,n){const l=i-s,p=e-n;return l*l+p*p}var Xc;u.bh=void 0,(Xc=u.bh||(u.bh={})).create="create",Xc.load="load",Xc.fullLoad="fullLoad";let Rl=null,Mo=[];const Yc=1e3/60,Jc="loadTime",Hc="fullLoadTime",Gp={mark(i){performance.mark(i)},frame(i){const e=i;Rl!=null&&Mo.push(e-Rl),Rl=e},clearMetrics(){Rl=null,Mo=[],performance.clearMeasures(Jc),performance.clearMeasures(Hc);for(const i in u.bh)performance.clearMarks(u.bh[i])},getPerformanceMetrics(){performance.measure(Jc,u.bh.create,u.bh.load),performance.measure(Hc,u.bh.create,u.bh.fullLoad);const i=performance.getEntriesByName(Jc)[0].duration,e=performance.getEntriesByName(Hc)[0].duration,s=Mo.length,n=1/(Mo.reduce((p,f)=>p+f,0)/s/1e3),l=Mo.filter(p=>p>Yc).reduce((p,f)=>p+(f-Yc)/Yc,0);return{loadTime:i,fullLoadTime:e,fps:n,percentDroppedFrames:l/(s+l)*100,totalFrames:s}}};u.$=function(i,e,s){var n,l,p,f,m,x,w,S,C,A,P,D,B=s[0],U=s[1],G=s[2];return e===i?(i[12]=e[0]*B+e[4]*U+e[8]*G+e[12],i[13]=e[1]*B+e[5]*U+e[9]*G+e[13],i[14]=e[2]*B+e[6]*U+e[10]*G+e[14],i[15]=e[3]*B+e[7]*U+e[11]*G+e[15]):(l=e[1],p=e[2],f=e[3],m=e[4],x=e[5],w=e[6],S=e[7],C=e[8],A=e[9],P=e[10],D=e[11],i[0]=n=e[0],i[1]=l,i[2]=p,i[3]=f,i[4]=m,i[5]=x,i[6]=w,i[7]=S,i[8]=C,i[9]=A,i[10]=P,i[11]=D,i[12]=n*B+m*U+C*G+e[12],i[13]=l*B+x*U+A*G+e[13],i[14]=p*B+w*U+P*G+e[14],i[15]=f*B+S*U+D*G+e[15]),i},u.A=hn,u.B=mr,u.C=class{constructor(i,e,s){this.receive=n=>{const l=n.data,p=l.id;if(p&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[p];const f=this.cancelCallbacks[p];delete this.cancelCallbacks[p],f&&f()}else Li()||l.mustQueue?(this.tasks[p]=l,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,l)},this.process=()=>{if(!this.taskQueue.length)return;const n=this.taskQueue.shift(),l=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(n,l)},this.target=i,this.parent=e,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Fp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Li()?i:window}send(i,e,s,n,l=!1){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[p]=s);const f=[],m={id:p,type:i,hasCallback:!!s,targetMapId:n,mustQueue:l,sourceMapId:this.mapId,data:ys(e,f)};return this.target.postMessage(m,{transfer:f}),{cancel:()=>{s&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const s=this.callbacks[i];delete this.callbacks[i],s&&(e.error?s(Qs(e.error)):s(null,Qs(e.data)))}else{let s=!1;const n=[],l=e.hasCallback?(m,x)=>{s=!0,delete this.cancelCallbacks[i];const w={id:i,type:"<response>",sourceMapId:this.mapId,error:m?ys(m):null,data:ys(x,n)};this.target.postMessage(w,{transfer:n})}:m=>{s=!0};let p=null;const f=Qs(e.data);if(this.parent[e.type])p=this.parent[e.type](e.sourceMapId,f,l);else if("getWorkerSource"in this.parent){const m=e.type.split(".");p=this.parent.getWorkerSource(e.sourceMapId,m[0],f.source)[m[1]](f,l)}else l(new Error(`Could not find function ${e.type}`));!s&&p&&p.cancel&&(this.cancelCallbacks[i]=p.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.D=Ye,u.E=mt,u.F=function(i,e){const s={};for(let n=0;n<e.length;n++){const l=e[n];l in i&&(s[l]=i[l])}return s},u.G=gh,u.H=_h,u.I=Pc,u.J=st,u.K=ht,u.L=na,u.M=fi,u.N=vi,u.O=Rr,u.P=_e,u.Q=ai,u.R=Br,u.S=Kt,u.T=dl,u.U=Pl,u.V=class extends Ps{},u.W=Uc,u.X=function(i,e){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let n=0;n<i.length;n++){const l=window.document.createElement("source");me(i[n])||(s.crossOrigin="Anonymous"),l.src=i[n],s.appendChild(l)}return{cancel:()=>{}}},u.Y=ze,u.Z=function(){var i=new hn(16);return hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},u._=We,u.a=Sr,u.a$=class extends E{},u.a0=function(i,e,s){var n=s[0],l=s[1],p=s[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},u.a1=wu,u.a2=function(){return Pt++},u.a3=N,u.a4=_n,u.a5=function(){yr.isLoading()||yr.isLoaded()||Kn()!=="deferred"||hl()},u.a6=jn,u.a7=Ca,u.a8=Ht,u.a9=Sh,u.aA=ba,u.aB=function(i){i=i.slice();const e=Object.create(null);for(let s=0;s<i.length;s++)e[i[s].id]=i[s];for(let s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=Mr(i[s],e[i[s].ref]));return i},u.aC=function(i){if(i.type==="custom")return new Lp(i);switch(i.type){case"background":return new Ep(i);case"circle":return new md(i);case"fill":return new Fd(i);case"fill-extrusion":return new Jd(i);case"heatmap":return new _d(i);case"hillshade":return new xd(i);case"line":return new sp(i);case"raster":return new Dp(i);case"symbol":return new El(i)}},u.aD=Ct,u.aE=function(i,e){if(!i)return[{command:Lt.setStyle,args:[e]}];let s=[];try{if(!Wt(i.version,e.version))return[{command:Lt.setStyle,args:[e]}];Wt(i.center,e.center)||s.push({command:Lt.setCenter,args:[e.center]}),Wt(i.zoom,e.zoom)||s.push({command:Lt.setZoom,args:[e.zoom]}),Wt(i.bearing,e.bearing)||s.push({command:Lt.setBearing,args:[e.bearing]}),Wt(i.pitch,e.pitch)||s.push({command:Lt.setPitch,args:[e.pitch]}),Wt(i.sprite,e.sprite)||s.push({command:Lt.setSprite,args:[e.sprite]}),Wt(i.glyphs,e.glyphs)||s.push({command:Lt.setGlyphs,args:[e.glyphs]}),Wt(i.transition,e.transition)||s.push({command:Lt.setTransition,args:[e.transition]}),Wt(i.light,e.light)||s.push({command:Lt.setLight,args:[e.light]});const n={},l=[];(function(f,m,x,w){let S;for(S in m=m||{},f=f||{})Object.prototype.hasOwnProperty.call(f,S)&&(Object.prototype.hasOwnProperty.call(m,S)||js(S,x,w));for(S in m)Object.prototype.hasOwnProperty.call(m,S)&&(Object.prototype.hasOwnProperty.call(f,S)?Wt(f[S],m[S])||(f[S].type==="geojson"&&m[S].type==="geojson"&&Da(f,m,S)?x.push({command:Lt.setGeoJSONSourceData,args:[S,m[S].data]}):es(S,m,x,w)):Zr(S,m,x))})(i.sources,e.sources,l,n);const p=[];i.layers&&i.layers.forEach(f=>{n[f.source]?s.push({command:Lt.removeLayer,args:[f.id]}):p.push(f)}),s=s.concat(l),function(f,m,x){m=m||[];const w=(f=f||[]).map(ds),S=m.map(ds),C=f.reduce(Is,{}),A=m.reduce(Is,{}),P=w.slice(),D=Object.create(null);let B,U,G,Q,W,te,re;for(B=0,U=0;B<w.length;B++)G=w[B],Object.prototype.hasOwnProperty.call(A,G)?U++:(x.push({command:Lt.removeLayer,args:[G]}),P.splice(P.indexOf(G,U),1));for(B=0,U=0;B<S.length;B++)G=S[S.length-1-B],P[P.length-1-B]!==G&&(Object.prototype.hasOwnProperty.call(C,G)?(x.push({command:Lt.removeLayer,args:[G]}),P.splice(P.lastIndexOf(G,P.length-U),1)):U++,te=P[P.length-B],x.push({command:Lt.addLayer,args:[A[G],te]}),P.splice(P.length-B,0,G),D[G]=!0);for(B=0;B<S.length;B++)if(G=S[B],Q=C[G],W=A[G],!D[G]&&!Wt(Q,W))if(Wt(Q.source,W.source)&&Wt(Q["source-layer"],W["source-layer"])&&Wt(Q.type,W.type)){for(re in Us(Q.layout,W.layout,x,G,null,Lt.setLayoutProperty),Us(Q.paint,W.paint,x,G,null,Lt.setPaintProperty),Wt(Q.filter,W.filter)||x.push({command:Lt.setFilter,args:[G,W.filter]}),Wt(Q.minzoom,W.minzoom)&&Wt(Q.maxzoom,W.maxzoom)||x.push({command:Lt.setLayerZoomRange,args:[G,W.minzoom,W.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Us(Q[re],W[re],x,G,re.slice(6),Lt.setPaintProperty):Wt(Q[re],W[re])||x.push({command:Lt.setLayerProperty,args:[G,re,W[re]]}));for(re in W)Object.prototype.hasOwnProperty.call(W,re)&&!Object.prototype.hasOwnProperty.call(Q,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Us(Q[re],W[re],x,G,re.slice(6),Lt.setPaintProperty):Wt(Q[re],W[re])||x.push({command:Lt.setLayerProperty,args:[G,re,W[re]]}))}else x.push({command:Lt.removeLayer,args:[G]}),te=P[P.lastIndexOf(G)+1],x.push({command:Lt.addLayer,args:[W,te]})}(p,e.layers,s)}catch(n){console.warn("Unable to compute style diff:",n),s=[{command:Lt.setStyle,args:[e]}]}return s},u.aF=function(i){const e=[],s=i.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},u.aG=function i(e,s){if(Array.isArray(e)){if(!Array.isArray(s)||e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],s[n]))return!1;return!0}if(typeof e=="object"&&e!==null&&s!==null){if(typeof s!="object"||Object.keys(e).length!==Object.keys(s).length)return!1;for(const n in e)if(!i(e[n],s[n]))return!1;return!0}return e===s},u.aH=ft,u.aI=wi,u.aJ=wa,u.aK=function(i){return i({pluginStatus:nr,pluginURL:xs}),wa.on("pluginStateChange",i),i},u.aL=class extends Fs{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},u.aM=cn,u.aN=class extends Fs{constructor(i,e){super(i,e),this.current=uc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},u.aO=gl,u.aP=class extends Fs{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},u.aQ=class extends Fs{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},u.aR=_l,u.aS=function(i,e,s,n,l,p,f){var m=1/(e-s),x=1/(n-l),w=1/(p-f);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+s)*m,i[13]=(l+n)*x,i[14]=(f+p)*w,i[15]=1,i},u.aT=Ut,u.aU=fd,u.aV=class extends o{},u.aW=lp,u.aX=class extends d{},u.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},u.aZ=Cu,u.a_=Te,u.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,n,l,p)=>{const f=l||p;return e[n]=!f||f.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e},u.ab=function(i,e){const s=[];for(const n in i)n in e||s.push(n);return s},u.ac=function(i){if(dt==null){const e=i.navigator?i.navigator.userAgent:null;dt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return dt},u.ad=qt,u.ae=function(i,e,s){var n=Math.sin(s),l=Math.cos(s),p=e[0],f=e[1],m=e[2],x=e[3],w=e[4],S=e[5],C=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*l+w*n,i[1]=f*l+S*n,i[2]=m*l+C*n,i[3]=x*l+A*n,i[4]=w*l-p*n,i[5]=S*l-f*n,i[6]=C*l-m*n,i[7]=A*l-x*n,i},u.af=function(i){var e=new hn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},u.ag=bl,u.ah=function(i,e){let s=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:p,maxZoom:f}=i,m=l?qt(gr.interpolationFactor(l,e,p,f),0,1):0;i.kind==="camera"?n=mr.number(i.minSize,i.maxSize,m):s=m}return{uSizeT:s,uSize:n}},u.aj=function(i,{uSize:e,uSizeT:s},{lowerSize:n,upperSize:l}){return i.kind==="source"?n/bs:i.kind==="composite"?mr.number(n/bs,l/bs,s):e},u.ak=Bc,u.al=function(i,e,s,n){const l=e.y-i.y,p=e.x-i.x,f=n.y-s.y,m=n.x-s.x,x=f*p-m*l;if(x===0)return null;const w=(m*(i.y-s.y)-f*(i.x-s.x))/x;return new _e(i.x+w*p,i.y+w*l)},u.am=kh,u.an=gu,u.ao=mc,u.ap=Mi,u.ar=Fc,u.as=function(i,e){var s=e[0],n=e[1],l=e[2],p=e[3],f=e[4],m=e[5],x=e[6],w=e[7],S=e[8],C=e[9],A=e[10],P=e[11],D=e[12],B=e[13],U=e[14],G=e[15],Q=s*m-n*f,W=s*x-l*f,te=s*w-p*f,re=n*x-l*m,de=n*w-p*m,Re=l*w-p*x,Ge=S*B-C*D,Fe=S*U-A*D,Le=S*G-P*D,ke=C*U-A*B,Ue=C*G-P*B,Ee=A*G-P*U,we=Q*Ee-W*Ue+te*ke+re*Le-de*Fe+Re*Ge;return we?(i[0]=(m*Ee-x*Ue+w*ke)*(we=1/we),i[1]=(l*Ue-n*Ee-p*ke)*we,i[2]=(B*Re-U*de+G*re)*we,i[3]=(A*de-C*Re-P*re)*we,i[4]=(x*Le-f*Ee-w*Fe)*we,i[5]=(s*Ee-l*Le+p*Fe)*we,i[6]=(U*te-D*Re-G*W)*we,i[7]=(S*Re-A*te+P*W)*we,i[8]=(f*Ue-m*Le+w*Ge)*we,i[9]=(n*Le-s*Ue-p*Ge)*we,i[10]=(D*de-B*te+G*Q)*we,i[11]=(C*te-S*de-P*Q)*we,i[12]=(m*Fe-f*ke-x*Ge)*we,i[13]=(s*ke-n*Fe+l*Ge)*we,i[14]=(B*W-D*re-U*Q)*we,i[15]=(S*re-C*W+A*Q)*we,i):null},u.at=qc,u.au=Lc,u.av=Gc,u.aw=function(){const i={},e=oe.$version;for(const s in oe.$root){const n=oe.$root[s];if(n.required){let l=null;l=s==="version"?e:n.type==="array"?[]:{},l!=null&&(i[s]=l)}}return i},u.ax=Lt,u.ay=ol,u.az=Ui,u.b=function(i,e){const s=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(s).then(n=>{e(null,n)}).catch(n=>{e(new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},u.b0=Oi,u.b1=function(i,e){var s=i[0],n=i[1],l=i[2],p=i[3],f=i[4],m=i[5],x=i[6],w=i[7],S=i[8],C=i[9],A=i[10],P=i[11],D=i[12],B=i[13],U=i[14],G=i[15],Q=e[0],W=e[1],te=e[2],re=e[3],de=e[4],Re=e[5],Ge=e[6],Fe=e[7],Le=e[8],ke=e[9],Ue=e[10],Ee=e[11],we=e[12],Ke=e[13],Xe=e[14],bt=e[15];return Math.abs(s-Q)<=lr*Math.max(1,Math.abs(s),Math.abs(Q))&&Math.abs(n-W)<=lr*Math.max(1,Math.abs(n),Math.abs(W))&&Math.abs(l-te)<=lr*Math.max(1,Math.abs(l),Math.abs(te))&&Math.abs(p-re)<=lr*Math.max(1,Math.abs(p),Math.abs(re))&&Math.abs(f-de)<=lr*Math.max(1,Math.abs(f),Math.abs(de))&&Math.abs(m-Re)<=lr*Math.max(1,Math.abs(m),Math.abs(Re))&&Math.abs(x-Ge)<=lr*Math.max(1,Math.abs(x),Math.abs(Ge))&&Math.abs(w-Fe)<=lr*Math.max(1,Math.abs(w),Math.abs(Fe))&&Math.abs(S-Le)<=lr*Math.max(1,Math.abs(S),Math.abs(Le))&&Math.abs(C-ke)<=lr*Math.max(1,Math.abs(C),Math.abs(ke))&&Math.abs(A-Ue)<=lr*Math.max(1,Math.abs(A),Math.abs(Ue))&&Math.abs(P-Ee)<=lr*Math.max(1,Math.abs(P),Math.abs(Ee))&&Math.abs(D-we)<=lr*Math.max(1,Math.abs(D),Math.abs(we))&&Math.abs(B-Ke)<=lr*Math.max(1,Math.abs(B),Math.abs(Ke))&&Math.abs(U-Xe)<=lr*Math.max(1,Math.abs(U),Math.abs(Xe))&&Math.abs(G-bt)<=lr*Math.max(1,Math.abs(G),Math.abs(bt))},u.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},u.b3=function(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i[3]=e[3]*s[3],i},u.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},u.b5=Pi,u.b6=bh,u.b7=yh,u.b8=function(i,e,s,n,l){var p,f=1/Math.tan(e/2);return i[0]=f/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+n)*(p=1/(n-l)),i[14]=2*l*n*p):(i[10]=-1,i[14]=-2*n),i},u.b9=function(i,e,s){var n=Math.sin(s),l=Math.cos(s),p=e[4],f=e[5],m=e[6],x=e[7],w=e[8],S=e[9],C=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*l+w*n,i[5]=f*l+S*n,i[6]=m*l+C*n,i[7]=x*l+A*n,i[8]=w*l-p*n,i[9]=S*l-f*n,i[10]=C*l-m*n,i[11]=A*l-x*n,i},u.bA=pt,u.bB=Xu,u.bC=Ha,u.bD=yr,u.ba=Ot,u.bb=vt,u.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},u.bd=class extends Ta{},u.be=Nc,u.bf=xh,u.bg=Gp,u.bi=rr,u.bj=function(i,e,s=!1){if(nr===Wn||nr===Xn||nr===Yn)throw new Error("setRTLTextPlugin cannot be called multiple times.");xs=Tr.resolveURL(i),nr=Wn,Jn=e,Hn(),s||hl()},u.bk=Kn,u.bl=function(i,e){const s={};for(let l=0;l<i.length;l++){const p=e&&e[i[l].id]||tn(i[l]);e&&(e[i[l].id]=p);let f=s[p];f||(f=s[p]=[]),f.push(i[l])}const n=[];for(const l in s)n.push(s[l]);return n},u.bm=Ne,u.bn=Ih,u.bo=Th,u.bp=ih,u.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=vi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],s=e.layout,n=e._unevaluatedLayout._values,l={layoutIconSize:n["icon-size"].possiblyEvaluate(new Ht(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Ht(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Ht(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:S}=i.bucket.textSizeData;l.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Ht(w),i.canonical),n["text-size"].possiblyEvaluate(new Ht(S),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:S}=i.bucket.iconSizeData;l.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Ht(w),i.canonical),n["icon-size"].possiblyEvaluate(new Ht(S),i.canonical)]}const p=s.get("text-line-height")*Mi,f=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",m=s.get("text-keep-upright"),x=s.get("text-size");for(const w of i.bucket.features){const S=s.get("text-font").evaluate(w,{},i.canonical).join(","),C=x.evaluate(w,{},i.canonical),A=l.layoutTextSize.evaluate(w,{},i.canonical),P=l.layoutIconSize.evaluate(w,{},i.canonical),D={horizontal:{},vertical:void 0},B=w.text;let U,G=[0,0];if(B){const te=B.toString(),re=s.get("text-letter-spacing").evaluate(w,{},i.canonical)*Mi,de=Gn(te)?re:0,Re=s.get("text-anchor").evaluate(w,{},i.canonical),Ge=Rh(e,w,i.canonical);if(!Ge){const Ee=s.get("text-radial-offset").evaluate(w,{},i.canonical);G=Ee?Bh(Re,[Ee*Mi,Zc]):s.get("text-offset").evaluate(w,{},i.canonical).map(we=>we*Mi)}let Fe=f?"center":s.get("text-justify").evaluate(w,{},i.canonical);const Le=s.get("symbol-placement"),ke=Le==="point"?s.get("text-max-width").evaluate(w,{},i.canonical)*Mi:0,Ue=()=>{i.bucket.allowVerticalPlacement&&qn(te)&&(D.vertical=kl(B,i.glyphMap,i.glyphPositions,i.imagePositions,S,ke,p,Re,"left",de,G,u.ai.vertical,!0,Le,A,C))};if(!f&&Ge){const Ee=new Set;if(Fe==="auto")for(let Ke=0;Ke<Ge.values.length;Ke+=2)Ee.add(qc(Ge.values[Ke]));else Ee.add(Fe);let we=!1;for(const Ke of Ee)if(!D.horizontal[Ke])if(we)D.horizontal[Ke]=D.horizontal[0];else{const Xe=kl(B,i.glyphMap,i.glyphPositions,i.imagePositions,S,ke,p,"center",Ke,de,G,u.ai.horizontal,!1,Le,A,C);Xe&&(D.horizontal[Ke]=Xe,we=Xe.positionedLines.length===1)}Ue()}else{Fe==="auto"&&(Fe=qc(Re));const Ee=kl(B,i.glyphMap,i.glyphPositions,i.imagePositions,S,ke,p,Re,Fe,de,G,u.ai.horizontal,!1,Le,A,C);Ee&&(D.horizontal[Fe]=Ee),Ue(),qn(te)&&f&&m&&(D.vertical=kl(B,i.glyphMap,i.glyphPositions,i.imagePositions,S,ke,p,Re,Fe,de,G,u.ai.vertical,!1,Le,A,C))}}let Q=!1;if(w.icon&&w.icon.name){const te=i.imageMap[w.icon.name];te&&(U=Mp(i.imagePositions[w.icon.name],s.get("icon-offset").evaluate(w,{},i.canonical),s.get("icon-anchor").evaluate(w,{},i.canonical)),Q=!!te.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Q:i.bucket.sdfIcons!==Q&&nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==i.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const W=Vh(D.horizontal)||D.vertical;i.bucket.iconsInText=!!W&&W.iconsInText,(W||U)&&Zp(i.bucket,w,D,U,i.imageMap,l,A,P,G,Q,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},u.br=kc,u.bs=Tc,u.bt=Cc,u.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},u.bv=zc,u.bw=ra,u.bx=function(i,e,s,n,l){return We(this,void 0,void 0,function*(){if(ht())try{return yield fi(i,e,s,n,l)}catch{}return function(p,f,m,x,w){const S=p.width,C=p.height;Di&&Nt||(Di=new OffscreenCanvas(S,C),Nt=Di.getContext("2d",{willReadFrequently:!0})),Di.width=S,Di.height=C,Nt.drawImage(p,0,0,S,C);const A=Nt.getImageData(f,m,x,w);return Nt.clearRect(0,0,S,C),A.data}(i,e,s,n,l)})},u.by=wh,u.bz=Y,u.c=Ur,u.d=function(i,e){const s=new Image;s.onload=()=>{e(null,s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Yi})},s.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(n):Yi},u.e=jt,u.f=function(i,e){return je(jt(i,{type:"json"}),e)},u.g=Fi,u.h=Tr,u.i=Li,u.j=Je,u.k=Oe,u.l=Ce,u.m=je,u.n=function(i){return new zc(i).readFields(xp,[])},u.o=function(i,e,s){if(!i.length)return s(null,[]);let n=i.length;const l=new Array(i.length);let p=null;i.forEach((f,m)=>{e(f,(x,w)=>{x&&(p=x),l[m]=w,--n==0&&s(p,l)})})},u.p=th,u.q=ho,u.r=mi,u.s=me,u.t=nc,u.u=Be,u.v=oe,u.w=nt,u.x=an,u.y=as,u.z=function([i,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(s),y:i*Math.sin(e)*Math.sin(s),z:i*Math.cos(s)}}}),Ae(["./shared"],function(u){class We{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,z){for(const j of k){this._layerConfigs[j.id]=j;const Z=this._layers[j.id]=u.aC(j);Z._featureFilter=u.a6(Z.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(const j of z)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};const L=u.bl(Object.values(this._layerConfigs),this.keyCache);for(const j of L){const Z=j.map(ue=>this._layers[ue.id]),ee=Z[0];if(ee.visibility==="none")continue;const X=ee.source||"";let $=this.familiesBySource[X];$||($=this.familiesBySource[X]={});const K=ee.sourceLayer||"_geojsonTileLayer";let ce=$[K];ce||(ce=$[K]=[]),ce.push(Z)}}}class Y{constructor(k){const z={},L=[];for(const X in k){const $=k[X],K=z[X]={};for(const ce in $){const ue=$[+ce];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const fe={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};L.push(fe),K[ce]={rect:fe,metrics:ue.metrics}}}const{w:j,h:Z}=u.p(L),ee=new u.q({width:j||1,height:Z||1});for(const X in k){const $=k[X];for(const K in $){const ce=$[+K];if(!ce||ce.bitmap.width===0||ce.bitmap.height===0)continue;const ue=z[X][K].rect;u.q.copy(ce.bitmap,ee,{x:0,y:0},{x:ue.x+1,y:ue.y+1},ce.bitmap)}}this.image=ee,this.positions=z}}u.bm("GlyphAtlas",Y);class pt{constructor(k){this.tileID=new u.O(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(k,z,L,j,Z){this.status="parsing",this.data=k,this.collisionBoxArray=new u.a3;const ee=new u.bn(Object.keys(k.layers).sort()),X=new u.bo(this.tileID,this.promoteId);X.bucketLayerIDs=[];const $={},K={featureIndex:X,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:L},ce=z.familiesBySource[this.source];for(const Et in ce){const zt=k.layers[Et];if(!zt)continue;zt.version===1&&u.w(`Vector tile source "${this.source}" layer "${Et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zi=ee.encode(Et),Yt=[];for(let xi=0;xi<zt.length;xi++){const Bi=zt.feature(xi),Cr=X.getId(Bi,Et);Yt.push({feature:Bi,id:Cr,index:xi,sourceLayerIndex:Zi})}for(const xi of ce[Et]){const Bi=xi[0];Bi.source!==this.source&&u.w(`layer.source = ${Bi.source} does not equal this.source = ${this.source}`),Bi.minzoom&&this.zoom<Math.floor(Bi.minzoom)||Bi.maxzoom&&this.zoom>=Bi.maxzoom||Bi.visibility!=="none"&&(yt(xi,this.zoom,L),($[Bi.id]=Bi.createBucket({index:X.bucketLayerIDs.length,layers:xi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zi,sourceID:this.source})).populate(Yt,K,this.tileID.canonical),X.bucketLayerIDs.push(xi.map(Cr=>Cr.id)))}}let ue,fe,He,ot;const Ze=u.aH(K.glyphDependencies,Et=>Object.keys(Et).map(Number));this.inFlightDependencies.forEach(Et=>Et==null?void 0:Et.cancel()),this.inFlightDependencies=[];const et=++this.dependencySentinel;Object.keys(Ze).length?this.inFlightDependencies.push(j.send("getGlyphs",{uid:this.uid,stacks:Ze,source:this.source,tileID:this.tileID,type:"glyphs"},(Et,zt)=>{et===this.dependencySentinel&&(ue||(ue=Et,fe=zt,Gt.call(this)))})):fe={};const ut=Object.keys(K.iconDependencies);ut.length?this.inFlightDependencies.push(j.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"icons"},(Et,zt)=>{et===this.dependencySentinel&&(ue||(ue=Et,He=zt,Gt.call(this)))})):He={};const Vt=Object.keys(K.patternDependencies);function Gt(){if(ue)return Z(ue);if(fe&&He&&ot){const Et=new Y(fe),zt=new u.bp(He,ot);for(const Zi in $){const Yt=$[Zi];Yt instanceof u.a4?(yt(Yt.layers,this.zoom,L),u.bq({bucket:Yt,glyphMap:fe,glyphPositions:Et.positions,imageMap:He,imagePositions:zt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Yt.hasPattern&&(Yt instanceof u.br||Yt instanceof u.bs||Yt instanceof u.bt)&&(yt(Yt.layers,this.zoom,L),Yt.addFeatures(K,this.tileID.canonical,zt.patternPositions))}this.status="done",Z(null,{buckets:Object.values($).filter(Zi=>!Zi.isEmpty()),featureIndex:X,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Et.image,imageAtlas:zt,glyphMap:this.returnDependencies?fe:null,iconMap:this.returnDependencies?He:null,glyphPositions:this.returnDependencies?Et.positions:null})}}Vt.length?this.inFlightDependencies.push(j.send("getImages",{icons:Vt,source:this.source,tileID:this.tileID,type:"patterns"},(Et,zt)=>{et===this.dependencySentinel&&(ue||(ue=Et,ot=zt,Gt.call(this)))})):ot={},Gt.call(this)}}function yt(V,k,z){const L=new u.a8(k);for(const j of V)j.recalculate(L,z)}function _e(V,k){const z=u.l(V.request,(L,j,Z,ee)=>{if(L)k(L);else if(j)try{const X=new u.bw.VectorTile(new u.bv(j));k(null,{vectorTile:X,rawData:j,cacheControl:Z,expires:ee})}catch(X){const $=new Uint8Array(j);let K=`Unable to parse the tile at ${V.request.url}, `;K+=$[0]===31&&$[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${X.messge}`,k(new Error(K))}});return()=>{z.cancel(),k()}}class rt{constructor(k,z,L,j){this.actor=k,this.layerIndex=z,this.availableImages=L,this.loadVectorData=j||_e,this.fetching={},this.loading={},this.loaded={}}loadTile(k,z){const L=k.uid;this.loading||(this.loading={});const j=!!(k&&k.request&&k.request.collectResourceTiming)&&new u.bu(k.request),Z=this.loading[L]=new pt(k);Z.abort=this.loadVectorData(k,(ee,X)=>{if(delete this.loading[L],ee||!X)return Z.status="done",this.loaded[L]=Z,z(ee);const $=X.rawData,K={};X.expires&&(K.expires=X.expires),X.cacheControl&&(K.cacheControl=X.cacheControl);const ce={};if(j){const ue=j.finish();ue&&(ce.resourceTiming=JSON.parse(JSON.stringify(ue)))}Z.vectorTile=X.vectorTile,Z.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,(ue,fe)=>{if(delete this.fetching[L],ue||!fe)return z(ue);z(null,u.e({rawTileData:$.slice(0)},fe,K,ce))}),this.loaded=this.loaded||{},this.loaded[L]=Z,this.fetching[L]={rawTileData:$,cacheControl:K,resourceTiming:ce}})}reloadTile(k,z){const L=this.loaded,j=k.uid;if(L&&L[j]){const Z=L[j];Z.showCollisionBoxes=k.showCollisionBoxes,Z.status==="parsing"?Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,(ee,X)=>{if(ee||!X)return z(ee,X);let $;if(this.fetching[j]){const{rawTileData:K,cacheControl:ce,resourceTiming:ue}=this.fetching[j];delete this.fetching[j],$=u.e({rawTileData:K.slice(0)},X,ce,ue)}else $=X;z(null,$)}):Z.status==="done"&&(Z.vectorTile?Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,z):z())}}abortTile(k,z){const L=this.loading,j=k.uid;L&&L[j]&&L[j].abort&&(L[j].abort(),delete L[j]),z()}removeTile(k,z){const L=this.loaded,j=k.uid;L&&L[j]&&delete L[j],z()}}class wt{constructor(){this.loaded={}}loadTile(k,z){return u._(this,void 0,void 0,function*(){const{uid:L,encoding:j,rawImageData:Z,redFactor:ee,greenFactor:X,blueFactor:$,baseShift:K}=k,ce=Z.width+2,ue=Z.height+2,fe=u.a(Z)?new u.R({width:ce,height:ue},yield u.bx(Z,-1,-1,ce,ue)):Z,He=new u.by(L,fe,j,ee,X,$,K);this.loaded=this.loaded||{},this.loaded[L]=He,z(null,He)})}removeTile(k){const z=this.loaded,L=k.uid;z&&z[L]&&delete z[L]}}function at(V,k){if(V.length!==0){Se(V[0],k);for(var z=1;z<V.length;z++)Se(V[z],!k)}}function Se(V,k){for(var z=0,L=0,j=0,Z=V.length,ee=Z-1;j<Z;ee=j++){var X=(V[j][0]-V[ee][0])*(V[ee][1]+V[j][1]),$=z+X;L+=Math.abs(z)>=Math.abs(X)?z-$+X:X-$+z,z=$}z+L>=0!=!!k&&V.reverse()}var Ve=u.bz(function V(k,z){var L,j=k&&k.type;if(j==="FeatureCollection")for(L=0;L<k.features.length;L++)V(k.features[L],z);else if(j==="GeometryCollection")for(L=0;L<k.geometries.length;L++)V(k.geometries[L],z);else if(j==="Feature")V(k.geometry,z);else if(j==="Polygon")at(k.coordinates,z);else if(j==="MultiPolygon")for(L=0;L<k.coordinates.length;L++)at(k.coordinates[L],z);return k});const st=u.bw.VectorTileFeature.prototype.toGeoJSON;var ht={exports:{}},Ot=u.bA,vt=u.bw.VectorTileFeature,qt=Pi;function Pi(V,k){this.options=k||{},this.features=V,this.length=V.length}function jt(V,k){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=k||4096}Pi.prototype.feature=function(V){return new jt(this.features[V],this.options.extent)},jt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var k=0;k<V.length;k++){for(var z=V[k],L=[],j=0;j<z.length;j++)L.push(new Ot(z[j][0],z[j][1]));this.geometry.push(L)}return this.geometry},jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,k=1/0,z=-1/0,L=1/0,j=-1/0,Z=0;Z<V.length;Z++)for(var ee=V[Z],X=0;X<ee.length;X++){var $=ee[X];k=Math.min(k,$.x),z=Math.max(z,$.x),L=Math.min(L,$.y),j=Math.max(j,$.y)}return[k,L,z,j]},jt.prototype.toGeoJSON=vt.prototype.toGeoJSON;var Pt=u.bB,ft=qt;function wi(V){var k=new Pt;return function(z,L){for(var j in z.layers)L.writeMessage(3,Ct,z.layers[j])}(V,k),k.finish()}function Ct(V,k){var z;k.writeVarintField(15,V.version||1),k.writeStringField(1,V.name||""),k.writeVarintField(5,V.extent||4096);var L={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<V.length;z++)L.feature=V.feature(z),k.writeMessage(2,ji,L);var j=L.keys;for(z=0;z<j.length;z++)k.writeStringField(3,j[z]);var Z=L.values;for(z=0;z<Z.length;z++)k.writeMessage(4,dt,Z[z])}function ji(V,k){var z=V.feature;z.id!==void 0&&k.writeVarintField(1,z.id),k.writeMessage(2,nt,V),k.writeVarintField(3,z.type),k.writeMessage(4,Li,z)}function nt(V,k){var z=V.feature,L=V.keys,j=V.values,Z=V.keycache,ee=V.valuecache;for(var X in z.properties){var $=z.properties[X],K=Z[X];if($!==null){K===void 0&&(L.push(X),Z[X]=K=L.length-1),k.writeVarint(K);var ce=typeof $;ce!=="string"&&ce!=="boolean"&&ce!=="number"&&($=JSON.stringify($));var ue=ce+":"+$,fe=ee[ue];fe===void 0&&(j.push($),ee[ue]=fe=j.length-1),k.writeVarint(fe)}}}function Dt(V,k){return(k<<3)+(7&V)}function Ii(V){return V<<1^V>>31}function Li(V,k){for(var z=V.loadGeometry(),L=V.type,j=0,Z=0,ee=z.length,X=0;X<ee;X++){var $=z[X],K=1;L===1&&(K=$.length),k.writeVarint(Dt(1,K));for(var ce=L===3?$.length-1:$.length,ue=0;ue<ce;ue++){ue===1&&L!==1&&k.writeVarint(Dt(2,ce-1));var fe=$[ue].x-j,He=$[ue].y-Z;k.writeVarint(Ii(fe)),k.writeVarint(Ii(He)),j+=fe,Z+=He}L===3&&k.writeVarint(Dt(7,1))}}function dt(V,k){var z=typeof V;z==="string"?k.writeStringField(1,V):z==="boolean"?k.writeBooleanField(7,V):z==="number"&&(V%1!=0?k.writeDoubleField(3,V):V<0?k.writeSVarintField(6,V):k.writeVarintField(5,V))}ht.exports=wi,ht.exports.fromVectorTileJs=wi,ht.exports.fromGeojsonVt=function(V,k){k=k||{};var z={};for(var L in V)z[L]=new ft(V[L].features,k),z[L].name=L,z[L].version=k.version,z[L].extent=k.extent;return wi({layers:z})},ht.exports.GeoJSONWrapper=ft;var Sr=u.bz(ht.exports);const Yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},fi=Math.fround||(Di=new Float32Array(1),V=>(Di[0]=+V,Di[0]));var Di;const Nt=3,ui=5,pr=6;class Tr{constructor(k){this.options=Object.assign(Object.create(Yi),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){const{log:z,minZoom:L,maxZoom:j}=this.options;z&&console.time("total time");const Z=`prepare ${k.length} points`;z&&console.time(Z),this.points=k;const ee=[];for(let $=0;$<k.length;$++){const K=k[$];if(!K.geometry)continue;const[ce,ue]=K.geometry.coordinates,fe=fi(Ui(ce)),He=fi(Fi(ue));ee.push(fe,He,1/0,$,-1,1),this.options.reduce&&ee.push(0)}let X=this.trees[j+1]=this._createTree(ee);z&&console.timeEnd(Z);for(let $=j;$>=L;$--){const K=+Date.now();X=this.trees[$]=this._createTree(this._cluster(X,$)),z&&console.log("z%d: %d clusters in %dms",$,X.numItems,+Date.now()-K)}return z&&console.timeEnd("total time"),this}getClusters(k,z){let L=((k[0]+180)%360+360)%360-180;const j=Math.max(-90,Math.min(90,k[1]));let Z=k[2]===180?180:((k[2]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)L=-180,Z=180;else if(L>Z){const ue=this.getClusters([L,j,180,ee],z),fe=this.getClusters([-180,j,Z,ee],z);return ue.concat(fe)}const X=this.trees[this._limitZoom(z)],$=X.range(Ui(L),Fi(ee),Ui(Z),Fi(j)),K=X.data,ce=[];for(const ue of $){const fe=this.stride*ue;ce.push(K[fe+ui]>1?Ur(K,fe,this.clusterProps):this.points[K[fe+Nt]])}return ce}getChildren(k){const z=this._getOriginId(k),L=this._getOriginZoom(k),j="No cluster with the specified id.",Z=this.trees[L];if(!Z)throw new Error(j);const ee=Z.data;if(z*this.stride>=ee.length)throw new Error(j);const X=this.options.radius/(this.options.extent*Math.pow(2,L-1)),$=Z.within(ee[z*this.stride],ee[z*this.stride+1],X),K=[];for(const ce of $){const ue=ce*this.stride;ee[ue+4]===k&&K.push(ee[ue+ui]>1?Ur(ee,ue,this.clusterProps):this.points[ee[ue+Nt]])}if(K.length===0)throw new Error(j);return K}getLeaves(k,z,L){const j=[];return this._appendLeaves(j,k,z=z||10,L=L||0,0),j}getTile(k,z,L){const j=this.trees[this._limitZoom(k)],Z=Math.pow(2,k),{extent:ee,radius:X}=this.options,$=X/ee,K=(L-$)/Z,ce=(L+1+$)/Z,ue={features:[]};return this._addTileFeatures(j.range((z-$)/Z,K,(z+1+$)/Z,ce),j.data,z,L,Z,ue),z===0&&this._addTileFeatures(j.range(1-$/Z,K,1,ce),j.data,Z,L,Z,ue),z===Z-1&&this._addTileFeatures(j.range(0,K,$/Z,ce),j.data,-1,L,Z,ue),ue.features.length?ue:null}getClusterExpansionZoom(k){let z=this._getOriginZoom(k)-1;for(;z<=this.options.maxZoom;){const L=this.getChildren(k);if(z++,L.length!==1)break;k=L[0].properties.cluster_id}return z}_appendLeaves(k,z,L,j,Z){const ee=this.getChildren(z);for(const X of ee){const $=X.properties;if($&&$.cluster?Z+$.point_count<=j?Z+=$.point_count:Z=this._appendLeaves(k,$.cluster_id,L,j,Z):Z<j?Z++:k.push(X),k.length===L)break}return Z}_createTree(k){const z=new u.av(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let L=0;L<k.length;L+=this.stride)z.add(k[L],k[L+1]);return z.finish(),z.data=k,z}_addTileFeatures(k,z,L,j,Z,ee){for(const X of k){const $=X*this.stride,K=z[$+ui]>1;let ce,ue,fe;if(K)ce=rr(z,$,this.clusterProps),ue=z[$],fe=z[$+1];else{const Ze=this.points[z[$+Nt]];ce=Ze.properties;const[et,ut]=Ze.geometry.coordinates;ue=Ui(et),fe=Fi(ut)}const He={type:1,geometry:[[Math.round(this.options.extent*(ue*Z-L)),Math.round(this.options.extent*(fe*Z-j))]],tags:ce};let ot;ot=K||this.options.generateId?z[$+Nt]:this.points[z[$+Nt]].id,ot!==void 0&&(He.id=ot),ee.features.push(He)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,z){const{radius:L,extent:j,reduce:Z,minPoints:ee}=this.options,X=L/(j*Math.pow(2,z)),$=k.data,K=[],ce=this.stride;for(let ue=0;ue<$.length;ue+=ce){if($[ue+2]<=z)continue;$[ue+2]=z;const fe=$[ue],He=$[ue+1],ot=k.within($[ue],$[ue+1],X),Ze=$[ue+ui];let et=Ze;for(const ut of ot){const Vt=ut*ce;$[Vt+2]>z&&(et+=$[Vt+ui])}if(et>Ze&&et>=ee){let ut,Vt=fe*Ze,Gt=He*Ze,Et=-1;const zt=((ue/ce|0)<<5)+(z+1)+this.points.length;for(const Zi of ot){const Yt=Zi*ce;if($[Yt+2]<=z)continue;$[Yt+2]=z;const xi=$[Yt+ui];Vt+=$[Yt]*xi,Gt+=$[Yt+1]*xi,$[Yt+4]=zt,Z&&(ut||(ut=this._map($,ue,!0),Et=this.clusterProps.length,this.clusterProps.push(ut)),Z(ut,this._map($,Yt)))}$[ue+4]=zt,K.push(Vt/et,Gt/et,1/0,zt,-1,et),Z&&K.push(Et)}else{for(let ut=0;ut<ce;ut++)K.push($[ue+ut]);if(et>1)for(const ut of ot){const Vt=ut*ce;if(!($[Vt+2]<=z)){$[Vt+2]=z;for(let Gt=0;Gt<ce;Gt++)K.push($[Vt+Gt])}}}}return K}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,z,L){if(k[z+ui]>1){const ee=this.clusterProps[k[z+pr]];return L?Object.assign({},ee):ee}const j=this.points[k[z+Nt]].properties,Z=this.options.map(j);return L&&Z===j?Object.assign({},Z):Z}}function Ur(V,k,z){return{type:"Feature",id:V[k+Nt],properties:rr(V,k,z),geometry:{type:"Point",coordinates:[(L=V[k],360*(L-.5)),le(V[k+1])]}};var L}function rr(V,k,z){const L=V[k+ui],j=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L,Z=V[k+pr],ee=Z===-1?{}:Object.assign({},z[Z]);return Object.assign(ee,{cluster:!0,cluster_id:V[k+Nt],point_count:L,point_count_abbreviated:j})}function Ui(V){return V/360+.5}function Fi(V){const k=Math.sin(V*Math.PI/180),z=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return z<0?0:z>1?1:z}function le(V){const k=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function je(V,k,z,L){for(var j,Z=L,ee=z-k>>1,X=z-k,$=V[k],K=V[k+1],ce=V[z],ue=V[z+1],fe=k+3;fe<z;fe+=3){var He=Ce(V[fe],V[fe+1],$,K,ce,ue);if(He>Z)j=fe,Z=He;else if(He===Z){var ot=Math.abs(fe-ee);ot<X&&(j=fe,X=ot)}}Z>L&&(j-k>3&&je(V,k,j,L),V[j+2]=Z,z-j>3&&je(V,j,z,L))}function Ce(V,k,z,L,j,Z){var ee=j-z,X=Z-L;if(ee!==0||X!==0){var $=((V-z)*ee+(k-L)*X)/(ee*ee+X*X);$>1?(z=j,L=Z):$>0&&(z+=ee*$,L+=X*$)}return(ee=V-z)*ee+(X=k-L)*X}function me(V,k,z,L){var j={id:V===void 0?null:V,type:k,geometry:z,tags:L,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Z){var ee=Z.geometry,X=Z.type;if(X==="Point"||X==="MultiPoint"||X==="LineString")be(Z,ee);else if(X==="Polygon"||X==="MultiLineString")for(var $=0;$<ee.length;$++)be(Z,ee[$]);else if(X==="MultiPolygon")for($=0;$<ee.length;$++)for(var K=0;K<ee[$].length;K++)be(Z,ee[$][K])}(j),j}function be(V,k){for(var z=0;z<k.length;z+=3)V.minX=Math.min(V.minX,k[z]),V.minY=Math.min(V.minY,k[z+1]),V.maxX=Math.max(V.maxX,k[z]),V.maxY=Math.max(V.maxY,k[z+1])}function ye(V,k,z,L){if(k.geometry){var j=k.geometry.coordinates,Z=k.geometry.type,ee=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),X=[],$=k.id;if(z.promoteId?$=k.properties[z.promoteId]:z.generateId&&($=L||0),Z==="Point")Oe(j,X);else if(Z==="MultiPoint")for(var K=0;K<j.length;K++)Oe(j[K],X);else if(Z==="LineString")Je(j,X,ee,!1);else if(Z==="MultiLineString"){if(z.lineMetrics){for(K=0;K<j.length;K++)Je(j[K],X=[],ee,!1),V.push(me($,"LineString",X,k.properties));return}mt(j,X,ee,!1)}else if(Z==="Polygon")mt(j,X,ee,!0);else{if(Z!=="MultiPolygon"){if(Z==="GeometryCollection"){for(K=0;K<k.geometry.geometries.length;K++)ye(V,{id:$,geometry:k.geometry.geometries[K],properties:k.properties},z,L);return}throw new Error("Input data is not a valid GeoJSON object.")}for(K=0;K<j.length;K++){var ce=[];mt(j[K],ce,ee,!0),X.push(ce)}}V.push(me($,Z,X,k.properties))}}function Oe(V,k){k.push(oe(V[0])),k.push(sr(V[1])),k.push(0)}function Je(V,k,z,L){for(var j,Z,ee=0,X=0;X<V.length;X++){var $=oe(V[X][0]),K=sr(V[X][1]);k.push($),k.push(K),k.push(0),X>0&&(ee+=L?(j*K-$*Z)/2:Math.sqrt(Math.pow($-j,2)+Math.pow(K-Z,2))),j=$,Z=K}var ce=k.length-3;k[2]=1,je(k,0,ce,z),k[ce+2]=1,k.size=Math.abs(ee),k.start=0,k.end=k.size}function mt(V,k,z,L){for(var j=0;j<V.length;j++){var Z=[];Je(V[j],Z,z,L),k.push(Z)}}function oe(V){return V/360+.5}function sr(V){var k=Math.sin(V*Math.PI/180),z=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return z<0?0:z>1?1:z}function Mr(V,k,z,L,j,Z,ee,X){if(L/=k,Z>=(z/=k)&&ee<L)return V;if(ee<z||Z>=L)return null;for(var $=[],K=0;K<V.length;K++){var ce=V[K],ue=ce.geometry,fe=ce.type,He=j===0?ce.minX:ce.minY,ot=j===0?ce.maxX:ce.maxY;if(He>=z&&ot<L)$.push(ce);else if(!(ot<z||He>=L)){var Ze=[];if(fe==="Point"||fe==="MultiPoint")Wt(ue,Ze,z,L,j);else if(fe==="LineString")Lt(ue,Ze,z,L,j,!1,X.lineMetrics);else if(fe==="MultiLineString")js(ue,Ze,z,L,j,!1);else if(fe==="Polygon")js(ue,Ze,z,L,j,!0);else if(fe==="MultiPolygon")for(var et=0;et<ue.length;et++){var ut=[];js(ue[et],ut,z,L,j,!0),ut.length&&Ze.push(ut)}if(Ze.length){if(X.lineMetrics&&fe==="LineString"){for(et=0;et<Ze.length;et++)$.push(me(ce.id,fe,Ze[et],ce.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(Ze.length===1?(fe="LineString",Ze=Ze[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=Ze.length===3?"Point":"MultiPoint"),$.push(me(ce.id,fe,Ze,ce.tags))}}}return $.length?$:null}function Wt(V,k,z,L,j){for(var Z=0;Z<V.length;Z+=3){var ee=V[Z+j];ee>=z&&ee<=L&&(k.push(V[Z]),k.push(V[Z+1]),k.push(V[Z+2]))}}function Lt(V,k,z,L,j,Z,ee){for(var X,$,K=Zr(V),ce=j===0?Da:Us,ue=V.start,fe=0;fe<V.length-3;fe+=3){var He=V[fe],ot=V[fe+1],Ze=V[fe+2],et=V[fe+3],ut=V[fe+4],Vt=j===0?He:ot,Gt=j===0?et:ut,Et=!1;ee&&(X=Math.sqrt(Math.pow(He-et,2)+Math.pow(ot-ut,2))),Vt<z?Gt>z&&($=ce(K,He,ot,et,ut,z),ee&&(K.start=ue+X*$)):Vt>L?Gt<L&&($=ce(K,He,ot,et,ut,L),ee&&(K.start=ue+X*$)):es(K,He,ot,Ze),Gt<z&&Vt>=z&&($=ce(K,He,ot,et,ut,z),Et=!0),Gt>L&&Vt<=L&&($=ce(K,He,ot,et,ut,L),Et=!0),!Z&&Et&&(ee&&(K.end=ue+X*$),k.push(K),K=Zr(V)),ee&&(ue+=X)}var zt=V.length-3;He=V[zt],ot=V[zt+1],Ze=V[zt+2],(Vt=j===0?He:ot)>=z&&Vt<=L&&es(K,He,ot,Ze),zt=K.length-3,Z&&zt>=3&&(K[zt]!==K[0]||K[zt+1]!==K[1])&&es(K,K[0],K[1],K[2]),K.length&&k.push(K)}function Zr(V){var k=[];return k.size=V.size,k.start=V.start,k.end=V.end,k}function js(V,k,z,L,j,Z){for(var ee=0;ee<V.length;ee++)Lt(V[ee],k,z,L,j,Z,!1)}function es(V,k,z,L){V.push(k),V.push(z),V.push(L)}function Da(V,k,z,L,j,Z){var ee=(Z-k)/(L-k);return V.push(Z),V.push(z+(j-z)*ee),V.push(1),ee}function Us(V,k,z,L,j,Z){var ee=(Z-z)/(j-z);return V.push(k+(L-k)*ee),V.push(Z),V.push(1),ee}function ds(V,k){for(var z=[],L=0;L<V.length;L++){var j,Z=V[L],ee=Z.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")j=Is(Z.geometry,k);else if(ee==="MultiLineString"||ee==="Polygon"){j=[];for(var X=0;X<Z.geometry.length;X++)j.push(Is(Z.geometry[X],k))}else if(ee==="MultiPolygon")for(j=[],X=0;X<Z.geometry.length;X++){for(var $=[],K=0;K<Z.geometry[X].length;K++)$.push(Is(Z.geometry[X][K],k));j.push($)}z.push(me(Z.id,ee,j,Z.tags))}return z}function Is(V,k){var z=[];z.size=V.size,V.start!==void 0&&(z.start=V.start,z.end=V.end);for(var L=0;L<V.length;L+=3)z.push(V[L]+k,V[L+1],V[L+2]);return z}function ze(V,k){if(V.transformed)return V;var z,L,j,Z=1<<V.z,ee=V.x,X=V.y;for(z=0;z<V.features.length;z++){var $=V.features[z],K=$.geometry,ce=$.type;if($.geometry=[],ce===1)for(L=0;L<K.length;L+=2)$.geometry.push(qr(K[L],K[L+1],k,Z,ee,X));else for(L=0;L<K.length;L++){var ue=[];for(j=0;j<K[L].length;j+=2)ue.push(qr(K[L][j],K[L][j+1],k,Z,ee,X));$.geometry.push(ue)}}return V.transformed=!0,V}function qr(V,k,z,L,j,Z){return[Math.round(z*(V*L-j)),Math.round(z*(k*L-Z))]}function ni(V,k,z,L,j){for(var Z=k===j.maxZoom?0:j.tolerance/((1<<k)*j.extent),ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:L,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},X=0;X<V.length;X++){ee.numFeatures++,Ss(ee,V[X],Z,j);var $=V[X].minX,K=V[X].minY,ce=V[X].maxX,ue=V[X].maxY;$<ee.minX&&(ee.minX=$),K<ee.minY&&(ee.minY=K),ce>ee.maxX&&(ee.maxX=ce),ue>ee.maxY&&(ee.maxY=ue)}return ee}function Ss(V,k,z,L){var j=k.geometry,Z=k.type,ee=[];if(Z==="Point"||Z==="MultiPoint")for(var X=0;X<j.length;X+=3)ee.push(j[X]),ee.push(j[X+1]),V.numPoints++,V.numSimplified++;else if(Z==="LineString")ts(ee,j,V,z,!1,!1);else if(Z==="MultiLineString"||Z==="Polygon")for(X=0;X<j.length;X++)ts(ee,j[X],V,z,Z==="Polygon",X===0);else if(Z==="MultiPolygon")for(var $=0;$<j.length;$++){var K=j[$];for(X=0;X<K.length;X++)ts(ee,K[X],V,z,!0,X===0)}if(ee.length){var ce=k.tags||null;if(Z==="LineString"&&L.lineMetrics){for(var ue in ce={},k.tags)ce[ue]=k.tags[ue];ce.mapbox_clip_start=j.start/j.size,ce.mapbox_clip_end=j.end/j.size}var fe={geometry:ee,type:Z==="Polygon"||Z==="MultiPolygon"?3:Z==="LineString"||Z==="MultiLineString"?2:1,tags:ce};k.id!==null&&(fe.id=k.id),V.features.push(fe)}}function ts(V,k,z,L,j,Z){var ee=L*L;if(L>0&&k.size<(j?ee:L))z.numPoints+=k.length/3;else{for(var X=[],$=0;$<k.length;$+=3)(L===0||k[$+2]>ee)&&(z.numSimplified++,X.push(k[$]),X.push(k[$+1])),z.numPoints++;j&&function(K,ce){for(var ue=0,fe=0,He=K.length,ot=He-2;fe<He;ot=fe,fe+=2)ue+=(K[fe]-K[ot])*(K[fe+1]+K[ot+1]);if(ue>0===ce)for(fe=0,He=K.length;fe<He/2;fe+=2){var Ze=K[fe],et=K[fe+1];K[fe]=K[He-2-fe],K[fe+1]=K[He-1-fe],K[He-2-fe]=Ze,K[He-1-fe]=et}}(X,Z),V.push(X)}}function Pe(V,k){var z=(k=this.options=function(j,Z){for(var ee in Z)j[ee]=Z[ee];return j}(Object.create(this.options),k)).debug;if(z&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var L=function(j,Z){var ee=[];if(j.type==="FeatureCollection")for(var X=0;X<j.features.length;X++)ye(ee,j.features[X],Z,X);else ye(ee,j.type==="Feature"?j:{geometry:j},Z);return ee}(V,k);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),L=function(j,Z){var ee=Z.buffer/Z.extent,X=j,$=Mr(j,1,-1-ee,ee,0,-1,2,Z),K=Mr(j,1,1-ee,2+ee,0,-1,2,Z);return($||K)&&(X=Mr(j,1,-ee,1+ee,0,-1,2,Z)||[],$&&(X=ds($,1).concat(X)),K&&(X=X.concat(ds(K,-1)))),X}(L,k),L.length&&this.splitTile(L,0,0,0),z&&(L.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xt(V,k,z){return 32*((1<<V)*z+k)+V}function ct(V,k){return k?V.properties[k]:V.id}function Ji(V,k){if(V==null)return!0;if(V.type==="Feature")return ct(V,k)!=null;if(V.type==="FeatureCollection"){const z=new Set;for(const L of V.features){const j=ct(L,k);if(j==null||z.has(j))return!1;z.add(j)}return!0}return!1}function Gr(V,k){const z=new Map;if(V!=null)if(V.type==="Feature")z.set(ct(V,k),V);else for(const L of V.features)z.set(ct(L,k),L);return z}Pe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pe.prototype.splitTile=function(V,k,z,L,j,Z,ee){for(var X=[V,k,z,L],$=this.options,K=$.debug;X.length;){L=X.pop(),z=X.pop(),k=X.pop(),V=X.pop();var ce=1<<k,ue=xt(k,z,L),fe=this.tiles[ue];if(!fe&&(K>1&&console.time("creation"),fe=this.tiles[ue]=ni(V,k,z,L,$),this.tileCoords.push({z:k,x:z,y:L}),K)){K>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,z,L,fe.numFeatures,fe.numPoints,fe.numSimplified),console.timeEnd("creation"));var He="z"+k;this.stats[He]=(this.stats[He]||0)+1,this.total++}if(fe.source=V,j){if(k===$.maxZoom||k===j)continue;var ot=1<<j-k;if(z!==Math.floor(Z/ot)||L!==Math.floor(ee/ot))continue}else if(k===$.indexMaxZoom||fe.numPoints<=$.indexMaxPoints)continue;if(fe.source=null,V.length!==0){K>1&&console.time("clipping");var Ze,et,ut,Vt,Gt,Et,zt=.5*$.buffer/$.extent,Zi=.5-zt,Yt=.5+zt,xi=1+zt;Ze=et=ut=Vt=null,Gt=Mr(V,ce,z-zt,z+Yt,0,fe.minX,fe.maxX,$),Et=Mr(V,ce,z+Zi,z+xi,0,fe.minX,fe.maxX,$),V=null,Gt&&(Ze=Mr(Gt,ce,L-zt,L+Yt,1,fe.minY,fe.maxY,$),et=Mr(Gt,ce,L+Zi,L+xi,1,fe.minY,fe.maxY,$),Gt=null),Et&&(ut=Mr(Et,ce,L-zt,L+Yt,1,fe.minY,fe.maxY,$),Vt=Mr(Et,ce,L+Zi,L+xi,1,fe.minY,fe.maxY,$),Et=null),K>1&&console.timeEnd("clipping"),X.push(Ze||[],k+1,2*z,2*L),X.push(et||[],k+1,2*z,2*L+1),X.push(ut||[],k+1,2*z+1,2*L),X.push(Vt||[],k+1,2*z+1,2*L+1)}}},Pe.prototype.getTile=function(V,k,z){var L=this.options,j=L.extent,Z=L.debug;if(V<0||V>24)return null;var ee=1<<V,X=xt(V,k=(k%ee+ee)%ee,z);if(this.tiles[X])return ze(this.tiles[X],j);Z>1&&console.log("drilling down to z%d-%d-%d",V,k,z);for(var $,K=V,ce=k,ue=z;!$&&K>0;)K--,ce=Math.floor(ce/2),ue=Math.floor(ue/2),$=this.tiles[xt(K,ce,ue)];return $&&$.source?(Z>1&&console.log("found parent tile z%d-%d-%d",K,ce,ue),Z>1&&console.time("drilling down"),this.splitTile($.source,K,ce,ue,V,k,z),Z>1&&console.timeEnd("drilling down"),this.tiles[X]?ze(this.tiles[X],j):null):null};class gt extends rt{constructor(k,z,L,j){super(k,z,L),this._dataUpdateable=new Map,this.loadGeoJSON=(Z,ee)=>{const{promoteId:X}=Z;if(Z.request)return u.f(Z.request,($,K,ce,ue)=>{this._dataUpdateable=Ji(K,X)?Gr(K,X):void 0,ee($,K,ce,ue)});if(typeof Z.data=="string")try{const $=JSON.parse(Z.data);this._dataUpdateable=Ji($,X)?Gr($,X):void 0,ee(null,$)}catch{ee(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}else Z.dataDiff?this._dataUpdateable?(function($,K,ce){var ue,fe,He,ot;if(K.removeAll&&$.clear(),K.remove)for(const Ze of K.remove)$.delete(Ze);if(K.add)for(const Ze of K.add){const et=ct(Ze,ce);et!=null&&$.set(et,Ze)}if(K.update)for(const Ze of K.update){let et=$.get(Ze.id);if(et==null)continue;const ut=!Ze.removeAllProperties&&(((ue=Ze.removeProperties)===null||ue===void 0?void 0:ue.length)>0||((fe=Ze.addOrUpdateProperties)===null||fe===void 0?void 0:fe.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||ut)&&(et=Object.assign({},et),$.set(Ze.id,et),ut&&(et.properties=Object.assign({},et.properties))),Ze.newGeometry&&(et.geometry=Ze.newGeometry),Ze.removeAllProperties)et.properties={};else if(((He=Ze.removeProperties)===null||He===void 0?void 0:He.length)>0)for(const Vt of Ze.removeProperties)Object.prototype.hasOwnProperty.call(et.properties,Vt)&&delete et.properties[Vt];if(((ot=Ze.addOrUpdateProperties)===null||ot===void 0?void 0:ot.length)>0)for(const{key:Vt,value:Gt}of Ze.addOrUpdateProperties)et.properties[Vt]=Gt}}(this._dataUpdateable,Z.dataDiff,X),ee(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ee(new Error(`Cannot update existing geojson data in ${Z.source}`)):ee(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,j&&(this.loadGeoJSON=j)}loadGeoJSONTile(k,z){const L=k.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const j=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!j)return z(null,null);const Z=new class{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.N,this.length=X.length,this._features=X}feature(X){return new class{constructor($){this._feature=$,this.extent=u.N,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))}loadGeometry(){if(this._feature.type===1){const $=[];for(const K of this._feature.geometry)$.push([new u.P(K[0],K[1])]);return $}{const $=[];for(const K of this._feature.geometry){const ce=[];for(const ue of K)ce.push(new u.P(ue[0],ue[1]));$.push(ce)}return $}}toGeoJSON($,K,ce){return st.call(this,$,K,ce)}}(this._features[X])}}(j.features);let ee=Sr(Z);ee.byteOffset===0&&ee.byteLength===ee.buffer.byteLength||(ee=new Uint8Array(ee)),z(null,{vectorTile:Z,rawData:ee.buffer})}loadData(k,z){var L;(L=this._pendingRequest)===null||L===void 0||L.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const j=!!(k&&k.request&&k.request.collectResourceTiming)&&new u.bu(k.request);this._pendingCallback=z,this._pendingRequest=this.loadGeoJSON(k,(Z,ee)=>{if(delete this._pendingCallback,delete this._pendingRequest,Z||!ee)return z(Z);if(typeof ee!="object")return z(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{Ve(ee,!0);try{if(k.filter){const $=u.bC(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($.result==="error")throw new Error($.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(ce=>$.value.evaluate({zoom:0},ce))}}this._geoJSONIndex=k.cluster?new Tr(function({superclusterOptions:$,clusterProperties:K}){if(!K||!$)return $;const ce={},ue={},fe={accumulated:null,zoom:0},He={properties:null},ot=Object.keys(K);for(const Ze of ot){const[et,ut]=K[Ze],Vt=u.bC(ut),Gt=u.bC(typeof et=="string"?[et,["accumulated"],["get",Ze]]:et);ce[Ze]=Vt.value,ue[Ze]=Gt.value}return $.map=Ze=>{He.properties=Ze;const et={};for(const ut of ot)et[ut]=ce[ut].evaluate(fe,He);return et},$.reduce=(Ze,et)=>{He.properties=et;for(const ut of ot)fe.accumulated=Ze[ut],Ze[ut]=ue[ut].evaluate(fe,He)},$}(k)).load(ee.features):function($,K){return new Pe($,K)}(ee,k.geojsonVtOptions)}catch($){return z($)}this.loaded={};const X={};if(j){const $=j.finish();$&&(X.resourceTiming={},X.resourceTiming[k.source]=JSON.parse(JSON.stringify($)))}z(null,X)}})}reloadTile(k,z){const L=this.loaded;return L&&L[k.uid]?super.reloadTile(k,z):this.loadTile(k,z)}removeSource(k,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),z()}getClusterExpansionZoom(k,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(L){z(L)}}getClusterChildren(k,z){try{z(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(L){z(L)}}getClusterLeaves(k,z){try{z(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(L){z(L)}}}class is{constructor(k){this.self=k,this.actor=new u.C(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:rt,geojson:gt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,L)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=L},this.self.registerRTLTextPlugin=z=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.applyArabicShaping=z.applyArabicShaping,u.bD.processBidirectionalText=z.processBidirectionalText,u.bD.processStyledBidirectionalText=z.processStyledBidirectionalText}}setReferrer(k,z){this.referrer=z}setImages(k,z,L){this.availableImages[k]=z;for(const j in this.workerSources[k]){const Z=this.workerSources[k][j];for(const ee in Z)Z[ee].availableImages=z}L()}setLayers(k,z,L){this.getLayerIndex(k).replace(z),L()}updateLayers(k,z,L){this.getLayerIndex(k).update(z.layers,z.removedIds),L()}loadTile(k,z,L){this.getWorkerSource(k,z.type,z.source).loadTile(z,L)}loadDEMTile(k,z,L){this.getDEMWorkerSource(k,z.source).loadTile(z,L)}reloadTile(k,z,L){this.getWorkerSource(k,z.type,z.source).reloadTile(z,L)}abortTile(k,z,L){this.getWorkerSource(k,z.type,z.source).abortTile(z,L)}removeTile(k,z,L){this.getWorkerSource(k,z.type,z.source).removeTile(z,L)}removeDEMTile(k,z){this.getDEMWorkerSource(k,z.source).removeTile(z)}removeSource(k,z,L){if(!this.workerSources[k]||!this.workerSources[k][z.type]||!this.workerSources[k][z.type][z.source])return;const j=this.workerSources[k][z.type][z.source];delete this.workerSources[k][z.type][z.source],j.removeSource!==void 0?j.removeSource(z,L):L()}loadWorkerSource(k,z,L){try{this.self.importScripts(z.url),L()}catch(j){L(j.toString())}}syncRTLPluginState(k,z,L){try{u.bD.setState(z);const j=u.bD.getPluginURL();if(u.bD.isLoaded()&&!u.bD.isParsed()&&j!=null){this.self.importScripts(j);const Z=u.bD.isParsed();L(Z?void 0:new Error(`RTL Text Plugin failed to import scripts from ${j}`),Z)}}catch(j){L(j.toString())}}getAvailableImages(k){let z=this.availableImages[k];return z||(z=[]),z}getLayerIndex(k){let z=this.layerIndexes[k];return z||(z=this.layerIndexes[k]=new We),z}getWorkerSource(k,z,L){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][z]||(this.workerSources[k][z]={}),this.workerSources[k][z][L]||(this.workerSources[k][z][L]=new this.workerSourceTypes[z]({send:(j,Z,ee)=>{this.actor.send(j,Z,ee,k)}},this.getLayerIndex(k),this.getAvailableImages(k))),this.workerSources[k][z][L]}getDEMWorkerSource(k,z){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][z]||(this.demWorkerSources[k][z]=new wt),this.demWorkerSources[k][z]}}return u.i()&&(self.worker=new is(self)),is}),Ae(["./shared"],function(u){var We="3.6.2";class Y{static testProp(t){if(!Y.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in Y.docStyle)return t[a];return t[0]}static create(t,a,o){const c=window.document.createElement(t);return a!==void 0&&(c.className=a),o&&o.appendChild(c),c}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(t,a){t.style[Y.transformProp]=a}static addEventListener(t,a,o,c={}){t.addEventListener(a,o,"passive"in c?c:c.capture)}static removeEventListener(t,a,o,c={}){t.removeEventListener(a,o,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)},0)}static mousePos(t,a){const o=t.getBoundingClientRect();return new u.P(a.clientX-o.left-t.clientLeft,a.clientY-o.top-t.clientTop)}static touchPos(t,a){const o=t.getBoundingClientRect(),c=[];for(let d=0;d<a.length;d++)c.push(new u.P(a[d].clientX-o.left-t.clientLeft,a[d].clientY-o.top-t.clientTop));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const pt={supported:!1,testSupport:function(h){!rt&&_e&&(wt?at(h):yt=h)}};let yt,_e,rt=!1,wt=!1;function at(h){const t=h.createTexture();h.bindTexture(h.TEXTURE_2D,t);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,_e),h.isContextLost())return;pt.supported=!0}catch{}h.deleteTexture(t),rt=!0}var Se,Ve;typeof document<"u"&&(_e=document.createElement("img"),_e.onload=function(){yt&&at(yt),yt=null,wt=!0},_e.onerror=function(){rt=!0,yt=null},_e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let t,a,o,c;h.resetRequestQueue=()=>{t=[],a=0,o=0,c={}},h.addThrottleControl=I=>{const T=o++;return c[T]=I,T},h.removeThrottleControl=I=>{delete c[I],y()},h.getImage=(I,T,M=!0)=>{pt.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*");const E={requestParameters:I,supportImageRefresh:M,callback:T,cancelled:!1,completed:!1,cancel:()=>{E.completed||E.cancelled||(E.cancelled=!0,E.innerRequest&&(E.innerRequest.cancel(),a--),y())}};return t.push(E),y(),E};const d=I=>{const{requestParameters:T,supportImageRefresh:M,callback:E}=I;return u.e(T,{type:"image"}),(M!==!1||u.i()||u.g(T.url)||T.headers&&!Object.keys(T.headers).reduce((O,R)=>O&&R==="accept",!0)?u.m:v)(T,(O,R,N,F)=>{_(I,E,O,R,N,F)})},_=(I,T,M,E,O,R)=>{M?T(M):E instanceof HTMLImageElement||u.a(E)?T(null,E):E&&((N,F)=>{typeof createImageBitmap=="function"?u.b(N,F):u.d(N,F)})(E,(N,F)=>{N!=null?T(N):F!=null&&T(null,F,{cacheControl:O,expires:R})}),I.cancelled||(I.completed=!0,a--,y())},y=()=>{const I=(()=>{const T=Object.keys(c);let M=!1;if(T.length>0){for(const E of T)if(M=c[E](),M)break}return M})()?u.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let T=a;T<I&&t.length>0;T++){const M=t.shift();if(M.cancelled){T--;continue}const E=d(M);a++,M.innerRequest=E}},v=(I,T)=>{const M=new Image,E=I.url;let O=!1;const R=I.credentials;return R&&R==="include"?M.crossOrigin="use-credentials":(R&&R==="same-origin"||!u.s(E))&&(M.crossOrigin="anonymous"),M.fetchPriority="high",M.onload=()=>{T(null,M),M.onerror=M.onload=null},M.onerror=()=>{O||T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),M.onerror=M.onload=null},M.src=E,{cancel:()=>{O=!0,M.src=""}}}}(Se||(Se={})),Se.resetRequestQueue(),function(h){h.Glyphs="Glyphs",h.Image="Image",h.Source="Source",h.SpriteImage="SpriteImage",h.SpriteJSON="SpriteJSON",h.Style="Style",h.Tile="Tile",h.Unknown="Unknown"}(Ve||(Ve={}));class st{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,o){const c=function(d){const _=d.match(ht);if(!_)throw new Error(`Unable to parse URL "${d}"`);return{protocol:_[1],authority:_[2],path:_[3]||"/",params:_[4]?_[4].split("&"):[]}}(t);return c.path+=`${a}${o}`,function(d){const _=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${_}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ot(h){var t=new u.A(3);return t[0]=h[0],t[1]=h[1],t[2]=h[2],t}var vt,qt=function(h,t,a){return h[0]=t[0]-a[0],h[1]=t[1]-a[1],h[2]=t[2]-a[2],h};vt=new u.A(3),u.A!=Float32Array&&(vt[0]=0,vt[1]=0,vt[2]=0);var Pi=function(h){var t=h[0],a=h[1];return t*t+a*a};function jt(h){const t=[];if(typeof h=="string")t.push({id:"default",url:h});else if(h&&h.length>0){const a=[];for(const{id:o,url:c}of h){const d=`${o}${c}`;a.indexOf(d)===-1&&(a.push(d),t.push({id:o,url:c}))}}return t}function Pt(h,t,a,o,c){if(o)return void h(o);if(c!==Object.values(t).length||c!==Object.values(a).length)return;const d={};for(const _ in t){d[_]={};const y=u.h.getImageCanvasContext(a[_]),v=t[_];for(const I in v){const{width:T,height:M,x:E,y:O,sdf:R,pixelRatio:N,stretchX:F,stretchY:J,content:ie}=v[I];d[_][I]={data:null,pixelRatio:N,sdf:R,stretchX:F,stretchY:J,content:ie,spriteData:{width:T,height:M,x:E,y:O,context:y}}}}h(null,d)}(function(){var h=new u.A(2);u.A!=Float32Array&&(h[0]=0,h[1]=0)})();class ft{constructor(t,a,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(a,c)}update(t,a,o){const{width:c,height:d}=t,_=!(this.size&&this.size[0]===c&&this.size[1]===d||o),{context:y}=this,{gl:v}=y;if(this.useMipmap=!!(a&&a.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!a||a.premultiply!==!1)),_)this.size=[c,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.a(t)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,c,d,0,this.format,v.UNSIGNED_BYTE,t.data);else{const{x:I,y:T}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.a(t)?v.texSubImage2D(v.TEXTURE_2D,0,I,T,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,I,T,c,d,v.RGBA,v.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D)}bind(t,a,o){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||t),this.filter=t),a!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function wi(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ct extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:o}of this.requestors)this._notify(a,o);this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const o=a.spriteData;a.data=new u.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let o=!0;const c=a.data||a.spriteData;return this._validateStretch(a.stretchX,c&&c.width)||(this.fire(new u.j(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(a.stretchY,c&&c.height)||(this.fire(new u.j(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(a.content,a)||(this.fire(new u.j(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,a){if(!t)return!0;let o=0;for(const c of t){if(c[0]<o||c[1]<c[0]||a<c[1])return!1;o=c[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const o=a.spriteData,c=o&&o.width||a.data.width,d=o&&o.height||a.data.height;return!(t[0]<0||c<t[0]||t[1]<0||d<t[1]||t[2]<0||c<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,o=!0){const c=this.getImage(t);if(o&&(c.data.width!==a.data.width||c.data.height!==a.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=c.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let o=!0;if(!this.isLoaded())for(const c of t)this.images[c]||(o=!1);this.isLoaded()||o?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const o={};for(const c of t){let d=this.getImage(c);d||(this.fire(new u.k("styleimagemissing",{id:c})),d=this.getImage(c)),d?o[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:u.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,o)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],o=this.getImage(t);if(!o)return null;if(a&&a.position.version===o.version)return a.position;if(a)a.position.version=o.version;else{const c={w:o.data.width+2,h:o.data.height+2,x:0,y:0},d=new u.I(c,o);this.patterns[t]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ft(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:a,h:o}=u.p(t),c=this.atlasImage;c.resize({width:a||1,height:o||1});for(const d in this.patterns){const{bin:_}=this.patterns[d],y=_.x+1,v=_.y+1,I=this.getImage(d).data,T=I.width,M=I.height;u.R.copy(I,c,{x:0,y:0},{x:y,y:v},{width:T,height:M}),u.R.copy(I,c,{x:0,y:M-1},{x:y,y:v-1},{width:T,height:1}),u.R.copy(I,c,{x:0,y:0},{x:y,y:v+M},{width:T,height:1}),u.R.copy(I,c,{x:T-1,y:0},{x:y-1,y:v},{width:1,height:M}),u.R.copy(I,c,{x:0,y:0},{x:y+T,y:v},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const o=this.getImage(a);o||u.w(`Image with ID: "${a}" was not found`),wi(o)&&this.updateImage(a,o)}}}const ji=1e20;function nt(h,t,a,o,c,d,_,y,v){for(let I=t;I<t+o;I++)Dt(h,a*d+I,d,c,_,y,v);for(let I=a;I<a+c;I++)Dt(h,I*d+t,1,o,_,y,v)}function Dt(h,t,a,o,c,d,_){d[0]=0,_[0]=-1e20,_[1]=ji,c[0]=h[t];for(let y=1,v=0,I=0;y<o;y++){c[y]=h[t+y*a];const T=y*y;do{const M=d[v];I=(c[y]-c[M]+T-M*M)/(y-M)/2}while(I<=_[v]&&--v>-1);v++,d[v]=y,_[v]=I,_[v+1]=ji}for(let y=0,v=0;y<o;y++){for(;_[v+1]<y;)v++;const I=d[v],T=y-I;h[t+y*a]=c[I]+T*T}}class Ii{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t,a){const o=[];for(const c in t)for(const d of t[c])o.push({stack:c,id:d});u.o(o,({stack:c,id:d},_)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let v=y.glyphs[d];if(v!==void 0)return void _(null,{stack:c,id:d,glyph:v});if(v=this._tinySDF(y,c,d),v)return y.glyphs[d]=v,void _(null,{stack:c,id:d,glyph:v});const I=Math.floor(d/256);if(256*I>65535)return void _(new Error("glyphs > 65535 not supported"));if(y.ranges[I])return void _(null,{stack:c,id:d,glyph:v});if(!this.url)return void _(new Error("glyphsUrl is not set"));let T=y.requests[I];T||(T=y.requests[I]=[],Ii.loadGlyphRange(c,I,this.url,this.requestManager,(M,E)=>{if(E){for(const O in E)this._doesCharSupportLocalGlyph(+O)||(y.glyphs[+O]=E[+O]);y.ranges[I]=!0}for(const O of T)O(M,E);delete y.requests[I]})),T.push((M,E)=>{M?_(M):E&&_(null,{stack:c,id:d,glyph:E[d]||null})})},(c,d)=>{if(c)a(c);else if(d){const _={};for(const{stack:y,id:v,glyph:I}of d)(_[y]||(_[y]={}))[v]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};a(null,_)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(u.u["CJK Unified Ideographs"](t)||u.u["Hangul Syllables"](t)||u.u.Hiragana(t)||u.u.Katakana(t))}_tinySDF(t,a,o){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let d=t.tinySDF;if(!d){let y="400";/bold/i.test(a)?y="900":/medium/i.test(a)?y="500":/light/i.test(a)&&(y="200"),d=t.tinySDF=new Ii.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:y})}const _=d.draw(String.fromCharCode(o));return{id:o,bitmap:new u.q({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ii.loadGlyphRange=function(h,t,a,o,c){const d=256*t,_=d+255,y=o.transformRequest(a.replace("{fontstack}",h).replace("{range}",`${d}-${_}`),Ve.Glyphs);u.l(y,(v,I)=>{if(v)c(v);else if(I){const T={};for(const M of u.n(I))T[M.id]=M;c(null,T)}})},Ii.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:a=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=a;const y=this.size=h+4*t,v=this._createCanvas(y),I=this.ctx=v.getContext("2d",{willReadFrequently:!0});I.font=`${_} ${d} ${h}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(h),_=Math.ceil(a),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),v=Math.min(this.size-this.buffer,_+Math.ceil(o)),I=y+2*this.buffer,T=v+2*this.buffer,M=Math.max(I*T,0),E=new Uint8ClampedArray(M),O={data:E,width:I,height:T,glyphWidth:y,glyphHeight:v,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(y===0||v===0)return O;const{ctx:R,buffer:N,gridInner:F,gridOuter:J}=this;R.clearRect(N,N,y,v),R.fillText(h,N,N+_);const ie=R.getImageData(N,N,y,v);J.fill(ji,0,M),F.fill(0,0,M);for(let q=0;q<v;q++)for(let H=0;H<y;H++){const se=ie.data[4*(q*y+H)+3]/255;if(se===0)continue;const ae=(q+N)*I+H+N;if(se===1)J[ae]=0,F[ae]=ji;else{const he=.5-se;J[ae]=he>0?he*he:0,F[ae]=he<0?he*he:0}}nt(J,0,0,I,T,I,this.f,this.v,this.z),nt(F,N,N,y,v,I,this.f,this.v,this.z);for(let q=0;q<M;q++){const H=Math.sqrt(J[q])-Math.sqrt(F[q]);E[q]=Math.round(255-255*(H/this.radius+this.cutoff))}return O}};class Li{constructor(){this.specification=u.v.light.position}possiblyEvaluate(t,a){return u.z(t.expression.evaluate(a))}interpolate(t,a,o){return{x:u.B.number(t.x,a.x,o),y:u.B.number(t.y,a.y,o),z:u.B.number(t.z,a.z,o)}}}let dt;class Sr extends u.E{constructor(t){super(),dt=dt||new u.r({anchor:new u.D(u.v.light.anchor),position:new Li,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(dt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(u.t,t,a))for(const o in t){const c=t[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),c):this._transitionable.setValue(o,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,o){return(!o||o.validate!==!1)&&u.x(this,t.call(u.y,u.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}}class Yi{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const o=t.join(",")+String(a);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,a)),this.dashEntry[o]}getDashRanges(t,a,o){const c=[];let d=t.length%2==1?-t[t.length-1]*o:0,_=t[0]*o,y=!0;c.push({left:d,right:_,isDash:y,zeroLength:t[0]===0});let v=t[0];for(let I=1;I<t.length;I++){y=!y;const T=t[I];d=v*o,v+=T,_=v*o,c.push({left:d,right:_,isDash:y,zeroLength:T===0})}return c}addRoundDash(t,a,o){const c=a/2;for(let d=-o;d<=o;d++){const _=this.width*(this.nextRow+o+d);let y=0,v=t[y];for(let I=0;I<this.width;I++){I/v.right>1&&(v=t[++y]);const T=Math.abs(I-v.left),M=Math.abs(I-v.right),E=Math.min(T,M);let O;const R=d/o*(c+1);if(v.isDash){const N=c-Math.abs(R);O=Math.sqrt(E*E+N*N)}else O=c-Math.sqrt(E*E+R*R);this.data[_+I]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t){for(let y=t.length-1;y>=0;--y){const v=t[y],I=t[y+1];v.zeroLength?t.splice(y,1):I&&I.isDash===v.isDash&&(I.left=v.left,t.splice(y,1))}const a=t[0],o=t[t.length-1];a.isDash===o.isDash&&(a.left=o.left-this.width,o.right=a.right+this.width);const c=this.width*this.nextRow;let d=0,_=t[d];for(let y=0;y<this.width;y++){y/_.right>1&&(_=t[++d]);const v=Math.abs(y-_.left),I=Math.abs(y-_.right),T=Math.min(v,I);this.data[c+y]=Math.max(0,Math.min(255,(_.isDash?T:-T)+128))}}addDash(t,a){const o=a?7:0,c=2*o+1;if(this.nextRow+c>this.height)return u.w("LineAtlas out of space"),null;let d=0;for(let y=0;y<t.length;y++)d+=t[y];if(d!==0){const y=this.width/d,v=this.getDashRanges(t,this.width,y);a?this.addRoundDash(v,y,o):this.addRegularDash(v)}const _={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:d};return this.nextRow+=c,this.dirty=!0,_}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class fi{constructor(t,a,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const c=this.workerPool.acquire(o);for(let d=0;d<c.length;d++){const _=new u.C(c[d],a,o);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a,o){u.o(this.actors,(c,d)=>{c.send(t,a,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Di(h,t,a){const o=function(c,d){if(c)return a(c);if(d){const _=u.F(u.e(d,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(_.vectorLayers=d.vector_layers,_.vectorLayerIds=_.vectorLayers.map(y=>y.id)),a(null,_)}};return h.url?u.f(t.transformRequest(h.url,Ve.Source),o):u.h.frame(()=>o(null,h))}class Nt{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.L?new u.L(t.lng,t.lat):u.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.L?new u.L(t.lng,t.lat):u.L.convert(t),this}extend(t){const a=this._sw,o=this._ne;let c,d;if(t instanceof u.L)c=t,d=t;else{if(!(t instanceof Nt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Nt.convert(t)):this.extend(u.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.L.convert(t)):this;if(c=t._sw,d=t._ne,!c||!d)return this}return a||o?(a.lng=Math.min(c.lng,a.lng),a.lat=Math.min(c.lat,a.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new u.L(c.lng,c.lat),this._ne=new u.L(d.lng,d.lat)),this}getCenter(){return new u.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.L(this.getWest(),this.getNorth())}getSouthEast(){return new u.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:o}=u.L.convert(t);let c=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(t){return t instanceof Nt?t:t&&new Nt(t)}static fromLngLat(t,a=0){const o=360*a/40075017,c=o/Math.cos(Math.PI/180*t.lat);return new Nt(new u.L(t.lng-c,t.lat-o),new u.L(t.lng+c,t.lat+o))}}class ui{constructor(t,a,o){this.bounds=Nt.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),o=Math.floor(u.G(this.bounds.getWest())*a),c=Math.floor(u.H(this.bounds.getNorth())*a),d=Math.ceil(u.G(this.bounds.getEast())*a),_=Math.ceil(u.H(this.bounds.getSouth())*a);return t.x>=o&&t.x<d&&t.y>=c&&t.y<_}}class pr extends u.E{constructor(t,a,o,c){if(super(),this.load=()=>{this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Di(this._options,this.map._requestManager,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),d?this.fire(new u.j(d)):_&&(u.e(this,_),_.bounds&&(this.tileBounds=new ui(_.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>u.e({},this._options),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.F(a,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,a){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(o,Ve.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(_,y){return delete t.request,t.aborted?a(null):_&&_.status!==404?a(_):(y&&y.resourceTiming&&(t.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&t.setExpiryData(y),t.loadVectorData(y,this.map.painter),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",c,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",c,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Tr extends u.E{constructor(t,a,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},a),u.e(this,u.F(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Di(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new u.j(t)):a&&(u.e(this,a),a.bounds&&(this.tileBounds=new ui(a.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return u.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=Se.getImage(this.map._requestManager.transformRequest(o,Ve.Tile),(c,d,_)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(c)t.state="errored",a(c);else if(d){this.map._refreshExpiredTiles&&_&&t.setExpiryData(_);const y=this.map.painter.context,v=y.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new ft(y,d,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),y.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,y.extTextureFilterAnisotropicMax)),t.state="loaded",a(null)}},this.map._refreshExpiredTiles)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}class Ur extends Tr{constructor(t,a,o,c){super(t,a,o,c),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t,a){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(o,Ve.Tile);function d(_,y){_&&(t.state="errored",a(_)),y&&(t.dem=y,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",a(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=Se.getImage(c,(_,y,v)=>u._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(_)t.state="errored",a(_);else if(y){this.map._refreshExpiredTiles&&t.setExpiryData(v);const I=u.a(y)&&u.J()?y:yield function(M){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.K()){const E=M.width+2,O=M.height+2;try{return new u.R({width:E,height:O},yield u.M(M,-1,-1,E,O))}catch{}}return u.h.getImageData(M,1)})}(y),T={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",T,d))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const a=t.canonical,o=Math.pow(2,a.z),c=(a.x-1+o)%o,d=a.x===0?t.wrap-1:t.wrap,_=(a.x+1+o)%o,y=a.x+1===o?t.wrap+1:t.wrap,v={};return v[new u.O(t.overscaledZ,d,a.z,c,a.y).key]={backfilled:!1},v[new u.O(t.overscaledZ,y,a.z,_,a.y).key]={backfilled:!1},a.y>0&&(v[new u.O(t.overscaledZ,d,a.z,c,a.y-1).key]={backfilled:!1},v[new u.O(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},v[new u.O(t.overscaledZ,y,a.z,_,a.y-1).key]={backfilled:!1}),a.y+1<o&&(v[new u.O(t.overscaledZ,d,a.z,c,a.y+1).key]={backfilled:!1},v[new u.O(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},v[new u.O(t.overscaledZ,y,a.z,_,a.y+1).key]={backfilled:!1}),v}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class rr extends u.E{constructor(t,a,o,c){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>u.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(c),this._data=a.data,this._options=u.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const d=u.N/this.tileSize;this.workerOptions=u.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*d,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*d,extent:u.N,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.N,radius:(a.clusterRadius||50)*d,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},a),this}getClusterChildren(t,a){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},a),this}getClusterLeaves(t,a,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:a,offset:o},c),this}_updateWorkerData(t){const a=u.e({},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(u.h.resolveURL(this._data),Ve.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(o,c)=>{if(this._pendingLoads--,this._removed||c&&c.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let d=null;if(c&&c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0)),o)return void this.fire(new u.j(o));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&u.e(_,{resourceTiming:d}),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,a){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,c,(d,_)=>(delete t.request,t.unloadVectorData(),t.aborted?a(null):d?a(d):(t.loadVectorData(_,this.map.painter,o==="reloadTile"),a(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ui=u.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Fi extends u.E{constructor(t,a,o,c){super(),this.load=(d,_)=>{this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Se.getImage(this.map._requestManager.transformRequest(this.url,Ve.Image),(y,v)=>{this._request=null,this._loaded=!0,y?this.fire(new u.j(y)):v&&(this.image=v,d&&(this.coordinates=d),_&&_(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Ui.members)),this.boundsSegments||(this.boundsSegments=u.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ft(d,this.image,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const I=this.tiles[v];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,y=!0)}y&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=o,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=a}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(u.U.fromLngLat);this.tileID=function(c){let d=1/0,_=1/0,y=-1/0,v=-1/0;for(const E of c)d=Math.min(d,E.x),_=Math.min(_,E.y),y=Math.max(y,E.x),v=Math.max(v,E.y);const I=Math.max(y-d,v-_),T=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),M=Math.pow(2,T);return new u.W(T,Math.floor((d+y)/2*M),Math.floor((_+v)/2*M))}(a),this.minzoom=this.maxzoom=this.tileID.z;const o=a.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new u.V,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,u.N,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,u.N),this._boundsArray.emplaceBack(o[2].x,o[2].y,u.N,u.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}hasTransition(){return!1}}class le extends Fi{constructor(t,a,o,c){super(t,a,o,c),this.load=()=>{this._loaded=!1;const d=this.options;this.urls=[];for(const _ of d.urls)this.urls.push(this.map._requestManager.transformRequest(_,Ve.Source).url);u.X(this.urls,(_,y)=>{this._loaded=!0,_?this.fire(new u.j(_)):y&&(this.video=y,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Ui.members)),this.boundsSegments||(this.boundsSegments=u.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.texSubImage2D(_.TEXTURE_2D,0,0,0,_.RGBA,_.UNSIGNED_BYTE,this.video)):(this.texture=new ft(d,this.video,_.RGBA),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const I=this.tiles[v];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,y=!0)}y&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=a}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new u.j(new u.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class je extends Fi{constructor(t,a,o,c){super(t,a,o,c),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const _=this.map.painter.context,y=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,Ui.members)),this.boundsSegments||(this.boundsSegments=u.S.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ft(_,this.canvas,y.RGBA,{premultiply:!0});let v=!1;for(const I in this.tiles){const T=this.tiles[I];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,v=!0)}v&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(_=>typeof _!="number"))||this.fire(new u.j(new u.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.Y(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new u.j(new u.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ce={},me=h=>{switch(h){case"geojson":return rr;case"image":return Fi;case"raster":return Tr;case"raster-dem":return Ur;case"vector":return pr;case"video":return le;case"canvas":return je}return Ce[h]};function be(h,t){const a=u.Z();return u.$(a,a,[1,1,0]),u.a0(a,a,[.5*h.width,.5*h.height,1]),u.a1(a,a,h.calculatePosMatrix(t.toUnwrapped()))}function ye(h,t,a,o,c,d){const _=function(M,E,O){if(M)for(const R of M){const N=E[R];if(N&&N.source===O&&N.type==="fill-extrusion")return!0}else for(const R in E){const N=E[R];if(N.source===O&&N.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,h.id),y=d.maxPitchScaleFactor(),v=h.tilesIn(o,y,_);v.sort(Oe);const I=[];for(const M of v)I.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(t,a,h._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,c,d,y,be(h.transform,M.tileID))});const T=function(M){const E={},O={};for(const R of M){const N=R.queryResults,F=R.wrappedTileID,J=O[F]=O[F]||{};for(const ie in N){const q=N[ie],H=J[ie]=J[ie]||{},se=E[ie]=E[ie]||[];for(const ae of q)H[ae.featureIndex]||(H[ae.featureIndex]=!0,se.push(ae))}}return E}(I);for(const M in T)T[M].forEach(E=>{const O=E.feature,R=h.getFeatureState(O.layer["source-layer"],O.id);O.source=O.layer.source,O.layer["source-layer"]&&(O.sourceLayer=O.layer["source-layer"]),O.state=R});return T}function Oe(h,t){const a=h.tileID,o=t.tileID;return a.overscaledZ-o.overscaledZ||a.canonical.y-o.canonical.y||a.wrap-o.wrap||a.canonical.x-o.canonical.x}class Je{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=u.a2(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,d){const _={};if(!d)return _;for(const y of c){const v=y.layerIds.map(I=>d.getLayer(I)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(I=>v.filter(T=>T.id===I)[0]));for(const I of v)_[I.id]=y}}return _}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof u.a4){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof u.a4&&d.hasRTLText){this.hasRTLText=!0,u.a5();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(c).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ft(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ft(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,o,c,d,_,y,v,I,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:_,tileSize:this.tileSize,pixelPosMatrix:T,transform:v,params:y,queryPadding:this.queryPadding*I},t,a,o):{}}querySourceFeatures(t,a){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),d=a&&a.sourceLayer?a.sourceLayer:"",_=c._geojsonTileLayer||c[d];if(!_)return;const y=u.a6(a&&a.filter),{z:v,x:I,y:T}=this.tileID.canonical,M={z:v,x:I,y:T};for(let E=0;E<_.length;E++){const O=_.feature(E);if(y.needGeometry){const F=u.a7(O,!0);if(!y.filter(new u.a8(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!y.filter(new u.a8(this.tileID.overscaledZ),O))continue;const R=o.getId(O,d),N=new u.a9(O,v,I,T,R);N.tile=M,t.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const o=u.aa(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(a)if(this.expirationTime<a)c=!0;else{const d=this.expirationTime-a;d?this.expirationTime=o+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!a.style.hasLayer(c))continue;const d=this.buckets[c],_=d.layers[0].sourceLayer||"_geojsonTileLayer",y=o[_],v=t[_];if(!y||!v||Object.keys(v).length===0)continue;d.update(v,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=a&&a.style&&a.style.getLayer(c);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<u.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=u.h.now()+t}setDependencies(t,a){const o={};for(const c of a)o[c]=!0;this.dependencies[t]=o}hasDependency(t,a){for(const o of t){const c=this.dependencies[o];if(c){for(const d of a)if(c[d])return!0}}return!1}}class mt{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,o){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:a,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},o)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const o=t.wrapped().key,c=a===void 0?0:this.data[o].indexOf(a),d=this.data[o][c];return this.data[o].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const o in this.data)for(const c of this.data[o])t(c.value)||a.push(c);for(const o of a)this.remove(o.value.tileID,o)}}class oe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,o){const c=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},u.e(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==c&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const d in this.state[t][c])o[d]||(this.deletedStates[t][c][d]=null)}else for(const d in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][d]===null&&delete this.deletedStates[t][c][d]}removeFeatureState(t,a,o){if(this.deletedStates[t]===null)return;const c=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&a!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,a){const o=String(a),c=u.e({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][a];if(d===null)return{};for(const _ in d)delete c[_]}return c}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const _ in this.stateChanges[c])this.state[c][_]||(this.state[c][_]={}),u.e(this.state[c][_],this.stateChanges[c][_]),d[_]=this.state[c][_];o[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const _ in this.state[c])d[_]={},this.state[c][_]={};else for(const _ in this.deletedStates[c]){if(this.deletedStates[c][_]===null)this.state[c][_]={};else for(const y of Object.keys(this.deletedStates[c][_]))delete this.state[c][_][y];d[_]=this.state[c][_]}o[c]=o[c]||{},u.e(o[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in t)t[c].setFeatureState(o,a)}}class sr extends u.E{constructor(t,a,o){super(),this.id=t,this.dispatcher=o,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,_,y)=>{const v=new(me(d.type))(c,d,_,y);if(v.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${v.id}`);return v})(t,a,o,this),this._tiles={},this._cache=new mt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new oe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a){return this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new u.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const o=this._tiles[a];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Mr).map(t=>t.key)}getRenderableIds(t){const a=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&a.push(this._tiles[o]);return t?a.sort((o,c)=>{const d=o.tileID,_=c.tileID,y=new u.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),v=new u.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||v.y-y.y||v.x-y.x}).map(o=>o.tileID.key):a.map(o=>o.tileID).sort(Mr).map(o=>o.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=a),this._loadTile(o,this._tileLoaded.bind(this,o,t,a)))}_tileLoaded(t,a,o,c){if(c)return t.state="errored",void(c.status!==404?this._source.fire(new u.j(c,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=u.h.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let c=0;c<a.length;c++){const d=a[c];if(t.neighboringTiles&&t.neighboringTiles[d]){const _=this.getTileByID(d);o(t,_),o(_,t)}}function o(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let _=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,v=Math.pow(2,c.tileID.canonical.z),I=d.tileID.key;_===0&&y===0||Math.abs(y)>1||(Math.abs(_)>1&&(Math.abs(_+v)===1?_+=v:Math.abs(_-v)===1&&(_-=v)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,_,y),c.neighboringTiles&&c.neighboringTiles[I]&&(c.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,o,c){for(const d in this._tiles){let _=this._tiles[d];if(c[d]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>o)continue;let y=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const I=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[I.key],_&&_.hasData()&&(y=I)}let v=y;for(;v.overscaledZ>a;)if(v=v.scaledTo(v.overscaledZ-1),t[v.key]){c[y.key]=y;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=a?o:null}for(let o=t.overscaledZ-1;o>=a;o--){const c=t.scaledTo(o),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(a*o*(this._maxTileCacheZoomLevels===null?u.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const o={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+a),o[d.tileID.key]=d}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new u.O(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(o=o.filter(T=>this._source.hasTile(T)))):o=[];const c=t.coveringZoomLevel(this._source),d=Math.max(c-sr.maxOverzooming,this._source.minzoom),_=Math.max(c+sr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const T={};for(const M of o)if(M.canonical.z>this._source.minzoom){const E=M.scaledTo(M.canonical.z-1);T[E.key]=E;const O=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));T[O.key]=O}o=o.concat(Object.values(T))}const y=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=this._updateRetainedTiles(o,c);if(Wt(this._source.type)){const T={},M={},E=Object.keys(v),O=u.h.now();for(const R of E){const N=v[R],F=this._tiles[R];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=O)continue;const J=this.findLoadedParent(N,d);J&&(this._addTile(J.tileID),T[J.tileID.key]=J.tileID),M[R]=N}this._retainLoadedChildren(M,c,_,v);for(const R in T)v[R]||(this._coveredTiles[R]=!0,v[R]=T[R]);if(a){const R={},N={};for(const F of o)this._tiles[F.key].hasData()?R[F.key]=F:N[F.key]=F;for(const F in N){const J=N[F].children(this._source.maxzoom);this._tiles[J[0].key]&&this._tiles[J[1].key]&&this._tiles[J[2].key]&&this._tiles[J[3].key]&&(R[J[0].key]=v[J[0].key]=J[0],R[J[1].key]=v[J[1].key]=J[1],R[J[2].key]=v[J[2].key]=J[2],R[J[3].key]=v[J[3].key]=J[3],delete N[F])}for(const F in N){const J=this.findLoadedParent(N[F],this._source.minzoom);if(J){R[J.tileID.key]=v[J.tileID.key]=J.tileID;for(const ie in R)R[ie].isChildOf(J.tileID)&&delete R[ie]}}for(const F in this._tiles)R[F]||(this._coveredTiles[F]=!0)}}for(const T in v)this._tiles[T].clearFadeHold();const I=u.ab(this._tiles,v);for(const T of I){const M=this._tiles[T];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const o={},c={},d=Math.max(a-sr.maxOverzooming,this._source.minzoom),_=Math.max(a+sr.maxUnderzooming,this._source.minzoom),y={};for(const v of t){const I=this._addTile(v);o[v.key]=v,I.hasData()||a<this._source.maxzoom&&(y[v.key]=v)}this._retainLoadedChildren(y,a,_,o);for(const v of t){let I=this._tiles[v.key];if(I.hasData())continue;if(a+1>this._source.maxzoom){const M=v.children(this._source.maxzoom)[0],E=this.getTile(M);if(E&&E.hasData()){o[M.key]=M;continue}}else{const M=v.children(this._source.maxzoom);if(o[M[0].key]&&o[M[1].key]&&o[M[2].key]&&o[M[3].key])continue}let T=I.wasRequested();for(let M=v.overscaledZ-1;M>=d;--M){const E=v.scaledTo(M);if(c[E.key])break;if(c[E.key]=!0,I=this.getTile(E),!I&&T&&(I=this._addTile(E)),I){const O=I.hasData();if((T||O)&&(o[E.key]=E),T=I.wasRequested(),O)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}a.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;c=d}for(const d of a)this._loadedParentTiles[d]=o}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const o=a;return a||(a=new Je(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))),a.uses++,this._tiles[t.key]=a,o||this._source.fire(new u.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=a.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,o){const c=[],d=this.transform;if(!d)return c;const _=o?d.getCameraQueryGeometry(t):t,y=t.map(R=>d.pointCoordinate(R,this.terrain)),v=_.map(R=>d.pointCoordinate(R,this.terrain)),I=this.getIds();let T=1/0,M=1/0,E=-1/0,O=-1/0;for(const R of v)T=Math.min(T,R.x),M=Math.min(M,R.y),E=Math.max(E,R.x),O=Math.max(O,R.y);for(let R=0;R<I.length;R++){const N=this._tiles[I[R]];if(N.holdingForFade())continue;const F=N.tileID,J=Math.pow(2,d.zoom-N.tileID.overscaledZ),ie=a*N.queryPadding*u.N/N.tileSize/J,q=[F.getTilePoint(new u.U(T,M)),F.getTilePoint(new u.U(E,O))];if(q[0].x-ie<u.N&&q[0].y-ie<u.N&&q[1].x+ie>=0&&q[1].y+ie>=0){const H=y.map(ae=>F.getTilePoint(ae)),se=v.map(ae=>F.getTilePoint(ae));c.push({tile:N,tileID:F,queryGeometry:H,cameraQueryGeometry:se,scale:J})}}return c}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of a)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Wt(this._source.type)){const t=u.h.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,o){this._state.updateState(t=t||"_geojsonTileLayer",a,o)}removeFeatureState(t,a,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,o)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,o){const c=this._tiles[t];c&&c.setDependencies(a,o)}reloadTilesForDependencies(t,a){for(const o in this._tiles)this._tiles[o].hasDependency(t,a)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,a))}}function Mr(h,t){const a=Math.abs(2*h.wrap)-+(h.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||o-a||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Wt(h){return h==="raster"||h==="image"||h==="video"}sr.maxOverzooming=10,sr.maxUnderzooming=3;const Lt="mapboxgl_preloaded_worker_pool";class Zr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Zr.workerCount;)this.workers.push(new Worker(u.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Lt]}numActive(){return Object.keys(this.active).length}}const js=Math.floor(u.h.hardwareConcurrency/2);let es;function Da(){return es||(es=new Zr),es}Zr.workerCount=u.ac(globalThis)?Math.max(Math.min(js,3),1):1;class Us{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.ad(t,0,1);let a=1,o=this._distances[a];const c=t*this.paddedLength+this.padding;for(;o<c&&a<this._distances.length;)o=this._distances[++a];const d=a-1,_=this._distances[d],y=o-_,v=y>0?(c-_)/y:0;return this.points[d].mult(1-v).add(this.points[a].mult(v))}}function ds(h,t){let a=!0;return h==="always"||h!=="never"&&t!=="never"||(a=!1),a}class Is{constructor(t,a,o){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(a/o);for(let _=0;_<this.xCellCount*this.yCellCount;_++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,o,c,d){this._forEachCell(a,o,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(t,a,o,c){this._forEachCell(a-c,o-c,a+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,a,o,c,d,_){this.boxCells[d].push(_)}_insertCircleCell(t,a,o,c,d,_){this.circleCells[d].push(_)}_query(t,a,o,c,d,_,y){if(o<0||t>this.width||c<0||a>this.height)return[];const v=[];if(t<=0&&a<=0&&this.width<=o&&this.height<=c){if(d)return[{key:null,x1:t,y1:a,x2:o,y2:c}];for(let I=0;I<this.boxKeys.length;I++)v.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const T=this.circles[3*I],M=this.circles[3*I+1],E=this.circles[3*I+2];v.push({key:this.circleKeys[I],x1:T-E,y1:M-E,x2:T+E,y2:M+E})}}else this._forEachCell(t,a,o,c,this._queryCell,v,{hitTest:d,overlapMode:_,seenUids:{box:{},circle:{}}},y);return v}query(t,a,o,c){return this._query(t,a,o,c,!1,null)}hitTest(t,a,o,c,d,_){return this._query(t,a,o,c,!0,d,_).length>0}hitTestCircle(t,a,o,c,d){const _=t-o,y=t+o,v=a-o,I=a+o;if(y<0||_>this.width||I<0||v>this.height)return!1;const T=[];return this._forEachCell(_,v,y,I,this._queryCellCircle,T,{hitTest:!0,overlapMode:c,circle:{x:t,y:a,radius:o},seenUids:{box:{},circle:{}}},d),T.length>0}_queryCell(t,a,o,c,d,_,y,v){const{seenUids:I,hitTest:T,overlapMode:M}=y,E=this.boxCells[d];if(E!==null){const R=this.bboxes;for(const N of E)if(!I.box[N]){I.box[N]=!0;const F=4*N,J=this.boxKeys[N];if(t<=R[F+2]&&a<=R[F+3]&&o>=R[F+0]&&c>=R[F+1]&&(!v||v(J))&&(!T||!ds(M,J.overlapMode))&&(_.push({key:J,x1:R[F],y1:R[F+1],x2:R[F+2],y2:R[F+3]}),T))return!0}}const O=this.circleCells[d];if(O!==null){const R=this.circles;for(const N of O)if(!I.circle[N]){I.circle[N]=!0;const F=3*N,J=this.circleKeys[N];if(this._circleAndRectCollide(R[F],R[F+1],R[F+2],t,a,o,c)&&(!v||v(J))&&(!T||!ds(M,J.overlapMode))){const ie=R[F],q=R[F+1],H=R[F+2];if(_.push({key:J,x1:ie-H,y1:q-H,x2:ie+H,y2:q+H}),T)return!0}}}return!1}_queryCellCircle(t,a,o,c,d,_,y,v){const{circle:I,seenUids:T,overlapMode:M}=y,E=this.boxCells[d];if(E!==null){const R=this.bboxes;for(const N of E)if(!T.box[N]){T.box[N]=!0;const F=4*N,J=this.boxKeys[N];if(this._circleAndRectCollide(I.x,I.y,I.radius,R[F+0],R[F+1],R[F+2],R[F+3])&&(!v||v(J))&&!ds(M,J.overlapMode))return _.push(!0),!0}}const O=this.circleCells[d];if(O!==null){const R=this.circles;for(const N of O)if(!T.circle[N]){T.circle[N]=!0;const F=3*N,J=this.circleKeys[N];if(this._circlesCollide(R[F],R[F+1],R[F+2],I.x,I.y,I.radius)&&(!v||v(J))&&!ds(M,J.overlapMode))return _.push(!0),!0}}}_forEachCell(t,a,o,c,d,_,y,v){const I=this._convertToXCellCoord(t),T=this._convertToYCellCoord(a),M=this._convertToXCellCoord(o),E=this._convertToYCellCoord(c);for(let O=I;O<=M;O++)for(let R=T;R<=E;R++)if(d.call(this,t,a,o,c,this.xCellCount*R+O,_,y,v))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,o,c,d,_){const y=c-t,v=d-a,I=o+_;return I*I>y*y+v*v}_circleAndRectCollide(t,a,o,c,d,_,y){const v=(_-c)/2,I=Math.abs(t-(c+v));if(I>v+o)return!1;const T=(y-d)/2,M=Math.abs(a-(d+T));if(M>T+o)return!1;if(I<=v||M<=T)return!0;const E=I-v,O=M-T;return E*E+O*O<=o*o}}function ze(h,t,a,o,c){const d=u.Z();return t?(u.a0(d,d,[1/c,1/c,1]),a||u.ae(d,d,o.angle)):u.a1(d,o.labelPlaneMatrix,h),d}function qr(h,t,a,o,c){if(t){const d=u.af(h);return u.a0(d,d,[c,c,1]),a||u.ae(d,d,-o.angle),d}return o.glCoordMatrix}function ni(h,t,a){let o;a?(o=[h.x,h.y,a(h.x,h.y),1],u.ag(o,o,t)):(o=[h.x,h.y,0,1],j(o,o,t));const c=o[3];return{point:new u.P(o[0]/c,o[1]/c),signedDistanceFromCamera:c}}function Ss(h,t){return .5+h/t*.5}function ts(h,t){const a=h[0]/h[3],o=h[1]/h[3];return a>=-t[0]&&a<=t[0]&&o>=-t[1]&&o<=t[1]}function Pe(h,t,a,o,c,d,_,y,v,I){const T=o?h.textSizeData:h.iconSizeData,M=u.ah(T,a.transform.zoom),E=[256/a.width*2+1,256/a.height*2+1],O=o?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;O.clear();const R=h.lineVertexArray,N=o?h.text.placedSymbolArray:h.icon.placedSymbolArray,F=a.transform.width/a.transform.height;let J=!1;for(let ie=0;ie<N.length;ie++){const q=N.get(ie);if(q.hidden||q.writingMode===u.ai.vertical&&!J){L(q.numGlyphs,O);continue}let H;if(J=!1,I?(H=[q.anchorX,q.anchorY,I(q.anchorX,q.anchorY),1],u.ag(H,H,t)):(H=[q.anchorX,q.anchorY,0,1],j(H,H,t)),!ts(H,E)){L(q.numGlyphs,O);continue}const se=Ss(a.transform.cameraToCenterDistance,H[3]),ae=u.aj(T,M,q),he=_?ae/se:ae*se,ve=new u.P(q.anchorX,q.anchorY),ge=ni(ve,c,I).point,Te={projections:{},offsets:{}},qe=Ji(q,he,!1,y,t,c,d,h.glyphOffsetArray,R,O,ge,ve,Te,F,v,I);J=qe.useVertical,(qe.notEnoughRoom||J||qe.needsFlipping&&Ji(q,he,!0,y,t,c,d,h.glyphOffsetArray,R,O,ge,ve,Te,F,v,I).notEnoughRoom)&&L(q.numGlyphs,O)}o?h.text.dynamicLayoutVertexBuffer.updateData(O):h.icon.dynamicLayoutVertexBuffer.updateData(O)}function xt(h,t,a,o,c,d,_,y,v,I,T,M,E){const O=y.glyphStartIndex+y.numGlyphs,R=y.lineStartIndex,N=y.lineStartIndex+y.lineLength,F=t.getoffsetX(y.glyphStartIndex),J=t.getoffsetX(O-1),ie=k(h*F,a,o,c,d,_,y.segment,R,N,v,I,T,M,E);if(!ie)return null;const q=k(h*J,a,o,c,d,_,y.segment,R,N,v,I,T,M,E);return q?{first:ie,last:q}:null}function ct(h,t,a,o){return h===u.ai.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*o?{useVertical:!0}:(h===u.ai.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Ji(h,t,a,o,c,d,_,y,v,I,T,M,E,O,R,N){const F=t/24,J=h.lineOffsetX*F,ie=h.lineOffsetY*F;let q;if(h.numGlyphs>1){const H=h.glyphStartIndex+h.numGlyphs,se=h.lineStartIndex,ae=h.lineStartIndex+h.lineLength,he=xt(F,y,J,ie,a,T,M,h,v,d,E,R,N);if(!he)return{notEnoughRoom:!0};const ve=ni(he.first.point,_,N).point,ge=ni(he.last.point,_,N).point;if(o&&!a){const Te=ct(h.writingMode,ve,ge,O);if(Te)return Te}q=[he.first];for(let Te=h.glyphStartIndex+1;Te<H-1;Te++)q.push(k(F*y.getoffsetX(Te),J,ie,a,T,M,h.segment,se,ae,v,d,E,R,N));q.push(he.last)}else{if(o&&!a){const se=ni(M,c,N).point,ae=h.lineStartIndex+h.segment+1,he=new u.P(v.getx(ae),v.gety(ae)),ve=ni(he,c,N),ge=ve.signedDistanceFromCamera>0?ve.point:Gr(M,he,se,1,c,N),Te=ct(h.writingMode,se,ge,O);if(Te)return Te}const H=k(F*y.getoffsetX(h.glyphStartIndex),J,ie,a,T,M,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,v,d,E,R,N);if(!H)return{notEnoughRoom:!0};q=[H]}for(const H of q)u.ak(I,H.point,H.angle);return{}}function Gr(h,t,a,o,c,d){const _=ni(h.add(h.sub(t)._unit()),c,d).point,y=a.sub(_);return a.add(y._mult(o/y.mag()))}function gt(h,t){const{projectionCache:a,lineVertexArray:o,labelPlaneMatrix:c,tileAnchorPoint:d,distanceFromAnchor:_,getElevation:y,previousVertex:v,direction:I,absOffsetX:T}=t;if(a.projections[h])return a.projections[h];const M=new u.P(o.getx(h),o.gety(h)),E=ni(M,c,y);if(E.signedDistanceFromCamera>0)return a.projections[h]=E.point,E.point;const O=h-I;return Gr(_===0?d:new u.P(o.getx(O),o.gety(O)),M,v,T-_+1,c,y)}function is(h,t,a){return h._unit()._perp()._mult(t*a)}function V(h,t,a,o,c,d,_,y){const{projectionCache:v,direction:I}=y;if(v.offsets[h])return v.offsets[h];const T=a.add(t);if(h+I<o||h+I>=c)return v.offsets[h]=T,T;const M=gt(h+I,y),E=is(M.sub(a),_,I),O=a.add(E),R=M.add(E);return v.offsets[h]=u.al(d,T,O,R)||T,v.offsets[h]}function k(h,t,a,o,c,d,_,y,v,I,T,M,E,O){const R=o?h-t:h+t;let N=R>0?1:-1,F=0;o&&(N*=-1,F=Math.PI),N<0&&(F+=Math.PI);let J,ie,q=N>0?y+_:y+_+1,H=c,se=c,ae=0,he=0;const ve=Math.abs(R),ge=[];let Te;for(;ae+he<=ve;){if(q+=N,q<y||q>=v)return null;ae+=he,se=H,ie=J;const De={projectionCache:M,lineVertexArray:I,labelPlaneMatrix:T,tileAnchorPoint:d,distanceFromAnchor:ae,getElevation:O,previousVertex:se,direction:N,absOffsetX:ve};if(H=gt(q,De),a===0)ge.push(se),Te=H.sub(se);else{let it;const $e=H.sub(se);it=$e.mag()===0?is(gt(q+N,De).sub(H),a,N):is($e,a,N),ie||(ie=se.add(it)),J=V(q,it,H,y,v,ie,a,De),ge.push(ie),Te=J.sub(ie)}he=Te.mag()}const qe=Te._mult((ve-ae)/he)._add(ie||se),St=F+Math.atan2(H.y-se.y,H.x-se.x);return ge.push(qe),{point:qe,angle:E?St:0,path:ge}}const z=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function L(h,t){for(let a=0;a<h;a++){const o=t.length;t.resize(o+4),t.float32.set(z,3*o)}}function j(h,t,a){const o=t[0],c=t[1];return h[0]=a[0]*o+a[4]*c+a[12],h[1]=a[1]*o+a[5]*c+a[13],h[3]=a[3]*o+a[7]*c+a[15],h}const Z=100;class ee{constructor(t,a=new Is(t.width+200,t.height+200,25),o=new Is(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Z,this.screenBottomBoundary=t.height+Z,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,o,c,d,_){const y=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,_),v=o*y.perspectiveRatio,I=t.x1*v+y.point.x,T=t.y1*v+y.point.y,M=t.x2*v+y.point.x,E=t.y2*v+y.point.y;return!this.isInsideGrid(I,T,M,E)||a!=="always"&&this.grid.hitTest(I,T,M,E,a,d)||y.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,T,M,E],offscreen:this.isOffscreen(I,T,M,E)}}placeCollisionCircles(t,a,o,c,d,_,y,v,I,T,M,E,O,R){const N=[],F=new u.P(a.anchorX,a.anchorY),J=ni(F,_,R),ie=Ss(this.transform.cameraToCenterDistance,J.signedDistanceFromCamera),q=(T?d/ie:d*ie)/u.ap,H=ni(F,y,R).point,se=xt(q,c,a.lineOffsetX*q,a.lineOffsetY*q,!1,H,F,a,o,y,{projections:{},offsets:{}},!1,R);let ae=!1,he=!1,ve=!0;if(se){const ge=.5*E*ie+O,Te=new u.P(-100,-100),qe=new u.P(this.screenRightBoundary,this.screenBottomBoundary),St=new Us,De=se.first,it=se.last;let $e=[];for(let _t=De.path.length-1;_t>=1;_t--)$e.push(De.path[_t]);for(let _t=1;_t<it.path.length;_t++)$e.push(it.path[_t]);const Zt=2.5*ge;if(v){const _t=$e.map(Tt=>ni(Tt,v,R));$e=_t.some(Tt=>Tt.signedDistanceFromCamera<=0)?[]:_t.map(Tt=>Tt.point)}let It=[];if($e.length>0){const _t=$e[0].clone(),Tt=$e[0].clone();for(let hi=1;hi<$e.length;hi++)_t.x=Math.min(_t.x,$e[hi].x),_t.y=Math.min(_t.y,$e[hi].y),Tt.x=Math.max(Tt.x,$e[hi].x),Tt.y=Math.max(Tt.y,$e[hi].y);It=_t.x>=Te.x&&Tt.x<=qe.x&&_t.y>=Te.y&&Tt.y<=qe.y?[$e]:Tt.x<Te.x||_t.x>qe.x||Tt.y<Te.y||_t.y>qe.y?[]:u.am([$e],Te.x,Te.y,qe.x,qe.y)}for(const _t of It){St.reset(_t,.25*ge);let Tt=0;Tt=St.length<=.5*ge?1:Math.ceil(St.paddedLength/Zt)+1;for(let hi=0;hi<Tt;hi++){const Jt=hi/Math.max(Tt-1,1),Oi=St.lerp(Jt),Si=Oi.x+Z,gi=Oi.y+Z;N.push(Si,gi,ge,0);const xr=Si-ge,Kt=gi-ge,Wr=Si+ge,Xr=gi+ge;if(ve=ve&&this.isOffscreen(xr,Kt,Wr,Xr),he=he||this.isInsideGrid(xr,Kt,Wr,Xr),t!=="always"&&this.grid.hitTestCircle(Si,gi,ge,t,M)&&(ae=!0,!I))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!I&&ae||!he||ie<this.perspectiveRatioCutoff?[]:N,offscreen:ve,collisionDetected:ae}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let o=1/0,c=1/0,d=-1/0,_=-1/0;for(const T of t){const M=new u.P(T.x+Z,T.y+Z);o=Math.min(o,M.x),c=Math.min(c,M.y),d=Math.max(d,M.x),_=Math.max(_,M.y),a.push(M)}const y=this.grid.query(o,c,d,_).concat(this.ignoredGrid.query(o,c,d,_)),v={},I={};for(const T of y){const M=T.key;if(v[M.bucketInstanceId]===void 0&&(v[M.bucketInstanceId]={}),v[M.bucketInstanceId][M.featureIndex])continue;const E=[new u.P(T.x1,T.y1),new u.P(T.x2,T.y1),new u.P(T.x2,T.y2),new u.P(T.x1,T.y2)];u.an(a,E)&&(v[M.bucketInstanceId][M.featureIndex]=!0,I[M.bucketInstanceId]===void 0&&(I[M.bucketInstanceId]=[]),I[M.bucketInstanceId].push(M.featureIndex))}return I}insertCollisionBox(t,a,o,c,d,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:_,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,o,c,d,_){const y=o?this.ignoredGrid:this.grid,v={bucketInstanceId:c,featureIndex:d,collisionGroupID:_,overlapMode:a};for(let I=0;I<t.length;I+=4)y.insertCircle(v,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,a,o,c){let d;return c?(d=[a,o,c(a,o),1],u.ag(d,d,t)):(d=[a,o,0,1],j(d,d,t)),{point:new u.P((d[0]/d[3]+1)/2*this.transform.width+Z,(-d[1]/d[3]+1)/2*this.transform.height+Z),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,a,o,c){return o<Z||t>=this.screenRightBoundary||c<Z||a>this.screenBottomBoundary}isInsideGrid(t,a,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=u.ao([]);return u.$(t,t,[-100,-100,0]),t}}function X(h,t,a){return t*(u.N/(h.tileSize*Math.pow(2,a-h.tileID.overscaledZ)))}class ${constructor(t,a,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class K{constructor(t,a,o,c,d){this.text=new $(t?t.text:null,a,o,d),this.icon=new $(t?t.icon:null,a,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ce{constructor(t,a,o){this.text=t,this.icon=a,this.skipFade=o}}class ue{constructor(){this.invProjMatrix=u.Z(),this.viewportMatrix=u.Z(),this.circles=[]}}class fe{constructor(t,a,o,c,d){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=d}}class He{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:o=>o.collisionGroupID===a}}return this.collisionGroups[t]}}function ot(h,t,a,o,c){const{horizontalAlign:d,verticalAlign:_}=u.au(h);return new u.P(-(d-.5)*t+o[0]*c,-(_-.5)*a+o[1]*c)}function Ze(h,t,a,o,c,d){const{x1:_,x2:y,y1:v,y2:I,anchorPointX:T,anchorPointY:M}=h,E=new u.P(t,a);return o&&E._rotate(c?d:-d),{x1:_+E.x,y1:v+E.y,x2:y+E.x,y2:I+E.y,anchorPointX:T,anchorPointY:M}}class et{constructor(t,a,o,c,d){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new ee(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new He(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,o,c){const d=o.getBucket(a),_=o.latestFeatureIndex;if(!d||!_||a.id!==d.layerIds[0])return;const y=o.collisionBoxArray,v=d.layers[0].layout,I=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),T=o.tileSize/u.N,M=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),E=v.get("text-pitch-alignment")==="map",O=v.get("text-rotation-alignment")==="map",R=X(o,1,this.transform.zoom),N=ze(M,E,O,this.transform,R);let F=null;if(E){const ie=qr(M,E,O,this.transform,R);F=u.a1([],this.transform.labelPlaneMatrix,ie)}this.retainedQueryData[d.bucketInstanceId]=new fe(d.bucketInstanceId,_,d.sourceLayerIndex,d.index,o.tileID);const J={bucket:d,layout:v,posMatrix:M,textLabelPlaneMatrix:N,labelToScreenMatrix:F,scale:I,textPixelRatio:T,holdingForFade:o.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:u.ah(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const ie of d.sortKeyRanges){const{sortKey:q,symbolInstanceStart:H,symbolInstanceEnd:se}=ie;t.push({sortKey:q,symbolInstanceStart:H,symbolInstanceEnd:se,parameters:J})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:J})}attemptAnchorPlacement(t,a,o,c,d,_,y,v,I,T,M,E,O,R,N,F){const J=u.aq[t.textAnchor],ie=[t.textOffset0,t.textOffset1],q=ot(J,o,c,ie,d),H=this.collisionIndex.placeCollisionBox(Ze(a,q.x,q.y,_,y,this.transform.angle),M,v,I,T.predicate,F);if((!N||this.collisionIndex.placeCollisionBox(Ze(N,q.x,q.y,_,y,this.transform.angle),M,v,I,T.predicate,F).box.length!==0)&&H.box.length>0){let se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[E.crossTileID]&&this.prevPlacement.placements[E.crossTileID]&&this.prevPlacement.placements[E.crossTileID].text&&(se=this.prevPlacement.variableOffsets[E.crossTileID].anchor),E.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[E.crossTileID]={textOffset:ie,width:o,height:c,anchor:J,textBoxScale:d,prevAnchor:se},this.markUsedJustification(O,J,E,R),O.allowVerticalPlacement&&(this.markUsedOrientation(O,R,E),this.placedOrientations[E.crossTileID]=R),{shift:q,placedGlyphBoxes:H}}}placeLayerBucketPart(t,a,o){const{bucket:c,layout:d,posMatrix:_,textLabelPlaneMatrix:y,labelToScreenMatrix:v,textPixelRatio:I,holdingForFade:T,collisionBoxArray:M,partiallyEvaluatedTextSize:E,collisionGroup:O}=t.parameters,R=d.get("text-optional"),N=d.get("icon-optional"),F=u.ar(d,"text-overlap","text-allow-overlap"),J=F==="always",ie=u.ar(d,"icon-overlap","icon-allow-overlap"),q=ie==="always",H=d.get("text-rotation-alignment")==="map",se=d.get("text-pitch-alignment")==="map",ae=d.get("icon-text-fit")!=="none",he=d.get("symbol-z-order")==="viewport-y",ve=J&&(q||!c.hasIconData()||N),ge=q&&(J||!c.hasTextData()||R);!c.collisionArrays&&M&&c.deserializeCollisionBoxes(M);const Te=this.retainedQueryData[c.bucketInstanceId].tileID,qe=this.terrain?(De,it)=>this.terrain.getElevation(Te,De,it):null,St=(De,it)=>{var $e,Zt;if(a[De.crossTileID])return;if(T)return void(this.placements[De.crossTileID]=new ce(!1,!1,!1));let It=!1,_t=!1,Tt=!0,hi=null,Jt={box:null,offscreen:null},Oi={box:null},Si=null,gi=null,xr=null,Kt=0,Wr=0,Xr=0;it.textFeatureIndex?Kt=it.textFeatureIndex:De.useRuntimeCollisionCircles&&(Kt=De.featureIndex),it.verticalTextFeatureIndex&&(Wr=it.verticalTextFeatureIndex);const vs=it.textBox;if(vs){const Gi=di=>{let Ti=u.ai.horizontal;if(c.allowVerticalPlacement&&!di&&this.prevPlacement){const or=this.prevPlacement.placedOrientations[De.crossTileID];or&&(this.placedOrientations[De.crossTileID]=or,Ti=or,this.markUsedOrientation(c,Ti,De))}return Ti},Vi=(di,Ti)=>{if(c.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&it.verticalTextBox){for(const or of c.writingModes)if(or===u.ai.vertical?(Jt=Ti(),Oi=Jt):Jt=di(),Jt&&Jt.box&&Jt.box.length)break}else Jt=di()},Ki=De.textAnchorOffsetStartIndex,Ls=De.textAnchorOffsetEndIndex;if(Ls===Ki){const di=(Ti,or)=>{const pi=this.collisionIndex.placeCollisionBox(Ti,F,I,_,O.predicate,qe);return pi&&pi.box&&pi.box.length&&(this.markUsedOrientation(c,or,De),this.placedOrientations[De.crossTileID]=or),pi};Vi(()=>di(vs,u.ai.horizontal),()=>{const Ti=it.verticalTextBox;return c.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&Ti?di(Ti,u.ai.vertical):{box:null,offscreen:null}}),Gi(Jt&&Jt.box&&Jt.box.length)}else{let di=u.aq[(Zt=($e=this.prevPlacement)===null||$e===void 0?void 0:$e.variableOffsets[De.crossTileID])===null||Zt===void 0?void 0:Zt.anchor];const Ti=(pi,Fs,cn)=>{const gl=pi.x2-pi.x1,_l=pi.y2-pi.y1,uc=De.textBoxScale,oo=ae&&ie==="never"?Fs:null;let Yr={box:[],offscreen:!1},Bs=F==="never"?1:2,Jr="never";di&&Bs++;for(let Dr=0;Dr<Bs;Dr++){for(let Hr=Ki;Hr<Ls;Hr++){const lo=c.textAnchorOffsets.get(Hr);if(di&&lo.textAnchor!==di)continue;const os=this.attemptAnchorPlacement(lo,pi,gl,_l,uc,H,se,I,_,O,Jr,De,c,cn,oo,qe);if(os&&(Yr=os.placedGlyphBoxes,Yr&&Yr.box&&Yr.box.length))return It=!0,hi=os.shift,Yr}di?di=null:Jr=F}return Yr};Vi(()=>Ti(vs,it.iconBox,u.ai.horizontal),()=>{const pi=it.verticalTextBox;return c.allowVerticalPlacement&&!(Jt&&Jt.box&&Jt.box.length)&&De.numVerticalGlyphVertices>0&&pi?Ti(pi,it.verticalIconBox,u.ai.vertical):{box:null,offscreen:null}}),Jt&&(It=Jt.box,Tt=Jt.offscreen);const or=Gi(Jt&&Jt.box);if(!It&&this.prevPlacement){const pi=this.prevPlacement.variableOffsets[De.crossTileID];pi&&(this.variableOffsets[De.crossTileID]=pi,this.markUsedJustification(c,pi.anchor,De,or))}}}if(Si=Jt,It=Si&&Si.box&&Si.box.length>0,Tt=Si&&Si.offscreen,De.useRuntimeCollisionCircles){const Gi=c.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex),Vi=u.aj(c.textSizeData,E,Gi),Ki=d.get("text-padding");gi=this.collisionIndex.placeCollisionCircles(F,Gi,c.lineVertexArray,c.glyphOffsetArray,Vi,_,y,v,o,se,O.predicate,De.collisionCircleDiameter,Ki,qe),gi.circles.length&&gi.collisionDetected&&!o&&u.w("Collisions detected, but collision boxes are not shown"),It=J||gi.circles.length>0&&!gi.collisionDetected,Tt=Tt&&gi.offscreen}if(it.iconFeatureIndex&&(Xr=it.iconFeatureIndex),it.iconBox){const Gi=Vi=>{const Ki=ae&&hi?Ze(Vi,hi.x,hi.y,H,se,this.transform.angle):Vi;return this.collisionIndex.placeCollisionBox(Ki,ie,I,_,O.predicate,qe)};Oi&&Oi.box&&Oi.box.length&&it.verticalIconBox?(xr=Gi(it.verticalIconBox),_t=xr.box.length>0):(xr=Gi(it.iconBox),_t=xr.box.length>0),Tt=Tt&&xr.offscreen}const Ds=R||De.numHorizontalGlyphVertices===0&&De.numVerticalGlyphVertices===0,ia=N||De.numIconVertices===0;if(Ds||ia?ia?Ds||(_t=_t&&It):It=_t&&It:_t=It=_t&&It,It&&Si&&Si.box&&this.collisionIndex.insertCollisionBox(Si.box,F,d.get("text-ignore-placement"),c.bucketInstanceId,Oi&&Oi.box&&Wr?Wr:Kt,O.ID),_t&&xr&&this.collisionIndex.insertCollisionBox(xr.box,ie,d.get("icon-ignore-placement"),c.bucketInstanceId,Xr,O.ID),gi&&(It&&this.collisionIndex.insertCollisionCircles(gi.circles,F,d.get("text-ignore-placement"),c.bucketInstanceId,Kt,O.ID),o)){const Gi=c.bucketInstanceId;let Vi=this.collisionCircleArrays[Gi];Vi===void 0&&(Vi=this.collisionCircleArrays[Gi]=new ue);for(let Ki=0;Ki<gi.circles.length;Ki+=4)Vi.circles.push(gi.circles[Ki+0]),Vi.circles.push(gi.circles[Ki+1]),Vi.circles.push(gi.circles[Ki+2]),Vi.circles.push(gi.collisionDetected?1:0)}if(De.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[De.crossTileID]=new ce(It||ve,_t||ge,Tt||c.justReloaded),a[De.crossTileID]=!0};if(he){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const De=c.getSortedSymbolIndexes(this.transform.angle);for(let it=De.length-1;it>=0;--it){const $e=De[it];St(c.symbolInstances.get($e),c.collisionArrays[$e])}}else for(let De=t.symbolInstanceStart;De<t.symbolInstanceEnd;De++)St(c.symbolInstances.get(De),c.collisionArrays[De]);if(o&&c.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[c.bucketInstanceId];u.as(De.invProjMatrix,_),De.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,a,o,c){let d;d=c===u.ai.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[u.at(a)];const _=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const y of _)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=d>=0&&y!==d?0:o.crossTileID)}markUsedOrientation(t,a,o){const c=a===u.ai.horizontal||a===u.ai.horizontalOnly?a:0,d=a===u.ai.vertical?a:0,_=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const y of _)t.text.placedSymbolArray.get(y).placedOrientation=c;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let o=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const c=a?a.symbolFadeChange(t):1,d=a?a.opacities:{},_=a?a.variableOffsets:{},y=a?a.placedOrientations:{};for(const v in this.placements){const I=this.placements[v],T=d[v];T?(this.opacities[v]=new K(T,c,I.text,I.icon),o=o||I.text!==T.text.placed||I.icon!==T.icon.placed):(this.opacities[v]=new K(null,c,I.text,I.icon,I.skipFade),o=o||I.text||I.icon)}for(const v in d){const I=d[v];if(!this.opacities[v]){const T=new K(I,c,!1,!1);T.isHidden()||(this.opacities[v]=T,o=o||I.text.placed||I.icon.placed)}}for(const v in _)this.variableOffsets[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.variableOffsets[v]=_[v]);for(const v in y)this.placedOrientations[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.placedOrientations[v]=y[v]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const o={};for(const c of a){const d=c.getBucket(t);d&&c.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,o,c.collisionBoxArray)}}updateBucketOpacities(t,a,o){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],d=c.layout,_=new K(null,0,!1,!1,!0),y=d.get("text-allow-overlap"),v=d.get("icon-allow-overlap"),I=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=d.get("text-rotation-alignment")==="map",M=d.get("text-pitch-alignment")==="map",E=d.get("icon-text-fit")!=="none",O=new K(null,0,y&&(v||!t.hasIconData()||d.get("icon-optional")),v&&(y||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const R=(N,F,J)=>{for(let ie=0;ie<F/4;ie++)N.opacityVertexArray.emplaceBack(J);N.hasVisibleVertices=N.hasVisibleVertices||J!==Cr};for(let N=0;N<t.symbolInstances.length;N++){const F=t.symbolInstances.get(N),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:ie,crossTileID:q}=F;let H=this.opacities[q];a[q]?H=_:H||(H=O,this.opacities[q]=H),a[q]=!0;const se=F.numIconVertices>0,ae=this.placedOrientations[F.crossTileID],he=ae===u.ai.vertical,ve=ae===u.ai.horizontal||ae===u.ai.horizontalOnly;if(J>0||ie>0){const ge=Bi(H.text);R(t.text,J,he?Cr:ge),R(t.text,ie,ve?Cr:ge);const Te=H.text.isHidden();[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(De=>{De>=0&&(t.text.placedSymbolArray.get(De).hidden=Te||he?1:0)}),F.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(F.verticalPlacedTextSymbolIndex).hidden=Te||ve?1:0);const qe=this.variableOffsets[F.crossTileID];qe&&this.markUsedJustification(t,qe.anchor,F,ae);const St=this.placedOrientations[F.crossTileID];St&&(this.markUsedJustification(t,"left",F,St),this.markUsedOrientation(t,St,F))}if(se){const ge=Bi(H.icon),Te=!(E&&F.verticalPlacedIconSymbolIndex&&he);F.placedIconSymbolIndex>=0&&(R(t.icon,F.numIconVertices,Te?ge:Cr),t.icon.placedSymbolArray.get(F.placedIconSymbolIndex).hidden=H.icon.isHidden()),F.verticalPlacedIconSymbolIndex>=0&&(R(t.icon,F.numVerticalIconVertices,Te?Cr:ge),t.icon.placedSymbolArray.get(F.verticalPlacedIconSymbolIndex).hidden=H.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ge=t.collisionArrays[N];if(ge){let Te=new u.P(0,0);if(ge.textBox||ge.verticalTextBox){let St=!0;if(I){const De=this.variableOffsets[q];De?(Te=ot(De.anchor,De.width,De.height,De.textOffset,De.textBoxScale),T&&Te._rotate(M?this.transform.angle:-this.transform.angle)):St=!1}ge.textBox&&ut(t.textCollisionBox.collisionVertexArray,H.text.placed,!St||he,Te.x,Te.y),ge.verticalTextBox&&ut(t.textCollisionBox.collisionVertexArray,H.text.placed,!St||ve,Te.x,Te.y)}const qe=!!(!ve&&ge.verticalIconBox);ge.iconBox&&ut(t.iconCollisionBox.collisionVertexArray,H.icon.placed,qe,E?Te.x:0,E?Te.y:0),ge.verticalIconBox&&ut(t.iconCollisionBox.collisionVertexArray,H.icon.placed,!qe,E?Te.x:0,E?Te.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const N=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=N.invProjMatrix,t.placementViewportMatrix=N.viewportMatrix,t.collisionCircleArray=N.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const o=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function ut(h,t,a,o,c){h.emplaceBack(t?1:0,a?1:0,o||0,c||0),h.emplaceBack(t?1:0,a?1:0,o||0,c||0),h.emplaceBack(t?1:0,a?1:0,o||0,c||0),h.emplaceBack(t?1:0,a?1:0,o||0,c||0)}const Vt=Math.pow(2,25),Gt=Math.pow(2,24),Et=Math.pow(2,17),zt=Math.pow(2,16),Zi=Math.pow(2,9),Yt=Math.pow(2,8),xi=Math.pow(2,1);function Bi(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Vt+t*Gt+a*Et+t*zt+a*Zi+t*Yt+a*xi+t}const Cr=0;class Po{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,o,c,d){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(_,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((y,v)=>y.sortKey-v.sortKey));this._currentPartIndex<_.length;)if(a.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,d())return!0;return!1}}class Zs{constructor(t,a,o,c,d,_,y,v){this.placement=new et(t,a,_,y,v),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,a,o){const c=u.h.now(),d=()=>!this._forceFullPlacement&&u.h.now()-c>2;for(;this._currentPlacementIndex>=0;){const _=a[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=y)&&(!_.maxzoom||_.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new Po(_)),this._inProgressLayer.continuePlacement(o[_.source],this.placement,this._showCollisionBoxes,_,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const qs=512/u.N/2;class Wl{constructor(t,a,o){this.tileID=t,this.bucketInstanceId=o,this._symbolsByKey={};const c=new Map;for(let d=0;d<a.length;d++){const _=a.get(d),y=_.key,v=c.get(y);v?v.push(_):c.set(y,[_])}for(const[d,_]of c){const y={positions:_.map(v=>({x:Math.floor(v.anchorX*qs),y:Math.floor(v.anchorY*qs)})),crossTileIDs:_.map(v=>v.crossTileID)};if(y.positions.length>128){const v=new u.av(y.positions.length,16,Uint16Array);for(const{x:I,y:T}of y.positions)v.add(I,T);v.finish(),delete y.positions,y.index=v}this._symbolsByKey[d]=y}}getScaledCoordinates(t,a){const{x:o,y:c,z:d}=this.tileID.canonical,{x:_,y,z:v}=a.canonical,I=qs/Math.pow(2,v-d),T=(y*u.N+t.anchorY)*I,M=c*u.N*qs;return{x:Math.floor((_*u.N+t.anchorX)*I-o*u.N*qs),y:Math.floor(T-M)}}findMatches(t,a,o){const c=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let d=0;d<t.length;d++){const _=t.get(d);if(_.crossTileID)continue;const y=this._symbolsByKey[_.key];if(!y)continue;const v=this.getScaledCoordinates(_,a);if(y.index){const I=y.index.range(v.x-c,v.y-c,v.x+c,v.y+c).sort();for(const T of I){const M=y.crossTileIDs[T];if(!o[M]){o[M]=!0,_.crossTileID=M;break}}}else if(y.positions)for(let I=0;I<y.positions.length;I++){const T=y.positions[I],M=y.crossTileIDs[I];if(Math.abs(T.x-v.x)<=c&&Math.abs(T.y-v.y)<=c&&!o[M]){o[M]=!0,_.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ut{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const o in this.indexes){const c=this.indexes[o],d={};for(const _ in c){const y=c[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),d[y.tileID.key]=y}this.indexes[o]=d}this.lng=t}addBucket(t,a,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<a.symbolInstances.length;d++)a.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const _=this.indexes[d];if(Number(d)>t.overscaledZ)for(const y in _){const v=_[y];v.tileID.isChildOf(t)&&v.findMatches(a.symbolInstances,t,c)}else{const y=_[t.scaledTo(Number(d)).key];y&&y.findMatches(a.symbolInstances,t,c)}}for(let d=0;d<a.symbolInstances.length;d++){const _=a.symbolInstances.get(d);_.crossTileID||(_.crossTileID=o.generate(),c[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Wl(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const o of a.getCrossTileIDsLists())for(const c of o)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let a=!1;for(const o in this.indexes){const c=this.indexes[o];for(const d in c)t[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[d]),delete c[d],a=!0)}return a}}class La{constructor(){this.layerIndexes={},this.crossTileIDs=new Ut,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,o){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new vn);let d=!1;const _={};c.handleWrapJump(o);for(const y of a){const v=y.getBucket(t);v&&t.id===v.layerIds[0]&&(v.bucketInstanceId||(v.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,v,this.crossTileIDs)&&(d=!0),_[v.bucketInstanceId]=!0)}return c.removeStaleBuckets(_)&&(d=!0),d}pruneUnusedLayers(t){const a={};t.forEach(o=>{a[o]=!0});for(const o in this.layerIndexes)a[o]||delete this.layerIndexes[o]}}const qi=(h,t)=>u.x(h,t&&t.filter(a=>a.identifier!=="source.canvas")),fr=u.F(u.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Xl=u.F(u.ax,["setCenter","setZoom","setBearing","setPitch"]),kr=u.aw();class Ri extends u.E{constructor(t,a={}){super(),this.map=t,this.dispatcher=new fi(Da(),this,t._getMapId()),this.imageManager=new Ct,this.imageManager.setEventedParent(this),this.glyphManager=new Ii(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Yi(256,512),this.crossTileSymbolIndex=new La,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.az());const o=this;this._rtlTextPluginCallback=Ri.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(d,_)=>{if(u.aA(d),_&&_.every(y=>y))for(const y in o.sourceCaches){const v=o.sourceCaches[y].getSource().type;v!=="vector"&&v!=="geojson"||o.sourceCaches[y].reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const y in this._layers){const v=this._layers[y];v.source===_.id&&this._validateLayer(v)}})}loadURL(t,a={},o){this.fire(new u.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const c=this.map._requestManager.transformRequest(t,Ve.Style);this._request=u.f(c,(d,_)=>{this._request=null,d?this.fire(new u.j(d)):_&&this._load(_,a,o)})}loadJSON(t,a={},o){this.fire(new u.k("dataloading",{dataType:"style"})),this._request=u.h.frame(()=>{this._request=null,a.validate=a.validate!==!1,this._load(t,a,o)})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(kr,{validate:!1})}_load(t,a,o){var c;const d=a.transformStyle?a.transformStyle(o,t):t;if(!a.validate||!qi(this,u.y(d))){this._loaded=!0,this.stylesheet=d;for(const _ in d.sources)this.addSource(_,d.sources[_],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new Sr(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const t=u.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const o=u.aC(a);o.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=o}}_loadSprite(t,a=!1,o=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(c,d,_,y){const v=jt(c),I=v.length,T=_>1?"@2x":"",M={},E={},O={};for(const{id:R,url:N}of v){const F=d.transformRequest(d.normalizeSpriteURL(N,T,".json"),Ve.SpriteJSON),J=`${R}_${F.url}`;M[J]=u.f(F,(H,se)=>{delete M[J],E[R]=se,Pt(y,E,O,H,I)});const ie=d.transformRequest(d.normalizeSpriteURL(N,T,".png"),Ve.SpriteImage),q=`${R}_${ie.url}`;M[q]=Se.getImage(ie,(H,se)=>{delete M[q],O[R]=se,Pt(y,E,O,H,I)})}return{cancel(){for(const R of Object.values(M))R.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(c,d)=>{if(this._spriteRequest=null,c)this.fire(new u.j(c));else if(d)for(const _ in d){this._spritesImagesIds[_]=[];const y=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(v=>!(v in d)):[];for(const v of y)this.imageManager.removeImage(v),this._changedImages[v]=!0;for(const v in d[_]){const I=_==="default"?v:`${_}:${v}`;this._spritesImagesIds[_].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,d[_][v],!1):this.imageManager.addImage(I,d[_][v]),a&&(this._changedImages[I]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),o&&o(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const o=t.sourceLayer;if(!o)return;const c=a.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(o)===-1)&&this.fire(new u.j(new Error(`Source layer "${o}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a);const o=[];for(const c of t)a[c]&&o.push(a[c]);return o}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const o of a){const c=this._layers[o];c.type!=="custom"&&(t[o]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const _ in this._updatedSources){const y=this._updatedSources[_];if(y==="reload")this._reloadSource(_);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];o[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in o){const d=this.sourceCaches[c];o[c]!==d.used&&d.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){this._checkLoaded();const o=this.serialize();if(t=a.transformStyle?a.transformStyle(o,t):t,qi(this,u.y(t)))return!1;(t=u.aD(t)).layers=u.aB(t.layers);const c=u.aE(o,t).filter(_=>!(_.command in Xl));if(c.length===0)return!1;const d=c.filter(_=>!(_.command in fr));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);for(const _ of c)_.command!=="setTransition"&&this[_.command].apply(this,_.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,a){if(this.getImage(t))return this.fire(new u.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.y.source,`sources.${t}`,a,null,o))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const c=this.sourceCaches[t]=new sr(t,a,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new u.j(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,o={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new u.j(new Error(`Layer "${c}" already exists on this map.`)));let d;if(t.type==="custom"){if(qi(this,u.aF(t)))return;d=u.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=u.aD(t),t=u.e(t,{source:c})),this._validate(u.y.layer,`layers.${c}`,t,{arrayIndex:-1},o))return;d=u.aC(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const _=a?this._order.indexOf(a):this._order.length;if(a&&_===-1)this.fire(new u.j(new Error(`Cannot add layer "${c}" before non-existing layer "${a}".`)));else{if(this._order.splice(_,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const o=this._order.indexOf(t);this._order.splice(o,1);const c=a?this._order.indexOf(a):this._order.length;a&&c===-1?this.fire(new u.j(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,o){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===a&&c.maxzoom===o||(a!=null&&(c.minzoom=a),o!=null&&(c.maxzoom=o),this._updateLayer(c)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,o={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!u.aG(c.filter,a))return a==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(u.y.filter,`layers.${c.id}.filter`,a,null,o)||(c.filter=u.aD(a),this._updateLayer(c)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.aD(this.getLayer(t).filter)}setLayoutProperty(t,a,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?u.aG(d.getLayoutProperty(a),o)||(d.setLayoutProperty(a,o,c),this._updateLayer(d)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const o=this.getLayer(t);if(o)return o.getLayoutProperty(a);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,o,c={}){this._checkLoaded();const d=this.getLayer(t);d?u.aG(d.getPaintProperty(a),o)||(d.setPaintProperty(a,o,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const o=t.source,c=t.sourceLayer,d=this.sourceCaches[o];if(d===void 0)return void this.fire(new u.j(new Error(`The source '${o}' does not exist in the map's style.`)));const _=d.getSource().type;_==="geojson"&&c?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||c?(t.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,t.id,a)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const o=t.source,c=this.sourceCaches[o];if(c===void 0)return void this.fire(new u.j(new Error(`The source '${o}' does not exist in the map's style.`)));const d=c.getSource().type,_=d==="vector"?t.sourceLayer:void 0;d!=="vector"||_?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(_,t.id,a):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,o=t.sourceLayer,c=this.sourceCaches[a];if(c!==void 0)return c.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(o,t.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=u.aH(this.sourceCaches,d=>d.serialize()),a=this._serializeByIds(this._order),o=this.map.getTerrain()||void 0,c=this.stylesheet;return u.aI({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:a,terrain:o},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=_=>this._layers[_].type==="fill-extrusion",o={},c=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(a(y)){o[y]=_;for(const v of t){const I=v[y];if(I)for(const T of I)c.push(T)}}}c.sort((_,y)=>y.intersectionZ-_.intersectionZ);const d=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(a(y))for(let v=c.length-1;v>=0;v--){const I=c[v].feature;if(o[I.layer.id]<_)break;d.push(I),c.pop()}else for(const v of t){const I=v[y];if(I)for(const T of I)d.push(T.feature)}}return d}queryRenderedFeatures(t,a,o){a&&a.filter&&this._validate(u.y.filter,"queryRenderedFeatures.filter",a.filter,null,a);const c={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const y of a.layers){const v=this._layers[y];if(!v)return this.fire(new u.j(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];c[v.source]=!0}}const d=[];a.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const y in this.sourceCaches)a.layers&&!c[y]||d.push(ye(this.sourceCaches[y],this._layers,_,t,a,o));return this.placement&&d.push(function(y,v,I,T,M,E,O){const R={},N=E.queryRenderedSymbols(T),F=[];for(const J of Object.keys(N).map(Number))F.push(O[J]);F.sort(Oe);for(const J of F){const ie=J.featureIndex.lookupSymbolFeatures(N[J.bucketInstanceId],v,J.bucketIndex,J.sourceLayerIndex,M.filter,M.layers,M.availableImages,y);for(const q in ie){const H=R[q]=R[q]||[],se=ie[q];se.sort((ae,he)=>{const ve=J.featureSortOrder;if(ve){const ge=ve.indexOf(ae.featureIndex);return ve.indexOf(he.featureIndex)-ge}return he.featureIndex-ae.featureIndex});for(const ae of se)H.push(ae)}}for(const J in R)R[J].forEach(ie=>{const q=ie.feature,H=I[y[J].source].getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=H});return R}(this._layers,_,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,a){a&&a.filter&&this._validate(u.y.filter,"querySourceFeatures.filter",a.filter,null,a);const o=this.sourceCaches[t];return o?function(c,d){const _=c.getRenderableIds().map(I=>c.getTileByID(I)),y=[],v={};for(let I=0;I<_.length;I++){const T=_[I],M=T.tileID.canonical.key;v[M]||(v[M]=!0,T.querySourceFeatures(y,d))}return y}(o,a):[]}addSourceType(t,a,o){return me(t)?o(new Error(`A source type called "${t}" already exists.`)):(((c,d)=>{Ce[c]=d})(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const o=this.light.getLight();let c=!1;for(const _ in t)if(!u.aG(t[_],o[_])){c=!0;break}if(!c)return;const d={now:u.h.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(d)}_validate(t,a,o,c,d={}){return(!d||d.validate!==!1)&&qi(this,t.call(u.y,u.e({key:a,style:this.serialize(),value:o,styleSpec:u.v},c)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const o=this.sourceCaches[a];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,o,c,d=!1){let _=!1,y=!1;const v={};for(const I of this._order){const T=this._layers[I];if(T.type!=="symbol")continue;if(!v[T.source]){const E=this.sourceCaches[T.source];v[T.source]=E.getRenderableIds(!0).map(O=>E.getTileByID(O)).sort((O,R)=>R.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(R.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(T,v[T.source],t.center.lng);_=_||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.h.now(),t.zoom))&&(this.pauseablePlacement=new Zs(t,this.map.terrain,this._order,d,a,o,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,v),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.h.now()),y=!0),_&&this.pauseablePlacement.placement.setStale()),y||_)for(const I of this._order){const T=this._layers[I];T.type==="symbol"&&this.placement.updateLayerOpacities(T,v[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,o){this.imageManager.getImages(a.icons,o),this._updateTilesForChangedImages();const c=this.sourceCaches[a.source];c&&c.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(t,a,o){this.glyphManager.getGlyphs(a.stacks,o);const c=this.sourceCaches[a.source];c&&c.setDependencies(a.tileID.key,a.type,[""])}getResource(t,a,o){return u.m(a,o)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(u.y.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,o={},c){this._checkLoaded();const d=[{id:t,url:a}],_=[...jt(this.stylesheet.sprite),...d];this._validate(u.y.sprite,"sprite",_,null,o)||(this.stylesheet.sprite=_,this._loadSprite(d,!0,c))}removeSprite(t){this._checkLoaded();const a=jt(this.stylesheet.sprite);if(a.find(o=>o.id===t)){if(this._spritesImagesIds[t])for(const o of this._spritesImagesIds[t])this.imageManager.removeImage(o),this._changedImages[o]=!0;a.splice(a.findIndex(o=>o.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return jt(this.stylesheet.sprite)}setSprite(t,a={},o){this._checkLoaded(),t&&this._validate(u.y.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,o):(this._unloadSprite(),o&&o(null)))}}Ri.registerForPluginStateChange=u.aK;var Fa=u.Q([{name:"a_pos",type:"Int16",components:2}]),Gs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ii={prelude:Ft(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ft(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ft(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ft(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ft("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ft(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ft(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ft("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ft("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ft("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ft(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ft(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ft(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ft(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ft(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ft(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ft(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ft(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ft(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ft(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ft(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ft(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ft(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ft("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Gs),terrainDepth:Ft("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Gs),terrainCoords:Ft("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Gs)};function Ft(h,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),c=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=d?d.concat(c):c,y={};return{fragmentSource:h=h.replace(a,(v,I,T,M,E)=>(y[E]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${E}
varying ${T} ${M} ${E};
#else
uniform ${T} ${M} u_${E};
#endif
`:`
#ifdef HAS_UNIFORM_u_${E}
    ${T} ${M} ${E} = u_${E};
#endif
`)),vertexSource:t=t.replace(a,(v,I,T,M,E)=>{const O=M==="float"?"vec2":"vec4",R=E.match(/color/)?"color":O;return y[E]?I==="define"?`
#ifndef HAS_UNIFORM_u_${E}
uniform lowp float u_${E}_t;
attribute ${T} ${O} a_${E};
varying ${T} ${M} ${E};
#else
uniform ${T} ${M} u_${E};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${E}
    ${E} = a_${E};
#else
    ${T} ${M} ${E} = u_${E};
#endif
`:`
#ifndef HAS_UNIFORM_u_${E}
    ${E} = unpack_mix_${R}(a_${E}, u_${E}_t);
#else
    ${T} ${M} ${E} = u_${E};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${E}
uniform lowp float u_${E}_t;
attribute ${T} ${O} a_${E};
#else
uniform ${T} ${M} u_${E};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${E}
    ${T} ${M} ${E} = a_${E};
#else
    ${T} ${M} ${E} = u_${E};
#endif
`:`
#ifndef HAS_UNIFORM_u_${E}
    ${T} ${M} ${E} = unpack_mix_${R}(a_${E}, u_${E}_t);
#else
    ${T} ${M} ${E} = u_${E};
#endif
`}),staticAttributes:o,staticUniforms:_}}class Ts{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,o,c,d,_,y,v,I){this.context=t;let T=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!T&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(T=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==o||T||this.boundIndexBuffer!==d||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==v||this.boundDynamicVertexBuffer3!==I?this.freshBind(a,o,c,d,_,y,v,I):(t.bindVertexArray.set(this.vao),y&&y.bind(),d&&d.dynamicDraw&&d.bind(),v&&v.bind(),I&&I.bind())}freshBind(t,a,o,c,d,_,y,v){const I=t.numAttributes,T=this.context,M=T.gl;this.vao&&this.destroy(),this.vao=T.createVertexArray(),T.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=v,a.enableAttributes(M,t);for(const E of o)E.enableAttributes(M,t);_&&_.enableAttributes(M,t),y&&y.enableAttributes(M,t),v&&v.enableAttributes(M,t),a.bind(),a.setVertexAttribPointers(M,t,d);for(const E of o)E.bind(),E.setVertexAttribPointers(M,t,d);_&&(_.bind(),_.setVertexAttribPointers(M,t,d)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(M,t,d)),v&&(v.bind(),v.setVertexAttribPointers(M,t,d)),T.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function oi(h){const t=[];for(let a=0;a<h.length;a++){if(h[a]===null)continue;const o=h[a].split(" ");t.push(o.pop())}return t}class Ba{constructor(t,a,o,c,d,_){const y=t.gl;this.program=y.createProgram();const v=oi(a.staticAttributes),I=o?o.getBinderAttributes():[],T=v.concat(I),M=ii.prelude.staticUniforms?oi(ii.prelude.staticUniforms):[],E=a.staticUniforms?oi(a.staticUniforms):[],O=o?o.getBinderUniforms():[],R=M.concat(E).concat(O),N=[];for(const ae of R)N.indexOf(ae)<0&&N.push(ae);const F=o?o.defines():[];d&&F.push("#define OVERDRAW_INSPECTOR;"),_&&F.push("#define TERRAIN3D;");const J=F.concat(ii.prelude.fragmentSource,a.fragmentSource).join(`
`),ie=F.concat(ii.prelude.vertexSource,a.vertexSource).join(`
`),q=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(q,J),y.compileShader(q),!y.getShaderParameter(q,y.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${y.getShaderInfoLog(q)}`);y.attachShader(this.program,q);const H=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);if(y.shaderSource(H,ie),y.compileShader(H),!y.getShaderParameter(H,y.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${y.getShaderInfoLog(H)}`);y.attachShader(this.program,H),this.attributes={};const se={};this.numAttributes=T.length;for(let ae=0;ae<this.numAttributes;ae++)T[ae]&&(y.bindAttribLocation(this.program,ae,T[ae]),this.attributes[T[ae]]=ae);if(y.linkProgram(this.program),!y.getProgramParameter(this.program,y.LINK_STATUS))throw new Error(`Program failed to link: ${y.getProgramInfoLog(this.program)}`);y.deleteShader(H),y.deleteShader(q);for(let ae=0;ae<N.length;ae++){const he=N[ae];if(he&&!se[he]){const ve=y.getUniformLocation(this.program,he);ve&&(se[he]=ve)}}this.fixedUniforms=c(t,se),this.terrainUniforms=((ae,he)=>({u_depth:new u.aL(ae,he.u_depth),u_terrain:new u.aL(ae,he.u_terrain),u_terrain_dim:new u.aM(ae,he.u_terrain_dim),u_terrain_matrix:new u.aN(ae,he.u_terrain_matrix),u_terrain_unpack:new u.aO(ae,he.u_terrain_unpack),u_terrain_exaggeration:new u.aM(ae,he.u_terrain_exaggeration)}))(t,se),this.binderUniforms=o?o.getUniforms(t,se):[]}draw(t,a,o,c,d,_,y,v,I,T,M,E,O,R,N,F,J,ie){const q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(c),t.setColorMode(d),t.setCullFace(_),v){t.activeTexture.set(q.TEXTURE2),q.bindTexture(q.TEXTURE_2D,v.depthTexture),t.activeTexture.set(q.TEXTURE3),q.bindTexture(q.TEXTURE_2D,v.texture);for(const se in this.terrainUniforms)this.terrainUniforms[se].set(v[se])}for(const se in this.fixedUniforms)this.fixedUniforms[se].set(y[se]);N&&N.setUniforms(t,this.binderUniforms,O,{zoom:R});let H=0;switch(a){case q.LINES:H=2;break;case q.TRIANGLES:H=3;break;case q.LINE_STRIP:H=1}for(const se of E.get()){const ae=se.vaos||(se.vaos={});(ae[I]||(ae[I]=new Ts)).bind(t,this,T,N?N.getPaintVertexBuffers():[],M,se.vertexOffset,F,J,ie),q.drawElements(a,se.primitiveLength*H,q.UNSIGNED_SHORT,se.primitiveOffset*H*2)}}}function Ar(h,t,a){const o=1/X(a,1,t.transform.tileZoom),c=Math.pow(2,a.tileID.overscaledZ),d=a.tileSize*Math.pow(2,t.transform.tileZoom)/c,_=d*(a.tileID.canonical.x+a.tileID.wrap*c),y=d*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[o,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const bn=(h,t,a,o)=>{const c=t.style.light,d=c.properties.get("position"),_=[d.x,d.y,d.z],y=function(){var I=new u.A(9);return u.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();c.properties.get("anchor")==="viewport"&&function(I,T){var M=Math.sin(T),E=Math.cos(T);I[0]=E,I[1]=M,I[2]=0,I[3]=-M,I[4]=E,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(y,-t.transform.angle),function(I,T,M){var E=T[0],O=T[1],R=T[2];I[0]=E*M[0]+O*M[3]+R*M[6],I[1]=E*M[1]+O*M[4]+R*M[7],I[2]=E*M[2]+O*M[5]+R*M[8]}(_,_,y);const v=c.properties.get("color");return{u_matrix:h,u_lightpos:_,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+a,u_opacity:o}},ps=(h,t,a,o,c,d,_)=>u.e(bn(h,t,a,o),Ar(d,t,_),{u_height_factor:-Math.pow(2,c.overscaledZ)/_.tileSize/8}),Do=h=>({u_matrix:h}),wn=(h,t,a,o)=>u.e(Do(h),Ar(a,t,o)),Ra=(h,t)=>({u_matrix:h,u_world:t}),Oa=(h,t,a,o,c)=>u.e(wn(h,t,a,o),{u_world:c}),fs=(h,t,a,o)=>{const c=h.transform;let d,_;if(o.paint.get("circle-pitch-alignment")==="map"){const y=X(a,1,c.zoom);d=!0,_=[y,y]}else d=!1,_=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,a,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:_}},In=(h,t,a)=>{const o=X(a,1,t.zoom),c=Math.pow(2,t.zoom-a.tileID.overscaledZ),d=a.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*c),t.pixelsToGLUnits[1]/(o*c)],u_overscale_factor:d}},ua=(h,t,a=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:a}),Lo=h=>({u_matrix:h}),Yl=(h,t,a,o)=>({u_matrix:h,u_extrude_scale:X(t,1,a),u_intensity:o});function Sn(h,t){const a=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new u.U(0,o/a).toLngLat().lat,new u.U(0,(o+1)/a).toLngLat().lat]}const Tn=(h,t,a,o)=>{const c=h.transform;return{u_matrix:Va(h,t,a,o),u_ratio:1/X(t,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Fo=(h,t,a,o,c)=>u.e(Tn(h,t,a,c),{u_image:0,u_image_height:o}),Jl=(h,t,a,o,c)=>{const d=h.transform,_=Ro(t,d);return{u_matrix:Va(h,t,a,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/X(t,1,d.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[_,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Bo=(h,t,a,o,c,d)=>{const _=h.lineAtlas,y=Ro(t,h.transform),v=a.layout.get("line-cap")==="round",I=_.getDash(o.from,v),T=_.getDash(o.to,v),M=I.width*c.fromScale,E=T.width*c.toScale;return u.e(Tn(h,t,a,d),{u_patternscale_a:[y/M,-I.height/2],u_patternscale_b:[y/E,-T.height/2],u_sdfgamma:_.width/(256*Math.min(M,E)*h.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:T.y,u_mix:c.t})};function Ro(h,t){return 1/X(h,1,t.tileZoom)}function Va(h,t,a,o){return h.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Oo=(h,t,a,o,c)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(_=c.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(d=c.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Vo(c.paint.get("raster-hue-rotate"))};var d,_};function Vo(h){h*=Math.PI/180;const t=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Mn=(h,t,a,o,c,d,_,y,v,I)=>{const T=c.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:T.cameraToCenterDistance,u_pitch:T.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:T.width/T.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:_,u_coord_matrix:y,u_is_text:+v,u_pitch_with_map:+o,u_texsize:I,u_texture:0}},Cn=(h,t,a,o,c,d,_,y,v,I,T)=>{const M=c.transform;return u.e(Mn(h,t,a,o,c,d,_,y,v,I),{u_gamma_scale:o?Math.cos(M._pitch)*M.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:1})},Ms=(h,t,a,o,c,d,_,y,v,I)=>u.e(Cn(h,t,a,o,c,d,_,y,!0,v),{u_texsize_icon:I,u_texture_icon:1}),Na=(h,t,a)=>({u_matrix:h,u_opacity:t,u_color:a}),zr=(h,t,a,o,c,d)=>u.e(function(_,y,v,I){const T=v.imageManager.getPattern(_.from.toString()),M=v.imageManager.getPattern(_.to.toString()),{width:E,height:O}=v.imageManager.getPixelSize(),R=Math.pow(2,I.tileID.overscaledZ),N=I.tileSize*Math.pow(2,v.transform.tileZoom)/R,F=N*(I.tileID.canonical.x+I.tileID.wrap*R),J=N*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[E,O],u_mix:y.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/X(I,1,v.transform.tileZoom),u_pixel_coord_upper:[F>>16,J>>16],u_pixel_coord_lower:[65535&F,65535&J]}}(o,d,a,c),{u_matrix:h,u_opacity:t}),ja={fillExtrusion:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_lightpos:new u.aP(h,t.u_lightpos),u_lightintensity:new u.aM(h,t.u_lightintensity),u_lightcolor:new u.aP(h,t.u_lightcolor),u_vertical_gradient:new u.aM(h,t.u_vertical_gradient),u_opacity:new u.aM(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_lightpos:new u.aP(h,t.u_lightpos),u_lightintensity:new u.aM(h,t.u_lightintensity),u_lightcolor:new u.aP(h,t.u_lightcolor),u_vertical_gradient:new u.aM(h,t.u_vertical_gradient),u_height_factor:new u.aM(h,t.u_height_factor),u_image:new u.aL(h,t.u_image),u_texsize:new u.aQ(h,t.u_texsize),u_pixel_coord_upper:new u.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(h,t.u_pixel_coord_lower),u_scale:new u.aP(h,t.u_scale),u_fade:new u.aM(h,t.u_fade),u_opacity:new u.aM(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_image:new u.aL(h,t.u_image),u_texsize:new u.aQ(h,t.u_texsize),u_pixel_coord_upper:new u.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(h,t.u_pixel_coord_lower),u_scale:new u.aP(h,t.u_scale),u_fade:new u.aM(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_world:new u.aQ(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_world:new u.aQ(h,t.u_world),u_image:new u.aL(h,t.u_image),u_texsize:new u.aQ(h,t.u_texsize),u_pixel_coord_upper:new u.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(h,t.u_pixel_coord_lower),u_scale:new u.aP(h,t.u_scale),u_fade:new u.aM(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new u.aM(h,t.u_camera_to_center_distance),u_scale_with_map:new u.aL(h,t.u_scale_with_map),u_pitch_with_map:new u.aL(h,t.u_pitch_with_map),u_extrude_scale:new u.aQ(h,t.u_extrude_scale),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_matrix:new u.aN(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_camera_to_center_distance:new u.aM(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new u.aM(h,t.u_pixels_to_tile_units),u_extrude_scale:new u.aQ(h,t.u_extrude_scale),u_overscale_factor:new u.aM(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_inv_matrix:new u.aN(h,t.u_inv_matrix),u_camera_to_center_distance:new u.aM(h,t.u_camera_to_center_distance),u_viewport_size:new u.aQ(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new u.aR(h,t.u_color),u_matrix:new u.aN(h,t.u_matrix),u_overlay:new u.aL(h,t.u_overlay),u_overlay_scale:new u.aM(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new u.aM(h,t.u_extrude_scale),u_intensity:new u.aM(h,t.u_intensity),u_matrix:new u.aN(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_world:new u.aQ(h,t.u_world),u_image:new u.aL(h,t.u_image),u_color_ramp:new u.aL(h,t.u_color_ramp),u_opacity:new u.aM(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_image:new u.aL(h,t.u_image),u_latrange:new u.aQ(h,t.u_latrange),u_light:new u.aQ(h,t.u_light),u_shadow:new u.aR(h,t.u_shadow),u_highlight:new u.aR(h,t.u_highlight),u_accent:new u.aR(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_image:new u.aL(h,t.u_image),u_dimension:new u.aQ(h,t.u_dimension),u_zoom:new u.aM(h,t.u_zoom),u_unpack:new u.aO(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_ratio:new u.aM(h,t.u_ratio),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.aQ(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_ratio:new u.aM(h,t.u_ratio),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.aQ(h,t.u_units_to_pixels),u_image:new u.aL(h,t.u_image),u_image_height:new u.aM(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_texsize:new u.aQ(h,t.u_texsize),u_ratio:new u.aM(h,t.u_ratio),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_image:new u.aL(h,t.u_image),u_units_to_pixels:new u.aQ(h,t.u_units_to_pixels),u_scale:new u.aP(h,t.u_scale),u_fade:new u.aM(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_ratio:new u.aM(h,t.u_ratio),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.aQ(h,t.u_units_to_pixels),u_patternscale_a:new u.aQ(h,t.u_patternscale_a),u_patternscale_b:new u.aQ(h,t.u_patternscale_b),u_sdfgamma:new u.aM(h,t.u_sdfgamma),u_image:new u.aL(h,t.u_image),u_tex_y_a:new u.aM(h,t.u_tex_y_a),u_tex_y_b:new u.aM(h,t.u_tex_y_b),u_mix:new u.aM(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_tl_parent:new u.aQ(h,t.u_tl_parent),u_scale_parent:new u.aM(h,t.u_scale_parent),u_buffer_scale:new u.aM(h,t.u_buffer_scale),u_fade_t:new u.aM(h,t.u_fade_t),u_opacity:new u.aM(h,t.u_opacity),u_image0:new u.aL(h,t.u_image0),u_image1:new u.aL(h,t.u_image1),u_brightness_low:new u.aM(h,t.u_brightness_low),u_brightness_high:new u.aM(h,t.u_brightness_high),u_saturation_factor:new u.aM(h,t.u_saturation_factor),u_contrast_factor:new u.aM(h,t.u_contrast_factor),u_spin_weights:new u.aP(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new u.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aL(h,t.u_is_size_feature_constant),u_size_t:new u.aM(h,t.u_size_t),u_size:new u.aM(h,t.u_size),u_camera_to_center_distance:new u.aM(h,t.u_camera_to_center_distance),u_pitch:new u.aM(h,t.u_pitch),u_rotate_symbol:new u.aL(h,t.u_rotate_symbol),u_aspect_ratio:new u.aM(h,t.u_aspect_ratio),u_fade_change:new u.aM(h,t.u_fade_change),u_matrix:new u.aN(h,t.u_matrix),u_label_plane_matrix:new u.aN(h,t.u_label_plane_matrix),u_coord_matrix:new u.aN(h,t.u_coord_matrix),u_is_text:new u.aL(h,t.u_is_text),u_pitch_with_map:new u.aL(h,t.u_pitch_with_map),u_texsize:new u.aQ(h,t.u_texsize),u_texture:new u.aL(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new u.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aL(h,t.u_is_size_feature_constant),u_size_t:new u.aM(h,t.u_size_t),u_size:new u.aM(h,t.u_size),u_camera_to_center_distance:new u.aM(h,t.u_camera_to_center_distance),u_pitch:new u.aM(h,t.u_pitch),u_rotate_symbol:new u.aL(h,t.u_rotate_symbol),u_aspect_ratio:new u.aM(h,t.u_aspect_ratio),u_fade_change:new u.aM(h,t.u_fade_change),u_matrix:new u.aN(h,t.u_matrix),u_label_plane_matrix:new u.aN(h,t.u_label_plane_matrix),u_coord_matrix:new u.aN(h,t.u_coord_matrix),u_is_text:new u.aL(h,t.u_is_text),u_pitch_with_map:new u.aL(h,t.u_pitch_with_map),u_texsize:new u.aQ(h,t.u_texsize),u_texture:new u.aL(h,t.u_texture),u_gamma_scale:new u.aM(h,t.u_gamma_scale),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_is_halo:new u.aL(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new u.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aL(h,t.u_is_size_feature_constant),u_size_t:new u.aM(h,t.u_size_t),u_size:new u.aM(h,t.u_size),u_camera_to_center_distance:new u.aM(h,t.u_camera_to_center_distance),u_pitch:new u.aM(h,t.u_pitch),u_rotate_symbol:new u.aL(h,t.u_rotate_symbol),u_aspect_ratio:new u.aM(h,t.u_aspect_ratio),u_fade_change:new u.aM(h,t.u_fade_change),u_matrix:new u.aN(h,t.u_matrix),u_label_plane_matrix:new u.aN(h,t.u_label_plane_matrix),u_coord_matrix:new u.aN(h,t.u_coord_matrix),u_is_text:new u.aL(h,t.u_is_text),u_pitch_with_map:new u.aL(h,t.u_pitch_with_map),u_texsize:new u.aQ(h,t.u_texsize),u_texsize_icon:new u.aQ(h,t.u_texsize_icon),u_texture:new u.aL(h,t.u_texture),u_texture_icon:new u.aL(h,t.u_texture_icon),u_gamma_scale:new u.aM(h,t.u_gamma_scale),u_device_pixel_ratio:new u.aM(h,t.u_device_pixel_ratio),u_is_halo:new u.aL(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_opacity:new u.aM(h,t.u_opacity),u_color:new u.aR(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_opacity:new u.aM(h,t.u_opacity),u_image:new u.aL(h,t.u_image),u_pattern_tl_a:new u.aQ(h,t.u_pattern_tl_a),u_pattern_br_a:new u.aQ(h,t.u_pattern_br_a),u_pattern_tl_b:new u.aQ(h,t.u_pattern_tl_b),u_pattern_br_b:new u.aQ(h,t.u_pattern_br_b),u_texsize:new u.aQ(h,t.u_texsize),u_mix:new u.aM(h,t.u_mix),u_pattern_size_a:new u.aQ(h,t.u_pattern_size_a),u_pattern_size_b:new u.aQ(h,t.u_pattern_size_b),u_scale_a:new u.aM(h,t.u_scale_a),u_scale_b:new u.aM(h,t.u_scale_b),u_pixel_coord_upper:new u.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aM(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_texture:new u.aL(h,t.u_texture),u_ele_delta:new u.aM(h,t.u_ele_delta)}),terrainDepth:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_ele_delta:new u.aM(h,t.u_ele_delta)}),terrainCoords:(h,t)=>({u_matrix:new u.aN(h,t.u_matrix),u_texture:new u.aL(h,t.u_texture),u_terrain_coords_id:new u.aM(h,t.u_terrain_coords_id),u_ele_delta:new u.aM(h,t.u_ele_delta)})};class Ua{constructor(t,a,o){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ha={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Za{constructor(t,a,o,c){this.length=a.length,this.attributes=o,this.itemSize=a.bytesPerElement,this.dynamicDraw=c,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let o=0;o<this.attributes.length;o++){const c=a.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,a,o){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],_=a.attributes[d.name];_!==void 0&&t.vertexAttribPointer(_,d.components,t[ha[d.type]],!1,this.itemSize,d.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $s=new WeakMap;function ms(h){var t;if($s.has(h))return $s.get(h);{const a=(t=h.getParameter(h.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return $s.set(h,a),a}}class kt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qa extends kt{getDefault(){return u.aT.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class mr extends kt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class gr extends kt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class kn extends kt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ga extends kt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $a extends kt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class An extends kt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class zn extends kt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Wa extends kt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class En extends kt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Pn extends kt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Xa extends kt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class No extends kt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class jo extends kt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ws extends kt{getDefault(){return u.aT.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Hl extends kt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Kl extends kt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Ql extends kt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ec extends kt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class tc extends kt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ic extends kt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Dn extends kt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ya extends kt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ln extends kt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fn extends kt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Xs extends kt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Uo extends kt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Zo extends kt{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const o=this.gl;ms(o)?o.bindVertexArray(t):(a=o.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Bn extends kt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Cs extends kt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class qo extends kt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class gs extends kt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Ys extends gs{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Go extends gs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Rn extends gs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bt{constructor(t,a,o,c,d){this.context=t,this.width=a,this.height=o;const _=t.gl,y=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new Ys(t,y),c)this.depthAttachment=d?new Rn(t,y):new Go(t,y);else if(d)throw new Error("Stencil cannot be setted without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class ri{constructor(t,a,o){this.blendFunction=t,this.blendColor=a,this.mask=o}}ri.Replace=[1,0],ri.disabled=new ri(ri.Replace,u.aT.transparent,[!1,!1,!1,!1]),ri.unblended=new ri(ri.Replace,u.aT.transparent,[!0,!0,!0,!0]),ri.alphaBlended=new ri([1,771],u.aT.transparent,[!0,!0,!0,!0]);class rc{constructor(t){var a,o;if(this.gl=t,this.clearColor=new qa(this),this.clearDepth=new mr(this),this.clearStencil=new gr(this),this.colorMask=new kn(this),this.depthMask=new Ga(this),this.stencilMask=new $a(this),this.stencilFunc=new An(this),this.stencilOp=new zn(this),this.stencilTest=new Wa(this),this.depthRange=new En(this),this.depthTest=new Pn(this),this.depthFunc=new Xa(this),this.blend=new No(this),this.blendFunc=new jo(this),this.blendColor=new Ws(this),this.blendEquation=new Hl(this),this.cullFace=new Kl(this),this.cullFaceSide=new Ql(this),this.frontFace=new ec(this),this.program=new tc(this),this.activeTexture=new ic(this),this.viewport=new Dn(this),this.bindFramebuffer=new Ya(this),this.bindRenderbuffer=new Ln(this),this.bindTexture=new Fn(this),this.bindVertexBuffer=new Xs(this),this.bindElementBuffer=new Uo(this),this.bindVertexArray=new Zo(this),this.pixelStoreUnpack=new Bn(this),this.pixelStoreUnpackPremultiplyAlpha=new Cs(this),this.pixelStoreUnpackFlipY=new qo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ms(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(o=t.RGB16F)!==null&&o!==void 0?o:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Ua(this,t,a)}createVertexBuffer(t,a,o){return new Za(this,t,a,o)}createRenderbuffer(t,a,o){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,t,a,o),this.bindRenderbuffer.set(null),d}createFramebuffer(t,a,o,c){return new Bt(this,t,a,o,c)}clear({color:t,depth:a,stencil:o}){const c=this.gl;let d=0;t&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),o!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),c.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.aG(t.blendFunction,ri.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ms(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return ms(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class At{constructor(t,a,o){this.func=t,this.mask=a,this.range=o}}At.ReadOnly=!1,At.ReadWrite=!0,At.disabled=new At(519,At.ReadOnly,[0,1]);const ks=7680;class si{constructor(t,a,o,c,d,_){this.test=t,this.ref=a,this.mask=o,this.fail=c,this.depthFail=d,this.pass=_}}si.disabled=new si({func:519,mask:0},0,0,ks,ks,ks);class ei{constructor(t,a,o){this.enable=t,this.mode=a,this.frontFace=o}}let da;function $o(h,t,a,o,c,d,_){const y=h.context,v=y.gl,I=h.useProgram("collisionBox"),T=[];let M=0,E=0;for(let q=0;q<o.length;q++){const H=o[q],se=t.getTile(H),ae=se.getBucket(a);if(!ae)continue;let he=H.posMatrix;c[0]===0&&c[1]===0||(he=h.translatePosMatrix(H.posMatrix,se,c,d));const ve=_?ae.textCollisionBox:ae.iconCollisionBox,ge=ae.collisionCircleArray;if(ge.length>0){const Te=u.Z(),qe=he;u.aU(Te,ae.placementInvProjMatrix,h.transform.glCoordMatrix),u.aU(Te,Te,ae.placementViewportMatrix),T.push({circleArray:ge,circleOffset:E,transform:qe,invTransform:Te,coord:H}),M+=ge.length/4,E=M}ve&&I.draw(y,v.LINES,At.disabled,si.disabled,h.colorModeForRenderPass(),ei.disabled,In(he,h.transform,se),h.style.map.terrain&&h.style.map.terrain.getTerrainData(H),a.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,null,h.transform.zoom,null,null,ve.collisionVertexBuffer)}if(!_||!T.length)return;const O=h.useProgram("collisionCircle"),R=new u.aV;R.resize(4*M),R._trim();let N=0;for(const q of T)for(let H=0;H<q.circleArray.length/4;H++){const se=4*H,ae=q.circleArray[se+0],he=q.circleArray[se+1],ve=q.circleArray[se+2],ge=q.circleArray[se+3];R.emplace(N++,ae,he,ve,ge,0),R.emplace(N++,ae,he,ve,ge,1),R.emplace(N++,ae,he,ve,ge,2),R.emplace(N++,ae,he,ve,ge,3)}(!da||da.length<2*M)&&(da=function(q){const H=2*q,se=new u.aX;se.resize(H),se._trim();for(let ae=0;ae<H;ae++){const he=6*ae;se.uint16[he+0]=4*ae+0,se.uint16[he+1]=4*ae+1,se.uint16[he+2]=4*ae+2,se.uint16[he+3]=4*ae+2,se.uint16[he+4]=4*ae+3,se.uint16[he+5]=4*ae+0}return se}(M));const F=y.createIndexBuffer(da,!0),J=y.createVertexBuffer(R,u.aW.members,!0);for(const q of T){const H={u_matrix:q.transform,u_inv_matrix:q.invTransform,u_camera_to_center_distance:(ie=h.transform).cameraToCenterDistance,u_viewport_size:[ie.width,ie.height]};O.draw(y,v.TRIANGLES,At.disabled,si.disabled,h.colorModeForRenderPass(),ei.disabled,H,h.style.map.terrain&&h.style.map.terrain.getTerrainData(q.coord),a.id,J,F,u.S.simpleSegment(0,2*q.circleOffset,q.circleArray.length,q.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ie;J.destroy(),F.destroy()}ei.disabled=new ei(!1,1029,2305),ei.backCCW=new ei(!0,1029,2305);const On=u.ao(new Float32Array(16));function Ja(h,t,a,o,c,d){const{horizontalAlign:_,verticalAlign:y}=u.au(h);return new u.P((-(_-.5)*t/c+o[0])*d,(-(y-.5)*a/c+o[1])*d)}function Ha(h,t,a,o,c,d,_,y,v,I,T){const M=h.text.placedSymbolArray,E=h.text.dynamicLayoutVertexArray,O=h.icon.dynamicLayoutVertexArray,R={};E.clear();for(let N=0;N<M.length;N++){const F=M.get(N),J=F.hidden||!F.crossTileID||h.allowVerticalPlacement&&!F.placedOrientation?null:o[F.crossTileID];if(J){const ie=new u.P(F.anchorX,F.anchorY),q=ni(ie,a?_:d,T),H=Ss(c.cameraToCenterDistance,q.signedDistanceFromCamera);let se=u.aj(h.textSizeData,v,F)*H/u.ap;a&&(se*=h.tilePixelRatio/y);const{width:ae,height:he,anchor:ve,textOffset:ge,textBoxScale:Te}=J,qe=Ja(ve,ae,he,ge,Te,se),St=a?ni(ie.add(qe),d,T).point:q.point.add(t?qe.rotate(-c.angle):qe),De=h.allowVerticalPlacement&&F.placedOrientation===u.ai.vertical?Math.PI/2:0;for(let it=0;it<F.numGlyphs;it++)u.ak(E,St,De);I&&F.associatedIconIndex>=0&&(R[F.associatedIconIndex]={shiftedAnchor:St,angle:De})}else L(F.numGlyphs,E)}if(I){O.clear();const N=h.icon.placedSymbolArray;for(let F=0;F<N.length;F++){const J=N.get(F);if(J.hidden)L(J.numGlyphs,O);else{const ie=R[F];if(ie)for(let q=0;q<J.numGlyphs;q++)u.ak(O,ie.shiftedAnchor,ie.angle);else L(J.numGlyphs,O)}}h.icon.dynamicLayoutVertexBuffer.updateData(O)}h.text.dynamicLayoutVertexBuffer.updateData(E)}function Vn(h,t,a){return a.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ka(h,t,a,o,c,d,_,y,v,I,T,M){const E=h.context,O=E.gl,R=h.transform,N=y==="map",F=v==="map",J=y!=="viewport"&&a.layout.get("symbol-placement")!=="point",ie=N&&!F&&!J,q=!a.layout.get("symbol-sort-key").isConstant();let H=!1;const se=h.depthModeForSublayer(0,At.ReadOnly),ae=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),he=[];for(const ve of o){const ge=t.getTile(ve),Te=ge.getBucket(a);if(!Te)continue;const qe=c?Te.text:Te.icon;if(!qe||!qe.segments.get().length||!qe.hasVisibleVertices)continue;const St=qe.programConfigurations.get(a.id),De=c||Te.sdfIcons,it=c?Te.textSizeData:Te.iconSizeData,$e=F||R.pitch!==0,Zt=h.useProgram(Vn(De,c,Te),St),It=u.ah(it,R.zoom),_t=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ve);let Tt,hi,Jt,Oi,Si=[0,0],gi=null;if(c)hi=ge.glyphAtlasTexture,Jt=O.LINEAR,Tt=ge.glyphAtlasTexture.size,Te.iconsInText&&(Si=ge.imageAtlasTexture.size,gi=ge.imageAtlasTexture,Oi=$e||h.options.rotating||h.options.zooming||it.kind==="composite"||it.kind==="camera"?O.LINEAR:O.NEAREST);else{const di=a.layout.get("icon-size").constantOr(0)!==1||Te.iconsNeedLinear;hi=ge.imageAtlasTexture,Jt=De||h.options.rotating||h.options.zooming||di||$e?O.LINEAR:O.NEAREST,Tt=ge.imageAtlasTexture.size}const xr=X(ge,1,h.transform.zoom),Kt=ze(ve.posMatrix,F,N,h.transform,xr),Wr=qr(ve.posMatrix,F,N,h.transform,xr),Xr=ae&&Te.hasTextData(),vs=a.layout.get("icon-text-fit")!=="none"&&Xr&&Te.hasIconData();if(J){const di=h.style.map.terrain?(or,pi)=>h.style.map.terrain.getElevation(ve,or,pi):null,Ti=a.layout.get("text-rotation-alignment")==="map";Pe(Te,ve.posMatrix,h,c,Kt,Wr,F,I,Ti,di)}const Ds=h.translatePosMatrix(ve.posMatrix,ge,d,_),ia=J||c&&ae||vs?On:Kt,Gi=h.translatePosMatrix(Wr,ge,d,_,!0),Vi=De&&a.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ki;Ki=De?Te.iconsInText?Ms(it.kind,It,ie,F,h,Ds,ia,Gi,Tt,Si):Cn(it.kind,It,ie,F,h,Ds,ia,Gi,c,Tt):Mn(it.kind,It,ie,F,h,Ds,ia,Gi,c,Tt);const Ls={program:Zt,buffers:qe,uniformValues:Ki,atlasTexture:hi,atlasTextureIcon:gi,atlasInterpolation:Jt,atlasInterpolationIcon:Oi,isSDF:De,hasHalo:Vi};if(q&&Te.canOverlap){H=!0;const di=qe.segments.get();for(const Ti of di)he.push({segments:new u.S([Ti]),sortKey:Ti.sortKey,state:Ls,terrainData:_t})}else he.push({segments:qe.segments,sortKey:0,state:Ls,terrainData:_t})}H&&he.sort((ve,ge)=>ve.sortKey-ge.sortKey);for(const ve of he){const ge=ve.state;if(E.activeTexture.set(O.TEXTURE0),ge.atlasTexture.bind(ge.atlasInterpolation,O.CLAMP_TO_EDGE),ge.atlasTextureIcon&&(E.activeTexture.set(O.TEXTURE1),ge.atlasTextureIcon&&ge.atlasTextureIcon.bind(ge.atlasInterpolationIcon,O.CLAMP_TO_EDGE)),ge.isSDF){const Te=ge.uniformValues;ge.hasHalo&&(Te.u_is_halo=1,Nn(ge.buffers,ve.segments,a,h,ge.program,se,T,M,Te,ve.terrainData)),Te.u_is_halo=0}Nn(ge.buffers,ve.segments,a,h,ge.program,se,T,M,ge.uniformValues,ve.terrainData)}}function Nn(h,t,a,o,c,d,_,y,v,I){const T=o.context;c.draw(T,T.gl.TRIANGLES,d,_,y,ei.disabled,v,I,a.id,h.layoutVertexBuffer,h.indexBuffer,t,a.paint,o.transform.zoom,h.programConfigurations.get(a.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function pa(h,t,a,o,c){if(!a||!o||!o.imageAtlas)return;const d=o.imageAtlas.patternPositions;let _=d[a.to.toString()],y=d[a.from.toString()];if(!_&&y&&(_=y),!y&&_&&(y=_),!_||!y){const v=c.getPaintProperty(t);_=d[v],y=d[v]}_&&y&&h.setConstantPatternPositions(_,y)}function fa(h,t,a,o,c,d,_){const y=h.context.gl,v="fill-pattern",I=a.paint.get(v),T=I&&I.constantOr(1),M=a.getCrossfadeParameters();let E,O,R,N,F;_?(O=T&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",E=y.LINES):(O=T?"fillPattern":"fill",E=y.TRIANGLES);const J=I.constantOr(null);for(const ie of o){const q=t.getTile(ie);if(T&&!q.patternsLoaded())continue;const H=q.getBucket(a);if(!H)continue;const se=H.programConfigurations.get(a.id),ae=h.useProgram(O,se),he=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ie);T&&(h.context.activeTexture.set(y.TEXTURE0),q.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),se.updatePaintBuffers(M)),pa(se,v,J,q,a);const ve=he?ie:null,ge=h.translatePosMatrix(ve?ve.posMatrix:ie.posMatrix,q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(_){N=H.indexBuffer2,F=H.segments2;const Te=[y.drawingBufferWidth,y.drawingBufferHeight];R=O==="fillOutlinePattern"&&T?Oa(ge,h,M,q,Te):Ra(ge,Te)}else N=H.indexBuffer,F=H.segments,R=T?wn(ge,h,M,q):Do(ge);ae.draw(h.context,E,c,h.stencilModeForClipping(ie),d,ei.disabled,R,he,a.id,H.layoutVertexBuffer,N,F,a.paint,h.transform.zoom,se)}}function ma(h,t,a,o,c,d,_){const y=h.context,v=y.gl,I="fill-extrusion-pattern",T=a.paint.get(I),M=T.constantOr(1),E=a.getCrossfadeParameters(),O=a.paint.get("fill-extrusion-opacity"),R=T.constantOr(null);for(const N of o){const F=t.getTile(N),J=F.getBucket(a);if(!J)continue;const ie=h.style.map.terrain&&h.style.map.terrain.getTerrainData(N),q=J.programConfigurations.get(a.id),H=h.useProgram(M?"fillExtrusionPattern":"fillExtrusion",q);M&&(h.context.activeTexture.set(v.TEXTURE0),F.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),q.updatePaintBuffers(E)),pa(q,I,R,F,a);const se=h.translatePosMatrix(N.posMatrix,F,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ae=a.paint.get("fill-extrusion-vertical-gradient"),he=M?ps(se,h,ae,O,N,E,F):bn(se,h,ae,O);H.draw(y,y.gl.TRIANGLES,c,d,_,ei.backCCW,he,ie,a.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,a.paint,h.transform.zoom,q,h.style.map.terrain&&J.centroidVertexBuffer)}}function sc(h,t,a,o,c,d,_){const y=h.context,v=y.gl,I=a.fbo;if(!I)return;const T=h.useProgram("hillshade"),M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(t);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,I.colorAttachment.get()),T.draw(y,v.TRIANGLES,c,d,_,ei.disabled,((E,O,R,N)=>{const F=R.paint.get("hillshade-shadow-color"),J=R.paint.get("hillshade-highlight-color"),ie=R.paint.get("hillshade-accent-color");let q=R.paint.get("hillshade-illumination-direction")*(Math.PI/180);R.paint.get("hillshade-illumination-anchor")==="viewport"&&(q-=E.transform.angle);const H=!E.options.moving;return{u_matrix:N?N.posMatrix:E.transform.calculatePosMatrix(O.tileID.toUnwrapped(),H),u_image:0,u_latrange:Sn(0,O.tileID),u_light:[R.paint.get("hillshade-exaggeration"),q],u_shadow:F,u_highlight:J,u_accent:ie}})(h,a,o,M?t:null),M,o.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function jn(h,t,a,o,c,d){const _=h.context,y=_.gl,v=t.dem;if(v&&v.data){const I=v.dim,T=v.stride,M=v.getPixels();if(_.activeTexture.set(y.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(T),t.demTexture){const O=t.demTexture;O.update(M,{premultiply:!1}),O.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else t.demTexture=new ft(_,M,y.RGBA,{premultiply:!1}),t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);_.activeTexture.set(y.TEXTURE0);let E=t.fbo;if(!E){const O=new ft(_,{width:I,height:I,data:null},y.RGBA);O.bind(y.LINEAR,y.CLAMP_TO_EDGE),E=t.fbo=_.createFramebuffer(I,I,!0,!1),E.colorAttachment.set(O.texture)}_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,I,I]),h.useProgram("hillshadePrepare").draw(_,y.TRIANGLES,o,c,d,ei.disabled,((O,R)=>{const N=R.stride,F=u.Z();return u.aS(F,0,u.N,-u.N,0,0,1),u.$(F,F,[0,-u.N,0]),{u_matrix:F,u_image:1,u_dimension:[N,N],u_zoom:O.overscaledZ,u_unpack:R.getUnpackVector()}})(t.tileID,v),null,a.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function ac(h,t,a,o,c,d){const _=o.paint.get("raster-fade-duration");if(!d&&_>0){const y=u.h.now(),v=(y-h.timeAdded)/_,I=t?(y-t.timeAdded)/_:-1,T=a.getSource(),M=c.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),E=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(h.tileID.overscaledZ-M),O=E&&h.refreshedUponExpiration?1:u.ad(E?v:1-I,0,1);return h.refreshedUponExpiration&&v>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const Wo=new u.aT(1,0,0,1),Qa=new u.aT(0,1,0,1),Un=new u.aT(0,0,1,1),Xo=new u.aT(1,0,1,1),Yo=new u.aT(0,1,1,1);function ga(h,t,a,o){tn(h,0,t+a/2,h.transform.width,a,o)}function en(h,t,a,o){tn(h,t-a/2,0,a,h.transform.height,o)}function tn(h,t,a,o,c,d){const _=h.context,y=_.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*h.pixelRatio,a*h.pixelRatio,o*h.pixelRatio,c*h.pixelRatio),_.clear({color:d}),y.disable(y.SCISSOR_TEST)}function Jo(h,t,a){const o=h.context,c=o.gl,d=a.posMatrix,_=h.useProgram("debug"),y=At.disabled,v=si.disabled,I=h.colorModeForRenderPass(),T="$debug",M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(a);o.activeTexture.set(c.TEXTURE0);const E=t.getTileByID(a.key).latestRawTileData,O=Math.floor((E&&E.byteLength||0)/1024),R=t.getTile(a).tileSize,N=512/Math.min(R,512)*(a.overscaledZ/h.transform.zoom)*.5;let F=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(F+=` => ${a.overscaledZ}`),function(J,ie){J.initDebugOverlayCanvas();const q=J.debugOverlayCanvas,H=J.context.gl,se=J.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,q.width,q.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(ie,5,5),se.strokeText(ie,5,5),J.debugOverlayTexture.update(q),J.debugOverlayTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE)}(h,`${F} ${O}kB`),_.draw(o,c.TRIANGLES,y,v,ri.alphaBlended,ei.disabled,ua(d,u.aT.transparent,N),null,T,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),_.draw(o,c.LINE_STRIP,y,v,I,ei.disabled,ua(d,u.aT.red),M,T,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function li(h,t,a){const o=h.context,c=o.gl,d=h.colorModeForRenderPass(),_=new At(c.LEQUAL,At.ReadWrite,h.depthRangeFor3D),y=h.useProgram("terrain"),v=t.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,h.width,h.height]);for(const I of a){const T=h.renderToTexture.getTexture(I),M=t.getTerrainData(I.tileID);o.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,T.texture);const E={u_matrix:h.transform.calculatePosMatrix(I.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(h.transform.zoom)};y.draw(o,c.TRIANGLES,_,si.disabled,d,ei.backCCW,E,M,"terrain",v.vertexBuffer,v.indexBuffer,v.segments)}}class As{constructor(t,a){this.context=new rc(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.Z(),renderTime:0},this.setup(),this.numSublayers=sr.maxUnderzooming+sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new La}resize(t,a,o){if(this.width=Math.floor(t*o),this.height=Math.floor(a*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,a=new u.a_;a.emplaceBack(0,0),a.emplaceBack(u.N,0),a.emplaceBack(0,u.N),a.emplaceBack(u.N,u.N),this.tileExtentBuffer=t.createVertexBuffer(a,Fa.members),this.tileExtentSegments=u.S.simpleSegment(0,0,4,2);const o=new u.a_;o.emplaceBack(0,0),o.emplaceBack(u.N,0),o.emplaceBack(0,u.N),o.emplaceBack(u.N,u.N),this.debugBuffer=t.createVertexBuffer(o,Fa.members),this.debugSegments=u.S.simpleSegment(0,0,4,5);const c=new u.V;c.emplaceBack(0,0,0,0),c.emplaceBack(u.N,0,u.N,0),c.emplaceBack(0,u.N,0,u.N),c.emplaceBack(u.N,u.N,u.N,u.N),this.rasterBoundsBuffer=t.createVertexBuffer(c,Ui.members),this.rasterBoundsSegments=u.S.simpleSegment(0,0,4,2);const d=new u.a_;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,Fa.members),this.viewportSegments=u.S.simpleSegment(0,0,4,2);const _=new u.a$;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(_);const y=new u.b0;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const v=this.context.gl;this.stencilClearMode=new si({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=u.Z();u.aS(o,0,this.width,this.height,0,0,1),u.a0(o,o,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,At.disabled,this.stencilClearMode,ri.disabled,ei.disabled,Lo(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const o=this.context,c=o.gl;this.nextStencilID+a.length>256&&this.clearStencil(),o.setColorMode(ri.disabled),o.setDepthMode(At.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of a){const y=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,v=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);d.draw(o,c.TRIANGLES,At.disabled,new si({func:c.ALWAYS,mask:0},y,255,c.KEEP,c.KEEP,c.REPLACE),ri.disabled,ei.disabled,Lo(_.posMatrix),v,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new si({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new si({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,o=t.sort((_,y)=>y.overscaledZ-_.overscaledZ),c=o[o.length-1].overscaledZ,d=o[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const _={};for(let y=0;y<d;y++)_[y+c]=new si({func:a.GEQUAL,mask:255},y+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=d,[_,o]}return[{[c]:si.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ri([t.CONSTANT_COLOR,t.ONE],new u.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ri.unblended:ri.alphaBlended}depthModeForSublayer(t,a,o){if(!this.opaquePassEnabledForLayer())return At.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new At(o||this.context.gl.LEQUAL,a,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.h.now()),this.imageManager.beginFrame();const o=this.style._order,c=this.style.sourceCaches,d={},_={},y={};for(const v in c){const I=c[v];I.used&&I.prepare(this.context),d[v]=I.getVisibleCoordinates(),_[v]=d[v].slice().reverse(),y[v]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let v=0;v<o.length;v++)if(this.style._layers[o[v]].is3D()){this.opaquePassCutoff=v;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||v.length)&&(u.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(I,T){const M=I.context,E=M.gl,O=ri.unblended,R=new At(E.LEQUAL,At.ReadWrite,[0,1]),N=T.getTerrainMesh(),F=T.sourceCache.getRenderableTiles(),J=I.useProgram("terrainDepth");M.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),M.clear({color:u.aT.transparent,depth:1});for(const ie of F){const q=T.getTerrainData(ie.tileID),H={u_matrix:I.transform.calculatePosMatrix(ie.tileID.toUnwrapped()),u_ele_delta:T.getMeshFrameDelta(I.transform.zoom)};J.draw(M,E.TRIANGLES,R,si.disabled,O,ei.backCCW,H,q,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain),function(I,T){const M=I.context,E=M.gl,O=ri.unblended,R=new At(E.LEQUAL,At.ReadWrite,[0,1]),N=T.getTerrainMesh(),F=T.getCoordsTexture(),J=T.sourceCache.getRenderableTiles(),ie=I.useProgram("terrainCoords");M.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),M.clear({color:u.aT.transparent,depth:1}),T.coordsIndex=[];for(const q of J){const H=T.getTerrainData(q.tileID);M.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,F.texture);const se={u_matrix:I.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(I.transform.zoom)};ie.draw(M,E.TRIANGLES,R,si.disabled,O,ei.backCCW,se,H,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),T.coordsIndex.push(q.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const v of o){const I=this.style._layers[v];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const T=_[I.source];(I.type==="custom"||T.length)&&this.renderLayer(this,c[I.source],I,T)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?u.aT.black:u.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const v=this.style._layers[o[this.currentLayer]],I=c[v.source],T=d[v.source];this._renderTileClippingMasks(v,T),this.renderLayer(this,I,v,T)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const v=this.style._layers[o[this.currentLayer]],I=c[v.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(v))continue;const T=(v.type==="symbol"?y:_)[v.source];this._renderTileClippingMasks(v,d[v.source]),this.renderLayer(this,I,v,T)}if(this.options.showTileBoundaries){const v=function(I,T){let M=null;const E=Object.values(I._layers).flatMap(F=>F.source&&!F.isHidden(T)?[I.sourceCaches[F.source]]:[]),O=E.filter(F=>F.getSource().type==="vector"),R=E.filter(F=>F.getSource().type!=="vector"),N=F=>{(!M||M.getSource().maxzoom<F.getSource().maxzoom)&&(M=F)};return O.forEach(F=>N(F)),M||R.forEach(F=>N(F)),M}(this.style,this.transform.zoom);v&&function(I,T,M){for(let E=0;E<M.length;E++)Jo(I,T,M[E])}(this,v,v.getVisibleCoordinates())}this.options.showPadding&&function(v){const I=v.transform.padding;ga(v,v.transform.height-(I.top||0),3,Wo),ga(v,I.bottom||0,3,Qa),en(v,I.left||0,3,Un),en(v,v.transform.width-(I.right||0),3,Xo);const T=v.transform.centerPoint;(function(M,E,O,R){tn(M,E-1,O-10,2,20,R),tn(M,E-10,O-1,20,2,R)})(v,T.x,v.transform.height-T.y,Yo)}(this),this.context.setDefault()}renderLayer(t,a,o,c){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(c||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(d,_,y,v,I){if(d.renderPass!=="translucent")return;const T=si.disabled,M=d.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(E,O,R,N,F,J,ie){const q=O.transform,H=F==="map",se=J==="map";for(const ae of E){const he=N.getTile(ae),ve=he.getBucket(R);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const ge=u.ah(ve.textSizeData,q.zoom),Te=X(he,1,O.transform.zoom),qe=ze(ae.posMatrix,se,H,O.transform,Te),St=R.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(ge){const De=Math.pow(2,q.zoom-he.tileID.overscaledZ);Ha(ve,H,se,ie,q,qe,ae.posMatrix,De,ge,St,O.style.map.terrain?(it,$e)=>O.style.map.terrain.getElevation(ae,it,$e):null)}}}(v,d,y,_,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),I),y.paint.get("icon-opacity").constantOr(1)!==0&&Ka(d,_,y,v,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),T,M),y.paint.get("text-opacity").constantOr(1)!==0&&Ka(d,_,y,v,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),T,M),_.map.showCollisionBoxes&&($o(d,_,y,v,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),$o(d,_,y,v,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))})(t,a,o,c,this.style.placement.variableOffsets);break;case"circle":(function(d,_,y,v){if(d.renderPass!=="translucent")return;const I=y.paint.get("circle-opacity"),T=y.paint.get("circle-stroke-width"),M=y.paint.get("circle-stroke-opacity"),E=!y.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(T.constantOr(1)===0||M.constantOr(1)===0))return;const O=d.context,R=O.gl,N=d.depthModeForSublayer(0,At.ReadOnly),F=si.disabled,J=d.colorModeForRenderPass(),ie=[];for(let q=0;q<v.length;q++){const H=v[q],se=_.getTile(H),ae=se.getBucket(y);if(!ae)continue;const he=ae.programConfigurations.get(y.id),ve=d.useProgram("circle",he),ge=ae.layoutVertexBuffer,Te=ae.indexBuffer,qe=d.style.map.terrain&&d.style.map.terrain.getTerrainData(H),St={programConfiguration:he,program:ve,layoutVertexBuffer:ge,indexBuffer:Te,uniformValues:fs(d,H,se,y),terrainData:qe};if(E){const De=ae.segments.get();for(const it of De)ie.push({segments:new u.S([it]),sortKey:it.sortKey,state:St})}else ie.push({segments:ae.segments,sortKey:0,state:St})}E&&ie.sort((q,H)=>q.sortKey-H.sortKey);for(const q of ie){const{programConfiguration:H,program:se,layoutVertexBuffer:ae,indexBuffer:he,uniformValues:ve,terrainData:ge}=q.state;se.draw(O,R.TRIANGLES,N,F,J,ei.disabled,ve,ge,y.id,ae,he,q.segments,y.paint,d.transform.zoom,H)}})(t,a,o,c);break;case"heatmap":(function(d,_,y,v){if(y.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const I=d.context,T=I.gl,M=si.disabled,E=new ri([T.ONE,T.ONE],u.aT.transparent,[!0,!0,!0,!0]);(function(O,R,N){const F=O.gl;O.activeTexture.set(F.TEXTURE1),O.viewport.set([0,0,R.width/4,R.height/4]);let J=N.heatmapFbo;if(J)F.bindTexture(F.TEXTURE_2D,J.colorAttachment.get()),O.bindFramebuffer.set(J.framebuffer);else{const ie=F.createTexture();F.bindTexture(F.TEXTURE_2D,ie),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),J=N.heatmapFbo=O.createFramebuffer(R.width/4,R.height/4,!1,!1),function(q,H,se,ae){var he,ve;const ge=q.gl,Te=(he=q.HALF_FLOAT)!==null&&he!==void 0?he:ge.UNSIGNED_BYTE,qe=(ve=q.RGBA16F)!==null&&ve!==void 0?ve:ge.RGBA;ge.texImage2D(ge.TEXTURE_2D,0,qe,H.width/4,H.height/4,0,ge.RGBA,Te,null),ae.colorAttachment.set(se)}(O,R,ie,J)}})(I,d,y),I.clear({color:u.aT.transparent});for(let O=0;O<v.length;O++){const R=v[O];if(_.hasRenderableParent(R))continue;const N=_.getTile(R),F=N.getBucket(y);if(!F)continue;const J=F.programConfigurations.get(y.id),ie=d.useProgram("heatmap",J),{zoom:q}=d.transform;ie.draw(I,T.TRIANGLES,At.disabled,M,E,ei.disabled,Yl(R.posMatrix,N,q,y.paint.get("heatmap-intensity")),null,y.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,y.paint,d.transform.zoom,J)}I.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(I,T){const M=I.context,E=M.gl,O=T.heatmapFbo;if(!O)return;M.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,O.colorAttachment.get()),M.activeTexture.set(E.TEXTURE1);let R=T.colorRampTexture;R||(R=T.colorRampTexture=new ft(M,T.colorRamp,E.RGBA)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(M,E.TRIANGLES,At.disabled,si.disabled,I.colorModeForRenderPass(),ei.disabled,((N,F,J,ie)=>{const q=u.Z();u.aS(q,0,N.width,N.height,0,0,1);const H=N.context.gl;return{u_matrix:q,u_world:[H.drawingBufferWidth,H.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}})(I,T),null,T.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,T.paint,I.transform.zoom)}(d,y))})(t,a,o,c);break;case"line":(function(d,_,y,v){if(d.renderPass!=="translucent")return;const I=y.paint.get("line-opacity"),T=y.paint.get("line-width");if(I.constantOr(1)===0||T.constantOr(1)===0)return;const M=d.depthModeForSublayer(0,At.ReadOnly),E=d.colorModeForRenderPass(),O=y.paint.get("line-dasharray"),R=y.paint.get("line-pattern"),N=R.constantOr(1),F=y.paint.get("line-gradient"),J=y.getCrossfadeParameters(),ie=N?"linePattern":O?"lineSDF":F?"lineGradient":"line",q=d.context,H=q.gl;let se=!0;for(const ae of v){const he=_.getTile(ae);if(N&&!he.patternsLoaded())continue;const ve=he.getBucket(y);if(!ve)continue;const ge=ve.programConfigurations.get(y.id),Te=d.context.program.get(),qe=d.useProgram(ie,ge),St=se||qe.program!==Te,De=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ae),it=R.constantOr(null);if(it&&he.imageAtlas){const It=he.imageAtlas,_t=It.patternPositions[it.to.toString()],Tt=It.patternPositions[it.from.toString()];_t&&Tt&&ge.setConstantPatternPositions(_t,Tt)}const $e=De?ae:null,Zt=N?Jl(d,he,y,J,$e):O?Bo(d,he,y,O,J,$e):F?Fo(d,he,y,ve.lineClipsArray.length,$e):Tn(d,he,y,$e);if(N)q.activeTexture.set(H.TEXTURE0),he.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),ge.updatePaintBuffers(J);else if(O&&(St||d.lineAtlas.dirty))q.activeTexture.set(H.TEXTURE0),d.lineAtlas.bind(q);else if(F){const It=ve.gradients[y.id];let _t=It.texture;if(y.gradientVersion!==It.version){let Tt=256;if(y.stepInterpolant){const hi=_.getSource().maxzoom,Jt=ae.canonical.z===hi?Math.ceil(1<<d.transform.maxZoom-ae.canonical.z):1;Tt=u.ad(u.aY(ve.maxLineLength/u.N*1024*Jt),256,q.maxTextureSize)}It.gradient=u.aZ({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:Tt,image:It.gradient||void 0,clips:ve.lineClipsArray}),It.texture?It.texture.update(It.gradient):It.texture=new ft(q,It.gradient,H.RGBA),It.version=y.gradientVersion,_t=It.texture}q.activeTexture.set(H.TEXTURE0),_t.bind(y.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}qe.draw(q,H.TRIANGLES,M,d.stencilModeForClipping(ae),E,ei.disabled,Zt,De,y.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,y.paint,d.transform.zoom,ge,ve.layoutVertexBuffer2),se=!1}})(t,a,o,c);break;case"fill":(function(d,_,y,v){const I=y.paint.get("fill-color"),T=y.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const M=d.colorModeForRenderPass(),E=y.paint.get("fill-pattern"),O=d.opaquePassEnabledForLayer()&&!E.constantOr(1)&&I.constantOr(u.aT.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===O){const R=d.depthModeForSublayer(1,d.renderPass==="opaque"?At.ReadWrite:At.ReadOnly);fa(d,_,y,v,R,M,!1)}if(d.renderPass==="translucent"&&y.paint.get("fill-antialias")){const R=d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,At.ReadOnly);fa(d,_,y,v,R,M,!0)}})(t,a,o,c);break;case"fill-extrusion":(function(d,_,y,v){const I=y.paint.get("fill-extrusion-opacity");if(I!==0&&d.renderPass==="translucent"){const T=new At(d.context.gl.LEQUAL,At.ReadWrite,d.depthRangeFor3D);if(I!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))ma(d,_,y,v,T,si.disabled,ri.disabled),ma(d,_,y,v,T,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const M=d.colorModeForRenderPass();ma(d,_,y,v,T,si.disabled,M)}}})(t,a,o,c);break;case"hillshade":(function(d,_,y,v){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const I=d.context,T=d.depthModeForSublayer(0,At.ReadOnly),M=d.colorModeForRenderPass(),[E,O]=d.renderPass==="translucent"?d.stencilConfigForOverlap(v):[{},v];for(const R of O){const N=_.getTile(R);N.needsHillshadePrepare!==void 0&&N.needsHillshadePrepare&&d.renderPass==="offscreen"?jn(d,N,y,T,si.disabled,M):d.renderPass==="translucent"&&sc(d,R,N,y,T,E[R.overscaledZ],M)}I.viewport.set([0,0,d.width,d.height])})(t,a,o,c);break;case"raster":(function(d,_,y,v){if(d.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!v.length)return;const I=d.context,T=I.gl,M=_.getSource(),E=d.useProgram("raster"),O=d.colorModeForRenderPass(),[R,N]=M instanceof Fi?[{},v]:d.stencilConfigForOverlap(v),F=N[N.length-1].overscaledZ,J=!d.options.moving;for(const ie of N){const q=d.depthModeForSublayer(ie.overscaledZ-F,y.paint.get("raster-opacity")===1?At.ReadWrite:At.ReadOnly,T.LESS),H=_.getTile(ie);H.registerFadeDuration(y.paint.get("raster-fade-duration"));const se=_.findLoadedParent(ie,0),ae=ac(H,se,_,y,d.transform,d.style.map.terrain);let he,ve;const ge=y.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;I.activeTexture.set(T.TEXTURE0),H.texture.bind(ge,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(T.TEXTURE1),se?(se.texture.bind(ge,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),he=Math.pow(2,se.tileID.overscaledZ-H.tileID.overscaledZ),ve=[H.tileID.canonical.x*he%1,H.tileID.canonical.y*he%1]):H.texture.bind(ge,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);const Te=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ie),qe=Te?ie:null,St=qe?qe.posMatrix:d.transform.calculatePosMatrix(ie.toUnwrapped(),J),De=Oo(St,ve||[0,0],he||1,ae,y);M instanceof Fi?E.draw(I,T.TRIANGLES,q,si.disabled,O,ei.disabled,De,Te,y.id,M.boundsBuffer,d.quadTriangleIndexBuffer,M.boundsSegments):E.draw(I,T.TRIANGLES,q,R[ie.overscaledZ],O,ei.disabled,De,Te,y.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(t,a,o,c);break;case"background":(function(d,_,y,v){const I=y.paint.get("background-color"),T=y.paint.get("background-opacity");if(T===0)return;const M=d.context,E=M.gl,O=d.transform,R=O.tileSize,N=y.paint.get("background-pattern");if(d.isPatternMissing(N))return;const F=!N&&I.a===1&&T===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==F)return;const J=si.disabled,ie=d.depthModeForSublayer(0,F==="opaque"?At.ReadWrite:At.ReadOnly),q=d.colorModeForRenderPass(),H=d.useProgram(N?"backgroundPattern":"background"),se=v||O.coveringTiles({tileSize:R,terrain:d.style.map.terrain});N&&(M.activeTexture.set(E.TEXTURE0),d.imageManager.bind(d.context));const ae=y.getCrossfadeParameters();for(const he of se){const ve=v?he.posMatrix:d.transform.calculatePosMatrix(he.toUnwrapped()),ge=N?zr(ve,T,d,N,{tileID:he,tileSize:R},ae):Na(ve,T,I),Te=d.style.map.terrain&&d.style.map.terrain.getTerrainData(he);H.draw(M,E.TRIANGLES,ie,J,q,ei.disabled,ge,Te,y.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(t,0,o,c);break;case"custom":(function(d,_,y){const v=d.context,I=y.implementation;if(d.renderPass==="offscreen"){const T=I.prerender;T&&(d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),T.call(I,v.gl,d.transform.customLayerMatrix()),v.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),v.setStencilMode(si.disabled);const T=I.renderingMode==="3d"?new At(d.context.gl.LEQUAL,At.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,At.ReadOnly);v.setDepthMode(T),I.render(v.gl,d.transform.customLayerMatrix()),v.setDirty(),d.setBaseState(),v.bindFramebuffer.set(null)}})(t,0,o)}}translatePosMatrix(t,a,o,c,d){if(!o[0]&&!o[1])return t;const _=d?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(_){const I=Math.sin(_),T=Math.cos(_);o=[o[0]*T-o[1]*I,o[0]*I+o[1]*T]}const y=[d?o[0]:X(a,o[0],this.transform.zoom),d?o[1]:X(a,o[1],this.transform.zoom),0],v=new Float32Array(16);return u.$(v,t,y),v}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!a||!o}useProgram(t,a){this.cache=this.cache||{};const o=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new Ba(this.context,ii[t],a,ja[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ft(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}class ar{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,o){const c=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const v=1/(y=u.ag([],y,t))[3]/a*c;return u.b3(y,y,[v,v,1/y[3],v])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const v=function(E,O){var R=O[0],N=O[1],F=O[2],J=R*R+N*N+F*F;return J>0&&(J=1/Math.sqrt(J)),E[0]=O[0]*J,E[1]=O[1]*J,E[2]=O[2]*J,E}([],function(E,O,R){var N=O[0],F=O[1],J=O[2],ie=R[0],q=R[1],H=R[2];return E[0]=F*H-J*q,E[1]=J*ie-N*H,E[2]=N*q-F*ie,E}([],qt([],d[y[0]],d[y[1]]),qt([],d[y[2]],d[y[1]]))),I=-((T=v)[0]*(M=d[y[1]])[0]+T[1]*M[1]+T[2]*M[2]);var T,M;return v.concat(I)});return new ar(d,_)}}class Js{constructor(t,a){this.min=t,this.max=a,this.center=function(o,c,d){return o[0]=.5*c[0],o[1]=.5*c[1],o[2]=.5*c[2],o}([],function(o,c,d){return o[0]=c[0]+d[0],o[1]=c[1]+d[1],o[2]=c[2]+d[2],o}([],this.min,this.max))}quadrant(t){const a=[t%2==0,t<2],o=Ot(this.min),c=Ot(this.max);for(let d=0;d<a.length;d++)o[d]=a[d]?this.min[d]:this.center[d],c[d]=a[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Js(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let c=0;c<t.planes.length;c++){const d=t.planes[c];let _=0;for(let y=0;y<a.length;y++)u.b4(d,a[y])>=0&&_++;if(_===0)return 0;_!==a.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const v=t.points[y][c]-this.min[c];d=Math.min(d,v),_=Math.max(_,v)}if(_<0||d>this.max[c]-this.min[c])return 0}return 1}}class _a{constructor(t=0,a=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=o,this.right=c}interpolate(t,a,o){return a.top!=null&&t.top!=null&&(this.top=u.B.number(t.top,a.top,o)),a.bottom!=null&&t.bottom!=null&&(this.bottom=u.B.number(t.bottom,a.bottom,o)),a.left!=null&&t.left!=null&&(this.left=u.B.number(t.left,a.left,o)),a.right!=null&&t.right!=null&&(this.right=u.B.number(t.right,a.right,o)),this}getCenter(t,a){const o=u.ad((this.left+t-this.right)/2,0,t),c=u.ad((this.top+a-this.bottom)/2,0,a);return new u.P(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new _a(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class rn{constructor(t,a,o,c,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=o??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _a,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new rn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-u.b5(t,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var o=new u.A(4);return u.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,c,d){var _=c[0],y=c[1],v=c[2],I=c[3],T=Math.sin(d),M=Math.cos(d);o[0]=_*M+v*T,o[1]=y*M+I*T,o[2]=_*-T+v*M,o[3]=y*-T+I*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=u.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,o){this._unmodified=!1,this._edgeInsets.interpolate(t,a,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new u.b6(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new u.P(0,0)),c=this.pointCoordinate(new u.P(this.width,0)),d=this.pointCoordinate(new u.P(this.width,this.height)),_=this.pointCoordinate(new u.P(0,this.height)),y=Math.floor(Math.min(o.x,c.x,d.x,_.x)),v=Math.floor(Math.max(o.x,c.x,d.x,_.x)),I=1;for(let T=y-I;T<=v+I;T++)T!==0&&a.push(new u.b6(T,t))}return a}coveringTiles(t){var a,o;let c=this.coveringZoomLevel(t);const d=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),y=u.U.fromLngLat(this.center),v=Math.pow(2,c),I=[v*_.x,v*_.y,0],T=[v*y.x,v*y.y,0],M=ar.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let E=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(E=c);const O=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,R=q=>({aabb:new Js([q*v,0,0],[(q+1)*v,v,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),N=[],F=[],J=c,ie=t.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let q=1;q<=3;q++)N.push(R(-q)),N.push(R(q));for(N.push(R(0));N.length>0;){const q=N.pop(),H=q.x,se=q.y;let ae=q.fullyVisible;if(!ae){const qe=q.aabb.intersects(M);if(qe===0)continue;ae=qe===2}const he=t.terrain?I:T,ve=q.aabb.distanceX(he),ge=q.aabb.distanceY(he),Te=Math.max(Math.abs(ve),Math.abs(ge));if(q.zoom===J||Te>O+(1<<J-q.zoom)-2&&q.zoom>=E){const qe=J-q.zoom,St=I[0]-.5-(H<<qe),De=I[1]-.5-(se<<qe);F.push({tileID:new u.O(q.zoom===J?ie:q.zoom,q.wrap,q.zoom,H,se),distanceSq:Pi([T[0]-.5-H,T[1]-.5-se]),tileDistanceToCamera:Math.sqrt(St*St+De*De)})}else for(let qe=0;qe<4;qe++){const St=(H<<1)+qe%2,De=(se<<1)+(qe>>1),it=q.zoom+1;let $e=q.aabb.quadrant(qe);if(t.terrain){const Zt=new u.O(it,q.wrap,it,St,De),It=t.terrain.getMinMaxElevation(Zt),_t=(a=It.minElevation)!==null&&a!==void 0?a:this.elevation,Tt=(o=It.maxElevation)!==null&&o!==void 0?o:this.elevation;$e=new Js([$e.min[0],$e.min[1],_t],[$e.max[0],$e.max[1],Tt])}N.push({aabb:$e,zoom:it,x:St,y:De,wrap:q.wrap,fullyVisible:ae})}}return F.sort((q,H)=>q.distanceSq-H.distanceSq).map(q=>q.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=u.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.P(u.G(t.lng)*this.worldSize,u.H(a)*this.worldSize)}unproject(t){return new u.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.pointLocation(this.centerPoint,t),o=t.getElevationForLngLatZoom(a,this.tileZoom);if(!(this.elevation-o))return;const c=this.getCameraPosition(),d=u.U.fromLngLat(c.lngLat,c.altitude),_=u.U.fromLngLat(a,o),y=d.x-_.x,v=d.y-_.y,I=d.z-_.z,T=Math.sqrt(y*y+v*v+I*I),M=this.scaleZoom(this.cameraToCenterDistance/T/this.tileSize);this._elevation=o,this._center=a,this.zoom=M}setLocationAtPoint(t,a){const o=this.pointCoordinate(a),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),_=new u.U(d.x-(o.x-c.x),d.y-(o.y-c.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),a.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return u.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const E=a.pointCoordinate(t);if(E!=null)return E}const o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];u.ag(o,o,this.pixelMatrixInverse),u.ag(c,c,this.pixelMatrixInverse);const d=o[3],_=c[3],y=o[1]/d,v=c[1]/_,I=o[2]/d,T=c[2]/_,M=I===T?0:(0-I)/(T-I);return new u.U(u.B.number(o[0]/d,c[0]/_,M)/this.worldSize,u.B.number(y,v,M)/this.worldSize)}coordinatePoint(t,a=0,o=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,a,1];return u.ag(c,c,o),new u.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Nt().extend(this.pointLocation(new u.P(0,t))).extend(this.pointLocation(new u.P(this.width,t))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Nt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,a=!1){const o=t.key,c=a?this._alignedPosMatrixCache:this._posMatrixCache;if(c[o])return c[o];const d=t.canonical,_=this.worldSize/this.zoomScale(d.z),y=d.x+Math.pow(2,d.z)*t.wrap,v=u.ao(new Float64Array(16));return u.$(v,v,[y*_,d.y*_,0]),u.a0(v,v,[_/u.N,_/u.N,1]),u.a1(v,a?this.alignedProjMatrix:this.projMatrix,v),c[o]=new Float32Array(v),c[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,a,o,c,d=-90,_=90,y=-180,v=180;const I=this.size,T=this._unmodified;if(this.latRange){const O=this.latRange;d=u.H(O[1])*this.worldSize,_=u.H(O[0])*this.worldSize,t=_-d<I.y?I.y/(_-d):0}if(this.lngRange){const O=this.lngRange;y=u.b5(u.G(O[0])*this.worldSize,0,this.worldSize),v=u.b5(u.G(O[1])*this.worldSize,0,this.worldSize),v<y&&(v+=this.worldSize),a=v-y<I.x?I.x/(v-y):0}const M=this.point,E=Math.max(a||0,t||0);if(E)return this.center=this.unproject(new u.P(a?(v+y)/2:M.x,t?(_+d)/2:M.y)),this.zoom+=this.scaleZoom(E),this._unmodified=T,void(this._constraining=!1);if(this.latRange){const O=M.y,R=I.y/2;O-R<d&&(c=d+R),O+R>_&&(c=_-R)}if(this.lngRange){const O=(y+v)/2,R=u.b5(M.x,O-this.worldSize/2,O+this.worldSize/2),N=I.x/2;R-N<y&&(o=y+N),R+N>v&&(o=v-N)}o===void 0&&c===void 0||(this.center=this.unproject(new u.P(o!==void 0?o:M.x,c!==void 0?c:M.y)).wrap()),this._unmodified=T,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b7(1,this.center.lat)*this.worldSize;let c=u.ao(new Float64Array(16));u.a0(c,c,[this.width/2,-this.height/2,1]),u.$(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=u.ao(new Float64Array(16)),u.a0(c,c,[1,-1,1]),u.$(c,c,[-1,-1,0]),u.a0(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this._minEleveationForCurrentTile),y=d-_*this._pixelPerMeter/Math.cos(this._pitch),v=_<0?y:d,I=Math.PI/2+this._pitch,T=this._fov*(.5+t.y/this.height),M=Math.sin(T)*v/Math.sin(u.ad(Math.PI-I-T,.01,Math.PI-.01)),E=this.getHorizon(),O=2*Math.atan(E/this.cameraToCenterDistance)*(.5+t.y/(2*E)),R=Math.sin(O)*v/Math.sin(u.ad(Math.PI-I-O,.01,Math.PI-.01)),N=Math.min(M,R),F=1.01*(Math.cos(Math.PI/2-this._pitch)*N+v),J=this.height/50;c=new Float64Array(16),u.b8(c,this._fov,this.width/this.height,J,F),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,u.a0(c,c,[1,-1,1]),u.$(c,c,[0,0,-this.cameraToCenterDistance]),u.b9(c,c,this._pitch),u.ae(c,c,this.angle),u.$(c,c,[-a,-o,0]),this.mercatorMatrix=u.a0([],c,[this.worldSize,this.worldSize,this.worldSize]),u.a0(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.a1(new Float64Array(16),this.labelPlaneMatrix,c),u.$(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=u.as([],c),this.pixelMatrix3D=u.a1(new Float64Array(16),this.labelPlaneMatrix,c);const ie=this.width%2/2,q=this.height%2/2,H=Math.cos(this.angle),se=Math.sin(this.angle),ae=a-Math.round(a)+H*ie+se*q,he=o-Math.round(o)+H*q+se*ie,ve=new Float64Array(c);if(u.$(ve,ve,[ae>.5?ae-1:ae,he>.5?he-1:he,0]),this.alignedProjMatrix=ve,c=u.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new u.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.ag(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let o=a.x,c=a.y,d=a.x,_=a.y;for(const y of t)o=Math.min(o,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),_=Math.max(_,y.y);return[new u.P(o,c),new u.P(d,c),new u.P(d,_),new u.P(o,_),new u.P(o,c)]}}}function zs(h,t){let a,o=!1,c=null,d=null;const _=()=>{c=null,o&&(h.apply(d,a),c=setTimeout(_,t),o=!1)};return(...y)=>(o=!0,d=this,a=y,c||_(),c)}class ya{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let o;return a.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(o=c)}),(o&&o[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:o,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=zs(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),_=Math.round(a.lng*d)/d,y=Math.round(a.lat*d)/d,v=this._map.getBearing(),I=this._map.getPitch();let T="";if(T+=t?`/${_}/${y}/${o}`:`${o}/${y}/${_}`,(v||I)&&(T+="/"+Math.round(10*v)/10),I&&(T+=`/${Math.round(I)}`),this._hashName){const M=this._hashName;let E=!1;const O=window.location.hash.slice(1).split("&").map(R=>{const N=R.split("=")[0];return N===M?(E=!0,`${N}=${T}`):R}).filter(R=>R);return E||O.push(`${M}=${T}`),`#${O.join("&")}`}return`#${T}`}}const Hs={linearity:.3,easing:u.ba(0,0,.3,1)},Ho=u.e({deceleration:2500,maxSpeed:1400},Hs),Ko=u.e({deceleration:20,maxSpeed:1400},Hs),Qo=u.e({deceleration:1e3,maxSpeed:360},Hs),el=u.e({deceleration:1e3,maxSpeed:90},Hs);class tl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=u.h.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)a.zoom+=d.zoomDelta||0,a.bearing+=d.bearingDelta||0,a.pitch+=d.pitchDelta||0,d.panDelta&&a.pan._add(d.panDelta),d.around&&(a.around=d.around),d.pinchAround&&(a.pinchAround=d.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(a.pan.mag()){const d=xa(a.pan.mag(),o,u.e({},Ho,t||{}));c.offset=a.pan.mult(d.amount/a.pan.mag()),c.center=this._map.transform.center,$r(c,d)}if(a.zoom){const d=xa(a.zoom,o,Ko);c.zoom=this._map.transform.zoom+d.amount,$r(c,d)}if(a.bearing){const d=xa(a.bearing,o,Qo);c.bearing=this._map.transform.bearing+u.ad(d.amount,-179,179),$r(c,d)}if(a.pitch){const d=xa(a.pitch,o,el);c.pitch=this._map.transform.pitch+d.amount,$r(c,d)}if(c.zoom||c.bearing){const d=a.pinchAround===void 0?a.around:a.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),u.e(c,{noMoveStart:!0})}}function $r(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function xa(h,t,a){const{maxSpeed:o,linearity:c,deceleration:d}=a,_=u.ad(h*c/(t/1e3),-o,o),y=Math.abs(_)/(d*c);return{easing:a.easing,duration:1e3*y,amount:_*(y/2)}}class _r extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,o,c={}){const d=Y.mousePos(a.getCanvasContainer(),o),_=a.unproject(d);super(t,u.e({point:d,lngLat:_,originalEvent:o},c)),this._defaultPrevented=!1,this.target=a}}class va extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,o){const c=t==="touchend"?o.changedTouches:o.touches,d=Y.touchPos(a.getCanvasContainer(),c),_=d.map(v=>a.unproject(v)),y=d.reduce((v,I,T,M)=>v.add(I.div(M.length)),new u.P(0,0));super(t,{points:d,point:y,lngLats:_,lngLat:a.unproject(y),originalEvent:o}),this._defaultPrevented=!1}}class il extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class rl{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new il(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new _r(t.type,this._map,t))}mouseup(t){this._map.fire(new _r(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new _r(t.type,this._map,t))}dblclick(t){return this._firePreventable(new _r(t.type,this._map,t))}mouseover(t){this._map.fire(new _r(t.type,this._map,t))}mouseout(t){this._map.fire(new _r(t.type,this._map,t))}touchstart(t){return this._firePreventable(new va(t.type,this._map,t))}touchmove(t){this._map.fire(new va(t.type,this._map,t))}touchend(t){this._map.fire(new va(t.type,this._map,t))}touchcancel(t){this._map.fire(new va(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new _r(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new _r(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _s{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(u.P.convert(t),this._map.terrain)}}class al{constructor(t,a){this._map=t,this._tr=new _s(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const o=a;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=o,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(c.x,o.x),_=Math.max(c.x,o.x),y=Math.min(c.y,o.y),v=Math.max(c.y,o.y);Y.setTransform(this._box,`translate(${d}px,${y}px)`),this._box.style.width=_-d+"px",this._box.style.height=v-y+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const o=this._startPos,c=a;if(this.reset(),Y.suppressClick(),o.x!==c.x||o.y!==c.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(o,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new u.k(t,{originalEvent:a}))}}function Er(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const a={};for(let o=0;o<h.length;o++)a[h[o].identifier]=t[o];return a}class rs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){const d=new u.P(0,0);for(const _ of c)d._add(_);return d.div(c.length)}(a),this.touches=Er(o,a)))}touchmove(t,a,o){if(this.aborted||!this.centroid)return;const c=Er(o,a);for(const d in this.touches){const _=c[d];(!_||_.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,a,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class sn{constructor(t){this.singleTap=new rs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,o){this.singleTap.touchstart(t,a,o)}touchmove(t,a,o){this.singleTap.touchmove(t,a,o)}touchend(t,a,o){const c=this.singleTap.touchend(t,a,o);if(c){const d=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(c)<30;if(d&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class ss{constructor(t){this._tr=new _s(t),this._zoomIn=new sn({numTouches:1,numTaps:2}),this._zoomOut=new sn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,o){this._zoomIn.touchstart(t,a,o),this._zoomOut.touchstart(t,a,o)}touchmove(t,a,o){this._zoomIn.touchmove(t,a,o),this._zoomOut.touchmove(t,a,o)}touchend(t,a,o){const c=this._zoomIn.touchend(t,a,o),d=this._zoomOut.touchend(t,a,o),_=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(c)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class as{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const o=this._lastPoint;if(!o)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=a.length?a[0]:a;return!this._moved&&c.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(o,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Y.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const nc={0:1,2:2};class Zn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=Y.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,o){const c=nc[o];return a.buttons===void 0||(a.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return Y.mouseButton(t)===this._eventButton}}class nl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const an=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=function(t){t.preventDefault()}},Ks=({enable:h,clickTolerance:t,bearingDegreesPerPixelMoved:a=.8})=>{const o=new Zn({checkCorrectEvent:c=>Y.mouseButton(c)===0&&c.ctrlKey||Y.mouseButton(c)===2});return new as({clickTolerance:t,move:(c,d)=>({bearingDelta:(d.x-c.x)*a}),moveStateManager:o,enable:h,assignEvents:an})},ns=({enable:h,clickTolerance:t,pitchDegreesPerPixelMoved:a=-.5})=>{const o=new Zn({checkCorrectEvent:c=>Y.mouseButton(c)===0&&c.ctrlKey||Y.mouseButton(c)===2});return new as({clickTolerance:t,move:(c,d)=>({pitchDelta:(d.y-c.y)*a}),moveStateManager:o,enable:h,assignEvents:an})};class Ne{constructor(t,a){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,a,o){return this._calculateTransform(t,a,o)}touchmove(t,a,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,a,o)}touchend(t,a,o){this._calculateTransform(t,a,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,o){o.length>0&&(this._active=!0);const c=Er(o,a),d=new u.P(0,0),_=new u.P(0,0);let y=0;for(const I in c){const T=c[I],M=this._touches[I];M&&(d._add(T),_._add(T.sub(M)),y++,c[I]=T)}if(this._touches=c,y<this._minTouches||!_.mag())return;const v=_.div(y);return this._sum._add(v),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(y),panDelta:v}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,o){if(!this._firstTwoTouches)return;t.preventDefault();const[c,d]=this._firstTwoTouches,_=ys(o,a,c),y=ys(o,a,d);if(!_||!y)return;const v=this._aroundCenter?null:_.add(y).div(2);return this._move([_,y],v,t)}touchend(t,a,o){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,_=ys(o,a,c),y=ys(o,a,d);_&&y||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ys(h,t,a){for(let o=0;o<h.length;o++)if(h[o].identifier===a)return t[o]}function Qs(h,t){return Math.log(h/t)/Math.LN2}class ol extends nn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qs(this._distance,o),pinchAround:a}}}function Be(h,t){return 180*h.angleWith(t)/Math.PI}class qn extends nn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Be(this._vector,o),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,o=Be(t,this._startVector);return Math.abs(o)<a}}function Gn(h){return Math.abs(h.y)>Math.abs(h.x)}class oc extends nn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,o){super.touchstart(t,a,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,Gn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,o){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,d=a.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const _=t.y>0==a.y>0;return Gn(t)&&Gn(a)&&_}}const $n={panStep:100,bearingStep:15,pitchStep:10};class ll{constructor(t){this._tr=new _s(t);const a=$n;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,o=0,c=0,d=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:y=>{const v=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:cl,zoom:a?Math.round(v.zoom)+a*(t.shiftKey?2:1):v.zoom,bearing:v.bearing+o*this._bearingStep,pitch:v.pitch+c*this._pitchStep,offset:[-d*this._panStep,-_*this._panStep],center:v.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cl(h){return h*(2-h)}const ul=4.000244140625;class lc{constructor(t,a){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=t,this._tr=new _s(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=u.h.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,a!==0&&a%ul==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Y.mousePos(this._el,t),o=this._tr;this._around=u.L.convert(this._aroundCenter?o.center:o.unproject(a)),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>ul?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&v!==0&&(v=1/v);const I=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(I*v))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,c=this._easing;let d,_=!1;if(this._type==="wheel"&&o&&c){const y=Math.min((u.h.now()-this._lastWheelEventTime)/200,1),v=c(y);d=u.B.number(o,a,v),y<1?this._frameId||(this._frameId=!0):_=!0}else d=a,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=u.bb;if(this._prevEase){const o=this._prevEase,c=(u.h.now()-o.start)/o.duration,d=o.easing(c+.01)-o.easing(c),_=.27/Math.sqrt(d*d+1e-4)*.01,y=Math.sqrt(.0729-_*_);a=u.ba(_,y,.25,1)}return this._prevEase={start:u.h.now(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Wn{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xn{constructor(t){this._tr=new _s(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yn{constructor(){this._tap=new sn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,o){if(!this._swipePoint)if(this._tapTime){const c=a[0],d=t.timeStamp-this._tapTime<500,_=this._tapPoint.dist(c)<30;d&&_?o.length>0&&(this._swipePoint=c,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(t,a,o)}touchmove(t,a,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const c=a[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,a,o)}touchend(t,a,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{const c=this._tap.touchend(t,a,o);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jn{constructor(t,a,o){this._el=t,this._mousePan=a,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class nr{constructor(t,a,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xs{constructor(t,a,o,c){this._el=t,this._touchZoom=a,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ba=h=>h.zoom||h.drag||h.pitch||h.rotate;class Hn extends u.k{}function wa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Kn{constructor(t,a){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=c.type==="renderFrame"?void 0:c,y={needsRenderFrame:!1},v={},I={},T=c.touches,M=T?this._getMapTouches(T):void 0,E=M?Y.touchPos(this._el,M):Y.mousePos(this._el,c);for(const{handlerName:N,handler:F,allowed:J}of this._handlers){if(!F.isEnabled())continue;let ie;this._blockedByActive(I,J,N)?F.reset():F[d||c.type]&&(ie=F[d||c.type](c,E,M),this.mergeHandlerResult(y,v,ie,N,_),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||F.isActive())&&(I[N]=F)}const O={};for(const N in this._previousActiveHandlers)I[N]||(O[N]=_);this._previousActiveHandlers=I,(Object.keys(O).length||wa(y))&&(this._changes.push([y,v,O]),this._triggerRenderFrame()),(Object.keys(I).length||wa(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tl(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,_]of this._listeners)Y.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,a,o]of this._listeners)Y.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const a=this._map,o=a.getCanvasContainer();this._add("mapEvent",new rl(a,t));const c=a.boxZoom=new al(a,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const d=new ss(a),_=new Xn(a);a.doubleClickZoom=new Wn(_,d),this._add("tapZoom",d),this._add("clickZoom",_),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const y=new Yn;this._add("tapDragZoom",y);const v=a.touchPitch=new oc(a);this._add("touchPitch",v),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const I=Ks(t),T=ns(t);a.dragRotate=new nr(t,I,T),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",T,["mouseRotate"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const M=(({enable:J,clickTolerance:ie})=>{const q=new Zn({checkCorrectEvent:H=>Y.mouseButton(H)===0&&!H.ctrlKey});return new as({clickTolerance:ie,move:(H,se)=>({around:se,panDelta:se.sub(H)}),activateOnStart:!0,moveStateManager:q,enable:J,assignEvents:an})})(t),E=new Ne(t,a);a.dragPan=new Jn(o,M,E),this._add("mousePan",M),this._add("touchPan",E,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const O=new qn,R=new ol;a.touchZoomRotate=new xs(o,R,O,y),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",R,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const N=a.scrollZoom=new lc(a,()=>this._triggerRenderFrame());this._add("scrollZoom",N,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const F=a.keyboard=new ll(a);this._add("keyboard",F),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new sl(a))}_add(t,a,o){this._handlers.push({handlerName:t,handler:a,allowed:o}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ba(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,o){for(const c in t)if(c!==o&&(!a||a.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const o of t)this._el.contains(o.target)&&a.push(o);return a}mergeHandlerResult(t,a,o,c,d){if(!o)return;u.e(t,o);const _={handlerName:c,originalEvent:o.originalEvent||d};o.zoomDelta!==void 0&&(a.zoom=_),o.panDelta!==void 0&&(a.drag=_),o.pitchDelta!==void 0&&(a.pitch=_),o.bearingDelta!==void 0&&(a.rotate=_)}_applyChanges(){const t={},a={},o={};for(const[c,d,_]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new u.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),u.e(a,d),u.e(o,_);this._updateMapTransform(t,a,o),this._changes=[]}_updateMapTransform(t,a,o){const c=this._map,d=c._getTransformForUpdate(),_=c.terrain;if(!(wa(t)||_&&this._terrainMovement))return this._fireEvents(a,o,!0);let{panDelta:y,zoomDelta:v,bearingDelta:I,pitchDelta:T,around:M,pinchAround:E}=t;E!==void 0&&(M=E),c._stop(!0),M=M||c.transform.centerPoint;const O=d.pointLocation(y?M.sub(y):M);I&&(d.bearing+=I),T&&(d.pitch+=T),v&&(d.zoom+=v),_?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(y)):d.setLocationAtPoint(O,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(O,M),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,d.recalculateZoom(c.terrain)})):d.setLocationAtPoint(O,M),c._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,o,!0)}_fireEvents(t,a,o){const c=ba(this._eventsInProgress),d=ba(t),_={};for(const T in t){const{originalEvent:M}=t[T];this._eventsInProgress[T]||(_[`${T}start`]=M),this._eventsInProgress[T]=t[T]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const T in _)this._fireEvent(T,_[T]);d&&this._fireEvent("move",d.originalEvent);for(const T in t){const{originalEvent:M}=t[T];this._fireEvent(T,M)}const y={};let v;for(const T in this._eventsInProgress){const{handlerName:M,originalEvent:E}=this._eventsInProgress[T];this._handlersById[M].isActive()||(delete this._eventsInProgress[T],v=a[M]||E,y[`${T}end`]=v)}for(const T in y)this._fireEvent(T,y[T]);const I=ba(this._eventsInProgress);if(o&&(c||d)&&!I){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=E=>E!==0&&-this._bearingSnap<E&&E<this._bearingSnap;!T||!T.essential&&u.h.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:v})),M(this._map.getBearing())&&this._map.resetNorth()):(M(T.bearing||this._map.getBearing())&&(T.bearing=0),T.freezeElevation=!0,this._map.easeTo(T,{originalEvent:v})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new u.k(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Hn("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class hl extends u.E{constructor(t,a){super(),this._renderFrameCallback=()=>{const o=Math.min((u.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,o){return t=u.P.convert(t).mult(-1),this.panTo(this.transform.center,u.e({offset:t},a),o)}panTo(t,a,o){return this.easeTo(u.e({center:t},a),o)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,o){return this.easeTo(u.e({zoom:t},a),o)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,o){return this.easeTo(u.e({bearing:t},a),o)}resetNorth(t,a){return this.rotateTo(0,u.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=Nt.convert(t);const o=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,a)}_cameraForBoxAndBearing(t,a,o,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=u.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const se=c.padding;c.padding={top:se,bottom:se,right:se,left:se}}c.padding=u.e(d,c.padding);const _=this.transform,y=_.padding,v=_.project(u.L.convert(t)),I=_.project(u.L.convert(a)),T=v.rotate(-o*Math.PI/180),M=I.rotate(-o*Math.PI/180),E=new u.P(Math.max(T.x,M.x),Math.max(T.y,M.y)),O=new u.P(Math.min(T.x,M.x),Math.min(T.y,M.y)),R=E.sub(O),N=(_.width-(y.left+y.right+c.padding.left+c.padding.right))/R.x,F=(_.height-(y.top+y.bottom+c.padding.top+c.padding.bottom))/R.y;if(F<0||N<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const J=Math.min(_.scaleZoom(_.scale*Math.min(N,F)),c.maxZoom),ie=u.P.convert(c.offset),q=new u.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(o*Math.PI/180),H=ie.add(q).mult(_.scale/_.zoomScale(J));return{center:_.unproject(v.add(I).div(2).sub(H)),zoom:J,bearing:o}}fitBounds(t,a,o){return this._fitInternal(this.cameraForBounds(t,a),a,o)}fitScreenCoordinates(t,a,o,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(t)),this.transform.pointLocation(u.P.convert(a)),o,c),c,d)}_fitInternal(t,a,o){return t?(delete(a=u.e(t,a)).padding,a.linear?this.easeTo(a,o):this.flyTo(a,o)):this}jumpTo(t,a){this.stop();const o=this._getTransformForUpdate();let c=!1,d=!1,_=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=u.L.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(d=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(_=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this._applyUpdatedTransform(o),this.fire(new u.k("movestart",a)).fire(new u.k("move",a)),c&&this.fire(new u.k("zoomstart",a)).fire(new u.k("zoom",a)).fire(new u.k("zoomend",a)),d&&this.fire(new u.k("rotatestart",a)).fire(new u.k("rotate",a)).fire(new u.k("rotateend",a)),_&&this.fire(new u.k("pitchstart",a)).fire(new u.k("pitch",a)).fire(new u.k("pitchend",a)),this.fire(new u.k("moveend",a))}calculateCameraOptionsFromTo(t,a,o,c=0){const d=u.U.fromLngLat(t,a),_=u.U.fromLngLat(o,c),y=_.x-d.x,v=_.y-d.y,I=_.z-d.z,T=Math.hypot(y,v,I);if(T===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(y,v),E=this.transform.scaleZoom(this.transform.cameraToCenterDistance/T/this.transform.tileSize),O=180*Math.atan2(y,-v)/Math.PI;let R=180*Math.acos(M/T)/Math.PI;return R=I<0?90-R:90+R,{center:_.toLngLat(),zoom:E,pitch:R,bearing:O}}easeTo(t,a){this._stop(!1,t.easeId),((t=u.e({offset:[0,0],duration:500,easing:u.bb},t)).animate===!1||!t.essential&&u.h.prefersReducedMotion)&&(t.duration=0);const o=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),_=this.getPitch(),y=this.getPadding(),v="zoom"in t?+t.zoom:c,I="bearing"in t?this._normalizeBearing(t.bearing,d):d,T="pitch"in t?+t.pitch:_,M="padding"in t?t.padding:o.padding,E=u.P.convert(t.offset);let O=o.centerPoint.add(E);const R=o.pointLocation(O),N=u.L.convert(t.center||R);this._normalizeCenter(N);const F=o.project(R),J=o.project(N).sub(F),ie=o.zoomScale(v-c);let q,H;t.around&&(q=u.L.convert(t.around),H=o.locationPoint(q));const se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||v!==c,this._rotating=this._rotating||d!==I,this._pitching=this._pitching||T!==_,this._padding=!o.isPaddingEqual(M),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,se),this.terrain&&this._prepareElevation(N),this._ease(ae=>{if(this._zooming&&(o.zoom=u.B.number(c,v,ae)),this._rotating&&(o.bearing=u.B.number(d,I,ae)),this._pitching&&(o.pitch=u.B.number(_,T,ae)),this._padding&&(o.interpolatePadding(y,M,ae),O=o.centerPoint.add(E)),this.terrain&&!t.freezeElevation&&this._updateElevation(ae),q)o.setLocationAtPoint(q,H);else{const he=o.zoomScale(o.zoom-c),ve=v>c?Math.min(2,ie):Math.max(.5,ie),ge=Math.pow(ve,1-ae),Te=o.unproject(F.add(J.mult(ae*ge)).mult(he));o.setLocationAtPoint(o.renderWorldCopies?Te.wrap():Te,O)}this._applyUpdatedTransform(o),this._fireMoveEvents(a)},ae=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,ae)},t),this}_prepareEase(t,a,o={}){this._moving=!0,a||o.moving||this.fire(new u.k("movestart",t)),this._zooming&&!o.zooming&&this.fire(new u.k("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new u.k("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new u.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const o=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(o-(a-(o*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.elevation=u.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const a=t.clone(),{center:o,zoom:c,pitch:d,bearing:_,elevation:y}=this.transformCameraUpdate(a);o&&(a.center=o),c!==void 0&&(a.zoom=c),d!==void 0&&(a.pitch=d),_!==void 0&&(a.bearing=_),y!==void 0&&(a.elevation=y),this.transform.apply(a)}_fireMoveEvents(t){this.fire(new u.k("move",t)),this._zooming&&this.fire(new u.k("zoom",t)),this._rotating&&this.fire(new u.k("rotate",t)),this._pitching&&this.fire(new u.k("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const o=this._zooming,c=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new u.k("zoomend",t)),c&&this.fire(new u.k("rotateend",t)),d&&this.fire(new u.k("pitchend",t)),this.fire(new u.k("moveend",t))}flyTo(t,a){if(!t.essential&&u.h.prefersReducedMotion){const $e=u.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo($e,a)}this.stop(),t=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.bb},t);const o=this._getTransformForUpdate(),c=this.getZoom(),d=this.getBearing(),_=this.getPitch(),y=this.getPadding(),v="zoom"in t?u.ad(+t.zoom,o.minZoom,o.maxZoom):c,I="bearing"in t?this._normalizeBearing(t.bearing,d):d,T="pitch"in t?+t.pitch:_,M="padding"in t?t.padding:o.padding,E=o.zoomScale(v-c),O=u.P.convert(t.offset);let R=o.centerPoint.add(O);const N=o.pointLocation(R),F=u.L.convert(t.center||N);this._normalizeCenter(F);const J=o.project(N),ie=o.project(F).sub(J);let q=t.curve;const H=Math.max(o.width,o.height),se=H/E,ae=ie.mag();if("minZoom"in t){const $e=u.ad(Math.min(t.minZoom,c,v),o.minZoom,o.maxZoom),Zt=H/o.zoomScale($e-c);q=Math.sqrt(Zt/ae*2)}const he=q*q;function ve($e){const Zt=(se*se-H*H+($e?-1:1)*he*he*ae*ae)/(2*($e?se:H)*he*ae);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function ge($e){return(Math.exp($e)-Math.exp(-$e))/2}function Te($e){return(Math.exp($e)+Math.exp(-$e))/2}const qe=ve(!1);let St=function($e){return Te(qe)/Te(qe+q*$e)},De=function($e){return H*((Te(qe)*(ge(Zt=qe+q*$e)/Te(Zt))-ge(qe))/he)/ae;var Zt},it=(ve(!0)-qe)/q;if(Math.abs(ae)<1e-6||!isFinite(it)){if(Math.abs(H-se)<1e-6)return this.easeTo(t,a);const $e=se<H?-1:1;it=Math.abs(Math.log(se/H))/q,De=function(){return 0},St=function(Zt){return Math.exp($e*q*Zt)}}return t.duration="duration"in t?+t.duration:1e3*it/("screenSpeed"in t?+t.screenSpeed/q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==I,this._pitching=T!==_,this._padding=!o.isPaddingEqual(M),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(F),this._ease($e=>{const Zt=$e*it,It=1/St(Zt);o.zoom=$e===1?v:c+o.scaleZoom(It),this._rotating&&(o.bearing=u.B.number(d,I,$e)),this._pitching&&(o.pitch=u.B.number(_,T,$e)),this._padding&&(o.interpolatePadding(y,M,$e),R=o.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation($e);const _t=$e===1?F:o.unproject(J.add(ie.mult(De(Zt))).mult(It));o.setLocationAtPoint(o.renderWorldCopies?_t.wrap():_t,R),this._applyUpdatedTransform(o),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,a)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,a,o){o.animate===!1||o.duration===0?(t(1),a()):(this._easeStart=u.h.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=u.b5(t,-180,180);const o=Math.abs(t-a);return Math.abs(t-360-a)<o&&(t-=360),Math.abs(t+360-a)<o&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const o=t.lng-a.center.lng;t.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(u.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class yr{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const o=this._map._getUIString(`AttributionControl.${a}`);t.title=o,t.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const a=this._map.style.sourceCaches;for(const c in a){const d=a[c];if(d.used||d.usedForTerrain){const _=d.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,d)=>c.length-d.length),t=t.filter((c,d)=>{for(let _=d+1;_<t.length;_++)if(t[_].indexOf(c)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ht{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const o=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const a=Y.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class on{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,o=a?this._queue.concat(a):this._queue;for(const c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const o of a)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Qn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var dl=u.Q([{name:"a_pos3d",type:"Int16",components:3}]);class pl extends u.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const o={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))o[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),u.aS(c.posMatrix,0,u.N,0,u.N,0,1),this._tiles[c.key]=new Je(c,this.tileSize));for(const c in this._tiles)o[c]||delete this._tiles[c]}freeRtt(t){for(const a in this._tiles){const o=this._tiles[a];(!t||o.tileID.equals(t)||o.tileID.isChildOf(t)||t.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const o of this._renderableTilesKeys){const c=this._tiles[o].tileID;if(c.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),u.aS(d.posMatrix,0,u.N,0,u.N,0,1),a[o]=d}else if(c.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const _=c.canonical.z-t.canonical.z,y=c.canonical.x-(c.canonical.x>>_<<_),v=c.canonical.y-(c.canonical.y>>_<<_),I=u.N>>_;u.aS(d.posMatrix,0,I,0,I,0,1),u.$(d.posMatrix,d.posMatrix,[-y*I,-v*I,0]),a[o]=d}else if(t.canonical.isChildOf(c.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const _=t.canonical.z-c.canonical.z,y=t.canonical.x-(t.canonical.x>>_<<_),v=t.canonical.y-(t.canonical.y>>_<<_),I=u.N>>_;u.aS(d.posMatrix,0,u.N,0,u.N,0,1),u.$(d.posMatrix,d.posMatrix,[y*I,v*I,0]),u.a0(d.posMatrix,d.posMatrix,[1/2**_,1/2**_,0]),a[o]=d}}return a}getSourceTile(t,a){const o=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>o.maxzoom&&(c=o.maxzoom),c<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&a)for(;c>=o.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(c--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=t)}}class fl{constructor(t,a,o){this.painter=t,this.sourceCache=new pl(a),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,o,c=u.N){var d;if(!(a>=0&&a<c&&o>=0&&o<c))return 0;const _=this.getTerrainData(t),y=(d=_.tile)===null||d===void 0?void 0:d.dem;if(!y)return 0;const v=function(R,N,F){var J=N[0],ie=N[1];return R[0]=F[0]*J+F[4]*ie+F[12],R[1]=F[1]*J+F[5]*ie+F[13],R}([],[a/c*u.N,o/c*u.N],_.u_terrain_matrix),I=[v[0]*y.dim,v[1]*y.dim],T=Math.floor(I[0]),M=Math.floor(I[1]),E=I[0]-T,O=I[1]-M;return y.get(T,M)*(1-E)*(1-O)+y.get(T+1,M)*E*(1-O)+y.get(T,M+1)*(1-E)*O+y.get(T+1,M+1)*E*O}getElevationForLngLatZoom(t,a){const{tileID:o,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(o,c%u.N,d%u.N,u.N)}getElevation(t,a,o,c=u.N){return this.getDEMElevation(t,a,o,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,d=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ft(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ft(c,new u.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.ao([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const c=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new ft(c,a.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),a.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const o=a&&a+a.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?d=t.canonical.z-c:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=t.canonical.x-(t.canonical.x>>d<<d),y=t.canonical.y-(t.canonical.y>>d<<d),v=u.bc(new Float64Array(16),[1/(u.N<<d),1/(u.N<<d),0]);u.$(v,v,[_*u.N,y*u.N,0]),this._demMatrixCache[t.key]={matrix:v,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,o=a.width/devicePixelRatio,c=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ft(a.context,{width:o,height:c,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ft(a.context,{width:o,height:c,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(o,c,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,o,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,_=0;d<this._coordsTextureSize;d++)for(let y=0;y<this._coordsTextureSize;y++,_+=4)a[_+0]=255&y,a[_+1]=255&d,a[_+2]=y>>8<<4|d>>8,a[_+3]=0;const o=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),c=new ft(t,o,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){const a=new Uint8Array(4),o=this.painter.context,c=o.gl;o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,a),o.bindFramebuffer.set(null);const d=a[0]+(a[2]>>4<<8),_=a[1]+((15&a[2])<<8),y=this.coordsIndex[255-a[3]],v=y&&this.sourceCache.getTileByID(y);if(!v)return null;const I=this._coordsTextureSize,T=(1<<v.tileID.canonical.z)*I;return new u.U(this._allowMercatorOverflow(t,(v.tileID.canonical.x*I+d)/T),(v.tileID.canonical.y*I+_)/T,this.getElevation(v.tileID,d,_,I))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,a=new u.bd,o=new u.b0,c=this.meshSize,d=u.N/c,_=c*c;for(let M=0;M<=c;M++)for(let E=0;E<=c;E++)a.emplaceBack(E*d,M*d,0);for(let M=0;M<_;M+=c+1)for(let E=0;E<c;E++)o.emplaceBack(E+M,c+E+M+1,c+E+M+2),o.emplaceBack(E+M,c+E+M+2,E+M+1);const y=a.length,v=y+2*(c+1);for(const M of[0,1])for(let E=0;E<=c;E++)for(const O of[0,1])a.emplaceBack(E*d,M*u.N,O);for(let M=0;M<2*c;M+=2)o.emplaceBack(v+M,v+M+1,v+M+3),o.emplaceBack(v+M,v+M+3,v+M+2),o.emplaceBack(y+M,y+M+3,y+M+1),o.emplaceBack(y+M,y+M+2,y+M+3);const I=a.length,T=I+2*(c+1);for(const M of[0,1])for(let E=0;E<=c;E++)for(const O of[0,1])a.emplaceBack(M*u.N,E*d,O);for(let M=0;M<2*c;M+=2)o.emplaceBack(I+M,I+M+1,I+M+3),o.emplaceBack(I+M,I+M+3,I+M+2),o.emplaceBack(T+M,T+M+3,T+M+1),o.emplaceBack(T+M,T+M+2,T+M+3);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(a,dl.members),segments:u.S.simpleSegment(0,0,a.length,o.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*u.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,a){var o;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(o=this.getMinMaxElevation(c).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return a&&a.dem&&(o.minElevation=a.dem.min*this.exaggeration,o.maxElevation=a.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(t,a){const o=u.U.fromLngLat(t.wrap()),c=(1<<a)*u.N,d=o.x*c,_=o.y*c,y=Math.floor(d/u.N),v=Math.floor(_/u.N);return{tileID:new u.O(a,0,a,y,v),mercatorX:d,mercatorY:_}}_allowMercatorOverflow(t,a){const o=t.x<this.painter.width/2;let c=u.bf(a);const d=this.painter.transform.center.lng;return o&&Math.sign(c)>0&&Math.sign(d)<0||!o&&Math.sign(c)<0&&Math.sign(d)>0?(c=360*Math.sign(d)+c,u.G(c)):a}}class cc{constructor(t,a,o){this._context=t,this._size=a,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new ft(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(o.texture),{id:t,fbo:a,texture:o,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Hi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ln{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new cc(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(o=>!t._layers[o].isHidden(a)),this._coordsDescendingInv={};for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const c=t.sourceCaches[o].getVisibleCoordinates();for(const d of c){const _=this.terrain.sourceCache.getTerrainCoords(d);for(const y in _)this._coordsDescendingInv[o][y]||(this._coordsDescendingInv[o][y]=[]),this._coordsDescendingInv[o][y].push(_[y])}}this._coordsDescendingInvStr={};for(const o of t._order){const c=t._layers[o],d=c.source;if(Hi[c.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const _ in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][_]=this._coordsDescendingInv[d][_].map(y=>y.key).sort().join()}}for(const o of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[c][o.tileID.key];d&&d!==o.rttCoords[c]&&(o.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const a=t.type,o=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Hi[a]&&(this._prevType&&Hi[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(Hi[this._prevType]||Hi[a]&&c){this._prevType=a;const d=this._stacks.length-1,_=this._stacks[d]||[];for(const y of this._renderableTiles){if(this.pool.isFull()&&(li(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(y),y.rtt[d]){const I=this.pool.getObjectForId(y.rtt[d].id);if(I.stamp===y.rtt[d].stamp){this.pool.useObject(I);continue}}const v=this.pool.getOrCreateFreeObject();this.pool.useObject(v),this.pool.stampObject(v),y.rtt[d]={id:v.id,stamp:v.stamp},o.context.bindFramebuffer.set(v.fbo.framebuffer),o.context.clear({color:u.aT.transparent,stencil:0}),o.currentStencilSource=void 0;for(let I=0;I<_.length;I++){const T=o.style._layers[_[I]],M=T.source?this._coordsDescendingInv[T.source][y.tileID.key]:[y.tileID];o.context.viewport.set([0,0,v.fbo.width,v.fbo.height]),o._renderTileClippingMasks(T,M),o.renderLayer(o,o.style.sourceCaches[T.source],T,M),T.source&&(y.rttCoords[T.source]=this._coordsDescendingInvStr[T.source][y.tileID.key])}}return li(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Hi[a]}return!1}}const Ye=We,tt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ia=h=>{h.touchstart=h.dragStart,h.touchmoveWindow=h.dragMove,h.touchend=h.dragEnd},eo={showCompass:!0,showZoom:!0,visualizePitch:!1};class to{constructor(t,a,o=!1){this.mousedown=_=>{this.startMouse(u.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),Y.mousePos(this.element,_)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,Y.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=Ks({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:y,bearingDegreesPerPixelMoved:v=.8})=>{const I=new nl;return new as({clickTolerance:y,move:(T,M)=>({bearingDelta:(M.x-T.x)*v}),moveStateManager:I,enable:_,assignEvents:Ia})})({clickTolerance:c,enable:!0}),this.map=t,o&&(this.mousePitch=ns({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:y,pitchDegreesPerPixelMoved:v=-.5})=>{const I=new nl;return new as({clickTolerance:y,move:(T,M)=>({pitchDelta:(M.y-T.y)*v}),moveStateManager:I,enable:_,assignEvents:Ia})})({clickTolerance:d,enable:!0})),Y.addEventListener(a,"mousedown",this.mousedown),Y.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(a,"touchcancel",this.reset)}startMouse(t,a){this.mouseRotate.dragStart(t,a),this.mousePitch&&this.mousePitch.dragStart(t,a),Y.disableDrag()}startTouch(t,a){this.touchRotate.dragStart(t,a),this.touchPitch&&this.touchPitch.dragStart(t,a),Y.disableDrag()}moveMouse(t,a){const o=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,a)||{};if(c&&o.setBearing(o.getBearing()+c),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,a)||{};d&&o.setPitch(o.getPitch()+d)}}moveTouch(t,a){const o=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,a)||{};if(c&&o.setBearing(o.getBearing()+c),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,a)||{};d&&o.setPitch(o.getPitch()+d)}}off(){const t=this.element;Y.removeEventListener(t,"mousedown",this.mousedown),Y.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let mi;function io(h,t,a){if(h=new u.L(h.lng,h.lat),t){const o=new u.L(h.lng-360,h.lat),c=new u.L(h.lng+360,h.lat),d=a.locationPoint(h).distSqr(t);a.locationPoint(o).distSqr(t)<d?h=o:a.locationPoint(c).distSqr(t)<d&&(h=c)}for(;Math.abs(h.lng-a.center.lng)>180;){const o=a.locationPoint(h);if(o.x>=0&&o.y>=0&&o.x<=a.width&&o.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const Pr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ml(h,t,a){const o=h.classList;for(const c in Pr)o.remove(`maplibregl-${a}-anchor-${c}`);o.add(`maplibregl-${a}-anchor-${t}`)}class Es extends u.E{constructor(t){if(super(),this._onKeyPress=a=>{const o=a.code,c=a.charCode||a.keyCode;o!=="Space"&&o!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=a=>{const o=a.originalEvent.target,c=this._element;this._popup&&(o===c||c.contains(o))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!o)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=io(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${Pr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),y=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*y?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=a=>{if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=u.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div"),this._element.setAttribute("aria-label","Map marker");const a=Y.createNS("http://www.w3.org/2000/svg","svg"),o=41,c=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${o}px`),a.setAttributeNS(null,"width",`${c}px`),a.setAttributeNS(null,"viewBox",`0 0 ${c} ${o}`);const d=Y.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const _=Y.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const y=Y.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const v=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of v){const ie=Y.createNS("http://www.w3.org/2000/svg","ellipse");ie.setAttributeNS(null,"opacity","0.04"),ie.setAttributeNS(null,"cx","10.5"),ie.setAttributeNS(null,"cy","5.80029008"),ie.setAttributeNS(null,"rx",J.rx),ie.setAttributeNS(null,"ry",J.ry),y.appendChild(ie)}const I=Y.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const T=Y.createNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(T);const M=Y.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const E=Y.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(E);const O=Y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");const R=Y.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(8.0, 8.0)");const N=Y.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#000000"),N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962");const F=Y.createNS("http://www.w3.org/2000/svg","circle");F.setAttributeNS(null,"fill","#FFFFFF"),F.setAttributeNS(null,"cx","5.5"),F.setAttributeNS(null,"cy","5.5"),F.setAttributeNS(null,"r","5.4999962"),R.appendChild(N),R.appendChild(F),_.appendChild(y),_.appendChild(I),_.appendChild(M),_.appendChild(O),_.appendChild(R),a.appendChild(_),a.setAttributeNS(null,"height",o*this._scale+"px"),a.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(a),this._offset=u.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),ml(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=u.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ci={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ai=0,ea=!1;const Sa={maxWidth:100,unit:"metric"};function Ta(h,t,a){const o=a&&a.maxWidth||100,c=h._container.clientHeight/2,d=h.unproject([0,c]),_=h.unproject([o,c]),y=d.distanceTo(_);if(a&&a.unit==="imperial"){const v=3.2808*y;v>5280?Ps(t,o,v/5280,h._getUIString("ScaleControl.Miles")):Ps(t,o,v,h._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Ps(t,o,y/1852,h._getUIString("ScaleControl.NauticalMiles")):y>=1e3?Ps(t,o,y/1e3,h._getUIString("ScaleControl.Kilometers")):Ps(t,o,y,h._getUIString("ScaleControl.Meters"))}function Ps(h,t,a,o){const c=function(d){const _=Math.pow(10,`${Math.floor(d)}`.length-1);let y=d/_;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(v){const I=Math.pow(10,Math.ceil(-Math.log(v)/Math.LN10));return Math.round(v*I)/I}(y),_*y}(a);h.style.width=t*(c/a)+"px",h.innerHTML=`${c}&nbsp;${o}`}const ro={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},so=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ta(h){if(h){if(typeof h=="number"){const t=Math.round(Math.abs(h)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,h),"top-left":new u.P(t,t),"top-right":new u.P(-t,t),bottom:new u.P(0,-h),"bottom-left":new u.P(t,-t),"bottom-right":new u.P(-t,-t),left:new u.P(h,0),right:new u.P(-h,0)}}if(h instanceof u.P||Array.isArray(h)){const t=u.P.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.P.convert(h.center||[0,0]),top:u.P.convert(h.top||[0,0]),"top-left":u.P.convert(h["top-left"]||[0,0]),"top-right":u.P.convert(h["top-right"]||[0,0]),bottom:u.P.convert(h.bottom||[0,0]),"bottom-left":u.P.convert(h["bottom-left"]||[0,0]),"bottom-right":u.P.convert(h["bottom-right"]||[0,0]),left:u.P.convert(h.left||[0,0]),right:u.P.convert(h.right||[0,0])}}return ta(new u.P(0,0))}const ao={extend:(h,...t)=>u.e(h,...t),run(h){h()},logToElement(h,t=!1,a="log"){const o=window.document.getElementById(a);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${h}`)}},no=We;class Rt{static get version(){return no}static get workerCount(){return Zr.workerCount}static set workerCount(t){Zr.workerCount=t}static get maxParallelImageRequests(){return u.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){u.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return u.c.WORKER_URL}static set workerUrl(t){u.c.WORKER_URL=t}static addProtocol(t,a){u.c.REGISTERED_PROTOCOLS[t]=a}static removeProtocol(t){delete u.c.REGISTERED_PROTOCOLS[t]}}return Rt.Map=class extends hl{constructor(h){if(u.bg.mark(u.bh.create),(h=u.e({},tt,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rn(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new on,this._controls=[],this._mapId=u.a2(),this._locale=u.e({},Qn,h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this._imageQueueHandle=Se.addThrottleControl(()=>this.isMoving()),this._requestManager=new st(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const a=zs(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{t?a(o):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Kn(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new ya(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,u.e({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new yr({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new Ht,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new u.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new u.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new u.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(a,o.firstChild):o.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,a,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,t,a,o)}resize(h){var t;const a=this._containerDimensions(),o=a[0],c=a[1],d=this._getClampedPixelRatio(o,c);if(this._resizeCanvas(o,c,d),this.painter.resize(o,c,d),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const v=this._getClampedPixelRatio(o,c);this._resizeCanvas(o,c,v),this.painter.resize(o,c,v)}this.transform.resize(o,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(o,c);const _=!this._moving;return _&&(this.stop(),this.fire(new u.k("movestart",h)).fire(new u.k("move",h))),this.fire(new u.k("resize",h)),_&&this.fire(new u.k("moveend",h)),this}_getClampedPixelRatio(h,t){const{0:a,1:o}=this._maxCanvasSize,c=this.getPixelRatio(),d=h*c,_=t*c;return Math.min(d>a?a/d:1,_>o?o/_:1)*c}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(Nt.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(h){return this.transform.locationPoint(u.L.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.pointLocation(u.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,t,a){if(h==="mouseenter"||h==="mouseover"){let o=!1;return{layer:t,listener:a,delegates:{mousemove:d=>{const _=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];_.length?o||(o=!0,a.call(this,new _r(h,this,d.originalEvent,{features:_}))):o=!1},mouseout:()=>{o=!1}}}}if(h==="mouseleave"||h==="mouseout"){let o=!1;return{layer:t,listener:a,delegates:{mousemove:_=>{(this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,a.call(this,new _r(h,this,_.originalEvent)))},mouseout:_=>{o&&(o=!1,a.call(this,new _r(h,this,_.originalEvent)))}}}}{const o=c=>{const d=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];d.length&&(c.features=d,a.call(this,c),delete c.features)};return{layer:t,listener:a,delegates:{[h]:o}}}}on(h,t,a){if(a===void 0)return super.on(h,t);const o=this._createDelegatedListener(h,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(o);for(const c in o.delegates)this.on(c,o.delegates[c]);return this}once(h,t,a){if(a===void 0)return super.once(h,t);const o=this._createDelegatedListener(h,t,a);for(const c in o.delegates)this.once(c,o.delegates[c]);return this}off(h,t,a){return a===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(o=>{const c=this._delegatedListeners[h];for(let d=0;d<c.length;d++){const _=c[d];if(_.layer===t&&_.listener===a){for(const y in _.delegates)this.off(y,_.delegates[y]);return c.splice(d,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let a;const o=h instanceof u.P||Array.isArray(h),c=o?h:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(o?{}:h)||{},c instanceof u.P||typeof c[0]=="number")a=[u.P.convert(c)];else{const d=u.P.convert(c[0]),_=u.P.convert(c[1]);a=[d,new u.P(_.x,d.y),_,new u.P(d.x,_.y),d]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,t));const a=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new Ri(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,t,a):this.style.loadJSON(h,t,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ri(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const a=this._requestManager.transformRequest(h,Ve.Style);u.f(a,(o,c)=>{o?this.fire(new u.j(o)):c&&this._updateDiff(c,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h,t)&&this._update(!0)}catch(a){u.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new u.j(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const t=this.style.sourceCaches[h.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);for(const a in this.style._layers){const o=this.style._layers[a];o.type==="hillshade"&&o.source===h.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fl(this.painter,t,h),this.painter.renderToTexture=new ln(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==h.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:h})),this}getTerrain(){var h,t;return(t=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const a=h[t]._tiles;for(const o in a){const c=a[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(h,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,a)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,a={}){const{pixelRatio:o=1,sdf:c=!1,stretchX:d,stretchY:_,content:y}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:v,height:I,data:T}=t,M=t;return this.style.addImage(h,{data:new u.R({width:v,height:I},new Uint8Array(T)),pixelRatio:o,stretchX:d,stretchY:_,content:y,sdf:c,version:0,userImage:M}),M.onAdd&&M.onAdd(this,h),this}}{const{width:v,height:I,data:T}=u.h.getImageData(t);this.style.addImage(h,{data:new u.R({width:v,height:I},T),pixelRatio:o,stretchX:d,stretchY:_,content:y,sdf:c,version:0})}}updateImage(h,t){const a=this.style.getImage(h);if(!a)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||u.a(t)?u.h.getImageData(t):t,{width:c,height:d,data:_}=o;if(c===void 0||d===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==a.data.width||d!==a.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(t instanceof HTMLImageElement||u.a(t));return a.data.replace(_,y),this.style.updateImage(h,a),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){Se.getImage(this._requestManager.transformRequest(h,Ve.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,t,a){return this.style.setLayerZoomRange(h,t,a),this._update(!0)}setFilter(h,t,a={}){return this.style.setFilter(h,t,a),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,a,o={}){return this.style.setPaintProperty(h,t,a,o),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,a,o={}){return this.style.setLayoutProperty(h,t,a,o),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setGlyphs(h,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,t,a,o=>{o||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,t,a=>{a||this._update(!0)}),this}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const t=this._canvasContainer=Y.create("div","maplibregl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),o=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],o);const c=this._controlContainer=Y.create("div","maplibregl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=Y.create("div",`maplibregl-ctrl-${_} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=Y.create("div","maplibregl-cooperative-gesture-screen",this._container);let h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use â + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){Y.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(h,t,a){this._canvas.width=Math.floor(a*h),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{t={requestedAttributes:h},o&&(t.statusMessage=o.statusMessage,t.type=o.type)},{once:!0});const a=this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h);if(!a){const o="Failed to initialize WebGL";throw t?(t.message=o,new Error(JSON.stringify(t))):new Error(o)}this.painter=new As(a,this.transform),pt.testSupport(a)}_onCooperativeGesture(h,t,a){return!t&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,d=u.h.now();this.style.zoomHistory.update(c,d);const _=new u.a8(c,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),y=_.crossFadingFactor();y===1&&y===this._crossFadingFactor||(a=!0,this._crossFadingFactor=y),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bg.mark(u.bh.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,u.bg.mark(u.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Se.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),u.bg.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=u.h.frame(h=>{u.bg.frame(h),this._frame=null,this._render(h)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return Ye}getCameraTargetElevation(){return this.transform.elevation}},Rt.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),o=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,a)=>{const o=this._map._getUIString(`NavigationControl.${a}`);t.title=o,t.setAttribute("aria-label",o)},this.options=u.e({},eo,h),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new to(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const a=Y.create("button",h,this._container);return a.type="button",a.addEventListener("click",t),a}},Rt.GeolocateControl=class extends u.E{constructor(h){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new u.L(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,c=this._map.getBearing(),d=u.e({bearing:c},this.options.fitBoundsOptions),_=Nt.fromLngLat(a,o);this._map.fitBounds(_,d,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new u.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ea)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Es({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Es({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")))})}},this.options=u.e({},ci,h)}onAdd(h){return this._map=h,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,a=!1){mi===void 0||a?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(o=>{mi=o.state!=="denied",t(mi)}).catch(()=>{mi=!!window.navigator.geolocation,t(mi)}):(mi=!!window.navigator.geolocation,t(mi)):t(mi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ai=0,ea=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),a=h.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),t=h.getSouthEast(),a=h.getNorthEast(),o=t.distanceTo(a),c=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ai--,ea=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ai++,ai>1?(h={maximumAge:6e5,timeout:0},ea=!0):(h=this.options.positionOptions,ea=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Rt.AttributionControl=yr,Rt.LogoControl=Ht,Rt.ScaleControl=class{constructor(h){this._onMove=()=>{Ta(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ta(this._map,this._container,this.options)},this.options=u.e({},Sa,h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Rt.FullscreenControl=class extends u.E{constructor(h={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Rt.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=h}onAdd(h){return this._map=h,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Rt.Popup=class extends u.E{constructor(h){super(),this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=io(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const a=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let o=this.options.anchor;const c=ta(this.options.offset);if(!o){const _=this._container.offsetWidth,y=this._container.offsetHeight;let v;v=a.y+c.bottom.y<y?["top"]:a.y>this._map.transform.height-y?["bottom"]:[],a.x<_/2?v.push("left"):a.x>this._map.transform.width-_/2&&v.push("right"),o=v.length===0?"bottom":v.join("-")}const d=a.add(c[o]).round();Y.setTransform(this._container,`${Pr[o]} translate(${d.x}px,${d.y}px)`),ml(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(ro),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=u.L.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),a=document.createElement("body");let o;for(a.innerHTML=h;o=a.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(so);h&&h.focus()}},Rt.Marker=Es,Rt.Style=Ri,Rt.LngLat=u.L,Rt.LngLatBounds=Nt,Rt.Point=u.P,Rt.MercatorCoordinate=u.U,Rt.Evented=u.E,Rt.AJAXError=u.bi,Rt.config=u.c,Rt.CanvasSource=je,Rt.GeoJSONSource=rr,Rt.ImageSource=Fi,Rt.RasterDEMTileSource=Ur,Rt.RasterTileSource=Tr,Rt.VectorTileSource=pr,Rt.VideoSource=le,Rt.setRTLTextPlugin=u.bj,Rt.getRTLTextPluginStatus=u.bk,Rt.prewarm=function(){Da().acquire(Lt)},Rt.clearPrewarmedResources=function(){const h=es;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Lt),es=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},ao.extend(Rt,{isSafari:u.ac,getPerformanceMetrics:u.bg.getPerformanceMetrics}),Rt});var Qe=Ie;return Qe})}(Nl)),Nl.exports}var Mf=Tf();const Vl=nd(Mf);var Cf=Pa('<link rel="stylesheet">'),kf=Pa('<div class="map svelte-17bjubn"><!></div>');function Af(Me,ne){Ao(ne,!1);const xe=sd();let pe=lt(ne,"map",12),Ie=lt(ne,"id",8,"map"),Ae=lt(ne,"location",24,()=>({lng:15,lat:45,zoom:1})),Qe=lt(ne,"style",24,()=>({version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]})),u=lt(ne,"css",8,null),We=lt(ne,"options",24,()=>({})),Y=lt(ne,"minzoom",8,0),pt=lt(ne,"maxzoom",8,14),yt=lt(ne,"controls",8,!1),_e=lt(ne,"tabbable",8,!1),rt=lt(ne,"zoom",12,null),wt=lt(ne,"center",12,null),at=lt(ne,"pitch",12,null),Se=lt(ne,"bearing",12,null),Ve=lt(ne,"interactive",8,!0),st=lt(ne,"attribution",8,!0),ht=lt(ne,"mapDescription",8,"Map"),Ot=ca(),vt={},qt=ca(!1);Zl("map",{getMap:()=>pe()});function Pi(nt=1e3){return new Promise(Dt=>setTimeout(Dt,nt))}function jt(){var nt;typeof((nt=pe())==null?void 0:nt.getZoom)=="function"&&(rt(pe().getZoom()),wt(pe().getCenter()),at(pe().getPitch()),Se(pe().getBearing()))}function Pt(){const nt=Xt(Ot).querySelector(".maplibregl-ctrl-zoom-in");nt&&(nt.setAttribute("aria-label","Zoom in on map"),nt.title="Zoom in on map");const Dt=Xt(Ot).querySelector(".maplibregl-ctrl-zoom-out");Dt&&(Dt.setAttribute("aria-label","Zoom out on map"),Dt.title="Zoom out on map")}Ae().bounds?vt.bounds=Ae().bounds:Ae().lng&&Ae().lat&&(vt.center=[+Ae().lng,+Ae().lat],Ae().zoom&&(vt.zoom=+Ae().zoom),Ae().pitch&&(vt.pitch=+Ae().pitch),Ae().bearing&&(vt.bearing=+Ae().bearing)),st()||(vt.attributionControl=!1),vt={...vt,...We()},$l(()=>{const nt=new Vl.Map({container:Xt(Ot),style:Qe(),minZoom:Y(),maxZoom:pt(),interactive:Ve(),...vt});pe(nt);const Dt=Xt(Ot).querySelector("canvas");return Dt&&(Dt.removeAttribute("role"),Dt.setAttribute("aria-label",ht())),yt()&&!Array.isArray(yt())?pe().addControl(new Vl.NavigationControl({showCompass:!1})):Array.isArray(yt())&&yt()!=["locate"]&&pe().addControl(new Vl.NavigationControl({showCompass:yt().includes("compass"),visualizePitch:yt().includes("pitch")})),Array.isArray(yt())&&yt().includes("locate")&&pe().addControl(new Vl.GeolocateControl),pe().on("load",Ii=>{jt(),jr(qt,!0),!_e()&&document.querySelector(`#${Ie()} canvas`)&&(document.querySelector(`#${Ie()} canvas`).tabIndex="-1"),Pt(),xe("load",{event:Ii})}),pe().on("moveend",jt),async()=>{await Pi(100),nt.remove()}});async function ft(nt){pe()&&(jr(qt,!1),pe().setStyle(nt),pe().once("idle",()=>{jr(qt,!0)}),xe("style",{style:nt}))}Nr(()=>yi(Qe()),()=>{ft(Qe())}),ql(),Eo();var wi=kf();uf(nt=>{var Dt=Cf();uu(()=>Yh(Dt,"href",u()?u():"https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css")),Fr(nt,Dt)});var Ct=du(wi);{var ji=nt=>{var Dt=Ul(),Ii=xn(Dt);Gl(Ii,ne,"default",{}),Fr(nt,Dt)};rd(Ct,nt=>{Xt(qt)&&nt(ji)})}pu(wi),hf(wi,nt=>jr(Ot,nt),()=>Xt(Ot)),uu(()=>Yh(wi,"id",Ie())),Fr(Me,wi),zo()}function ru(Me,ne){Ao(ne,!1);let xe=lt(ne,"id",8),pe=lt(ne,"type",8),Ie=lt(ne,"url",8,null),Ae=lt(ne,"props",28,()=>({})),Qe=lt(ne,"data",8,null),u=lt(ne,"layer",8,null),We=lt(ne,"promoteId",8,null),Y=lt(ne,"minzoom",8,null),pt=lt(ne,"maxzoom",8,null),yt=lt(ne,"tilesize",8,256),_e=ca(!1),rt=Ie();const{getMap:wt}=hu("map"),at=wt();Zl("source",{source:xe(),layer:u(),promoteId:We()}),at.getSource(xe())&&at.removeSource(xe());function Se(Pt=1e3){return new Promise(ft=>setTimeout(ft,Pt))}async function Ve(){await Se(100),at.isSourceLoaded(xe())?(jr(_e,!0),console.debug(xe()+" map source loaded!")):(console.debug("..."),Ve())}Y()&&Ae(Ae().minzoom=Y(),!0),pt()&&Ae(Ae().maxzoom=pt(),!0),u()&&We()?(Ae(Ae().promoteId={},!0),Ae(Ae().promoteId[u()]=We(),!0)):We()&&Ae(Ae().promoteId=We(),!0);function st(){console.debug(xe()+" map source loading...");let Pt;pe()=="geojson"?Qe()?Pt={type:pe(),data:Qe(),...Ae()}:Ie()&&(Pt={type:pe(),data:Ie(),...Ae()}):pe()=="vector"?Pt={type:pe(),tiles:[Ie()],...Ae()}:pe()=="raster"?Pt={type:pe(),tiles:[Ie()],tileSize:yt(),...Ae()}:pe()=="raster-dem"&&(Pt={type:pe(),tiles:[Ie()],tileSize:yt(),...Ae()}),Pt&&(at.addSource(xe(),Pt),Ve())}function ht(Pt){let ft=at.getSource(xe());ft&&ft.setData(Pt)}function Ot(Pt){if(Pt!==rt){let ft=at.getSource(xe());ft&&ft.setTiles([Pt]),rt=Pt}}function vt(Pt){Pt!==rt&&(at.getSource(xe()).tiles=[Pt],at.style.sourceCaches[xe()].clearTiles(),at.style.sourceCaches[xe()].update(at.transform),at.triggerRepaint(),rt=Pt)}$l(st),ad(async()=>{typeof(at==null?void 0:at.getSource)=="function"&&at.getSource(xe())&&(at.getStyle().layers.filter(ft=>ft.source==xe()).forEach(ft=>{at.removeLayer(ft.id)}),at.removeSource(xe()))}),Nr(()=>(yi(pe()),Xt(_e),yi(Qe())),()=>{pe()=="geojson"&&Xt(_e)&&ht(Qe())}),Nr(()=>(yi(pe()),Xt(_e),yi(Ie())),()=>{pe()=="vector"&&Xt(_e)&&Ot(Ie())}),Nr(()=>(yi(pe()),Xt(_e),yi(Ie())),()=>{pe()=="raster"&&Xt(_e)&&vt(Ie())}),ql(),Eo();var qt=Ul(),Pi=xn(qt);{var jt=Pt=>{var ft=Ul(),wi=xn(ft);Gl(wi,ne,"default",{}),Fr(Pt,ft)};rd(Pi,Pt=>{Xt(_e)&&Pt(jt)})}Fr(Me,qt),zo()}function su(Me,ne){Ao(ne,!1);const[xe,pe]=pf(),Ie=()=>df(Sr,"$hoverObj",xe),Ae=sd();let Qe=lt(ne,"id",8),u=lt(ne,"type",8),We=lt(ne,"filter",8,null),Y=lt(ne,"layout",24,()=>({})),pt=lt(ne,"paint",24,()=>({})),yt=lt(ne,"data",8,null),_e=lt(ne,"colorKey",8,"color"),rt=lt(ne,"nameKey",8,null),wt=lt(ne,"valueKey",8,null),at=lt(ne,"idKey",12,null),Se=lt(ne,"select",8,!1),Ve=lt(ne,"clickIgnore",8,!1),st=lt(ne,"clickCenter",8,!1),ht=lt(ne,"selected",12,null),Ot=lt(ne,"hover",8,!1),vt=lt(ne,"hovered",12,null),qt=lt(ne,"highlight",8,!1),Pi=lt(ne,"highlightKey",8,"highlighted"),jt=lt(ne,"highlighted",24,()=>[]),Pt=lt(ne,"order",8,null),ft=lt(ne,"maxzoom",8,null),wi=lt(ne,"minzoom",8,null),Ct=lt(ne,"sourceLayer",12,null),ji=lt(ne,"visible",8,!0);const{source:nt,layer:Dt,promoteId:Ii}=hu("source"),{getMap:Li}=hu("map"),dt=Li();Zl("layer",{layer:Qe()});const Sr=ff({id:null,feature:null,event:null});Zl("hover",Sr),at(at()?at():Ii),Ct(Ct()?Ct():Dt);let Yi=ca(null),fi=ca(null),Di=ca([]),Nt={...Y()};Y().visibility||(Nt.visibility=ji()?"visible":"none");let ui={id:Qe(),type:u(),source:nt,paint:pt(),layout:Nt};We()&&(ui.filter=We()),Ct()&&(ui["source-layer"]=Ct()),ft()&&(ui.maxzoom=ft()),wi()&&(ui.minzoom=wi()),$l(()=>{dt.getLayer(Qe())&&dt.removeLayer(Qe()),dt.addLayer(ui,Pt())});let pr=[];function Tr(me,be=_e()){console.debug("updating colors...");for(const ye of pr)dt.setFeatureState({source:nt,sourceLayer:Ct(),id:ye},{color:null,value:null});pr=[];for(const ye of me)dt.setFeatureState({source:nt,sourceLayer:Ct(),id:ye[at()]},{color:be?ye[be]:null,value:wt()?ye[wt()]:null,name:rt()?ye[rt()]:null}),pr.push(ye[at()])}function Ur(me){dt.getLayer(Qe())&&dt.setFilter(Qe(),me)}function rr(me){if(dt.getLayer(Qe()))for(const be in me)dt.setLayoutProperty(Qe(),be,me[be])}function Ui(me){if(dt.getLayer(Qe()))for(const be in me)dt.setPaintProperty(Qe(),be,me[be])}function Fi(me){!Y().visibility&&dt.getLayer(Qe())&&dt.setLayoutProperty(Qe(),"visibility",me?"visible":"none")}Se()&&dt.on("click",Qe(),me=>{if(me.features.length>0&&!Ve()){let be=me.features[0];if(ht(be.id),Ae("select",{id:ht(),feature:be,event:me}),Xt(Yi)&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:Xt(Yi)},{selected:!1}),dt.setFeatureState({source:nt,sourceLayer:Ct(),id:ht()},{selected:!0}),st()){let ye=centroid(me.features[0].toJSON().geometry);dt.flyTo({center:ye.geometry.coordinates})}jr(Yi,ht())}}),Ot()&&(dt.on("mousemove",Qe(),me=>{if(me.features.length>0){vt()&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:vt()},{hovered:!1});let be=me.features[0];vt(jr(fi,be.id)),Sr.set({id:vt(),feature:be,event:me}),Ae("hover",Ie()),dt.setFeatureState({source:nt,sourceLayer:Ct(),id:vt()},{hovered:!0}),dt.getCanvas().style.cursor="pointer"}}),dt.on("mouseleave",Qe(),me=>{vt()&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:vt()},{hovered:!1}),vt(jr(fi,null)),Sr.set({id:null,feature:null,event:me}),Ae("hover",Ie()),dt.getCanvas().style.cursor=""})),ad(async()=>{typeof(dt==null?void 0:dt.getLayer)=="function"&&dt.getLayer(Qe())&&dt.removeLayer(Qe())}),Nr(()=>(yi(yt()),yi(_e())),()=>{yt()&&Tr(yt(),_e())}),Nr(()=>yi(We()),()=>{Ur(We())}),Nr(()=>yi(Y()),()=>{rr(Y())}),Nr(()=>yi(pt()),()=>{Ui(pt())}),Nr(()=>yi(ji()),()=>{Fi(ji())}),Nr(()=>(yi(qt()),yi(jt()),Xt(Di),yi(Ct())),()=>{if(qt()&&jt()!=Xt(Di)){if(Xt(Di)[0])for(const me of Xt(Di)){let be={};be[Pi()]=!1,dt.setFeatureState({source:nt,sourceLayer:Ct(),id:me},be)}if(jr(Di,jt()),jt()[0])for(const me of jt()){let be={};be[Pi()]=!0,dt.setFeatureState({source:nt,sourceLayer:Ct(),id:me},be)}}}),Nr(()=>(yi(Se()),yi(ht()),Xt(Yi),yi(Ct())),()=>{Se()&&ht()!=Xt(Yi)&&(Xt(Yi)&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:Xt(Yi)},{selected:!1}),ht()&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:ht()},{selected:!0}),jr(Yi,ht()))}),Nr(()=>(yi(Ot()),yi(vt()),Xt(fi),yi(Ct())),()=>{Ot()&&vt()!=Xt(fi)&&(Xt(fi)&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:Xt(fi)},{hovered:!1}),vt()&&dt.setFeatureState({source:nt,sourceLayer:Ct(),id:vt()},{hovered:!0}),jr(fi,vt()))}),ql(),Eo();var le=Ul(),je=xn(le);Gl(je,ne,"default",{get hovered(){return vt()}}),Fr(Me,le),If(ne,"updateColors",Tr);var Ce=zo({updateColors:Tr});return pe(),Ce}const zf="FeatureCollection",Ef="proposed_location_shop_voronoi",Pf={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},Df=[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-1.312270660989319,51.08845450354666],[-1.290865151839772,51.0849773617534],[-1.302537145520176,51.0706360872162],[-1.307909642009294,51.0680143529846],[-1.311105554344791,51.06917824670078],[-1.323153244981856,51.076902641181306],[-1.312270660989319,51.08845450354666]]]}}],Lf={type:zf,name:Ef,crs:Pf,features:Df},Ff="FeatureCollection",Bf="all_facilities",Rf={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},Of=[{type:"Feature",properties:{name:"Olivers Battery Post Office",type:"post_office",operator:null},geometry:{type:"Point",coordinates:[-1.347579388332042,51.04787219503109]}},{type:"Feature",properties:{name:"Winchester Post Office",type:"post_office",operator:"WHSmith"},geometry:{type:"Point",coordinates:[-1.31442098830699,51.06288539504301]}},{type:"Feature",properties:{name:"Springvale Post Office",type:"post_office",operator:"Springvale Stores"},geometry:{type:"Point",coordinates:[-1.299680388278648,51.10072949507175]}},{type:"Feature",properties:{name:"Sparsholt Post Office",type:"post_office",operator:"Sparsholt Village Shop"},geometry:{type:"Point",coordinates:[-1.379123088331115,51.07866209505366]}},{type:"Feature",properties:{name:"Stoney Lane Post Office",type:"post_office",operator:null},geometry:{type:"Point",coordinates:[-1.336047688311744,51.074085795051005]}},{type:"Feature",properties:{name:"Stanmore News Food & Wine",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.328845488318338,51.055532795037216]}},{type:"Feature",properties:{name:"One Stop",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.343743788325768,51.05572449503707]}},{type:"Feature",properties:{name:"BP Shop",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.320666188315171,51.05378439503605]}},{type:"Feature",properties:{name:"One Stop",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.299648488298466,51.064831595044744]}},{type:"Feature",properties:{name:"Tesco Express",type:"shops",operator:"Tesco"},geometry:{type:"Point",coordinates:[-1.305031388280439,51.102383695072874]}},{type:"Feature",properties:{name:"Beechcroft Farm Shop",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.376432888339822,51.06033679503991]}},{type:"Feature",properties:{name:"SU Shop",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.326209288314725,51.05966119504036]}},{type:"Feature",properties:{name:"Springvale Stores",type:"shops",operator:"Premier"},geometry:{type:"Point",coordinates:[-1.299712688278641,51.10077069507176]}},{type:"Feature",properties:{name:"Spar",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.336053888311733,51.07411069505103]}},{type:"Feature",properties:{name:"Premier",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.336842488323874,51.052826695035]}},{type:"Feature",properties:{name:"Tesco Express",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.313681488306859,51.062448595042696]}},{type:"Feature",properties:{name:"Tesco Extra",type:"shops",operator:"Tesco Stores Ltd"},geometry:{type:"Point",coordinates:[-1.293609619968613,51.06831951150311]}},{type:"Feature",properties:{name:"Sainsbury's",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.340222324446314,51.04584629535454]}},{type:"Feature",properties:{name:"Waitrose",type:"shops",operator:"Waitrose & Partners"},geometry:{type:"Point",coordinates:[-1.336949891576882,51.07431054086545]}},{type:"Feature",properties:{name:"Tesco Express",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.318525982082349,51.06902732950839]}},{type:"Feature",properties:{name:"Sainsbury's",type:"shops",operator:"Sainsbury's Supermarkets Ltd"},geometry:{type:"Point",coordinates:[-1.31172107298326,51.06222129722275]}},{type:"Feature",properties:{name:"Co-op Food",type:"shops",operator:"The Southern Co-operative"},geometry:{type:"Point",coordinates:[-1.317345396622813,51.066643695452264]}},{type:"Feature",properties:{name:"Sparsholt Village Shop",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.379169405409158,51.078697094028925]}},{type:"Feature",properties:{name:"ALDI",type:"shops",operator:"Aldi Stores Limited"},geometry:{type:"Point",coordinates:[-1.337390807185855,51.07488733038854]}},{type:"Feature",properties:{name:"Tesco Express",type:"shops",operator:null},geometry:{type:"Point",coordinates:[-1.333358930269171,51.08230550161545]}},{type:"Feature",properties:{name:"Proposed Location",type:"proposed_location",operator:null},geometry:{type:"Point",coordinates:[-1.310735015875909,51.07385012619341]}}],Vf={type:Ff,name:Bf,crs:Rf,features:Of};var Nf=Pa("<!> <!> <!>",1),jf=Pa('<div class="map svelte-czikxo"><!></div>');function Uf(Me){const ne={url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/oa/v3/boundaries/{z}/{x}/{y}.pbf",layer:"boundaries",code:"areacd"},xe={path:"./style-ons-light.json"};let pe=ca(),Ie=["E00118142","E00118146","E00118156","E00118157","E00118158","E00184995","E00118144"];var Ae=jf(),Qe=du(Ae);Af(Qe,{id:"map",location:{zoom:13.4,lng:-1.3065931828408566,lat:51.07846501200899},get style(){return xe.path},controls:!0,get map(){return Xt(pe)},set map(u){jr(pe,u)},children:(u,We)=>{var Y=Nf(),pt=xn(Y);ru(pt,{id:"oaBoundaries",type:"vector",get url(){return ne.url},get layer(){return ne.layer},get promoteId(){return ne.code},maxzoom:12,minzoom:5,children:(rt,wt)=>{const at=id(()=>["in",ne.code,...Ie]);su(rt,{id:"oaBoundaries",type:"fill",get sourceLayer(){return ne.layer},minzoom:5,paint:{"fill-color":"black","fill-opacity":.2,"fill-outline-color":"rgba(0,0,0,1)"},get filter(){return Xt(at)}})},$$slots:{default:!0}});var yt=Ea(pt,2);ru(yt,{id:"shopVoronoi",type:"geojson",data:Lf,children:(rt,wt)=>{su(rt,{id:"shopVoronoi",type:"line",paint:{"line-color":"blue","line-width":2}})},$$slots:{default:!0}});var _e=Ea(yt,2);ru(_e,{id:"points",type:"geojson",data:Vf,children:(rt,wt)=>{su(rt,{id:"points",type:"circle",paint:{"circle-radius":["match",["get","type"],"post_office",5,"shops",5,7],"circle-color":["match",["get","type"],"post_office","#22d0b6","shops","#27a0cc","#f66068"],"circle-stroke-color":"#414042","circle-stroke-width":2}})},$$slots:{default:!0}}),Fr(u,Y)},$$slots:{default:!0},$$legacy:!0}),pu(Ae),Fr(Me,Ae)}var Zf=Pa('<div id="custom-profile"></div>');function qf(Me,ne){Ao(ne,!1),$l(()=>{if(window.pym)pe();else{const Ie=document.createElement("script");Ie.src="https://cdn.ons.gov.uk/vendor/pym/1.3.2/pym.min.js",Ie.onload=function(){pe()},document.body.appendChild(Ie)}function pe(){new window.pym.Parent("custom-profile","https://www.ons.gov.uk/visualisations/customprofiles/embed/#/?name=QWJib3R0cyBCYXJ0b24gQmFybiBDYXRjaG1lbnQ=&comp=RW5nbGFuZA==&tabs=W3siY29kZSI6InBvcHVsYXRpb25fbXllIiwiZGF0YSI6W3siYXJlYW5tIjoiTXlDdXN0b21BcmVhIiwiY2F0ZWdvcnkiOiJBbGwgQWdlcyIsInZhbHVlIjoxMDAsIm9yaWdpbmFsVmFsdWUiOjI0NjEsImNvdW50IjoyNTAwLCJwZXJjZW50YWdlIjoxMDB9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFsbCBBZ2VzIiwidmFsdWUiOjEwMCwib3JpZ2luYWxWYWx1ZSI6NTcxMTI1NDIsImNvdW50Ijo1NzExMjUwMCwicGVyY2VudGFnZSI6MTAwfV19LHsiY29kZSI6ImhvdXNlaG9sZHMiLCJkYXRhIjpbeyJhcmVhbm0iOiJNeUN1c3RvbUFyZWEiLCJjYXRlZ29yeSI6Ik51bWJlciBvZiBob3VzZWhvbGRzIiwidmFsdWUiOjk5MCwiY291bnQiOjk5MCwib3JpZ2luYWxWYWx1ZSI6OTg1fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJOdW1iZXIgb2YgaG91c2Vob2xkcyIsInZhbHVlIjoyMzQzNjEwMCwiY291bnQiOjIzNDM2MTAwLCJvcmlnaW5hbFZhbHVlIjoyMzQzNjA4NX1dfSx7ImNvZGUiOiJyZXNpZGVudF9hZ2VfbXllIiwiZGF0YSI6W3siYXJlYW5tIjoiTXlDdXN0b21BcmVhIiwiY2F0ZWdvcnkiOiJBZ2UgMCAtIDQiLCJ2YWx1ZSI6NS42LCJvcmlnaW5hbFZhbHVlIjoxMzksImNvdW50IjoxNDAsInBlcmNlbnRhZ2UiOjUuNn0seyJhcmVhbm0iOiJNeUN1c3RvbUFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgNS05IiwidmFsdWUiOjYuNywib3JpZ2luYWxWYWx1ZSI6MTY1LCJjb3VudCI6MTcwLCJwZXJjZW50YWdlIjo2Ljd9LHsiYXJlYW5tIjoiTXlDdXN0b21BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDEwLTE0IiwidmFsdWUiOjguMSwib3JpZ2luYWxWYWx1ZSI6MjAwLCJjb3VudCI6MjAwLCJwZXJjZW50YWdlIjo4LjF9LHsiYXJlYW5tIjoiTXlDdXN0b21BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDE1LTE5IiwidmFsdWUiOjQuNSwib3JpZ2luYWxWYWx1ZSI6MTEwLCJjb3VudCI6MTEwLCJwZXJjZW50YWdlIjo0LjV9LHsiYXJlYW5tIjoiTXlDdXN0b21BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDIwLTI0IiwidmFsdWUiOjQsIm9yaWdpbmFsVmFsdWUiOjk4LCJjb3VudCI6MTAwLCJwZXJjZW50YWdlIjo0fSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCAyNS0yOSIsInZhbHVlIjo0LjYsIm9yaWdpbmFsVmFsdWUiOjExMiwiY291bnQiOjExMCwicGVyY2VudGFnZSI6NC42fSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCAzMC0zNCIsInZhbHVlIjo2LjEsIm9yaWdpbmFsVmFsdWUiOjE1MSwiY291bnQiOjE1MCwicGVyY2VudGFnZSI6Ni4xfSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCAzNS0zOSIsInZhbHVlIjo3LjEsIm9yaWdpbmFsVmFsdWUiOjE3NCwiY291bnQiOjE3MCwicGVyY2VudGFnZSI6Ny4xfSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA0MC00NCIsInZhbHVlIjo4LjIsIm9yaWdpbmFsVmFsdWUiOjIwMiwiY291bnQiOjIwMCwicGVyY2VudGFnZSI6OC4yfSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA0NS00OSIsInZhbHVlIjo4LjMsIm9yaWdpbmFsVmFsdWUiOjIwNCwiY291bnQiOjIwMCwicGVyY2VudGFnZSI6OC4zfSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA1MC01NCIsInZhbHVlIjo2LjgsIm9yaWdpbmFsVmFsdWUiOjE2NywiY291bnQiOjE3MCwicGVyY2VudGFnZSI6Ni44fSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA1NS01OSIsInZhbHVlIjo0LjEsIm9yaWdpbmFsVmFsdWUiOjEwMSwiY291bnQiOjEwMCwicGVyY2VudGFnZSI6NC4xfSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA2MC02NCIsInZhbHVlIjo0LjYsIm9yaWdpbmFsVmFsdWUiOjExNCwiY291bnQiOjExMCwicGVyY2VudGFnZSI6NC42fSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA2NS02OSIsInZhbHVlIjo0LjIsIm9yaWdpbmFsVmFsdWUiOjEwNCwiY291bnQiOjEwMCwicGVyY2VudGFnZSI6NC4yfSx7ImFyZWFubSI6Ik15Q3VzdG9tQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA3MC03NCIsInZhbHVlIjozLjcsIm9yaWdpbmFsVmFsdWUiOjkxLCJjb3VudCI6OTAsInBlcmNlbnRhZ2UiOjMuN30seyJhcmVhbm0iOiJNeUN1c3RvbUFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgNzUtNzkiLCJ2YWx1ZSI6NC4yLCJvcmlnaW5hbFZhbHVlIjoxMDMsImNvdW50IjoxMDAsInBlcmNlbnRhZ2UiOjQuMn0seyJhcmVhbm0iOiJNeUN1c3RvbUFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgODAtODQiLCJ2YWx1ZSI6My4yLCJvcmlnaW5hbFZhbHVlIjo3OCwiY291bnQiOjgwLCJwZXJjZW50YWdlIjozLjJ9LHsiYXJlYW5tIjoiTXlDdXN0b21BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDg1KyIsInZhbHVlIjo2LCJvcmlnaW5hbFZhbHVlIjoxNDgsImNvdW50IjoxNTAsInBlcmNlbnRhZ2UiOjZ9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFnZSAwIC0gNCIsInZhbHVlIjo1LjQsIm9yaWdpbmFsVmFsdWUiOjMwNjUzNzUsImNvdW50IjozMDY1NDAwLCJwZXJjZW50YWdlIjo1LjR9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgNS05IiwidmFsdWUiOjUuOCwib3JpZ2luYWxWYWx1ZSI6MzMzNjk4OSwiY291bnQiOjMzMzcwMDAsInBlcmNlbnRhZ2UiOjUuOH0seyJhcmVhbm0iOiJDb21wYXJpc29uQXJlYSIsImNhdGVnb3J5IjoiQWdlZCAxMC0xNCIsInZhbHVlIjo2LjEsIm9yaWdpbmFsVmFsdWUiOjM0OTQyODksImNvdW50IjozNDk0MzAwLCJwZXJjZW50YWdlIjo2LjF9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgMTUtMTkiLCJ2YWx1ZSI6NS44LCJvcmlnaW5hbFZhbHVlIjozMzEwMDk2LCJjb3VudCI6MzMxMDEwMCwicGVyY2VudGFnZSI6NS44fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDIwLTI0IiwidmFsdWUiOjYsIm9yaWdpbmFsVmFsdWUiOjM0MzY1NTQsImNvdW50IjozNDM2NjAwLCJwZXJjZW50YWdlIjo2fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDI1LTI5IiwidmFsdWUiOjYuNSwib3JpZ2luYWxWYWx1ZSI6MzcyMTI3MCwiY291bnQiOjM3MjEzMDAsInBlcmNlbnRhZ2UiOjYuNX0seyJhcmVhbm0iOiJDb21wYXJpc29uQXJlYSIsImNhdGVnb3J5IjoiQWdlZCAzMC0zNCIsInZhbHVlIjo3LCJvcmlnaW5hbFZhbHVlIjozOTkyMDM1LCJjb3VudCI6Mzk5MjAwMCwicGVyY2VudGFnZSI6N30seyJhcmVhbm0iOiJDb21wYXJpc29uQXJlYSIsImNhdGVnb3J5IjoiQWdlZCAzNS0zOSIsInZhbHVlIjo2LjgsIm9yaWdpbmFsVmFsdWUiOjM4NTk5ODcsImNvdW50IjozODYwMDAwLCJwZXJjZW50YWdlIjo2Ljh9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgNDAtNDQiLCJ2YWx1ZSI6Ni41LCJvcmlnaW5hbFZhbHVlIjozNjg1ODMwLCJjb3VudCI6MzY4NTgwMCwicGVyY2VudGFnZSI6Ni41fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDQ1LTQ5IiwidmFsdWUiOjYuMSwib3JpZ2luYWxWYWx1ZSI6MzQ3OTA3NCwiY291bnQiOjM0NzkxMDAsInBlcmNlbnRhZ2UiOjYuMX0seyJhcmVhbm0iOiJDb21wYXJpc29uQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA1MC01NCIsInZhbHVlIjo2LjgsIm9yaWdpbmFsVmFsdWUiOjM4NjY1NzQsImNvdW50IjozODY2NjAwLCJwZXJjZW50YWdlIjo2Ljh9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgNTUtNTkiLCJ2YWx1ZSI6Ni43LCJvcmlnaW5hbFZhbHVlIjozODUzNjk5LCJjb3VudCI6Mzg1MzcwMCwicGVyY2VudGFnZSI6Ni43fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDYwLTY0IiwidmFsdWUiOjUuOSwib3JpZ2luYWxWYWx1ZSI6MzM4MTAxNSwiY291bnQiOjMzODEwMDAsInBlcmNlbnRhZ2UiOjUuOX0seyJhcmVhbm0iOiJDb21wYXJpc29uQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA2NS02OSIsInZhbHVlIjo0LjksIm9yaWdpbmFsVmFsdWUiOjI4MjU3NjUsImNvdW50IjoyODI1ODAwLCJwZXJjZW50YWdlIjo0Ljl9LHsiYXJlYW5tIjoiQ29tcGFyaXNvbkFyZWEiLCJjYXRlZ29yeSI6IkFnZWQgNzAtNzQiLCJ2YWx1ZSI6NC43LCJvcmlnaW5hbFZhbHVlIjoyNjU3NzIyLCJjb3VudCI6MjY1NzcwMCwicGVyY2VudGFnZSI6NC43fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDc1LTc5IiwidmFsdWUiOjQsIm9yaWdpbmFsVmFsdWUiOjIyODM3NjAsImNvdW50IjoyMjgzODAwLCJwZXJjZW50YWdlIjo0fSx7ImFyZWFubSI6IkNvbXBhcmlzb25BcmVhIiwiY2F0ZWdvcnkiOiJBZ2VkIDgwLTg0IiwidmFsdWUiOjIuNSwib3JpZ2luYWxWYWx1ZSI6MTQzNzY2MCwiY291bnQiOjE0Mzc3MDAsInBlcmNlbnRhZ2UiOjIuNX0seyJhcmVhbm0iOiJDb21wYXJpc29uQXJlYSIsImNhdGVnb3J5IjoiQWdlZCA4NSsiLCJ2YWx1ZSI6Mi41LCJvcmlnaW5hbFZhbHVlIjoxNDI0ODQ4LCJjb3VudCI6MTQyNDgwMCwicGVyY2VudGFnZSI6Mi41fV19XQ==&poly=eyJ0eXBlIjoiUG9seWdvbiIsImNvb3JkaW5hdGVzIjpbW1stMS4zMTIyNyw1MS4wODg0NV0sWy0xLjMyMzE1LDUxLjA3NjldLFstMS4zMTExMSw1MS4wNjkxOF0sWy0xLjMwNzkxLDUxLjA2ODAxXSxbLTEuMzAyNTQsNTEuMDcwNjRdLFstMS4yOTA4Nyw1MS4wODQ5OF0sWy0xLjMxMjI3LDUxLjA4ODQ1XV1dfQ==&oa=WyJFMDAxMTgxNDIiLCJFMDAxMTgxNDYiLCJFMDAxMTgxNTYiLCJFMDAxMTgxNTciLCJFMDAxMTgxNTgiLCJFMDAxODQ5OTUiLCJFMDAxMTgxNDQiXQ==&lsoa=WyJFMDEwMjMyNTMiXQ==&version=Mw==")}}),Eo();var xe=Zf();Fr(Me,xe),zo()}var au={exports:{}};/*! pym.js - v1.3.2 - 2018-02-13 */var Kh;function Gf(){return Kh||(Kh=1,function(Me){(function(ne){Me.exports?Me.exports=ne():window.pym=ne.call(this)})(function(){var ne="xPYMx",xe={},pe=function(_e){var rt=document.createEvent("Event");rt.initEvent("pym:"+_e,!0,!0),document.dispatchEvent(rt)},Ie=function(_e){var rt=new RegExp("[\\?&]"+_e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),wt=rt.exec(location.search);return wt===null?"":decodeURIComponent(wt[1].replace(/\+/g," "))},Ae=function(_e,rt){if(!(rt.xdomain!=="*"&&!_e.origin.match(new RegExp(rt.xdomain+"$")))&&typeof _e.data=="string")return!0},Qe=function(_e){var rt=/^(?:(?:https?|mailto|ftp):|[^&:/?#]*(?:[/?#]|$))/gi;if(_e.match(rt))return!0},u=function(_e,rt,wt){var at=["pym",_e,rt,wt];return at.join(ne)},We=function(_e){var rt=["pym",_e,"(\\S+)","(.*)"];return new RegExp("^"+rt.join(ne)+"$")},Y=Date.now||function(){return new Date().getTime()},pt=function(_e,rt,wt){var at,Se,Ve,st=null,ht=0;wt||(wt={});var Ot=function(){ht=wt.leading===!1?0:Y(),st=null,Ve=_e.apply(at,Se),st||(at=Se=null)};return function(){var vt=Y();!ht&&wt.leading===!1&&(ht=vt);var qt=rt-(vt-ht);return at=this,Se=arguments,qt<=0||qt>rt?(st&&(clearTimeout(st),st=null),ht=vt,Ve=_e.apply(at,Se),st||(at=Se=null)):!st&&wt.trailing!==!1&&(st=setTimeout(Ot,qt)),Ve}},yt=function(){for(var _e=xe.autoInitInstances.length,rt=_e-1;rt>=0;rt--){var wt=xe.autoInitInstances[rt];wt.el.getElementsByTagName("iframe").length&&wt.el.getElementsByTagName("iframe")[0].contentWindow||xe.autoInitInstances.splice(rt,1)}};return xe.autoInitInstances=[],xe.autoInit=function(_e){var rt=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),wt=rt.length;yt();for(var at=0;at<wt;++at){var Se=rt[at];Se.setAttribute("data-pym-auto-initialized",""),Se.id===""&&(Se.id="pym-"+at+"-"+Math.random().toString(36).substr(2,5));var Ve=Se.getAttribute("data-pym-src"),st={xdomain:"string",title:"string",name:"string",id:"string",sandbox:"string",allowfullscreen:"boolean",parenturlparam:"string",parenturlvalue:"string",optionalparams:"boolean",trackscroll:"boolean",scrollwait:"number"},ht={};for(var Ot in st)if(Se.getAttribute("data-pym-"+Ot)!==null)switch(st[Ot]){case"boolean":ht[Ot]=Se.getAttribute("data-pym-"+Ot)!=="false";break;case"string":ht[Ot]=Se.getAttribute("data-pym-"+Ot);break;case"number":var vt=Number(Se.getAttribute("data-pym-"+Ot));isNaN(vt)||(ht[Ot]=vt);break;default:console.err("unrecognized attribute type")}var qt=new xe.Parent(Se.id,Ve,ht);xe.autoInitInstances.push(qt)}return _e||pe("pym-initialized"),xe.autoInitInstances},xe.Parent=function(_e,rt,wt){this.id=_e,this.url=rt,this.el=document.getElementById(_e),this.iframe=null,this.settings={xdomain:"*",optionalparams:!0,parenturlparam:"parentUrl",parenturlvalue:window.location.href,trackscroll:!1,scrollwait:100},this.messageRegex=We(this.id),this.messageHandlers={},wt=wt||{},this._constructIframe=function(){var Se=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var Ve="",st=this.url.indexOf("#");for(st>-1&&(Ve=this.url.substring(st,this.url.length),this.url=this.url.substring(0,st)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+Se+"&childId="+this.id,this.settings.optionalparams&&(this.iframe.src+="&parentTitle="+encodeURIComponent(document.title),this.iframe.src+="&"+this.settings.parenturlparam+"="+encodeURIComponent(this.settings.parenturlvalue)),this.iframe.src+=Ve,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.settings.title&&this.iframe.setAttribute("title",this.settings.title),this.settings.allowfullscreen!==void 0&&this.settings.allowfullscreen!==!1&&this.iframe.setAttribute("allowfullscreen",""),this.settings.sandbox!==void 0&&typeof this.settings.sandbox=="string"&&this.iframe.setAttribute("sandbox",this.settings.sandbox),this.settings.id&&(document.getElementById(this.settings.id)||this.iframe.setAttribute("id",this.settings.id)),this.settings.name&&this.iframe.setAttribute("name",this.settings.name);this.el.firstChild;)this.el.removeChild(this.el.firstChild);this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize),this.settings.trackscroll&&window.addEventListener("scroll",this._throttleOnScroll)},this._onResize=(function(){this.sendWidth(),this.settings.trackscroll&&this.sendViewportAndIFramePosition()}).bind(this),this._onScroll=(function(){this.sendViewportAndIFramePosition()}).bind(this),this._fire=function(Se,Ve){if(Se in this.messageHandlers)for(var st=0;st<this.messageHandlers[Se].length;st++)this.messageHandlers[Se][st].call(this,Ve)},this.remove=function(){window.removeEventListener("message",this._processMessage),window.removeEventListener("resize",this._onResize),this.el.removeChild(this.iframe),yt()},this._processMessage=(function(Se){if(Ae(Se,this.settings)&&typeof Se.data=="string"){var Ve=Se.data.match(this.messageRegex);if(!Ve||Ve.length!==3)return!1;var st=Ve[1],ht=Ve[2];this._fire(st,ht)}}).bind(this),this._onHeightMessage=function(Se){var Ve=parseInt(Se);this.iframe.setAttribute("height",Ve+"px")},this._onNavigateToMessage=function(Se){Qe(Se)&&(document.location.href=Se)},this._onScrollToChildPosMessage=function(Se){var Ve=document.getElementById(this.id).getBoundingClientRect().top+window.pageYOffset,st=Ve+parseInt(Se);window.scrollTo(0,st)},this.onMessage=function(Se,Ve){Se in this.messageHandlers||(this.messageHandlers[Se]=[]),this.messageHandlers[Se].push(Ve)},this.sendMessage=function(Se,Ve){this.el.getElementsByTagName("iframe").length&&(this.el.getElementsByTagName("iframe")[0].contentWindow?this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(u(this.id,Se,Ve),"*"):this.remove())},this.sendWidth=function(){var Se=this.el.offsetWidth.toString();this.sendMessage("width",Se)},this.sendViewportAndIFramePosition=function(){var Se=this.iframe.getBoundingClientRect(),Ve=window.innerWidth||document.documentElement.clientWidth,st=window.innerHeight||document.documentElement.clientHeight,ht=Ve+" "+st;ht+=" "+Se.top+" "+Se.left,ht+=" "+Se.bottom+" "+Se.right,this.sendMessage("viewport-iframe-position",ht)};for(var at in wt)this.settings[at]=wt[at];return this._throttleOnScroll=pt(this._onScroll.bind(this),this.settings.scrollwait),this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),this.onMessage("scrollToChildPos",this._onScrollToChildPosMessage),this.onMessage("parentPositionInfo",this.sendViewportAndIFramePosition),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},xe.Child=function(_e){this.parentWidth=null,this.id=null,this.parentTitle=null,this.parentUrl=null,this.settings={renderCallback:null,xdomain:"*",polling:0,parenturlparam:"parentUrl"},this.timerId=null,this.messageRegex=null,this.messageHandlers={},_e=_e||{},this.onMessage=function(Se,Ve){Se in this.messageHandlers||(this.messageHandlers[Se]=[]),this.messageHandlers[Se].push(Ve)},this._fire=function(Se,Ve){if(Se in this.messageHandlers)for(var st=0;st<this.messageHandlers[Se].length;st++)this.messageHandlers[Se][st].call(this,Ve)},this._processMessage=(function(Se){if(Ae(Se,this.settings)&&typeof Se.data=="string"){var Ve=Se.data.match(this.messageRegex);if(!(!Ve||Ve.length!==3)){var st=Ve[1],ht=Ve[2];this._fire(st,ht)}}}).bind(this),this._onWidthMessage=function(Se){var Ve=parseInt(Se);Ve!==this.parentWidth&&(this.parentWidth=Ve,this.settings.renderCallback&&this.settings.renderCallback(Ve),this.sendHeight())},this.sendMessage=function(Se,Ve){window.parent.postMessage(u(this.id,Se,Ve),"*")},this.sendHeight=(function(){var Se=document.getElementsByTagName("body")[0].offsetHeight.toString();return this.sendMessage("height",Se),Se}).bind(this),this.getParentPositionInfo=function(){this.sendMessage("parentPositionInfo")},this.scrollParentTo=function(Se){this.sendMessage("navigateTo","#"+Se)},this.navigateParentTo=function(Se){this.sendMessage("navigateTo",Se)},this.scrollParentToChildEl=function(Se){var Ve=document.getElementById(Se).getBoundingClientRect().top+window.pageYOffset;this.scrollParentToChildPos(Ve)},this.scrollParentToChildPos=function(Se){this.sendMessage("scrollToChildPos",Se.toString())};var rt=function(Se){var Ve=document.getElementsByTagName("html")[0],st,ht=Ve.className;try{window.self!==window.top?st="embedded":st="not-embedded"}catch{st="embedded"}ht.indexOf(st)<0&&(Ve.className=ht?ht+" "+st:st,Se&&Se(st),pe("marked-embedded"))};this.remove=function(){window.removeEventListener("message",this._processMessage),this.timerId&&clearInterval(this.timerId)};for(var wt in _e)this.settings[wt]=_e[wt];this.id=Ie("childId")||_e.id,this.messageRegex=new RegExp("^pym"+ne+this.id+ne+"(\\S+)"+ne+"(.*)$");var at=parseInt(Ie("initialWidth"));return this.parentUrl=Ie(this.settings.parenturlparam),this.parentTitle=Ie("parentTitle"),this.onMessage("width",this._onWidthMessage),window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&this.settings.renderCallback(at),this.sendHeight(),this.settings.polling&&(this.timerId=window.setInterval(this.sendHeight,this.settings.polling)),rt(_e.onMarkedEmbeddedStatus),this},typeof document<"u"&&xe.autoInit(!0),xe})}(au)),au.exports}Gf();var nu,Qh;function $f(){if(Qh)return nu;Qh=1,nu={rgb2hsl:Me,rgb2hsv:ne,rgb2hwb:xe,rgb2cmyk:pe,rgb2keyword:Ie,rgb2xyz:Ae,rgb2lab:Qe,rgb2lch:u,hsl2rgb:We,hsl2hsv:Y,hsl2hwb:pt,hsl2cmyk:yt,hsl2keyword:_e,hsv2rgb:rt,hsv2hsl:wt,hsv2hwb:at,hsv2cmyk:Se,hsv2keyword:Ve,hwb2rgb:st,hwb2hsl:ht,hwb2hsv:Ot,hwb2cmyk:vt,hwb2keyword:qt,cmyk2rgb:Pi,cmyk2hsl:jt,cmyk2hsv:Pt,cmyk2hwb:ft,cmyk2keyword:wi,keyword2rgb:fi,keyword2hsl:Di,keyword2hsv:Nt,keyword2hwb:ui,keyword2cmyk:pr,keyword2lab:Tr,keyword2xyz:Ur,xyz2rgb:Ct,xyz2lab:ji,xyz2lch:nt,lab2xyz:Dt,lab2rgb:Li,lab2lch:Ii,lch2lab:dt,lch2xyz:Sr,lch2rgb:Yi};function Me(le){var je=le[0]/255,Ce=le[1]/255,me=le[2]/255,be=Math.min(je,Ce,me),ye=Math.max(je,Ce,me),Oe=ye-be,Je,mt,oe;return ye==be?Je=0:je==ye?Je=(Ce-me)/Oe:Ce==ye?Je=2+(me-je)/Oe:me==ye&&(Je=4+(je-Ce)/Oe),Je=Math.min(Je*60,360),Je<0&&(Je+=360),oe=(be+ye)/2,ye==be?mt=0:oe<=.5?mt=Oe/(ye+be):mt=Oe/(2-ye-be),[Je,mt*100,oe*100]}function ne(le){var je=le[0],Ce=le[1],me=le[2],be=Math.min(je,Ce,me),ye=Math.max(je,Ce,me),Oe=ye-be,Je,mt,oe;return ye==0?mt=0:mt=Oe/ye*1e3/10,ye==be?Je=0:je==ye?Je=(Ce-me)/Oe:Ce==ye?Je=2+(me-je)/Oe:me==ye&&(Je=4+(je-Ce)/Oe),Je=Math.min(Je*60,360),Je<0&&(Je+=360),oe=ye/255*1e3/10,[Je,mt,oe]}function xe(le){var je=le[0],Ce=le[1],ye=le[2],me=Me(le)[0],be=1/255*Math.min(je,Math.min(Ce,ye)),ye=1-1/255*Math.max(je,Math.max(Ce,ye));return[me,be*100,ye*100]}function pe(le){var je=le[0]/255,Ce=le[1]/255,me=le[2]/255,be,ye,Oe,Je;return Je=Math.min(1-je,1-Ce,1-me),be=(1-je-Je)/(1-Je)||0,ye=(1-Ce-Je)/(1-Je)||0,Oe=(1-me-Je)/(1-Je)||0,[be*100,ye*100,Oe*100,Je*100]}function Ie(le){return Ui[JSON.stringify(le)]}function Ae(le){var je=le[0]/255,Ce=le[1]/255,me=le[2]/255;je=je>.04045?Math.pow((je+.055)/1.055,2.4):je/12.92,Ce=Ce>.04045?Math.pow((Ce+.055)/1.055,2.4):Ce/12.92,me=me>.04045?Math.pow((me+.055)/1.055,2.4):me/12.92;var be=je*.4124+Ce*.3576+me*.1805,ye=je*.2126+Ce*.7152+me*.0722,Oe=je*.0193+Ce*.1192+me*.9505;return[be*100,ye*100,Oe*100]}function Qe(le){var je=Ae(le),Ce=je[0],me=je[1],be=je[2],ye,Oe,Je;return Ce/=95.047,me/=100,be/=108.883,Ce=Ce>.008856?Math.pow(Ce,1/3):7.787*Ce+16/116,me=me>.008856?Math.pow(me,1/3):7.787*me+16/116,be=be>.008856?Math.pow(be,1/3):7.787*be+16/116,ye=116*me-16,Oe=500*(Ce-me),Je=200*(me-be),[ye,Oe,Je]}function u(le){return Ii(Qe(le))}function We(le){var je=le[0]/360,Ce=le[1]/100,me=le[2]/100,be,ye,Oe,Je,mt;if(Ce==0)return mt=me*255,[mt,mt,mt];me<.5?ye=me*(1+Ce):ye=me+Ce-me*Ce,be=2*me-ye,Je=[0,0,0];for(var oe=0;oe<3;oe++)Oe=je+1/3*-(oe-1),Oe<0&&Oe++,Oe>1&&Oe--,6*Oe<1?mt=be+(ye-be)*6*Oe:2*Oe<1?mt=ye:3*Oe<2?mt=be+(ye-be)*(2/3-Oe)*6:mt=be,Je[oe]=mt*255;return Je}function Y(le){var je=le[0],Ce=le[1]/100,me=le[2]/100,be,ye;return me===0?[0,0,0]:(me*=2,Ce*=me<=1?me:2-me,ye=(me+Ce)/2,be=2*Ce/(me+Ce),[je,be*100,ye*100])}function pt(le){return xe(We(le))}function yt(le){return pe(We(le))}function _e(le){return Ie(We(le))}function rt(le){var je=le[0]/60,Ce=le[1]/100,mt=le[2]/100,me=Math.floor(je)%6,be=je-Math.floor(je),ye=255*mt*(1-Ce),Oe=255*mt*(1-Ce*be),Je=255*mt*(1-Ce*(1-be)),mt=255*mt;switch(me){case 0:return[mt,Je,ye];case 1:return[Oe,mt,ye];case 2:return[ye,mt,Je];case 3:return[ye,Oe,mt];case 4:return[Je,ye,mt];case 5:return[mt,ye,Oe]}}function wt(le){var je=le[0],Ce=le[1]/100,me=le[2]/100,be,ye;return ye=(2-Ce)*me,be=Ce*me,be/=ye<=1?ye:2-ye,be=be||0,ye/=2,[je,be*100,ye*100]}function at(le){return xe(rt(le))}function Se(le){return pe(rt(le))}function Ve(le){return Ie(rt(le))}function st(le){var je=le[0]/360,Ce=le[1]/100,me=le[2]/100,be=Ce+me,ye,Oe,Je,mt;switch(be>1&&(Ce/=be,me/=be),ye=Math.floor(6*je),Oe=1-me,Je=6*je-ye,(ye&1)!=0&&(Je=1-Je),mt=Ce+Je*(Oe-Ce),ye){default:case 6:case 0:r=Oe,g=mt,b=Ce;break;case 1:r=mt,g=Oe,b=Ce;break;case 2:r=Ce,g=Oe,b=mt;break;case 3:r=Ce,g=mt,b=Oe;break;case 4:r=mt,g=Ce,b=Oe;break;case 5:r=Oe,g=Ce,b=mt;break}return[r*255,g*255,b*255]}function ht(le){return Me(st(le))}function Ot(le){return ne(st(le))}function vt(le){return pe(st(le))}function qt(le){return Ie(st(le))}function Pi(le){var je=le[0]/100,Ce=le[1]/100,me=le[2]/100,be=le[3]/100,ye,Oe,Je;return ye=1-Math.min(1,je*(1-be)+be),Oe=1-Math.min(1,Ce*(1-be)+be),Je=1-Math.min(1,me*(1-be)+be),[ye*255,Oe*255,Je*255]}function jt(le){return Me(Pi(le))}function Pt(le){return ne(Pi(le))}function ft(le){return xe(Pi(le))}function wi(le){return Ie(Pi(le))}function Ct(le){var je=le[0]/100,Ce=le[1]/100,me=le[2]/100,be,ye,Oe;return be=je*3.2406+Ce*-1.5372+me*-.4986,ye=je*-.9689+Ce*1.8758+me*.0415,Oe=je*.0557+Ce*-.204+me*1.057,be=be>.0031308?1.055*Math.pow(be,1/2.4)-.055:be=be*12.92,ye=ye>.0031308?1.055*Math.pow(ye,1/2.4)-.055:ye=ye*12.92,Oe=Oe>.0031308?1.055*Math.pow(Oe,1/2.4)-.055:Oe=Oe*12.92,be=Math.min(Math.max(0,be),1),ye=Math.min(Math.max(0,ye),1),Oe=Math.min(Math.max(0,Oe),1),[be*255,ye*255,Oe*255]}function ji(le){var je=le[0],Ce=le[1],me=le[2],be,ye,Oe;return je/=95.047,Ce/=100,me/=108.883,je=je>.008856?Math.pow(je,1/3):7.787*je+16/116,Ce=Ce>.008856?Math.pow(Ce,1/3):7.787*Ce+16/116,me=me>.008856?Math.pow(me,1/3):7.787*me+16/116,be=116*Ce-16,ye=500*(je-Ce),Oe=200*(Ce-me),[be,ye,Oe]}function nt(le){return Ii(ji(le))}function Dt(le){var je=le[0],Ce=le[1],me=le[2],be,ye,Oe,Je;return je<=8?(ye=je*100/903.3,Je=7.787*(ye/100)+16/116):(ye=100*Math.pow((je+16)/116,3),Je=Math.pow(ye/100,1/3)),be=be/95.047<=.008856?be=95.047*(Ce/500+Je-16/116)/7.787:95.047*Math.pow(Ce/500+Je,3),Oe=Oe/108.883<=.008859?Oe=108.883*(Je-me/200-16/116)/7.787:108.883*Math.pow(Je-me/200,3),[be,ye,Oe]}function Ii(le){var je=le[0],Ce=le[1],me=le[2],be,ye,Oe;return be=Math.atan2(me,Ce),ye=be*360/2/Math.PI,ye<0&&(ye+=360),Oe=Math.sqrt(Ce*Ce+me*me),[je,Oe,ye]}function Li(le){return Ct(Dt(le))}function dt(le){var je=le[0],Ce=le[1],me=le[2],be,ye,Oe;return Oe=me/360*2*Math.PI,be=Ce*Math.cos(Oe),ye=Ce*Math.sin(Oe),[je,be,ye]}function Sr(le){return Dt(dt(le))}function Yi(le){return Li(dt(le))}function fi(le){return rr[le]}function Di(le){return Me(fi(le))}function Nt(le){return ne(fi(le))}function ui(le){return xe(fi(le))}function pr(le){return pe(fi(le))}function Tr(le){return Qe(fi(le))}function Ur(le){return Ae(fi(le))}var rr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ui={};for(var Fi in rr)Ui[JSON.stringify(rr[Fi])]=Fi;return nu}var ou,ed;function Wf(){if(ed)return ou;ed=1;var Me=$f(),ne=function(){return new Qe};for(var xe in Me){ne[xe+"Raw"]=function(u){return function(We){return typeof We=="number"&&(We=Array.prototype.slice.call(arguments)),Me[u](We)}}(xe);var pe=/(\w+)2(\w+)/.exec(xe),Ie=pe[1],Ae=pe[2];ne[Ie]=ne[Ie]||{},ne[Ie][Ae]=ne[xe]=function(u){return function(We){typeof We=="number"&&(We=Array.prototype.slice.call(arguments));var Y=Me[u](We);if(typeof Y=="string"||Y===void 0)return Y;for(var pt=0;pt<Y.length;pt++)Y[pt]=Math.round(Y[pt]);return Y}}(xe)}var Qe=function(){this.convs={}};return Qe.prototype.routeSpace=function(u,We){var Y=We[0];return Y===void 0?this.getValues(u):(typeof Y=="number"&&(Y=Array.prototype.slice.call(We)),this.setValues(u,Y))},Qe.prototype.setValues=function(u,We){return this.space=u,this.convs={},this.convs[u]=We,this},Qe.prototype.getValues=function(u){var We=this.convs[u];if(!We){var Y=this.space,pt=this.convs[Y];We=ne[Y][u](pt),this.convs[u]=We}return We},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(u){Qe.prototype[u]=function(We){return this.routeSpace(u,arguments)}}),ou=ne,ou}var lu,td;function Xf(){if(td)return lu;td=1;var Me=Wf();return lu=function(ne){var xe,pe,Ie,Ae;if(xe=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(ne)){var Qe=xe[1],u=Qe.replace(/a$/,""),We=u==="cmyk"?4:3;pe=Me[u],Ie=xe[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(pt,yt){return/%$/.test(pt)&&yt===We?parseFloat(pt)/100:(/%$/.test(pt),parseFloat(pt))}),Qe===u&&Ie.push(1),Ae=Ie[We]===void 0?1:Ie[We],Ie=Ie.slice(0,We),pe[u]=function(){return Ie}}else if(/^#[A-Fa-f0-9]+$/.test(ne)){var u=ne.replace(/^#/,""),We=u.length;pe=Me.rgb,Ie=u.split(We===3?/(.)/:/(..)/),Ie=Ie.filter(Boolean).map(function(_e){return parseInt(We===3?_e+_e:_e,16)}),Ae=1,pe.rgb=function(){return Ie},Ie[0]||(Ie[0]=0),Ie[1]||(Ie[1]=0),Ie[2]||(Ie[2]=0)}else pe=Me.keyword,pe.keyword=function(){return ne},Ie=ne,Ae=1;var Y={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{Y.rgb=pe.rgb(Ie)}catch{}try{Y.hsl=pe.hsl(Ie)}catch{}try{Y.hsv=pe.hsv(Ie)}catch{}try{Y.cmyk=pe.cmyk(Ie)}catch{}try{Y.keyword=pe.keyword(Ie)}catch{}return Y.rgb&&(Y.hex="#"+Y.rgb.map(function(pt){var yt=pt.toString(16);return yt.length===1?"0"+yt:yt}).join("")),Y.rgb&&(Y.rgba=Y.rgb.concat(Ae)),Y.hsl&&(Y.hsla=Y.hsl.concat(Ae)),Y.hsv&&(Y.hsva=Y.hsv.concat(Ae)),Y.cmyk&&(Y.cmyka=Y.cmyk.concat(Ae)),Y},lu}var Yf=Xf();const Jf=nd(Yf),Hf=Me=>{if(!Me||typeof Me!="string")return"black";const ne=Jf(Me).rgb;return ne?(ne[0]*299+ne[1]*587+ne[2]*114)/1e3>125?"black":"white":"black"},jl=[];if(typeof window<"u"){const Me=()=>jl.forEach(ne=>ne());window.addEventListener("scroll",Me),window.addEventListener("resize",Me)}if(typeof IntersectionObserver<"u"){const Me=new Map;new IntersectionObserver((ne,xe)=>{ne.forEach(pe=>{const Ie=Me.get(pe.target),Ae=jl.indexOf(Ie);pe.isIntersecting?Ae===-1&&jl.push(Ie):(Ie(),Ae!==-1&&jl.splice(Ae,1))})},{rootMargin:"400px 0px"})}var Kf=Pa('<mark role="presentation"><!></mark>');function cu(Me,ne){Ao(ne,!1);const xe=ca();let pe=lt(ne,"color",8,"lightgrey"),Ie=lt(ne,"nowrap",8,!0);Nr(()=>yi(pe()),()=>{jr(xe,Hf(pe()))}),ql(),Eo();var Ae=Kf();let Qe,u;var We=du(Ae);Gl(We,ne,"default",{}),pu(Ae),uu(Y=>{Qe=_f(Ae,1,"em svelte-usg3es",null,Qe,Y),u=yf(Ae,"",u,{"background-color":pe(),color:Xt(xe)})},[()=>({nowrap:Ie()})],id),Fr(Me,Ae),zo()}var Qf=Pa("<h1>Abbott Barton Barn</h1> <p>The area outlined in blue in the map below shows the area which is closest to the Abbott's Barton barn when considering local shops. The corresponded grey area is the smallest areas which the Office for National Statistics has data for. The areas chosen are the ones where the population weighted centroid falls into the blue area.</p> <!> <!> <!> <!> <!>",1);function lm(Me){var ne=Qf(),xe=Ea(xn(ne),4);cu(xe,{color:"#22d0b6",children:(u,We)=>{tu();var Y=eu("Post offices");Fr(u,Y)},$$slots:{default:!0}});var pe=Ea(xe,2);cu(pe,{color:"#27a0cc",children:(u,We)=>{tu();var Y=eu("Shops");Fr(u,Y)},$$slots:{default:!0}});var Ie=Ea(pe,2);cu(Ie,{color:"#f66068",children:(u,We)=>{tu();var Y=eu("Abbott's Barton barn");Fr(u,Y)},$$slots:{default:!0}});var Ae=Ea(Ie,2);Uf(Ae);var Qe=Ea(Ae,2);qf(Qe,{}),Fr(Me,ne)}export{lm as component};
